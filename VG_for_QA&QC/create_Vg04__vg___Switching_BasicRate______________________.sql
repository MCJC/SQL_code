/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
/***                                                                                                                                                  ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[vg_04__Switching_BasicRate]                              <<<<<     ***/
/***                                                                                                                                                  ***/
/********************************************************************************************************************************************************/
USE [forum]
GO
/********************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/********************************************************************************************************************************************************/
----------------------------------------------------------------------------------------------------------------------------------------------------------
ALTER  VIEW
               [dbo].[vg_04__Switching_BasicRate]
AS
----------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
----------------------------------------------------------------------------------------------------------------------------------------------------------
       [SBRv_row]
                  =  ROW_NUMBER()
                     OVER(ORDER BY
                            [Nation_fk]     
                          , [Origin_religion_fk]
                          , [Sex_fk]
                          , [Destination_religion_fk] )
     , [Nation_fk]
     , [switching]                = CASE
                                       WHEN    O.[Pew_RelL02_Display]
                                             = D.[Pew_RelL02_Display]
                                       THEN
                                                  'no_switching_'
                                               +  D.[Pew_RelL02_Display]
                                                + '_'
                                                + SUBSTRING(S.[Sex], 1, 2)
                                       WHEN    O.[Pew_RelL02_Display]
                                            <> D.[Pew_RelL02_Display]
                                       THEN
                                                  O.[Pew_RelL02_Display]
                                                + '_to_'
                                                + D.[Pew_RelL02_Display]
                                                + '_'
                                                + SUBSTRING(S.[Sex], 1, 2)
                                     END
     , [Switch_Pct]
----------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM
----------------------------------------------------------------------------------------------------------------------------------------------------------
       [Pew_Nation_Religion_Switching_Base_Rate]    R
     , [Pew_Religion_Group]                         O
     , [Pew_Religion_Group]                         D
     , [Pew_Sex]                                    S
----------------------------------------------------------------------------------------------------------------------------------------------------------
WHERE
        O.[Religion_group_pk]
     =  R.[Origin_religion_fk]
  AND
        D.[Religion_group_pk]
     =  R.[Destination_religion_fk]
  AND
        S.[Sex_pk]
     =  R.[Sex_fk]
  AND
        R.[Switch_Pct]
     <> 0
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
