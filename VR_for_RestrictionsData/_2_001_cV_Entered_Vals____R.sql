/***************************************************************************************************************************************************************/
Print '--- '+CONVERT(VARCHAR(19),SYSDATETIME())+' ==>  script 2.001    ---------------------------------------------------------------------------------------- '
/***************************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v01_EnteredValues]                                     <<<<<     ***/
/***             (all new currently enetered values)                                                                                            ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
USE              [GRSHRcode]
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#vars')                        IS NOT NULL
DROP TABLE              #vars
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/***  view [EnteredValues] ************************************************************************************************************************/
/**************************************************************************************************************************************************/
declare @CODEnew nvarchar(max)
set     @CODEnew = 
/**************************************************************************************************************************************************/
                                                       /*** >>>    ...                                                                          ***/
 N'
ALTER VIEW     [v01_EnteredValues]
AS
      SELECT
               G.[RowID]
             , G.[Question_Year]
             , G.[Nation_fk]
             , G.[Ctry_EditorialName]
             ' +
/**************************************************************************************************************************************************/
(           SELECT ', ' + [QAS] FROM [AT_Qs]           /*** >      Begin selection (into text, in a cell, comma delimited list of varnames)     ***/
                             FOR XML PATH('')    )     /*** <      End of the selection, nesting all cells into an XML string cell              ***/
/**************************************************************************************************************************************************/
+N'                FROM [GRI_Ctry]   G
                      , [SHI_Ctry]   S
                      , [Sources]    X
                  WHERE
                         G.[Nation_fk]
                       = S.[Nation_fk]
                    AND
                         G.[Nation_fk]
                       = X.[Nation_fk]        '
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEnew                        /***        display the currently stored code (to be executed)                           ***/
	EXEC              (@CODEnew)                       /***        execute the code that has been stored as text                                ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
Print                    '------------------------------------------------------------------------------------------------------------------------------------- '
/***************************************************************************************************************************************************************/
GO