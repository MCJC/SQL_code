/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V5_Basic&Index]                                                         <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V6_Basic&Index]
AS
/***************************************************************************************************************************************************************/
/***  Begining of select statement (values by country)  ********************************************************************************************************/
/***************************************************************************************************************************************************************/
SELECT 
/*** variables NOT changing though time ************************************************************************************************************************/
       [Nation_fk]
      ,[Country_fk]
      ,[Ctry_EditorialName]
      ,[GDP_per_capita]
      ,[Region5]
      ,[Region6]
      ,[SubRegion]
      ,[IMF_Advance]
      ,[Global_NS]
      ,[UN_Reg1]
      ,[UN_Reg2]
      ,[UN_Develop]
/*** population variables CAN CHANGE though time ***************************************************************************************************************/
      ,[Pop2000]
      ,[Pop2010]
      ,[Pop2012]
/*** index values SHOULD BE ADDED EACH YEAR ********************************************************************************************************************/
      ,[GRI_2007]
      ,[GRI_2008]
      ,[GRI_2009]
      ,[GRI_2010]
      ,[GRI_2011]
      ,[GRI_2012]
      ,[SHI_2007]
      ,[SHI_2008]
      ,[SHI_2009]
      ,[SHI_2010]
      ,[SHI_2011]
      ,[SHI_2012]
      ,[GFI_2007]
      ,[GFI_2008]
      ,[GFI_2009]
      ,[GFI_2010]
      ,[GFI_2011]
      ,[GFI_2012]
/***************************************************************************************************************************************************************/
FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
/*** variables NOT changibng though time ***********************************************************************************************************************/
       [Nation_pk]                 AS Nation_fk
      ,[Country_fk]
      ,N.[Ctry_EditorialName]
      ,[GDP_per_capita]
      ,[Region]                    AS Region5
      ,[SubRegion6]                AS Region6
      ,[SubRegion]
      ,[IMF_Advance]
      ,[Global_NS]
      ,[UN_Reg1]
      ,[UN_Reg2]
      ,[UN_Develop]
/*** population variables CAN CHANGE though time ***************************************************************************************************************/
      ,S1.[Cnt]                    AS Pop2000
      ,S2.[Cnt]                    AS Pop2010
      ,S3.[Cnt]                    AS Pop2012
/*** sources for the query (some repeated for different years) *************************************************************************************************/
  FROM 
       [forum].[dbo].[Pew_Nation]                N
     , [forum].[dbo].[Pew_Nation_Age_Sex_Value]  S1
     , [forum].[dbo].[Pew_Field]                 F1
     , [forum].[dbo].[Pew_Nation_Age_Sex_Value]  S2
     , [forum].[dbo].[Pew_Field]                 F2
     , [forum].[dbo].[Pew_Nation_Age_Sex_Value]  S3
     , [forum].[dbo].[Pew_Field]                 F3
/*** filters and matching conditions ***************************************************************************************************************************/
 WHERE 
       S1.[Nation_fk]   =     [Nation_pk]
   AND S2.[Nation_fk]   =     [Nation_pk]
   AND S3.[Nation_fk]   =     [Nation_pk]
   AND S1.[Field_fk]    =  F1.[Field_pk]
   AND S2.[Field_fk]    =  F2.[Field_pk]
   AND S3.[Field_fk]    =  F3.[Field_pk]
   AND S1.[Age_fk]      =  0
   AND S1.[Sex_fk]      =  0
   AND S2.[Age_fk]      =  0
   AND S2.[Sex_fk]      =  0
   AND S3.[Age_fk]      =  0
   AND S3.[Sex_fk]      =  0
   AND F1.[Field_year]  =  '2000'
   AND F2.[Field_year]  =  '2010'
   AND F3.[Field_year]  =  '2012'
/***************************************************************************************************************************************************************/
)                                                                                                                                           AS      M  /* MAIN */
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
/*** query with most current index values should be added here to be joined ************************************************************************************/
/***************************************************************************************************************************************************************/
(
/*** index values for 2012 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2012_pk
      ,[GRI]                    AS GRI_2012
      ,[SHI]                    AS SHI_2012
      ,[GFI]                    AS GFI_2012
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2012
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2012   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2012_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2011 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2011_pk
      ,[GRI]                    AS GRI_2011
      ,[SHI]                    AS SHI_2011
      ,[GFI]                    AS GFI_2011
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2011
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2011   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2011_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2010 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2010_pk
      ,[GRI]                    AS GRI_2010
      ,[SHI]                    AS SHI_2010
      ,[GFI]                    AS GFI_2010
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2010
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2010   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2010_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2009 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2009_pk
      ,[GRI]                    AS GRI_2009
      ,[SHI]                    AS SHI_2009
      ,[GFI]                    AS GFI_2009
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2009
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2009   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2009_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2008 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2008_pk
      ,[GRI]                    AS GRI_2008
      ,[SHI]                    AS SHI_2008
      ,[GFI]                    AS GFI_2008
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2008
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2008   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2008_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2007 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2007_pk
      ,[GRI]                    AS GRI_2007
      ,[SHI]                    AS SHI_2007
      ,[GFI]                    AS GFI_2007
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2007
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2007   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2007_pk
/***************************************************************************************************************************************************************/
