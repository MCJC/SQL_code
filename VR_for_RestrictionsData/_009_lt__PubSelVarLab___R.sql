/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 009    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrp__01_lab_SelDataBYCtry&Year]                         <<<<<     ***/
/***             This table has Stata statements for labeling variables included in dataset for public download                                              ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
ALTER  VIEW                      [dbo].[vrp__01v]        AS
SELECT * FROM
(
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
   SELECT
 	    [k]           =  ROW_NUMBER() OVER(ORDER BY [Question_Abbreviation_Std])
	  , [rowforlabel] = 
	                       ''label var  '' 
                        +                                                  Q.[attr]
                        +  RIGHT(''                           "'', (33-LEN(Q.[attr])))
                        +                                                  L.[attr]
                        +  ''"  ''
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
    FROM
                          [forum]..[Pew_Question_Std]                S 
  INNER JOIN
             ( SELECT * FROM [forum]..[Pew_Question_Attributes] WHERE [attk] = ''In_PubDataSet'' )   Q    ON S.[Question_Std_pk] = Q.[Question_Std_fk]
   LEFT JOIN
             ( SELECT * FROM [forum]..[Pew_Question_Attributes] WHERE [attk] = ''80CharsLabel''  )   L    ON S.[Question_Std_pk] = L.[Question_Std_fk]
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
)  SETA
'
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/*** checking / executing SQL statement that has been stored as a string variable ******************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                                 /***        display the currently stored code (to be executed)               ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
	EXEC              (@ALLCODE)                                                /***        execute the code that has been stored as text                    ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/








/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrp__01v_labSelDataBYCtry&Year]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrp__01v_labSelDataBYCtry&Year]
SELECT * INTO    [forum_ResAnal].[dbo].[vrp__01v_labSelDataBYCtry&Year]
            FROM                 [dbo].[vrp__01v]
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
--	SELECT* FROM [forum_ResAnal].[dbo].[vrp__01_lab_SelDataBYCtry&Year]
/***************************************************************************************************************************************************************/
