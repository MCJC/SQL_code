/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 014    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***           >>>>>         This script creates a lookup table [forum_ResAnal].[dbo].[vr___09_cDB_Basic_TopLines_All]                       <<<<<           ***/
/***                                                                                                                                                         ***/
/***     NOTES:                                                                                                                                              ***/
/***           This view only includes aggregated numeric values                                                                                             ***/
/***                                                                                                                                                         ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @VCODE00 nvarchar(max)
declare @VCODE01 nvarchar(max)
declare @VCODE02 nvarchar(max)
declare @VCODE03 nvarchar(max)
declare @VCODE04 nvarchar(max)
declare @VCODE05 nvarchar(max)
declare @VCODE06 nvarchar(max)
declare @VCODE07 nvarchar(max)
declare @VCODE08 nvarchar(max)
declare @VCODE09 nvarchar(max)
declare @VCODE10 nvarchar(max)
declare @VCODE11 nvarchar(max)
declare @VCODE12 nvarchar(max)
declare @VCODE13 nvarchar(max)
declare @VCODE14 nvarchar(max)
declare @VCODE15 nvarchar(max)
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set @vCODE00 = 
/***************************************************************************************************************************************************************/
/*   >    00    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S00    -- "alter view" statement ---------------------------------------------------------------------------------------------------------------------*/
/*--->   S001   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

alter VIEW [dbo].[vr___09_] AS

'
/*---<   S001   -----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S00    -- "alter view" statement ---------------------------------------------------------------------------------------------------------------------*/
/*   <    00    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE01 = 
/***************************************************************************************************************************************************************/
/*   >    01    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S01    -- Selected Data from long set ----------------------------------------------------------------------------------------------------------------*/
/*--->   S011   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

WITH   CTE01
AS
      (
          SELECT
                 [Q_Year]    =                  CAST(D.[Question_Year] AS VARCHAR)
                ,[QS_fk]     =                         [QSk]
                ,[Variable]  = CASE
                                   WHEN                [QA_std]     LIKE ''%_ny%'' 
                                    AND                [QA_std] NOT LIKE ''%_ny'' 
                                   THEN STUFF(         [QA_std]      ,         
                                   ((CHARINDEX(''_ny'',  [QA_std])) + 3) , 1, '''')
                                   ELSE                [QA_std]
                               END
                ,[Q_Wording] =                         [QW_std]
                ,[Value]     = CASE
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2)) > 1)
                                      AND(             [QA_std] LIKE ''GRI_19_''              +''[bcdefx]''
                                                    OR [QA_std] LIKE ''SHI_0''  +''[1,4,5]''+''_''+''[bcdefx]''  )
                                   THEN    ''1.00''
                                   ELSE         ISNULL([Answer_value], ''0.00'')
                               END
                ,[A_Wording] = CASE
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2))  = 0)
                                      AND(             [QA_std] LIKE ''GRI_19_''              +''[bcdefx]''
                                                    OR [QA_std] LIKE ''SHI_0''  +''[1,4,5]''+''_''+''[bcdefx]''  )
                                   THEN    ''No cases were found''
                                   WHEN
                                           (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2)) >= 1)
                                      AND(             [QA_std] LIKE ''GRI_19_''              +''[bcdefx]''
                                                    OR [QA_std] LIKE ''SHI_0''  +''[1,4,5]''+''_''+''[bcdefx]''  )
                                   THEN    ''1+ cases were found''
                                   ELSE    [answer_wording_std]
                               END
                ,[CntWg]
                ,[WTWg]
            FROM [vr___06_cDB_LongData_ALL_byCYQ] D
               , [vr___08_cDB_Weights_f_TopLines] W
           WHERE          D.[Nation_fk]
                        = W.[Nation_fk]
             AND          D.[Question_Year]
                        = W.[Question_Year]
             AND          D.[Locality]
                       IN            (
                                        ''aggregated by country''
                                      , ''not detailed''           )
             AND          D.[QA_std] NOT IN   (''GFI'', ''GRI'', ''SHI'', ''GRI_20_05_x1'')
             AND          D.[QA_std] NOT LIKE ''XSG_S_%''
             AND          D.[QA_std] NOT LIKE ''%_d''+''[a,b]''
             AND          D.[QA_std] NOT LIKE ''%_rd_1d''
      )

'
/*---<   S011    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S01    -- Selected Data from long set ----------------------------------------------------------------------------------------------------------------*/
/*   <    01    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE02 = 
/***************************************************************************************************************************************************************/
/*   >    02    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S02    -- Aggregated data by C & Y -------------------------------------------------------------------------------------------------------------------*/
/*--->   S021   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE02
AS
      (
                SELECT
                        DISTINCT
                        [NumYr]          = [Question_Year]
                      , [TxtYr]          = CAST(               [Question_Year]   AS VARCHAR)
                      , [Nations]        = CAST(COUNT(DISTINCT [Nation_fk]    )  AS VARCHAR)
                 FROM   [vr___06_cDB_LongData_ALL_byCYQ]
                WHERE   [Nation_fk] < 1000
             GROUP BY   [Question_Year]
      )

'
/*---<   S021    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S02    -- Aggregated data by C & Y -------------------------------------------------------------------------------------------------------------------*/
/*   <    02    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE03 = 
/***************************************************************************************************************************************************************/
/*   >    03    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S03    -- Aggregated data by C/Y/Q/A -----------------------------------------------------------------------------------------------------------------*/
/*--->   S031   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE03
AS
      (
          SELECT
                 [RYCNT]       = ''N'' + [Q_Year]
                ,[RYPCT]       = ''P'' + [Q_Year]
                ,[Variable]
                ,[Value]
                ,[Number]      =     SUM([CntWg])
                ,[Percentage]  =     SUM([WTWg])
           FROM   
                 [CTE01]
        GROUP BY
                 [Q_Year]
                ,[Variable]
                ,[Value]
      )


'
/*---<   S031    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S03    -- Aggregated data by C/Y/Q/A -----------------------------------------------------------------------------------------------------------------*/
/*   <    03    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE04 = 
/***************************************************************************************************************************************************************/
/*   >    04    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S04    -- Headings and other static rows by table by arranging field names and other elements to be used as code -------------------------------------*/
/*--->   S041   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE04
AS
      (
          SELECT
                [M]
              , [x]  = ''['' + [M] + ''] = STR(ISNULL(MAX(['' + [M] + [F]
              , [v]  = ''['' + [M] + '']''
              , [s]  = SUBSTRING([M],2,2) +''|''+ RIGHT([M],4) +''|''+ LEFT([M],1)
              , [a]  = SUBSTRING([M],2,2)
              , [y]  =                          RIGHT([M],4)
              , [f]  =                                             LEFT([M],1)
              , [e]  = ''''
              , [d]  = CASE
                       WHEN  LEFT([M], 1  )  = ''N''
                       AND  RIGHT([M], 4  )  = 2007
                       THEN                         ''baseline year,''
                       WHEN  LEFT([M], 1  )  = ''N''
                       AND  RIGHT([M], 4  )  = (SELECT ((MAX([NumYr])) - 1 ) FROM [CTE02] )
                       THEN                         ''previous year,''
                       WHEN  LEFT([M], 1  )  = ''N''
                       AND  RIGHT([M], 4  )  = (SELECT ((MAX([NumYr]))     ) FROM [CTE02] )
                       THEN                         ''latest year,''
                       WHEN  LEFT([M], 1  )  = ''N''
                       THEN                         ''year''
                       ELSE '' ending''
                        END
              , [p]  = CASE
                       WHEN  LEFT([M], 1  )  = ''N''
                       AND  RIGHT([M], 4  ) <  2011
                       THEN                         ''JUN ''
                       WHEN  LEFT([M], 1  )  = ''N''
                       AND  RIGHT([M], 4  ) >= 2011
                       THEN                         ''DEC ''
                       ELSE RIGHT([M], 4  )
                        END
              , [n]  = [N]
              , [c]  = ''COUNTRIES''
              , [t]  = [T]
              , [l]  = 
      ''--------------------------------------------------------------------------------------------------------------------------------------------------------''
       FROM (
'
/*---<   S041    ----------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S042   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'
             SELECT
                      DISTINCT
                      [M] = [RYPCT]
                    , [N] = ''  %  OF  ''
                    , [T] = ''100 %''
                    , [F] = '']),0),12,0)''
               FROM                          [CTE03]
            UNION
            ALL
             SELECT
                      DISTINCT
                      [M] = [RYCNT]
                    , [N] = ''NUMBER OF''
                    , [T] = [Nations]
                    , [F] = '']),0), 3,0)+''''%''''''
               FROM                                          [CTE03]
                                                         ,   [CTE02]
                      WHERE [RYCNT] = ''N'' + [TxtYr]
'
/*---<   S042    ----------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S043   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'
            ) LongReshaped
      )

'
/*---<   S043    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S04    -- Headings and other static rows by table by arranging field names and other elements to be used as code -------------------------------------*/
/*   <    04    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE05 = 
/***************************************************************************************************************************************************************/
/*   >    05    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S05    -- answer wordings ----------------------------------------------------------------------------------------------------------------------------*/
/*--->   S051   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE05
AS
      (
          SELECT
                  DISTINCT
                  [Variable]
                 ,[Q_Wording]
                 ,[Value]
                 ,[A_Wording]
            FROM  [CTE01]
      )

'
/*---<   S051    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S05    -- answer wordings ----------------------------------------------------------------------------------------------------------------------------*/
/*   <    05    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE06 = 
/***************************************************************************************************************************************************************/
/*   >    06    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S06    -- question wordings --------------------------------------------------------------------------------------------------------------------------*/
/*--->   S061   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE06
AS
      (
          SELECT
                  DISTINCT
                  [QS_fk]
                 ,[Variable]
                 ,[Q_Wording]
            FROM  [CTE01]
      )

'
/*---<   S061    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S06    -- question wordings --------------------------------------------------------------------------------------------------------------------------*/
/*   <    06    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE07 = 
/***************************************************************************************************************************************************************/
/*   >    07    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S07    -- 'TopLine label' from question attributes ---------------------------------------------------------------------------------------------------*/
/*--->   S071   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE07
AS
      (
          SELECT
                   [Variable]
                 , [label]     = ISNULL([attr], '''')
            FROM
                   [CTE06]
         LEFT
         JOIN 
                 ( SELECT * FROM [forum]..[Pew_Question_Attributes]
                            WHERE [attk]
                                = ''TopLine label''                     )  ATT7
              ON   [QS_fk]
                 = [Question_Std_fk]
      )

'
/*---<   S071    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S07    -- 'TopLine label' from question attributes ---------------------------------------------------------------------------------------------------*/
/*   <    07    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE08 = 
/***************************************************************************************************************************************************************/
/*   >    08    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S08    -- notes from question attributes -------------------------------------------------------------------------------------------------------------*/
/*--->   S081   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE08
AS
      (
          SELECT
                   [Variable]
                 , [note]      = ISNULL([attr], '''')
            FROM
                   [CTE06]
        LEFT
        JOIN 
                   ( SELECT * FROM [forum]..[Pew_Question_Attributes]
                             WHERE [attk]
                                 = ''XNote01''                           )  ATT8
              ON   [QS_fk]
                 = [Question_Std_fk]
      )

'
/*---<   S081    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S08    -- notes from question attributes -------------------------------------------------------------------------------------------------------------*/
/*   <    08    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
set @vCODE09 = 
/***************************************************************************************************************************************************************/
/*   >    09    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S09    -- ABC ----------------------------------------------------------------------------------------------------------------------------------------*/
/*--->   S091   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'

,      CTE09
AS
      (
          SELECT
                    [V]         = [Variable]
                  , [S]         = ISNULL([attr], '''')
             FROM
                    [CTE06]
             LEFT
             JOIN 
                    ( SELECT * FROM [forum]..[Pew_Question_Attributes]
                              WHERE [attk]
                                  = ''SortKey''                           )  ATT9
                 ON [QS_fk]
                   =[Question_Std_fk]
      )

'
/*---<   S091    ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S09    -- @@@ ----------------------------------------------------------------------------------------------------------------------------------------*/
/*   <    09    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */




set @vCODE11 = 

                 'IF OBJECT_ID  (N''[forum_ResAnal]..[tCTE03]'', N''U'') IS NOT NULL '
               + 'DROP TABLE        [forum_ResAnal]..[tCTE03]  ;'
               +  (@vCODE01)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE02)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE03)                                    /***        ... partial excecution ...                                                   ***/
                   +  '    SELECT * INTO  [forum_ResAnal]..[tCTE03] FROM [CTE03]'
	EXEC              (@vCODE11)                                    /***        ... partial excecution ...                                                   ***/
	


set @vCODE12 = 

                 'IF OBJECT_ID  (N''[forum_ResAnal]..[tCTE04]'', N''U'') IS NOT NULL '
               + 'DROP TABLE        [forum_ResAnal]..[tCTE04]  ;'
               +  (@vCODE01)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE02)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE03)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE04)                                    /***        ... partial excecution ...                                                   ***/
                   +  'SELECT * INTO [forum_ResAnal]..[tCTE04] FROM [CTE04]'
	EXEC              (@vCODE12)                                    /***        ... partial excecution ...                                                   ***/
--	go





/***************************************************************************************************************************************************************/
set @vCODE10 = 
/***************************************************************************************************************************************************************/
/*   >    10    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
/*-  >   S10    -- main body section --------------------------------------------------------------------------------------------------------------------------*/
/*--->   S101   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'


,      CTE10
AS
      (
          SELECT
                  M.Variable
                , M.Value
                ,   Wording   =  L.A_Wording
'
/*---<   S101    ----------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S102   -- "value (pct/count) & year" headings nested in XML string cell in parentesis ----------------------------------------------------------------*/
 (   SELECT ',' + [v] FROM /*e>*/ [tCTE04] /*<e*/ ORDER BY [s] for xml path('')   )
/*---<   S102   -- "value (pct/count) & year" headings nested in XML string cell in parentesis ----------------------------------------------------------------*/
+
/*--->   S103   -----------------------------------------------------------------------------------------------------------------------------------------------*/
N'
FROM
        [CTE05]                                                           L
     INNER
     JOIN
'
/*---<   S103   -----------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S104   -- subquery M ---------------------------------------------------------------------------------------------------------------------------------*/
/*--->   S104.1 -- part 1 of X of subquery M ------------------------------------------------------------------------------------------------------------------*/
N'
     (SELECT
          Variable
        , Value
'
/*---<   S104.1 -- part 1 of X of subquery M ------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S104.2 -- part 2 of X of subquery M: other row of headings nested in XML string cell in parentesis ---------------------------------------------------*/
 (   SELECT ',' + [x] FROM /*e>*/ [tCTE04] /*<e*/ ORDER BY [s] for xml path('')   )
/*---<   S104.2 -- part 2 of X of subquery M: other row of headings nested in XML string cell in parentesis ---------------------------------------------------*/
+
/*--->   S104.3 -- part 3 of X of subquery M ------------------------------------------------------------------------------------------------------------------*/
N'
FROM
                [CTE03]
'
/*---<   S104.3 -- part 3 of X of subquery M ------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S104.4 -- part 4 of X of subquery M: start pivoting percentages --------------------------------------------------------------------------------------*/
N'
  PIVOT   (       MAX([Percentage])
            FOR       [RYPCT]
            IN       (
'
/*---<   S104.4 -- part 4 of X of subquery M: start pivoting percentages --------------------------------------------------------------------------------------*/
+
/*--->   S104.5 -- part 5 of X of subquery M: list of sorted years nested in XML string cell (first comma removed through stuffing  function) -----------------*/
STUFF(
          (
               SELECT   DISTINCT
                        ', [' + [RYPCT] + ']'
                 FROM   [tCTE03]
             ORDER BY
                        ', [' + [RYPCT] + ']'
                                               for xml path('')
          )
      , 1, 1, '')
/*---<   S104.5 -- part 5 of X of subquery M: list of sorted years nested in XML string cell (first comma removed through stuffing  function) -----------------*/
+
/*--->   S104.6 -- part 6 of X of subquery M: end pivoting percentages ----------------------------------------------------------------------------------------*/
N'                       )   )   AS   pivt1       '
/*---<   S104.6 -- part 6 of X of subquery M: end pivoting percentages ----------------------------------------------------------------------------------------*/
+
/*--->   S104.7 -- part 7 of X of subquery M: start pivoting counts -------------------------------------------------------------------------------------------*/
N'
  PIVOT   (       MAX([Number])
            FOR       [RYCNT]
            IN       (
'
/*---<   S104.7 -- part 7 of X of subquery M: start pivoting counts -------------------------------------------------------------------------------------------*/
+
/*--->   S104.8 -- part 8 of X of subquery M: list of sorted years nested in XML string cell (first comma removed through stuffing  function) -----------------*/
STUFF(
          (
               SELECT   DISTINCT
                        ', [' + [RYCNT] + ']'
                 FROM           [tCTE03]
             ORDER BY
                        ', [' + [RYCNT] + ']'
                                               for xml path('')
          )
      , 1, 1, '')
/*---<   S104.8 -- part 8 of X of subquery M: list of sorted years nested in XML string cell (first comma removed through stuffing  function) -----------------*/
+
/*--->   S104.9 -- part 9 of X of subquery M: end pivoting counts ---------------------------------------------------------------------------------------------*/
N'                       )   )   AS   pivt2       '
/*---<   S104.9 -- part 9 of X of subquery M: end pivoting counts ---------------------------------------------------------------------------------------------*/
+
/*--->   S10410 -- part 10 of 10 of subquery M: aggregation statementend to end subquery ----------------------------------------------------------------------*/
N'
  GROUP BY Variable, Value                                                                       )  M 
'
/*---<   S10410 -- part 10 of 10 of subquery M: aggregation statementend to end subquery ----------------------------------------------------------------------*/
/*---<   S104   -- subquery M ---------------------------------------------------------------------------------------------------------------------------------*/
+
/*--->   S105   -----------------------------------------------------------------------------------------------------------------------------------------------*/
  N'
     ON   M.Variable = L.Variable
    AND   M.Value    = L.Value
      )

'
/*---<   S105   -----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-  <   S10    -- main body section --------------------------------------------------------------------------------------------------------------------------*/
/*   <    10    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/
/*                                                                                                                                                             */
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/*                                                                                                                                                             */
/***************************************************************************************************************************************************************/
--set @vCODE11 = 
--/***************************************************************************************************************************************************************/
--/*   >    11    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/*-  >   S11    -- presentation body rows ---------------------------------------------------------------------------------------------------------------------*/
--/*--->   S111   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'

--,      CTE11
--AS
--      (
--          SELECT
--                    [Variable]
--                ,   [Value]
--                ,   [Wording]   =  CASE
--                                      WHEN [Value] = 500
--                                      THEN
--                                            ''---------------------------------------------------''
--                                          + ''---------------------------------------------------''
--                                          + ''--------------------------------------------------''
--                                      ELSE  ''''                                                        END
--'
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis ----------------------------------------------------------------*/
-- (   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   )
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis ----------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--            FROM
--                    [CTE06] /* #QWording*/                                                             Q
--     CROSS
--      JOIN
--                   (
--                     SELECT *
--                       FROM (SELECT  [Value] =  -5.00, [d]     ,[M] FROM [CTE04] /* heading */) H 
--                              PIVOT             (MAX([d]) FOR [M] IN (
--'
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--       UNION ALL
--                     SELECT *
--                       FROM (SELECT  [Value] =  -4.00, [p]     ,[M] FROM [CTE04] /* heading */) H 
--                              PIVOT             (MAX([p]) FOR [M] IN (
--'
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'                                                     ) ) tpivoted '
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--       UNION ALL
--                     SELECT *
--                       FROM (SELECT  [Value] =  -3.00, [n]     ,[M] FROM [CTE04] /* heading */) H 
--                              PIVOT             (MAX([n]) FOR [M] IN (
--'
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'                                                     ) ) tpivoted '
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/

--/*  code scripting checkd until this point --*/


--N'
--       UNION ALL
--       SELECT *
--         FROM (SELECT  [Value] =  -2.00, [c]     ,[M] FROM [CTE04] /* heading */) H 
--                PIVOT               (MAX([c]) FOR [M] IN (
--'
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'                                                     ) ) tpivoted '
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--       UNION ALL
--       SELECT *
--         FROM (SELECT  [Value] = 200.00, [t]     ,[M] FROM [CTE04] /* heading */) H 
--                PIVOT               (MAX([t]) FOR [M] IN (
--'
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'                                                     ) ) tpivoted '
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--       UNION ALL
--       SELECT *
--         FROM (SELECT  [Value] = 500.00, [e]     ,[M] FROM [CTE04] /* heading */) H 
--                PIVOT               (MAX([e]) FOR [M] IN (
--'
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--                                                     ) ) tpivoted '
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--                                                                  )  F
--      )

--'
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-  <   S11    -- presentation body rows ---------------------------------------------------------------------------------------------------------------------*/
--/*   <    11    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
--/***************************************************************************************************************************************************************/
--/*                                                                                                                                                             */
--/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
--/*                                                                                                                                                             */
--/***************************************************************************************************************************************************************/
--set @vCODE12 = 
--/***************************************************************************************************************************************************************/
--/*   >    12    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/*-  >   S12    -- presentation body rows: question wordings ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*--->   S121   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'

--,      CTE12
--AS
--      (
--          SELECT
--                    [Variable]
--                ,   [Value]
--                ,   [Wording]   =  Q_Wording
--'
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis ----------------------------------------------------------------*/
-- (   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   )
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis ----------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--            FROM
--                    [CTE06] /* #QWording*/                                                             Q
--     CROSS
--      JOIN
--                   (
--                     SELECT *
--                       FROM (SELECT  [Value] =  -6.00
----                                  ,[e]
----                                  ,[M]
----                             FROM  [CTE04] /* heading */       )   e
--                              PIVOT             (MAX([e]) FOR [M] IN (
--'
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--STUFF((   SELECT ',' + [v] FROM /*e>*/ [#CTE04] /*<e*/ ORDER BY [s] for xml path('')   ),1, 1,'')
--/*---<   S11x   -- "value (pct/count) & year" headings nested in XML string cell in parentesis (1st comma removed) --------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
--/*---<   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--+
--/*--->   S11x   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'
--                                                                  )  F
--      )

--'
--/*---<   S12x    ----------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-  <   S12    -- @@@ ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*   <    12    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
--/***************************************************************************************************************************************************************/
--/*                                                                                                                                                             */
--/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
--/*                                                                                                                                                             */
--/***************************************************************************************************************************************************************/
--set @vCODE13 = 
--/***************************************************************************************************************************************************************/
--/*   >    13    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/*-  >   S13    -- labels ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*--->   S131   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--N'

--,      CTE13
--AS
--      (
--          SELECT
--            Variable
--        ,   Value
--        ,   Wording   =  label
--'
--+

-- (   SELECT ',' + [v] FROM [#CTE04] /* heading */ ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/

--+
--N'
--FROM
--        [CTE07] /* < #QLabel */                                                             Q
--   CROSS
--   JOIN
--     ( SELECT *
--         FROM (  SELECT  [Value] = -7.00
--                        ,[e]
--                        ,[M]
--                   FROM  [CTE04] /* heading */       )   e
--       PIVOT (MAX([e]) FOR [M] IN (
--'
--+

--STUFF((SELECT ',' + [v] FROM [#CTE04] /* heading */ ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/

--+
--N'                                                     ) ) tpivoted )  F
--      )

--'
--/*---<   S131    ----------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-  <   S13    -- @@@ ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*   <    13    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
--/***************************************************************************************************************************************************************/
--/*                                                                                                                                                             */
--/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
--/*                                                                                                                                                             */
--/***************************************************************************************************************************************************************/
--set @vCODE14 = 
--/***************************************************************************************************************************************************************/
--/*   >    14    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/*-  >   S14    -- ABC ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*--->   S141   -----------------------------------------------------------------------------------------------------------------------------------------------*/
------- body rows of Q notes to be published  ----
--N'

--,      CTE10
--AS
--      (
--          SELECT
--            Variable
--        ,   Value
--        ,   Wording   =  note
--'
--+

-- (   SELECT ',' + [v] FROM [#CTE04] /* heading */ ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/

--+

--N'
--FROM
--        [CTE08] /* #QNote */                                                            Q
--CROSS
--JOIN
--     ( SELECT *
--         FROM (  SELECT  [Value] = 201.00
--                        ,[e]
--                        ,[M]
--                   FROM  [CTE04] /* heading */       )   e
--       PIVOT (MAX([e]) FOR [M] IN (
--'
--+

--STUFF((SELECT ',' + [v] FROM [#CTE04] /* heading */ ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/

--+
--N'
--                                                     ) ) tpivoted )  F 
--      )

--'
--/*---<   S141    ----------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-  <   S14    -- @@@ ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*   <    14    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
--/***************************************************************************************************************************************************************/
--/*                                                                                                                                                             */
--/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
--/*                                                                                                                                                             */
--/***************************************************************************************************************************************************************/
--set @vCODE15 = 
--/***************************************************************************************************************************************************************/
--/*   >    15    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/*-  >   S15    -- view content to be altered/created ---------------------------------------------------------------------------------------------------------*/
--/*--->   S151   -----------------------------------------------------------------------------------------------------------------------------------------------*/



--N'


--SELECT
--          vx1Row
--          =  ROW_NUMBER()
--             OVER(ORDER BY
--                             [S]
--                           , [Variable]
--                           , [Value]
--                                          )
--        , Variable
--        , Value
--        , Wording
--'
--+   -----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- (   SELECT ',' + [v] FROM [#CTE04] /* heading */ ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
--+   -----------------------------------------------------------------------------------------------------------------------------------------------------------------
--N'
--FROM
--     (           SELECT * FROM [CTE10]
--       UNION ALL SELECT * FROM [CTE11]
--       UNION ALL SELECT * FROM [CTE12]
--       UNION ALL SELECT * FROM [CTE13]
--       UNION ALL SELECT * FROM [CTE14]  )   U
--LEFT JOIN                      [CTE09]      S
--       ON     [V] = [Variable]


--'
--/*---<   S141    ----------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-  <   S14    -- @@@ ----------------------------------------------------------------------------------------------------------------------------------------*/
--/*   <    14    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
--/***************************************************************************************************************************************************************/
--/*                                                                                                                                                             */
--/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
--/*                                                                                                                                                             */
--/***************************************************************************************************************************************************************/
--set @ALLCODE = 
--/***************************************************************************************************************************************************************/
--/*   >   ALL    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/*-  >   ALL1   -----------------------------------------------------------------------------------------------------------------------------------------------*/










--/***************************************************************************************************************************************************************/
--set     @ALLCODE = 
--/***     >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>     ***/
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
--        @CODEBEG                                                    /***                - initial code -                                                     ***/
--    +   @MYCODE1                                                    /***   NPR          [vr_01w_DB_Long_NoAggregated]            ------>     170,623         ***/
--    + N'UNION ALL'                                                  /***                - link -                                                             ***/
--    +   @MYCODE2                                                    /***   PDAbC       *Province, aggregated by Country          ------>      27,608         ***/
--    + N'UNION ALL'                                                  /***                - link -                                                             ***/
--    +   @MYCODE3                                                    /***   ACVbC       *Calculated & Aggregated variables        ------>      78,908         ***/
--    + N'UNION ALL'                                                  /***                - link -                                                             ***/
--    +   @MYCODE4                                                    /***   uIbCR       *Country & Region (unrounded) indexes     ------>       4,398         ***/
--    + N'UNION ALL'                                                  /***                - link -                                                             ***/
--    +   @MYCODE5                                                    /***   RIbCR       *Country & Region rounded indexes (.X)    ------>       4,398         ***/
--    +   @ENDCODE                                                    /***                - final code -                                                       ***/
--                                                                    /***                                                                     285,935         ***/
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
--/***     <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<     ***/


--/*---<   ALL1   -----------------------------------------------------------------------------------------------------------------------------------------------*/
--/*   <   ALL    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
--/***************************************************************************************************************************************************************/
--/*                                                                                                                                                             */
--/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
--/*                                                                                                                                                             */
--/***************************************************************************************************************************************************************/





--  IF OBJECT_ID('tempdb..[#MySQLCode]') IS NOT NULL
--  DROP TABLE            [#MySQLCode]



set @vCODE13 = 
 
 
 
                  (@vCODE00)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE01)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE02)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE03)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE04)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE05)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE06)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE07)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE08)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE09)                                    /***        ... partial excecution ...                                                   ***/
               +  (@vCODE10)                                    /***        ... partial excecution ...                                                   ***/


                   +  'select * from CTE10'



--	--EXEC              (@vCODE02)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE03)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE04)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE05)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE06)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE07)                                    /***        ... partial excecution ...                                                   ***/




--	--EXEC              (@vCODE00)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE01)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE02)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE03)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE04)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE05)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE06)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE07)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE08)                                    /***        ... partial excecution ...                                                   ***/
--	--EXEC              (@vCODE09)                                    /***        ... partial excecution ...                                                   ***/
	EXEC              (@vCODE13)                                    /***        ... partial excecution ...                                                   ***/

	--select * from CTE09









/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--	EXEC dbo.LongPrint @VCODE00                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE01                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE02                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE03                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE04                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE05                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE06                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE07                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE08                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE09                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE10                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE11                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE12                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE13                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @VCODE14                                     /***        display                                                                      ***/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display                                                                      ***/
--/***************************************************************************************************************************************************************/
--/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
--/***                                                                                                                                                         ***/
----		EXEC  (@ALLCODE)
--/***                                                                                                                                                         ***/
--/***************************************************************************************************************************************************************/
--GO

----/***************************************************************************************************************************************************************/
----GO
----/***************************************************************************************************************************************************************/








--/***************************************************************************************************************************************************************/
--IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr___09_cDB_Basic_TopLines_All]', N'U') IS NOT NULL
--DROP TABLE       [forum_ResAnal].[dbo].[vr___09_cDB_Basic_TopLines_All]
--SELECT * INTO    [forum_ResAnal].[dbo].[vr___09_cDB_Basic_TopLines_All]
--            FROM                 [dbo].[vr___09_]
--/***************************************************************************************************************************************************************/
--GO
--/***************************************************************************************************************************************************************/
----	SELECT* FROM [forum_ResAnal].[dbo].[vr___09_cDB_Basic_TopLines_All] WHERE [QA_std] IS NULL
--/***************************************************************************************************************************************************************/


