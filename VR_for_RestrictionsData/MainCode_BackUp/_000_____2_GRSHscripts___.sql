/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/    
/*** --------------                                      files involved in: Restrictions Data processing                                      -------------- ***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _001_lt__NatLocTOOL_____R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 001    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>         This script creates a lookup table of countries and the locality used for coding events                        <<<<<     ***/
/***                                                                                                                                            ***/
/***                                               > > >     lookup tables  work faster     < < <                                               ***/
/**************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/**************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr___0______NationLocalityTOOL]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr___0______NationLocalityTOOL]
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT * 	INTO [forum_ResAnal].[dbo].[vr___0______NationLocalityTOOL]
FROM
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*** Set of data at country/province level ********************************************************************************************************/
SELECT
           distinct
          [Nation_fk]     = N.[Nation_pk]
      ,   [Locality_fk]   = L.[Locality_pk]
      , L.[Locality]
  FROM [forum].[dbo].[Pew_Q&A]               Q
      ,[forum].[dbo].[Pew_Locality]          L
      ,[forum].[dbo].[Pew_Nation]            N
      ,[forum].[dbo].[Pew_Locality_Answer]   KL
WHERE Q.[Answer_fk]   = KL.[Answer_fk]
  AND L.[Locality_pk] = KL.[Locality_fk]
                                /* No need of change in order to keep consistency of 2012: 
                                   Data by Province currently belonging to South Sudan
                                   should considered data for Sudan before 2010             */
  AND N.[Nation_pk]   =  L.[Nation_fk]
                                /* In order to avoid changing the final set,
                                   Data previously used for Northern Cyprus
                                   should be excluded                                       */
                                /* Although we have REAL data by province for North Korea,
                                   we will not use them in this analysis                    */
                                /* Pull only data on Restrictions                           */
  AND Q.[Pew_Data_Collection] = 'Global Restriction on Religion Study'
  AND Q.[Question_Year] = 2012
                                /* redundant filters                                        */
  AND
    (    Q.[Question_abbreviation_std]   LIKE 'GRI_19_[b-f]'
      OR Q.[Question_abbreviation_std]   LIKE 'SHI_0[1, 4, 5]_[b-f]'   )
/******************************************************************************************************** Set of data at country/province level ***/
) AS CPL
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _002_lt__QstRelTOOL_____R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 002    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>         This script creates a lookup table of questions on specific religion groups including groups' ID               <<<<<     ***/
/***                                                                                                                                            ***/
/***                                               > > >     lookup tables  work faster     < < <                                               ***/
/**************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/**************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr___0______QuestnReligionTOOL]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr___0______QuestnReligionTOOL]
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT * 	INTO [forum_ResAnal].[dbo].[vr___0______QuestiReligionTOOL]
FROM
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*** Set of data at country/religious group level *************************************************************************************************/
SELECT
           DISTINCT
           Religion_fk = G.[Religion_group_pk]
      ,    Religion    = G.[Pew_religion]
      ,    QA_std      = Q.[Question_abbreviation_std]
      ,    QW_std      = Q.[Question_short_wording_std]
  FROM [forum].[dbo].[Pew_Q&A]                      Q
      ,[forum].[dbo].[Pew_Nation]                   N
      ,[forum].[dbo].[Pew_Religion_Group]           G
      ,[forum].[dbo].[Pew_Nation_Religion_Answer]   KR
WHERE Q.[Answer_fk]           = KR.[Answer_fk]
  AND KR.[Religion_group_fk]  =  G.[Religion_group_pk]
  AND  N.[Nation_pk]          = KR.[Nation_fk]
                                /* Pull only data on Restrictions */
  AND Q.[Pew_Data_Collection] = 'Global Restriction on Religion Study'

  AND Q.[Question_Year] = 2012
                                /* redundant filters                                        */
  AND
    (    Q.[Question_abbreviation_std]   LIKE 'GRI_11_%'
      OR Q.[Question_abbreviation_std]   LIKE 'GRI_20_01x%'
      OR Q.[Question_abbreviation_std]   LIKE 'SHI_01_x%'              )
/************************************************************************************************* Set of data at country/religious group level ***/
) AS CRL
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _003_lt__DBLongNoAggr___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 003    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>         This script creates long set of data from the 'Global Restriction on Religion Study'                           <<<<<     ***/
/***                   The long set of data includes numeric values and descriptive wordings for GR&SH R                                        ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/**************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
GO
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[NewTempTab1]'                , N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[NewTempTab1]
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[NewTempTab2]'                , N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[NewTempTab2]
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[NewTempTab3]'                , N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[NewTempTab3]
GO
/**************************************************************************************************************************************************/
ExtractGRSH 'Ctry', '[FORUM]..[Pew_Nation_Answer]'         , '[NewTempTab1]'
GO 
ExtractGRSH 'Prov', '[FORUM]..[Pew_Locality_Answer]'       , '[NewTempTab2]'
GO 
ExtractGRSH 'RGrp', '[FORUM]..[Pew_Nation_Religion_Answer]', '[NewTempTab3]'
GO 
/**************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT *
 INTO                   [vr___01_cDB_Long__NoAggregated]
 FROM
       (
          SELECT * FROM [NewTempTab1]
          UNION ALL 
          SELECT * FROM [NewTempTab2]
          UNION ALL
          SELECT * FROM [NewTempTab3]
                                       ) TempTabs
/*  >   filters  ---------------------------------------------------------------------------------------------------------------------------------*/
WHERE
Ctry_EditorialName                                 != 'North Korea'        /* Excluded from the analysis                                          */
AND
Ctry_EditorialName +'_/_'+ STR(Question_Year, 4,0) != 'South Sudan_/_2010' /* although data are not aggregated for the other part of former Sudan */
AND
QA_std                                 NOT LIKE       '%_d'+ '[a,b]'       /* exclude all da/db counts from 2010                                  */
/*  <   filters  ---------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[NewTempTab1]'                , N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[NewTempTab1]
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[NewTempTab2]'                , N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[NewTempTab2]
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[NewTempTab3]'                , N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[NewTempTab3]
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _004_lt__DBWide_byCnY___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 004    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>         This script creates semi-WIDE set of STORED data from the 'Global Restriction on Religion Study'                            <<<<<     ***/
/***                    -  Data of each row are by country-year                                                                                              ***/
/***                    -  Any wide/semi-wide set of data includes only numeric values for GR&SH R                                                           ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vr___02_cDB_Wide__by_Ctry&Year]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr___02_cDB_Wide__by_Ctry&Year]
SELECT * INTO    [forum_ResAnal].[dbo].[vr___02_cDB_Wide__by_Ctry&Year]
FROM
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Long NPR aggregated by country and null values recoded as zero in known count variables  *****************************************************************/
N'
(
/***************************************************************************************************************************************************************/
SELECT 
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement (notice THERE IS alias for the recoded field           ***/
          DISTINCT                                                              /*** should be distinct to include once each variable name                   ***/
          CASE                                                                  /*** CASE to select two different wordings...                                ***/
          WHEN        [QA_std]     LIKE 'GRI_19_[b-f]'                          /*** when count variables GRI_19                                             ***/
                 OR   [QA_std]     LIKE 'SHI_01_[b-f]'                          /*** or   count variables SHI_01                                             ***/
                 OR   [QA_std]     LIKE 'SHI_04_[b-f]'                          /*** or   count variables SHI_04                                             ***/
                 OR   [QA_std]     LIKE 'SHI_05_[c-f]'                          /*** or   count variables SHI_05                                             ***/
          THEN ', ' + [QA_std] + ' = ISNULL(' + [QA_std] + ', 0)'               /*** as comma delimited code to include null values as ceros                 ***/
          ELSE ', ' + [QA_std]                                                  /*** else comma delimited field for all other QA Std (StdVarName)            ***/
          END                                                                   /*** end of CASE section, used to include two different wordings             ***/
    FROM                                                                        /*** from...                                                                 ***/
          [vr___01_cDB_Long__NoAggregated]                                      /*** name of the table which includes all field (var) names as rows          ***/
                                                                                /*** NO FILTERS needed                                                       ***/
         ORDER BY                                                               /*** sorting order using exact final field, including:                       ***/
          CASE                                                                  /*** CASE to sort using two different wordings...                            ***/
          WHEN        [QA_std]     LIKE 'GRI_19_[b-f]'                          /*** when count variables GRI_19                                             ***/
                 OR   [QA_std]     LIKE 'SHI_01_[b-f]'                          /*** or   count variables SHI_01                                             ***/
                 OR   [QA_std]     LIKE 'SHI_04_[b-f]'                          /*** or   count variables SHI_04                                             ***/
                 OR   [QA_std]     LIKE 'SHI_05_[c-f]'                          /*** or   count variables SHI_05                                             ***/
          THEN ', ' + [QA_std] + ' = ISNULL(' + [QA_std] + ', 0)'               /*** as comma delimited code to include null values as ceros                 ***/
          ELSE ', ' + [QA_std]                                                  /*** else comma delimited field for all other QA Std (StdVarName)            ***/
          END                                                                   /*** end of CASE, used to sort list of fields by two different wordings      ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  all this from...  ****************************************************************************************************************************************/
N'
FROM ( 
'
/****************************************************************************************************************************************  all this from...  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Long NPR aggregated by country (& religion due to variable names)  ***************************************************************************************/
N'
SELECT 
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
      ,[Answer_value]      = SUM([Answer_value])
  FROM
            [vr___01_cDB_Long__NoAggregated]
GROUP BY
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
)                                                                                                                                                      AS   lnpr
'
/***************************************************************************************  Long NPR aggregated by country (& religion due to variable names)  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
N'
PIVOT
(
  MAX([Answer_value])
  FOR [QA_std]
                   in (
'
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** start listing of variables                                              ***/
/***************************************************************************************************************************************************************/
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement (notice THERE IS alias for the recoded field           ***/
          DISTINCT                                                              /*** should be distinct to include once each variable name                   ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [QA_std]                                                              /*** Fiels including all Q Abb Std (StdVarName)                              ***/
    FROM                                                                        /*** from...                                                                 ***/
          [vr___01_cDB_Long__NoAggregated]                                      /*** name of the table which includes all field (var) names as rows          ***/
                                                                                /*** NO FILTERS needed                                                       ***/
         ORDER BY                                                               /*** sorting order using exact final field, including:                       ***/
          ', '                                                                  /*** comma delimiter                                  -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          [QA_std]                                                              /*** Fiels including all Q Abb Std (StdVarName)       -> as part of sorting  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
                                                                                /*** end of listing of variables                                             ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
N'
)
 )                                                                                                                                                     AS   pivt
  )                                                                                                                                                    AS   berc
'
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--  SELECT @ALLCODE
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
/***************************************************************************************************************************************************************/
EXEC  (@ALLCODE)
/***************************************************************************************************************************************************************/
GO 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _005_lt__DBWnXt_byCnY___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 005    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vr_03w_W&Extras_by_Ctry&Year]                           <<<<<     ***/
/***             This table only includes numeric values aggregated by country/religion & year (does not include descriptive wordings).                      ***/
/***             The table adds calculated variables using the basic variables stored in the database.                                                       ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr___03_cDB_W&Xtra_byCtry&Year]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr___03_cDB_W&Xtra_byCtry&Year]
SELECT * INTO    [forum_ResAnal].[dbo].[vr___03_cDB_W&Xtra_byCtry&Year]
FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
(
/***************************************************************************************************************************************************************/
--*** May need to:
--    Clean XSG_25n27  as rowmax(GRX_25_01_2010 SHX_27_01_2010)
/*** main select statement *************************************************************************************************************************************/
/*** table including numeric values + Step-3 calculated variables **********************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* NOTE: scaled GRI_19_ b to f requested by Peter Henne in 2015 */
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI_19_b, scaled (0 = None, .2 = 1-9 cases, .4 = 10-200 cases, .6 = 201 - 1000 cases, .8 = 1001 - 9999 cases, 1 = 10000+ cases) */
                   GRI_19_b_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_b   >  10000 THEN 1     -- (1   = 10000+      cases)
              WHEN GRI_19_b   >   1000 THEN 0.8   -- ( .8 =  1001 - 9999 cases)
              WHEN GRI_19_b   >    200 THEN 0.6   -- ( .6 =   201 - 1000 cases)
              WHEN GRI_19_b   >     10 THEN 0.4   -- ( .4 =    10 -  200 cases)
              WHEN GRI_19_b   >      0 THEN 0.2   -- ( .2 =     1 -    9 cases)
              WHEN GRI_19_b   =      0 THEN 0.0   -- (0   =  None             )
         END
                                                               ) AS DECIMAL (38,2))
/* GRI_19_c, scaled (0 = None, .2 = 1-9 cases, .4 = 10-200 cases, .6 = 201 - 1000 cases, .8 = 1001 - 9999 cases, 1 = 10000+ cases) */
       ,           GRI_19_c_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_c   >  10000 THEN 1     -- (1   = 10000+      cases)
              WHEN GRI_19_c   >   1000 THEN 0.8   -- ( .8 =  1001 - 9999 cases)
              WHEN GRI_19_c   >    200 THEN 0.6   -- ( .6 =   201 - 1000 cases)
              WHEN GRI_19_c   >     10 THEN 0.4   -- ( .4 =    10 -  200 cases)
              WHEN GRI_19_c   >      0 THEN 0.2   -- ( .2 =     1 -    9 cases)
              WHEN GRI_19_c   =      0 THEN 0.0   -- (0   =  None             )
         END
                                                               ) AS DECIMAL (38,2))
/* GRI_19_d, scaled (0 = None, .2 = 1-9 cases, .4 = 10-200 cases, .6 = 201 - 1000 cases, .8 = 1001 - 9999 cases, 1 = 10000+ cases) */
       ,           GRI_19_d_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_d   >  10000 THEN 1     -- (1   = 10000+      cases)
              WHEN GRI_19_d   >   1000 THEN 0.8   -- ( .8 =  1001 - 9999 cases)
              WHEN GRI_19_d   >    200 THEN 0.6   -- ( .6 =   201 - 1000 cases)
              WHEN GRI_19_d   >     10 THEN 0.4   -- ( .4 =    10 -  200 cases)
              WHEN GRI_19_d   >      0 THEN 0.2   -- ( .2 =     1 -    9 cases)
              WHEN GRI_19_d   =      0 THEN 0.0   -- (0   =  None             )
         END
                                                               ) AS DECIMAL (38,2))
/* GRI_19_e, scaled (0 = None, .2 = 1-9 cases, .4 = 10-200 cases, .6 = 201 - 1000 cases, .8 = 1001 - 9999 cases, 1 = 10000+ cases) */
       ,           GRI_19_e_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_e   >  10000 THEN 1     -- (1   = 10000+      cases)
              WHEN GRI_19_e   >   1000 THEN 0.8   -- ( .8 =  1001 - 9999 cases)
              WHEN GRI_19_e   >    200 THEN 0.6   -- ( .6 =   201 - 1000 cases)
              WHEN GRI_19_e   >     10 THEN 0.4   -- ( .4 =    10 -  200 cases)
              WHEN GRI_19_e   >      0 THEN 0.2   -- ( .2 =     1 -    9 cases)
              WHEN GRI_19_e   =      0 THEN 0.0   -- (0   =  None             )
         END
                                                               ) AS DECIMAL (38,2))
/* GRI_19_f, scaled (0 = None, .2 = 1-9 cases, .4 = 10-200 cases, .6 = 201 - 1000 cases, .8 = 1001 - 9999 cases, 1 = 10000+ cases) */
       ,           GRI_19_f_scaled
       = CAST ((
         CASE 
              WHEN GRI_19_f   >  10000 THEN 1     -- (1   = 10000+      cases)
              WHEN GRI_19_f   >   1000 THEN 0.8   -- ( .8 =  1001 - 9999 cases)
              WHEN GRI_19_f   >    200 THEN 0.6   -- ( .6 =   201 - 1000 cases)
              WHEN GRI_19_f   >     10 THEN 0.4   -- ( .4 =    10 -  200 cases)
              WHEN GRI_19_f   >      0 THEN 0.2   -- ( .2 =     1 -    9 cases)
              WHEN GRI_19_f   =      0 THEN 0.0   -- (0   =  None             )
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* NOTE: scaled GRI_19_ b to f requested by Peter Henne in 2015 ends here */
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* NOTE: scaled index values based in year 2007 */
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI_scaled index */
      ,  GRI_scaled 
         =        CAST ((
                  CASE
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'low'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 1.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'moderate'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 2.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 3.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'very high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* SHI_scaled index */
      ,  SHI_scaled 
         =        CAST ((
                  CASE
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'low'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 1.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'moderate'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 2.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 3.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'very high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GFI_scaled index */
      ,  GFI_scaled 
         =        CAST ((
                  CASE
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'low'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 1.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'moderate'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 2.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 3.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'very high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI_rounded index */
      ,  GRI_rd_1d 
         =        CAST ((
                                  GRI 
                                                               ) AS DECIMAL (38,1))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* SHI_rounded index */
      ,  SHI_rd_1d 
         =        CAST ((
                                  SHI 
                                                               ) AS DECIMAL (38,1))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GFI_rounded index */
      ,  GFI_rd_1d 
         =        CAST ((
                                  GFI
                                                               ) AS DECIMAL (38,1))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , *

FROM
/***************************************************************************************************************************************************************/
(
/*** table including numeric values + Step-2 calculated variables **********************************************************************************************/
SELECT
/* Indexes wiolll NOT fit previously published data  ----------------------------------------------------------------------------------------------------------*/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI index */
         GRI 
         =
                  CAST ((((
                                [GRI_01]
                         +      [GRI_02]
                         +      [GRI_03]
                         +      [GRI_04]
                         +      [GRI_05]
                         +      [GRI_06]
                         +      [GRI_07]
                         +      [GRI_08_for_index]
                         +      [GRI_09]
                         +      [GRI_10]
                         +      [GRI_11]
                         +      [GRI_12]
                         +      [GRI_13]
                         +      [GRI_14]
                         +      [GRI_15]
                         +      [GRI_16]
                         +      [GRI_17]
                         +      [GRI_18]
                         +      [GRI_19]
                         +      [GRI_20]
                                                       ) / 2    )
                                                                  ) AS DECIMAL (38,32))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* SHI index */
       , SHI 
         =        CAST ((((
                                [SHI_01]
                         +      [SHI_02]
                         +      [SHI_03]
                         +      [SHI_04]
                         +      [SHI_05]
                         +      [SHI_06]
                         +      [SHI_07]
                         +      [SHI_08]
                         +      [SHI_09]
                         +      [SHI_10]
                         +      [SHI_11_for_index]
                         +      [SHI_12]
                         +      [SHI_13]
                                                       ) / 1.3  )
                                                                  ) AS DECIMAL (38,32))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GFI index */
       , GFI 
         =        CAST ((((
                                [GRI_20_01]
                         +      [GRI_20_02]
                         + ( (  [GRI_20_03_a]
                              + [GRI_20_03_b]
                              + [GRI_20_03_c]
                                               ) / 3 )
                         +      [GRI_20_04]
                         +      [GRI_20_05]
                                                       ) / 5 ) 
                                                              * 10
                                                                  ) AS DECIMAL (38,32))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Christianity */
       , XSG_01_xG1 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG1 + SHI_01_xG1 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Islam */
       , XSG_01_xG2 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG2 + SHI_01_xG2 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Buddhism */
       , XSG_01_xG3 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG3 + SHI_01_xG3 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Hinduism */
       , XSG_01_xG4 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG4 + SHI_01_xG4 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Judaism */
       , XSG_01_xG5 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG5 + SHI_01_xG5 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
       , XSG_01_xG6 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG6 + SHI_01_xG6 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Ethnic or Tribal Religions */
       , XSG_01_xG7 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG7 + SHI_01_xG7 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_01_summary_a_ny           for toplines */
       ,           SHI_01_summary_a_ny
       = CAST ((
         CASE 
              WHEN SHI_01     =  0.00
              THEN               0.00
              WHEN SHI_01     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nya
       = CAST ((
         CASE 
              WHEN SHI_01_a   >  0.00
              THEN               1.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyb
       = CAST ((
         CASE 
              WHEN SHI_01_b   >  0.00
              THEN               1.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyc
       = CAST ((
         CASE 
              WHEN SHI_01_c   >  0.00
              THEN               1.03
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyd
       = CAST ((
         CASE 
              WHEN SHI_01_d   >  0.00
              THEN               1.04
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nye
       = CAST ((
         CASE 
              WHEN SHI_01_e   >  0.00
              THEN               1.05
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_nyf
       = CAST ((
         CASE 
              WHEN SHI_01_f   >  0.00
              THEN               1.06
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 XSG_242526_ny           for toplines */
       ,           XSG_242526_ny
       = CAST ((
         CASE WHEN GRX_24     = 0.00
               AND SHX_25     = 0.00
               AND SHX_26     = 0.00
              THEN              0.00
              WHEN GRX_24     > 0.00
                OR SHX_25     > 0.00
                OR SHX_26     > 0.00
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_242526_ny1
       = CAST ((
         CASE WHEN GRX_24     = 0.00
               AND SHX_25     = 0.00
               AND SHX_26     = 0.00
              THEN              NULL
              WHEN GRX_24     = 1.00
                OR SHX_25     = 1.00
                OR SHX_26     = 1.00
              THEN              1.00
              WHEN GRX_24     = 0.67
                OR SHX_25     = 0.67
                OR SHX_26     = 0.67
              THEN              0.67
              WHEN GRX_24     = 0.33
                OR SHX_25     = 0.33
                OR SHX_26     = 0.33
              THEN              0.33
              END
                                                               ) AS DECIMAL (38,2))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 XSG_25n27_ny           for toplines */
       ,           XSG_25n27_ny
       = CAST ((
         CASE WHEN GRX_25_ny  = 0.00
               AND SHX_27_ny  = 0.00
              THEN              0.00
              WHEN GRX_25_ny  = 0.01
                OR SHX_27_ny  = 0.01
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_25n27_ny2
       = CAST ((
         CASE WHEN GRX_25_ny2 = 0.02
                OR SHX_27_ny2 = 0.02
              THEN              0.02
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_25n27_ny3
       = CAST ((
         CASE WHEN GRX_25_ny3 = 0.03
                OR SHX_27_ny3 = 0.03
              THEN              0.03
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------

       , *
FROM
/***************************************************************************************************************************************************************/
(
/*** table including numeric values + Step-1 calculated variables **********************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
         GRI_20
         =        ROUND(
                  CAST ((((
                                [GRI_20_01]
                         +      [GRI_20_02]
                         + ( (  [GRI_20_03_a]
                              + [GRI_20_03_b]
                              + [GRI_20_03_c]
                                               ) / 3 )
                         +      [GRI_20_04]
                         +      [GRI_20_05]
                                                       ) / 5  )
                                                               ) AS DECIMAL (38,2)) ,2)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , GRI_20_top
         =        CAST ((
                  CASE
                  WHEN GRI_20_03_a = 1
                    OR GRI_20_03_b = 1
                    OR GRI_20_03_c = 1
                    OR GRI_20_02   > 0.5
                  THEN               1.00
                  WHEN GRI_20_01   > 0
                    OR GRI_20_02   > 0
                    OR GRI_20_03_a > 0
                    OR GRI_20_03_b > 0
                    OR GRI_20_03_c > 0
                    OR GRI_20_04   > 0
                    OR GRI_20_05   > 0
                  THEN               0.50
                  ELSE               0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , GRI_20_03_top
         =        CAST ((
                  CASE
                  WHEN GRI_20_03_a >= GRI_20_03_b
                   AND GRI_20_03_a >= GRI_20_03_c
                  THEN GRI_20_03_a
                  WHEN GRI_20_03_b >= GRI_20_03_a
                   AND GRI_20_03_b >= GRI_20_03_c
                  THEN GRI_20_03_b
                  WHEN GRI_20_03_c >= GRI_20_03_b
                   AND GRI_20_03_c >= GRI_20_03_c
                  THEN GRI_20_03_c
                  ELSE NULL
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , 
--       select
       SHI_01
         =        CAST ((
                  (
                  CAST ((
                    ( CASE
                      WHEN SHI_01_a > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_b > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_c > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_d > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_e > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_f > 0 THEN 1
                      ELSE                   0
                       END                     )
                                                       
                                                               ) AS DECIMAL (38,2))
                                                                                    / 6 )
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , SHI_01_summary_b
         =        CAST ((
                  (
                  CAST ((
                    ( CASE
                      WHEN SHI_01_a > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_b > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_c > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_d > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_e > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_f > 0 THEN 1
                      ELSE                   0
                       END                     )
                                                       
                                                               ) AS DECIMAL (38,2))
                                                                                    / 6 )
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_01_[a,b,c,d,e,f]_dummy for tables of question answers by country */
       ,           SHI_01_a_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_a   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_b_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_b   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_c_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_c   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_d_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_d   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_e_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_e   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_f_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_f   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Christianity */
       , GRI_11_xG1
         =        CAST ((
                  CASE
                  WHEN   GRI_11_01a
                       + GRI_11_01b
                       + GRI_11_02
                       + GRI_11_03
                       + GRI_11_11
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Islam */
       , GRI_11_xG2 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_04
                       + GRI_11_05
                       + GRI_11_06
                       + GRI_11_12
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Buddhism */
       , GRI_11_xG3 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_07
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Hinduism */
       , GRI_11_xG4 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_08
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Judaism */
       , GRI_11_xG5 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_09
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
       , GRI_11_xG6 
         =        CAST ((
                  CASE
                  WHEN   isnull(GRI_11_10, 0)
                       + isnull(GRI_11_14, 0)
                       + isnull(GRI_11_15, 0)
                       + isnull(GRI_11_16, 0)
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Ethnic or Tribal Religions */
       , GRI_11_xG7
         =        CAST ((
                  CASE
                  WHEN   GRI_11_13
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Christianity */
       , SHI_01_xG1
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_01a
                       + SHI_01_x_01b
                       + SHI_01_x_02
                       + SHI_01_x_03
                       + SHI_01_x_11
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Islam */
       , SHI_01_xG2 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_04
                       + SHI_01_x_05
                       + SHI_01_x_06
                       + SHI_01_x_12
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Buddhism */
       , SHI_01_xG3 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_07
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Hinduism */
       , SHI_01_xG4 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_08
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Judaism */
       , SHI_01_xG5 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_09
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
       , SHI_01_xG6 
         =        CAST ((
                  CASE
                  WHEN   isnull(SHI_01_x_10, 0)
                       + isnull(SHI_01_x_14, 0)
                       + isnull(SHI_01_x_15, 0)
                       + isnull(SHI_01_x_16, 0)
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Ethnic or Tribal Religions */
       , SHI_01_xG7
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_13
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* recode GRI_08 to be used as index-factor */
       , GRI_08_for_index
         =        CAST ((
                  CASE
                  WHEN GRI_08  = 0.5
                  THEN           1
                  ELSE GRI_08
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* recode SHI_Q_11 to be used as index-factor */
       , SHI_11_for_index
         =        CAST ((
                  CASE
                  WHEN SHI_11  = 0.5
                  THEN           1
                  ELSE SHI_11
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_16               for toplines */
       ,           GRI_16_ny
       = CAST ((
         CASE 
              WHEN GRI_16     =  0.00
              THEN               0.00
              WHEN GRI_16     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_16_ny1
       = CAST ((
         CASE 
              WHEN GRI_16     =  0.00
              THEN               NULL
              WHEN GRI_16     >  0.00
              THEN               GRI_16
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_19               for toplines */
       ,           GRI_19_ny
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               0.00
              WHEN GRI_19     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_ny1
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               NULL
              WHEN GRI_19     >  0.00
              THEN               GRI_19
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_19_summ_ny          for toplines */
       ,           GRI_19_summ_ny
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               0.00
              WHEN GRI_19     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_nyb
       = CAST ((
         CASE 
              WHEN GRI_19_b   >  0.00
              THEN               1.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_nyc
       = CAST ((
         CASE 
              WHEN GRI_19_c   >  0.00
              THEN               1.03
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_nyd
       = CAST ((
         CASE 
              WHEN GRI_19_d   >  0.00
              THEN               1.04
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_nye
       = CAST ((
         CASE 
              WHEN GRI_19_e   >  0.00
              THEN               1.05
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_nyf
       = CAST ((
         CASE 
              WHEN GRI_19_f   >  0.00
              THEN               1.06
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_19_x              for toplines */
       ,           GRI_19_x
       =           ISNULL(GRI_19_b, 0)
                 + ISNULL(GRI_19_c, 0)
                 + ISNULL(GRI_19_d, 0)
                 + ISNULL(GRI_19_e, 0)
                 + ISNULL(GRI_19_f, 0)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_04_ny          for toplines */
       ,           SHI_04_ny
       = CAST ((
         CASE 
              WHEN SHI_04     =  0.00
              THEN               0.00
              WHEN SHI_04     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_04_ny1
       = CAST ((
         CASE 
              WHEN SHI_04     =  0.00
              THEN               NULL
              WHEN SHI_04     >  0.00
              THEN               SHI_04
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_05_ny          for toplines */
       ,           SHI_05_ny
       = CAST ((
         CASE 
              WHEN SHI_05     =  0.00
              THEN               0.00
              WHEN SHI_05     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_05_ny1
       = CAST ((
         CASE 
              WHEN SHI_05     =  0.00
              THEN               NULL
              WHEN SHI_05     >  0.00
              THEN               SHI_05
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_07_ny          for toplines */
       ,           SHI_07_ny
       = CAST ((
         CASE 
              WHEN SHI_07     =  0.00
              THEN               0.00
              WHEN SHI_07     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_07_ny1
       = CAST ((
         CASE 
              WHEN SHI_07     =  0.00
              THEN               NULL
              WHEN SHI_07     >  0.00
              THEN               SHI_07
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_01_x              for toplines??? - added on Dec2015  */
       ,           SHI_01_x
       =           ISNULL(SHI_01_b, 0)
                 + ISNULL(SHI_01_c, 0)
                 + ISNULL(SHI_01_d, 0)
                 + ISNULL(SHI_01_e, 0)
                 + ISNULL(SHI_01_f, 0)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22               for toplines */
--     ,           GRX_22_ny1    => this was the former name
       ,           GRX_22_aggreg
       = CAST ((
         CASE WHEN ISNULL(GRX_22   , 9)  = 9
               AND ISNULL(GRX_22_01, 9)  = 9
               AND ISNULL(GRX_22_02, 9)  = 9
               AND ISNULL(GRX_22_04, 9)  = 9
              THEN               NULL
              WHEN ISNULL(GRX_22   , 0)  < 0.66
               AND ISNULL(GRX_22_01, 0)  < 0.66
               AND ISNULL(GRX_22_02, 0)  < 0.66
               AND ISNULL(GRX_22_04, 0)  < 0.66
              THEN              0
              WHEN ISNULL(GRX_22   , 0)  < 1.00
               AND ISNULL(GRX_22_01, 0)  < 1.00
               AND ISNULL(GRX_22_02, 0)  < 1.00
               AND ISNULL(GRX_22_04, 0)  < 1.00
              THEN              0.67
              WHEN GRX_22     = 1.00
                OR GRX_22_01  = 1.00
                OR GRX_22_02  = 1.00
                OR GRX_22_04  = 1.00
              THEN              1.00
--              ELSE 1000                       /*this for checking any value non-recoded*/
              END
                                                               ) AS DECIMAL (38,2))
/* current does not display "NO" -- this would be just a dummy but it has NOT BEEN TESTED: */
---------------------------------------------------------------------------------------------
--       ,           GRX_22_ny
--       = CAST ((
--         CASE WHEN ISNULL(GRX_22   , 9)   = 9
--               AND ISNULL(GRX_22_01, 9)   = 9
--               AND ISNULL(GRX_22_02, 9)   = 9
--               AND ISNULL(GRX_22_04, 9)   = 9
--              THEN               NULL
--              WHEN ISNULL(GRX_22   , 0)   < 0.66
--               AND ISNULL(GRX_22_01, 0)   < 0.66
--               AND ISNULL(GRX_22_02, 0)   < 0.66
--               AND ISNULL(GRX_22_04, 0)   < 0.66
--              THEN              0
--              WHEN ISNULL(GRX_22   , 0)  >= 0.66
--               AND ISNULL(GRX_22_01, 0)  >= 0.66
--               AND ISNULL(GRX_22_02, 0)  >= 0.66
--               AND ISNULL(GRX_22_04, 0)  >= 0.66
--              THEN              0.01
--              END
--                                                               ) AS DECIMAL (38,2))
---------------------------------------------------------------------------------------------
/*                                                         END of CODE -> NOT BEEN TESTED: */
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_01               for toplines */
       ,           GRX_22_01_ny
       = CAST ((
         CASE WHEN GRX_22_01  < 0.66
              THEN              0
              WHEN GRX_22_01 >= 0.66
              THEN              0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_01_ny1
       = CAST ((
         CASE WHEN GRX_22_01  < 0.66
              THEN              NULL
              WHEN GRX_22_01 >= 0.66
              THEN              GRX_22_01
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_02               for toplines */
       ,           GRX_22_02_ny
       = CAST ((
         CASE WHEN GRX_22_02  < 0.66
              THEN              0
              WHEN GRX_22_02 >= 0.66
              THEN              0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_02_ny1
       = CAST ((
         CASE WHEN GRX_22_02  < 0.66
              THEN              NULL
              WHEN GRX_22_02 >= 0.66
              THEN              GRX_22_02
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_03               for toplines */
       ,           GRX_22_03_ny
       = CAST ((
         CASE WHEN GRX_22_03  <  0.66
              THEN               0
              WHEN GRX_22_03 >=  0.66
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_03_ny1
       = CAST ((
         CASE WHEN GRX_22_03  <  0.66
              THEN               NULL
              WHEN GRX_22_03 >=  0.66
              THEN               GRX_22_03
        END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_04               for toplines */
       ,           GRX_22_04_ny
       = CAST ((
         CASE WHEN GRX_22_04  <  0.66
              THEN               0
              WHEN GRX_22_04 >=  0.66
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_04_ny1
       = CAST ((
         CASE WHEN GRX_22_04  <  0.66
              THEN               NULL
              WHEN GRX_22_04 >=  0.66
              THEN               GRX_22_04
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_24               for toplines */
       ,           GRX_24_ny
       = CAST ((
         CASE WHEN GRX_24     =  0
              THEN               0
              WHEN GRX_24     >  0
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_24_ny1
       = CAST ((
         CASE WHEN GRX_24     =  0
              THEN               NULL
              WHEN GRX_24     >  0
              THEN               GRX_24
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_25               for toplines */
       ,           GRX_25_ny
       = CAST ((
         CASE 
              WHEN GRX_25_01  =  0.00
              THEN               0.00
              WHEN GRX_25_01  =  1.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_25_ny2
       = CAST ((
         CASE 
              WHEN GRX_25_02  =  1.00
              THEN               0.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_25_ny3
       = CAST ((
         CASE 
              WHEN GRX_25_03  =  1.00
              THEN               0.03
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHX_25               for toplines */
       ,           SHX_25_ny
       = CAST ((
         CASE WHEN SHX_25     =  0
              THEN               0
              WHEN SHX_25     >  0
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHX_25_ny1
       = CAST ((
         CASE WHEN SHX_25     =  0
              THEN               NULL
              WHEN SHX_25     >  0
              THEN               SHX_25
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHX_26               for toplines */
       ,           SHX_26_ny
       = CAST ((
         CASE WHEN SHX_26     =  0
              THEN               0
              WHEN SHX_26     >  0
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHX_26_ny1
       = CAST ((
         CASE WHEN SHX_26     =  0
              THEN               NULL
              WHEN SHX_26     >  0
              THEN               SHX_26
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHX_27               for toplines */
       ,           SHX_27_ny
       = CAST ((
         CASE 
              WHEN SHX_27_01  =  0.00
              THEN               0.00
              WHEN SHX_27_01  =  1.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHX_27_ny2
       = CAST ((
         CASE 
              WHEN SHX_27_02  =  1.00
              THEN               0.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHX_27_ny3
       = CAST ((
         CASE 
              WHEN SHX_27_03  =  1.00
              THEN               0.03
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , *
FROM
/*** View including numeric values aggregated by country/religion & year ***************************************************************************************/
               [dbo].[vr___02_cDB_Wide__by_Ctry&Year]
/*************************************************************************************** View including numeric values aggregated by country/religion & year ***/
/********************************************************************************************** table including numeric values + Step-1 calculated variables ***/
)                                                                                                                                                       AS NV_S1
/***************************************************************************************************************************************************************/
)                                                                                                                                                       AS NV_S2
/********************************************************************************************** table including numeric values + Step-2 calculated variables ***/
/********************************************************************************************** table including numeric values + Step-3 calculated variables ***/
/************************************************************************************************************************************* main select statement ***/
/***************************************************************************************************************************************************************/
) formerview
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _006_lt__LongData_ALL___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
/***                                                                                                                                                  ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[vr_LongCodedData_in_DB]                                  <<<<<     ***/
/***             This view includes numeric values and wordings, as stored & aggregated by country/religion & year & variable (long format)           ***/
/***                                                                                                                                                  ***/
/********************************************************************************************************************************************************/
/*  complete (unfiltered) view could be stored in   *****************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE varchar(max)
declare @CODEBEG varchar(max)
declare @MYCODE1 varchar(max)
declare @MYCODE2 varchar(max)
declare @MYCODE3 varchar(max)
declare @MYCODE4 varchar(max)
declare @MYCODE5 varchar(max)
declare @ENDCODE varchar(max)
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @CODEBEG = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vr_06w_LongData_ALL]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
SELECT * INTO    [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
FROM
(
/***************************************************************************************************************************************************************/
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
       [v_Basic_row] = ROW_NUMBER()OVER(ORDER BY
                                                  [Nation_fk]
                                                 ,[Question_Year]
                                                 ,[QA_std]
                                                 ,[Locality_fk]
                                                 ,[Answer_fk]     )
      ,[ValSource]
      ,[entity]
      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[answer_wording_std]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
      ,[editable]               = CASE
                                       WHEN [note] LIKE ''%this field can be edited'' THEN 1
                                       WHEN [note] LIKE ''%eld should NOT be edited'' THEN 0
                                  END
      ,[CntWg]
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > (begin seleccion from) ALL SETS OF DATA  ****************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
FROM
(
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < (begin seleccion from) ALL SETS OF DATA  ****************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE1 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > Basic Data: NPR  ****************************************************************************************************************************************/
---   Long set of data including numeric values and descriptive wordings.
---   At levels: country, country/religious group, & country/province
---   Notes
---        - In order to keep consistent to previuos years, data by Province currently belonging to South Sudan
---          should considered data for Sudan before 2010
---        - In order to avoid changing the final set,data previously used for Northern Cyprus
---          should be excluded (current decision)
---        - Although we have REAL data by province for North Korea, we do not use them
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr01LNA''
      , [entity]             = CASE
                                    WHEN [entity]         = ''CR&P'' THEN ''Not Yet Stored in DB''
                                    WHEN [entity]         = ''Ctry'' THEN ''Stored by Country''
                                    WHEN [entity]         = ''RGrp'' THEN ''Stordred by Religion Group (& Ctry)''
                                    WHEN [Question_Year]  < 2012
                                     AND [entity]         = ''Prov'' THEN ''Stored by Locality (should be aggregated)''
                                    WHEN [Question_Year] >= 2012
                                     AND [entity]         = ''Prov'' THEN ''Stored by Country (using Locality code)''
                               END
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field can be edited''
      , [link_fk]
      , [Nation_fk]
      , [Locality_fk]
      , [Religion_fk]
      , [Region5]
      , [Region6]
      , [Ctry_EditorialName]
      , [Locality]           = CASE
                                    WHEN [Locality]       = '''' THEN ''not detailed''
                                    WHEN [Locality]      != '''' THEN [Locality]
                               END
      , [Religion]           = CASE
                                    WHEN [Religion]       = '''' THEN ''not detailed''
                                    WHEN [Religion]      != '''' THEN [Religion]
                               END
      , [Question_Year]
      , [QA_std]             = CASE
                                    WHEN [Question_Year]  < 2012
                                     AND [entity]         = ''Prov'' THEN [QA_std] + ''__p''
                                    ELSE                                  [QA_std]
                               END
      , [QW_std]
 --   , [Answer_value]
      , [Answer_value]       =      CAST([Answer_value] AS nvarchar)
      , [answer_wording]
      , [answer_wording_std]
      , [Question_fk]
      , [Answer_fk]
      , [Notes]
      , [CntWg]              = 1
FROM
        [vr___01_cDB_Long__NoAggregated]


'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*****************************************************************************************************************************************  Basic Data: NPR  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE2 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > PDAbC province data (before 2012) aggregated at country level  ******************************************************************************************/
---   Long set of data aggregating both numeric values and descriptive wordings.
---   (Notes same as above)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource]          = ''vr05WCY''
      , [entity]             = ''Province, aggregated by Country''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       D1.[Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       D1.[Region5]
      , [Region6]            =       D1.[Region6]
      , [Ctry_EditorialName] =       D1.[Ctry_EditorialName]
      , [Locality]           = ''aggregated by country''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       D2.[Question_Year]
      , [QA_std]             =       D2.[QA_std]
      , [QW_std]             =       D2.[QW_std]
      , [Answer_value]       = CASE
                               WHEN  D3.[Answer_value] IS NULL
                               THEN  ''0''
                               ELSE
                                CAST(D3.[Answer_value] AS nvarchar)
                               END
      , [Answer_wording]     = CASE
                               WHEN  D3.[Answer_wording] IS NULL
                               THEN  ''not detailed''
                               ELSE  D3.[Answer_wording]
                               END
      , [Answer_wording_std] = CASE
                               WHEN  D3.[Answer_wording_std] IS NULL
                               THEN  ''No cases were found''
                               ELSE  D3.[Answer_wording_std]
                               END
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
  FROM 
       ( SELECT 
                DISTINCT
                [Nation_fk]
               ,[Region5]
               ,[Region6]
               ,[Ctry_EditorialName]
               ,[Question_Year]      AS [QY]
           FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
          WHERE    [Question_Year]  < 2012                             )  D1
INNER JOIN
       ( SELECT 
                DISTINCT
                [Question_Year]
               ,[QA_std]         /* SHI_04_b not coded for 2008 */
               ,[QW_std]
               ,[Question_fk]
           FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
          WHERE    [entity]         = ''Prov''
            AND    [Question_Year]  < 2012                             )  D2
   ON      D1.[QY]
         = D2.[Question_Year]
LEFT JOIN
(
SELECT
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]         = SUM([Answer_value])
      ,[answer_wording]       = STUFF(
                                      ( SELECT 
                                                ''|''
                                              + ISNULL([Answer_wording], '''')
                                         FROM         
                                                    ( SELECT *
                                                        FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
                                                       WHERE    [entity]         = ''Prov''
                                                         AND    [Question_Year]  < 2012                             )  S2
                                        WHERE      S1.[Nation_fk]
                                                 = S2.[Nation_fk]
                                             AND   S1.[Question_Year]
                                                 = S2.[Question_Year]
                                             AND   S1.[QA_std]
                                                 = S2.[QA_std]
                                     FOR XML PATH('''') ), 1, 1, '''')
      ,[answer_wording_std]
      ,[Question_fk]
  FROM 
       ( SELECT *
           FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
          WHERE    [entity]         = ''Prov''
            AND    [Question_Year]  < 2012                             )  S1
GROUP BY
          [Nation_fk]
        , [Region5]
        , [Region6]
        , [Ctry_EditorialName]
        , [Question_Year]
        , [QA_std]
        , [QW_std]
        , [answer_wording_std]
        , [Question_fk]
                                                                                                                                                    )  D3
   ON      D1.[Nation_fk]
         = D3.[Nation_fk]
  AND      D2.[Question_Year]
         = D3.[Question_Year]
  AND      D2.[QA_std]
         = D3.[QA_std]
  AND      D2.[QW_std]
         = D3.[QW_std]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*************************************************************************************************************************************  province data PDAbC  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE3 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > ACVbC other aggregated and calculated variables by country  *********************************************************************************************/
---   Long set of data aggregating both numeric values and descriptive wordings.
/***************************************************************************************************************************************************************/
/*** > major select statement for ACVbC  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr05WCY''
--    ,                        ACVC.[QA_link]
--    ,                        ACVC.[AV_link]
      , [entity]             = ''Calculated & Aggregated variables''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       ACVC.[Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       ACVC.[Region5]
      , [Region6]            =       ACVC.[Region6]
      , [Ctry_EditorialName] =       ACVC.[Ctry_EditorialName]
      , [Locality]           = ''not detailed''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       ACVC.[Question_Year]
      , [QA_std]             =       ACVC.[QA_std]
      , [QW_std]             =       QAWD.[QW_std]
 --   , [Answer_value]       =       ACVC.[Answer_value]
      , [Answer_value]       =  CAST(ACVC.[Answer_value] AS nvarchar)
      , [Answer_wording]     = ''aggregated value: not detailed''
      , [Answer_wording_std] =       QAWD.[AW_std]
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
FROM
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < major select statement fro ACVbC  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** >                                .  ***********************************************************************************************************************/
/*=============================================================================================================================================================*/
                                                                                /*** begining of query Lev2 enclosed between parenthesis                     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
( SELECT
         [AV_link] = CASE 
                          WHEN [Answer_value] >= 2
                           AND [QA_std]        = ''GRI_19_x''
                          THEN  1
                          WHEN [QA_std]        = ''GRI_20''
                          THEN  0
                          WHEN [Answer_value] >= 2
                           AND [QA_std]        = ''SHI_01_x''
                          THEN  1

                          ELSE [Answer_value]            END

      ,  [QA_link] = [QA_std]
          /*   CASE 
                  WHEN                 [QA_std] LIKE ''%_ny%'' 
                  THEN STUFF(          [QA_std]      ,         
                  ((CHARINDEX(''_ny'', [QA_std])) + 3) , 1, '''')
                  ELSE                 [QA_std]
                  END  */
       , *
    FROM  [forum_ResAnal].[dbo].[vr___03_cDB_W&Xtra_byCtry&Year]   SWCY
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'  UNPIVOT  '
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** beginning of unpivoting specifications                                  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
  (
     [Answer_value]
FOR
     [QA_std]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** beginning of listing of variables                                       ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
in (
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** List variables: Begin stuffing function to remove the first comma in the list to be retrieved (parenthesis not needed) ************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [COLUMN_NAME]                                                         /*** field in system view which includes all field names                     ***/
    FROM                                                                        /*** from...                                                                 ***/
          [INFORMATION_SCHEMA].[COLUMNS]                                  TabA  /*** name of the system view which includes all field names                  ***/
	LEFT JOIN                                                                   /*** joined to a query...                                                    ***/
		( SELECT DISTINCT                                                       /*** SELECT (+ DISTINCT) statement                                           ***/
					[QA_std]                                                       /*** all variable names before aggregating data                              ***/
			FROM [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated] ) TabB  /*** from NPR long view which includes all original variables' names         ***/
		ON                  [COLUMN_NAME] = [QA_std]                              /*** matching by field/variable names                                        ***/
	WHERE                                                                       /*** begining of filters to be applied...                                    ***/
          [TABLE_NAME]  = 'vr___03_cDB_W&Xtra_byCtry&Year'                      /*** TO INCLUDE ONLY desired view including calculated/aggegated fields      ***/
    AND                                                                         /*** second filter to be applied...                                          ***/
          [QA_std]         IS NULL                                              /*** new calculated/aggegated fields do not match                            ***/
    AND                                                                         /*** third filter to be applied...                                           ***/
          [COLUMN_NAME]    NOT IN (                                             /*** exclude field names not correspnding to calculated/aggegated vars       ***/
                                     'Nation_fk'                                /*** ...                                                                     ***/
                                   , 'Ctry_EditorialName'                       /*** ...                                                                     ***/
                                   , 'Question_Year'                            /*** ...                                                                     ***/
                                   , 'Region5'                                  /*** ...                                                                     ***/
                                   , 'Region6'                                  /*** ...                                                                     ***/
                             --    , 'UN_TotalPopulation'                       /*** ...  not added yet - 2016/01/14                                         ***/
                                   , 'GFI'                                      /*** ...  DECIMAL(38,32)  instead of  (38,2)                                 ***/
                                   , 'GRI'                                      /*** ...  DECIMAL(38,32)  instead of  (38,2)                                 ***/
                                   , 'SHI'                                      /*** ...  DECIMAL(38,32)  instead of  (38,2)                                 ***/
                                   , 'GFI_rd_1d'                                /*** ...  DECIMAL(38,1)   instead of  (38,2)                                 ***/
                                   , 'GRI_rd_1d'                                /*** ...  DECIMAL(38,1)   instead of  (38,2)                                 ***/
                                   , 'SHI_rd_1d'                                /*** ...  DECIMAL(38,1)   instead of  (38,2)                                 ***/
                                                                         )      /*** end of third filter                                                     ***/
    AND                                                                         /*** fourth filter - case 1 - to be applied...                               ***/
          [COLUMN_NAME]    NOT LIKE  '%_ny1'                                    /*** exclude field names for extra detailed y (1) from n/y distributions     ***/
    AND                                                                         /*** fourth filter - case 2 - to be applied...                               ***/
          [COLUMN_NAME]    NOT LIKE  '%_ny2'                                    /*** exclude field names for extra detailed y (2) from n/y distributions     ***/
    AND                                                                         /*** fourth filter - case 3 - to be applied...                               ***/
          [COLUMN_NAME]    NOT LIKE  '%_ny3'                                    /*** exclude field names for extra detailed y (3) from n/y distributions     ***/
    AND                                                                         /*** fourth filter - case @ - to be applied...                               ***/
          [COLUMN_NAME]    NOT LIKE  '%_summ%_ny[a-f]'                 /*** exclude field names for extra detailed y (@) from n/y distributions     ***/
    FOR XML PATH('')                                                            /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                               /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N' 
   )    '
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end of listing of variables                                             ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'    )                                                         AS   MUPV    '
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end (& alias) of unpivoting specifications                              ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
                                                                                                                                                     )  AS ACVC
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end & alias of query Lev2 enclosed between parenthesis                  ***/
/*=============================================================================================================================================================*/
/*** <                                .  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'LEFT JOIN'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** >                                .  ***********************************************************************************************************************/
/*=============================================================================================================================================================*/
                                                                                /*** begining of query Lev2 enclosed between parenthesis                     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
( SELECT 
         [QAStd_pk]
       , [QA_std]    = [Question_abbreviation_std]
       , [QW_std]    = [Question_wording_std]
       , [QsWstd]    = [Question_short_wording_std]
       , [AV_std]    = [Answer_value_std]
       , [AW_std]    = [Answer_Wording_std]
    FROM
         [forum].[dbo].[Pew_Q&A_Std]
   WHERE
         [Question_abbreviation_std] LIKE ''[S,G,X][F,H,R,S]%''                                                                  )  AS QAWD
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end & alias of query Lev2 enclosed between parenthesis                  ***/
/*=============================================================================================================================================================*/
/*** <                                .  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N' ON
     (       ACVC.[QA_link]
           = QAWD.[QA_std]
       AND   ACVC.[AV_link]
           = QAWD.[AV_std]         )
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************************************  aggregated/calculated data ACVbC  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE4 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > uIbCR (unrounded) indexes aggregated by country and median indexes by regions  **************************************************************************/
---   Long set of data coming directly from set of indexes.
/***************************************************************************************************************************************************************/
/*** > major select statement for uIbCR  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr04uICY''
      , [entity]             = ''Indexes & Median Indexes''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       [Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       [Region5]
      , [Region6]            =       [Region6]
      , [Ctry_EditorialName] =       [Ctry_EditorialName]
      , [Locality]           = ''not detailed''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       [Year]
      , [QA_std]             =       [Index_abbreviation]
      , [QW_std]             =       [Index_name]
      , [Answer_value]       =  CASE
                                    WHEN                                       [Index_value]                       =  0    THEN  ''0''
                                    WHEN                                       [Index_value]                       = 10    THEN ''10''
                                    ELSE LEFT                           ((CAST([Index_value] AS nvarchar(max))), 
                                          (LEN                          ((CAST([Index_value] AS nvarchar(max))))
                                           - PATINDEX(''%[1-9]%'', REVERSE((CAST([Index_value] AS nvarchar(max))))) + 1)  )
                                    END
      , [Answer_wording]     = ''not detailed''
      , [Answer_wording_std] = ''scale 0 - [+.] - 10''
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
FROM
        [vr_04w_R&H_Index_by_CtryRegion&Yr]
'
/********************************************************************************************************  country indexes & by region median indexes uIbCR  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE5 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > RIbCR indexes aggregated by country and median indexes by regions (rounded to one decimal)  *************************************************************/
---   Long set of data coming directly from set of indexes.
/***************************************************************************************************************************************************************/
/*** > major select statement for RIbCR  **********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr04RICY''
      , [entity]             = ''Indexes & Median Indexes''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       [Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       [Region5]
      , [Region6]            =       [Region6]
      , [Ctry_EditorialName] =       [Ctry_EditorialName]
      , [Locality]           = ''not detailed''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       [Year]
      , [QA_std]             =       [Index_abbreviation] + ''_rd_1d''
      , [QW_std]             =       [Index_name]         + '' (rounded to one decimal)''
      , [Answer_value]       =  CAST([I_Rounded_value] AS nvarchar)
      , [Answer_wording]     = ''not detailed''
      , [Answer_wording_std] = ''scale 0.0 - [+.1] - 10.0''
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
FROM
        [vr_04w_R&H_Index_by_CtryRegion&Yr]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************  rounded country indexes & by region median indexes RIbCR  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @ENDCODE = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > (finalize seleccion from) ALL SETS OF DATA  *************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
)  ASoD
)  FormerView
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < (finalize seleccion from) ALL SETS OF DATA  *************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***     >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        @CODEBEG                                                    /***                - initial code -                                                     ***/
    +   @MYCODE1                                                    /***   NPR          [vr_01w_DB_Long_NoAggregated]            ------>     170,623         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE2                                                    /***   PDAbC       *Province, aggregated by Country          ------>      27,608         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE3                                                    /***   ACVbC       *Calculated & Aggregated variables        ------>      78,908         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE4                                                    /***   uIbCR       *Country & Region (unrounded) indexes     ------>       4,398         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE5                                                    /***   RIbCR       *Country & Region rounded indexes (.X)    ------>       4,398         ***/
    +   @ENDCODE                                                    /***                - final code -                                                       ***/
                                                                    /***                                                                     285,935         ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<     ***/
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--	EXEC dbo.LongPrint @CODEBEG                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE1                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE2                                     /***        display the currently stored code (to be executed)                           ***/
	EXEC dbo.LongPrint @MYCODE3                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE4                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE5                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @ENDCODE                                     /***        display the currently stored code (to be executed)                           ***/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
/***************************************************************************************************************************************************************/
--	EXEC              (@MYCODE1)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE2)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE3)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE4)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE5)                                    /***        ... partial excecution ...                                                   ***/
/***************************************************************************************************************************************************************/
--		EXEC dbo.LongPrint @ALLCODE                                 /***        display the currently stored code (to be executed)                           ***/
/***************************************************************************************************************************************************************/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
--		EXEC  (@ALLCODE)
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _006_lt__PubSelVarDat___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 00_    ------------------------------------------------------------------------------------------ '


--- can be recoded using metacode


/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrp__01_cDB_SelDataBYCtry&Year]                         <<<<<     ***/
/***             This table filters selected values from [vr___03_cDB_W&Xtra_byCtry&Year] aggregated by country/religion & year                              ***/
/***             The data will be available for public download                                                                                              ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrp__01_cDB_SelDataBYCtry&Year]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrp__01_cDB_SelDataBYCtry&Year]
SELECT * INTO    [forum_ResAnal].[dbo].[vrp__01_cDB_SelDataBYCtry&Year]
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*=============================================================================================================================================================*/
   SELECT
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
          [Nation_fk]
         ,[Region5]
         ,[Region6]
         ,[Ctry_EditorialName]
         ,[Question_Year]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
         ,[GRI_Q_1]                        = [GRI_01]
         ,[GRI_Q_2]                        = [GRI_02]
         ,[GRI_Q_3]                        = [GRI_03]
         ,[GRI_Q_4]                        = [GRI_04]
         ,[GRI_Q_5]                        = [GRI_05]
         ,[GRI_Q_6]                        = [GRI_06]
         ,[GRI_Q_7]                        = [GRI_07]
         ,[GRI_Q_8]                        = [GRI_08_for_index]
         ,[GRI_Q_9]                        = [GRI_09]
         ,[GRI_Q_10]                       = [GRI_10]
         ,[GRI_Q_11]                       = [GRI_11]
         ,[GRI_Q_11_Christianity]          = [GRI_11_xG1]
         ,[GRI_Q_11_Islam]                 = [GRI_11_xG2]
         ,[GRI_Q_11_Buddhism]              = [GRI_11_xG3]
         ,[GRI_Q_11_Hinduism]              = [GRI_11_xG4]
         ,[GRI_Q_11_Judaism]               = [GRI_11_xG5]
         ,[GRI_Q_11_Folk_Religions]        = [GRI_11_xG7]
         ,[GRI_Q_11_Other_Religions]       = [GRI_11_xG6]
         ,[GRI_Q_12]                       = [GRI_12]
         ,[GRI_Q_13]                       = [GRI_13]
         ,[GRI_Q_14]                       = [GRI_14]
         ,[GRI_Q_15]                       = [GRI_15]
         ,[GRI_Q_16]                       = [GRI_16_ny]       * 100  --   fromerly rescaled [GRI_16_ny1]
         ,[GRI_Q_16_reasons]               = [GRI_16]
         ,[GRI_Q_17]                       = [GRI_17]
         ,[GRI_Q_18]                       = [GRI_18]
         ,[GRI_Q_19]                       = [GRI_19_ny]       * 100  --   fromerly rescaled [GRI_19_ny1]
         ,[GRI_Q_19_extent]                = [GRI_19]
         ,[GRI_Q_19_Abuse]                 = [GRI_19_e_scaled]
         ,[GRI_Q_19_Deaths]                = [GRI_19_f_scaled]
         ,[GRI_Q_19_Displacements]         = [GRI_19_d_scaled]
         ,[GRI_Q_19_Detentions]            = [GRI_19_c_scaled]
         ,[GRI_Q_19_Property_Damage]       = [GRI_19_b_scaled]
         ,[GRI_Q_20_1]                     = [GRI_20_01]
         ,[GRI_Q_20_2]                     = [GRI_20_02]
         ,[GRI_Q_20_3]                     = [GRI_20_03_top]
         ,[GRI_Q_20_3_a]                   = [GRI_20_03_a]
         ,[GRI_Q_20_3_b]                   = [GRI_20_03_b]
         ,[GRI_Q_20_3_c]                   = [GRI_20_03_c]
         ,[GRI_Q_20_4]                     = [GRI_20_04]
         ,[GRI_Q_20_5]                     = [GRI_20_05]
         ,[SHI_Q_1_Harassment]             = [SHI_01_a_dummy]
         ,[SHI_Q_1_PropertyDamage]         = [SHI_01_b_dummy]
         ,[SHI_Q_1_Detentions]             = [SHI_01_c_dummy]
         ,[SHI_Q_1_Displacements]          = [SHI_01_d_dummy]
         ,[SHI_Q_1_Assaults]               = [SHI_01_e_dummy]
         ,[SHI_Q_1_Deaths]                 = [SHI_01_f_dummy]
         ,[SHI_Q_1_Extent]                 = [SHI_01]
         ,[SHI_Q_1_harass_Christianity]    = [SHI_01_xG1]
         ,[SHI_Q_1_harass_Islam]           = [SHI_01_xG2]
         ,[SHI_Q_1_harass_Buddhism]        = [SHI_01_xG3]
         ,[SHI_Q_1_harass_Hinduism]        = [SHI_01_xG4]
         ,[SHI_Q_1_harass_Judaism]         = [SHI_01_xG5]
         ,[SHI_Q_1_harass_Folk_Religions]  = [SHI_01_xG7]
         ,[SHI_Q_1_harass_Other_Religions] = [SHI_01_xG6]
         ,[SHI_Q_2]                        = [SHI_02]
         ,[SHI_Q_3]                        = [SHI_03]
         ,[SHI_Q_4]                        = [SHI_04_ny]       * 100  --   fromerly rescaled [SHI_04_ny0]
         ,[SHI_Q_4_extent]                 = [SHI_04]
         ,[SHI_Q_5]                        = [SHI_05_ny]       * 100  --   fromerly rescaled [SHI_05_ny0]
         ,[SHI_Q_5_extent]                 = [SHI_05]
         ,[SHI_Q_6]                        = [SHI_06]
         ,[SHI_Q_7]                        = [SHI_07]
         ,[SHI_Q_8]                        = [SHI_08]
         ,[SHI_Q_9]                        = [SHI_09]
         ,[SHI_Q_10]                       = [SHI_10]
         ,[SHI_Q_11]                       = [SHI_11_for_index]
         ,[SHI_Q_12]                       = [SHI_12]
         ,[SHI_Q_13]                       = [SHI_13]
         ,[GRX_22_blasphemy]               = [GRX_22_01_ny]    * 100  --   fromerly rescaled [GRX_22_01_ny1]
         ,[GRX_22_apostasy]                = [GRX_22_02_ny]    * 100  --   fromerly rescaled [GRX_22_02_ny1]
         ,[GRX_22_hate_speech]             = [GRX_22_03_ny]    * 100  --   fromerly rescaled [GRX_22_03_ny1]
         ,[GRX_22_criticism_of_religion]   = [GRX_22_04_ny]    * 100  --   fromerly rescaled [GRX_22_04_ny1]
         ,[GRX_30]                         = [GRX_30]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
                 [forum_ResAnal].[dbo].[vr___03_cDB_W&Xtra_byCtry&Year]
/*=============================================================================================================================================================*/
                                                                                     ) SelPubDS
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _006_lt__PubSelVarLab___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 00_    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrp__01_cDB_SelDataBYCtry&Year]                         <<<<<     ***/
/***             This table filters selected values from [vr___03_cDB_W&Xtra_byCtry&Year] aggregated by country/religion & year                              ***/
/***             The data will be available for public download                                                                                              ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrp__02_cDB_Label_of_Variables]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrp__02_cDB_Label_of_Variables]
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT * INTO    [forum_ResAnal].[dbo].[vrp__02_cDB_Label_of_Variables]
  FROM (
       /*======================================================================================================================================================*/
          SELECT
       /*------------------------------------------------------------------------------------------------------------------------------------------------------*/
	                [k] = 
	                       ROW_NUMBER() OVER(ORDER BY [Question_Abbreviation_Std])
	              , [A] = 
	                       'label var  ' 
                        +                                          [In_PubDataSet]
                        +  RIGHT('                     "', (33-LEN([In_PubDataSet])))
                        +                                          [Question_Label_80Chars]
                        +  '"  '
         --       , [L] = LEN([In_PubDataSet])
       /*------------------------------------------------------------------------------------------------------------------------------------------------------*/
               FROM [forum].[dbo].[Pew_Question_Std]
              WHERE [In_PubDataSet] != '-'
         --   ORDER
		 --      BY       LEN([In_PubDataSet])
       /*======================================================================================================================================================*/
       )  SETA
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/ 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _007_lt__DBIndexbyCRY___R.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/******************************************************************************************************************************/
/***                                                                                                                        ***/
/***    >>>>> This is the script for the lookup table [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]    <<<<<    ***/
/***                                                                                                                        ***/
/***     NOTES:                                                                                                             ***/
/***     For calculating the median value for the world or for a region:                                                    ***/
/***           The median is the numerical value separating the higher half from the lower half of the data                 ***/
/***           (it can differ from the mean). We find it by arranging all the observations from lowest value                ***/
/***           to highest value and picking the middle one. If there is an even number of observations,                     ***/
/***           median is defined  to be the mean of the two middle values.                                                  ***/
/***                                                                                                                        ***/
/***                                     > > >     lookup tables  work faster     < < <                                     ***/
/***                                                                                                                        ***/
/******************************************************************************************************************************/
USE [forum_ResAnal]
GO
/******************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
GO
/******************************************************************************************************************************/
WITH PREv4
  AS
      (
/******************************************************************************************************************************/
        SELECT
/*----------------------------------------------------------------------------------------------------------------------------*/
                [Nation_fk]
              , [Region5_code]   
                 =   CASE
                          WHEN [Region5] = 'Americas'                  THEN 1000
                          WHEN [Region5] = 'Europe'                    THEN 1003
                          WHEN [Region5] = 'Middle East-North Africa'  THEN 1004
                          WHEN [Region5] = 'Sub-Saharan Africa'        THEN 1005
                          WHEN [Region5] = 'Asia-Pacific'              THEN 1006
                          END
              , [Region6_code]
                 =   CASE
                          WHEN [Region6] = 'North America'             THEN 1001
                          WHEN [Region6] = 'Latin America-Caribbean'   THEN 1002
                          WHEN [Region6] = 'Europe'                    THEN 1003
                          WHEN [Region6] = 'Middle East-North Africa'  THEN 1004
                          WHEN [Region6] = 'Sub-Saharan Africa'        THEN 1005
                          WHEN [Region6] = 'Asia-Pacific'              THEN 1006
                          END
              , [Region5]
              , [Region6]
              , [Ctry_EditorialName]
              , [Index_Year]
                 =   CASE
                          WHEN [Question_Year] <  2011 THEN 'MID-' + STR([Question_Year], 4,0)
                          ELSE                              'END-' + STR([Question_Year], 4,0)
                          END
              , [Index_Abbreviation]
              , [Index_Name]             = [Question_short_wording_std]
              , [Index_Value]
              , [I_Rounded_Value]
              , [I_Scaled_Value]
              , [Year]                   = [Question_Year]
        FROM
/******************************************************************************************************************************/
        (
/******************************************************************************************************************************/
        SELECT 
                  [Nation_fk]
              ,   [Ctry_EditorialName]
              ,   [Region5]
              ,   [Region6]
              ,   [Question_Year]
              ,   [GRI] -- as float works for rounding: don't re-cast
              ,   [SHI] -- as float works for rounding: don't re-cast
              ,   [GFI] -- as float works for rounding: don't re-cast
          FROM    [vr___03_cDB_W&Xtra_byCtry&Year]
/******************************************************************************************************************************/
        )                                                         B
/******************************************************************************************************************************/
        UNPIVOT
          (
             [Index_Value]
        FOR
             [Index_Abbreviation]
        in (
                       [GRI]  /*** GRI Yindex (d prec/scale)    ***/
                     , [SHI]  /*** SHI Yindex (d prec/scale)    ***/
                     , [GFI]  /*** GFI Yindex (d prec/scale)    ***/
                                                       ) ) as UNPIVTD1
/******************************************************************************************************************************/
        JOIN
/******************************************************************************************************************************/
        (
/******************************************************************************************************************************/
        SELECT 
                  [N2]        = [Nation_fk]
              ,   [Y2]        = [Question_Year]
              ,   [GRI]       = [GRI_rd_1d]    -- already rounded: don't re-cast
              ,   [SHI]       = [SHI_rd_1d]    -- already rounded: don't re-cast
              ,   [GFI]       = [GFI_rd_1d]    -- already rounded: don't re-cast
          FROM    [vr___03_cDB_W&Xtra_byCtry&Year]
/******************************************************************************************************************************/
        )                                                         B
/******************************************************************************************************************************/
        UNPIVOT
          (
             [I_Rounded_Value]
        FOR
             [I2]
        in (
                       [GRI]  /*** GRI Yindex rounded ***/
                     , [SHI]  /*** SHI Yindex rounded ***/
                     , [GFI]  /*** GFI Yindex rounded ***/
                                                       ) ) as UNPIVTD2
/******************************************************************************************************************************/
        ON        [N2]        = [Nation_fk]
        AND       [Y2]        = [Question_Year]
        AND       [I2]        = [Index_Abbreviation]
/******************************************************************************************************************************/
        JOIN
/******************************************************************************************************************************/
        (
/******************************************************************************************************************************/
        SELECT 
                  [N3]        = [Nation_fk]
              ,   [Y3]        = [Question_Year]
              ,   [GRI]       = [GRI_scaled]    -- already scaled: don't re-cast
              ,   [SHI]       = [SHI_scaled]    -- already scaled: don't re-cast
              ,   [GFI]       = [GFI_scaled]    -- already scaled: don't re-cast
          FROM    [vr___03_cDB_W&Xtra_byCtry&Year]
/******************************************************************************************************************************/
        )                                                         B
/******************************************************************************************************************************/
        UNPIVOT
          (
             [I_Scaled_Value]
        FOR
             [I3]
        in (
                       [GRI]  /*** GRI Yindex scaled ***/
                     , [SHI]  /*** SHI Yindex scaled ***/
                     , [GFI]  /*** GFI Yindex scaled ***/
                                                       ) ) as UNPIVTD3
/******************************************************************************************************************************/
        ON        [N3]        = [Nation_fk]
        AND       [Y3]        = [Question_Year]
        AND       [I3]        = [Index_Abbreviation]
/******************************************************************************************************************************/


        JOIN
(
/****** Script for SelectTopNRows command from SSMS  ******/
SELECT 
       [QAS] = [Question_abbreviation_std]
      ,[Question_short_wording_std]
  FROM [forum].[dbo].[Pew_Question_Std]
) q



















/******************************************************************************************************************************/
        ON        [QAS]       = [Index_Abbreviation]
/******************************************************************************************************************************/



/****** Script for SelectTopNRows command from SSMS  ******/
SELECT
       [Region_pk]
      ,[Region_EditorialName]
  FROM [forum].[dbo].[Pew_Region]
Region_pk	Region_EditorialName
1000	Americas
1001	North America
1002	Latin America-Caribbean
1003	Europe
1004	Middle East-North Africa
1005	Sub-Saharan Africa
1006	Asia-Pacific
10000	World



      )
/******************************************************************************************************************************/
/******************************************************************************************************************************/

/******************************************************************************************************************************/
SELECT * INTO    [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
FROM
--------------------------------------------------------------------------------------------------------------------------------
(
/******************************************************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [RIYv_row]           =  ROW_NUMBER()
                                 OVER(ORDER BY
                                                 [level]              DESC
                                               , [Nation_fk]
                                               , [Index_abbreviation]
                                               , [Year]                     )
--------------------------------------------------------------------------------------------------------------------------------
       , [Index_Year]
       , [level]
       , [Region5_code]
       , [Region6_code]
       , [Nation_fk]
       , [Region5]
       , [Region6]
       , [Ctry_EditorialName]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]
       , [I_Rounded_value]
       , [I_Scaled_value]     = CASE
                                    WHEN     [I_Scaled_value] IS NOT NULL         THEN [I_Scaled_value]
                                    WHEN     [Index_value] >= [low|lowest]
                                         AND [Index_value] <= [low|highest]       THEN 1
                                    WHEN     [Index_value] >= [moderate|lowest]
                                         AND [Index_value] <= [moderate|highest]  THEN 2
                                    WHEN     [Index_value] >= [high|lowest]
                                         AND [Index_value] <= [high|highest]      THEN 3
                                    WHEN     [Index_value] >= [very high|lowest]
                                         AND [Index_value] <= [very high|highest] THEN 4
                                END
       , [Year]
       , [ByRegion6]          = CASE
                                    WHEN [level] IN ( 1, 2   ) THEN 1
                                    ELSE                            0
                                END
       , [ByRegion5]          = CASE
                                    WHEN [level] IN ( 1, 2.5 ) THEN 1
                                    ELSE                            0
                                END
       , [ByWorld]           = CASE
                                    WHEN [level] IN ( 1, 3   ) THEN 1
                                    ELSE                            0
                                END
       , [ByWorld&Region]    = CASE
                                    WHEN [level] IN ( 2, 3   ) THEN 1
                                    ELSE                            0
                                END
FROM
/*** >>> country, region, and world joined to set of cutpoints ****************************************************************/
/******************************************************************************************************************************/
/*** country, region, and world  **********************************************************************************************/
(
/*** country level ************************************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  1
       , [Region5_code]
       , [Region6_code]
       , [Nation_fk]
       , [Region5]
       , [Region6]
       , [Ctry_EditorialName]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]
       , [I_Rounded_value]
       , [I_Scaled_value]
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
/************************************************************************************************************ country level ***/
UNION ALL
/*** median index by year and region 6 ****************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  2
       , [Region5_code]          =  CASE
                                        WHEN [Region6_code] = 1001                   THEN 1000
                                        WHEN [Region6_code] = 1002                   THEN 1000
                                        ELSE [Region6_code]
                                    END
       , [Region6_code]
       , [Nation_fk]             =           [Region6_code]
       , [Region5]               =  CASE
                                        WHEN [Region6] = 'North America'             THEN 'Americas'
                                        WHEN [Region6] = 'Latin America-Caribbean'   THEN 'Americas'
                                        ELSE [Region6]
                                    END
       , [Region6]
       , [Ctry_EditorialName]    =  'All countires in ' + [Region6]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]           =       (AVG([Index_value]))    /* avg 2 middle values if needed */
       , [I_Rounded_value]       = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
       , [I_Scaled_value]        = NULL
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
FROM
--------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************/
(
/*** > include StOrd & MedPos *************************************************************************************************/
/*     Notice that:                                                                                                           */
/*                  [StOrd]  will have the numeric sorting order of rows by values                                            */
/*                  [MedPos] will have the position in the sorted list:                                                       */
/*                           in three cases:  | 1  |  2  | 3 |                                                                */
/*                           the median is the second value:  (3+1)/2 = 2                                                     */
/******************************************************************************************************************************/
SELECT 
--------------------------------------------------------------------------------------------------------------------------------
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region6]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region6]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                 ,[Region6]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Region6_code]
      ,[Nation_fk]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
--------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************* < include StOrd & MedPos ***/
)                                                                                                                             B
/******************************************************************************************************************************/
/*     Notice that: In an odd number of observations, the position is an integer, then we can say:                            */
/*                  [StOrd] = [MedPos]                                                                                        */
/*                  In an even number of observations, the position is between the two middle values, then we need:           */
/*                  [StOrd] = ([MedPos] +/- 0.5)                                                                              */
/******************************************************************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/******************************************************************************************************************************/
/*  We can have one or two middle values, we group by the other variables                                                     */
/******************************************************************************************************************************/
GROUP BY
         [Region6_code]
       , [Region6]
       , [Year]
       , [Index_Year]
       , [Index_name]
       , [Index_abbreviation]
/****************************************************************************************** median index by year and region ***/
UNION ALL
/*** median index by year and region 5 ****************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  2.5
       , [Region5_code]
       , [Region6_code]          =  CASE
                                        WHEN [Region5_code] = 1000                   THEN NULL
                                        ELSE [Region5_code]
                                    END
       , [Nation_fk]             =           [Region5_code]
       , [Region5]
       , [Region6]               =  CASE
                                        WHEN [Region5] = 'Americas'                  THEN 'N.A. & L.A.-C.'
                                        ELSE [Region5]
                                    END
       , [Ctry_EditorialName]    =  'All countires in ' + [Region5]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]           =       (AVG([Index_value]))    /* avg 2 middle values if needed */
       , [I_Rounded_value]       = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
       , [I_Scaled_value]        = NULL
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
FROM
--------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************/
(
/*** > include StOrd & MedPos *************************************************************************************************/
/*     Notice that:                                                                                                           */
/*                  [StOrd]  will have the numeric sorting order of rows by values                                            */
/*                  [MedPos] will have the position in the sorted list:                                                       */
/*                           in three cases:  | 1  |  2  | 3 |                                                                */
/*                           the median is the second value:  (3+1)/2 = 2                                                     */
/******************************************************************************************************************************/
SELECT 
--------------------------------------------------------------------------------------------------------------------------------
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region5]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region5]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                 ,[Region5]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Region5_code]
      ,[Nation_fk]
      ,[Region5]
      ,[Ctry_EditorialName]
      ,[Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
--------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************* < include StOrd & MedPos ***/
)                                                                                                                             B
/******************************************************************************************************************************/
/*     Notice that: In an odd number of observations, the position is an integer, then we can say:                            */
/*                  [StOrd] = [MedPos]                                                                                        */
/*                  In an even number of observations, the position is between the two middle values, then we need:           */
/*                  [StOrd] = ([MedPos] +/- 0.5)                                                                              */
/******************************************************************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/******************************************************************************************************************************/
/*  We can have one or two middle values, we group by the other variables                                                     */
/******************************************************************************************************************************/
GROUP BY
         [Region5_code]
       , [Region5]
       , [Year]
       , [Index_Year]
       , [Index_name]
       , [Index_abbreviation]
/****************************************************************************************** median index by year and region ***/
UNION ALL
/*** world median index by year ***********************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  3
       , [Region5_code]          =  10000
       , [Region6_code]          =  10000
       , [Nation_fk]             =  10000
       , [Region5]               =  'World'
       , [Region6]               =  'World'
       , [Ctry_EditorialName]    =  'All countires in the world'
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]           =       (AVG([Index_value]))    /* avg 2 middle values if needed */
       , [I_Rounded_value]       = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
       , [I_Scaled_value]        = NULL
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
FROM
--------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************/
(
/*** > include StOrd & MedPos *************************************************************************************************/
/*     Notice that:                                                                                                           */
/*                  [StOrd]  will have the numeric sorting order of rows by values                                            */
/*                  [MedPos] will have the position in the sorted list:                                                       */
/*                           in three cases:  | 1  |  2  | 3 |                                                                */
/*                           the median is the second value:  (3+1)/2 = 2                                                     */
/******************************************************************************************************************************/
SELECT 
--------------------------------------------------------------------------------------------------------------------------------
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Nation_fk]
      ,[Ctry_EditorialName]
      ,[Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
--------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************* < include StOrd & MedPos ***/
)                                                                                                                             B
/******************************************************************************************************************************/
/*     Notice that: In an odd number of observations, the position is an integer, then we can say:                            */
/*                  [StOrd] = [MedPos]                                                                                        */
/*                  In an even number of observations, the position is between the two middle values, then we need:           */
/*                  [StOrd] = ([MedPos] +/- 0.5)                                                                              */
/******************************************************************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/******************************************************************************************************************************/
/*  We can have one or two middle values, we group by the other variables                                                     */
/******************************************************************************************************************************/
GROUP BY
         [Year]
       , [Index_Year]
       , [Index_name]
       , [Index_abbreviation]
/******************************************************************************************************************************/
)                                                                                                                           CRW
/*********************************************************************************************** country, region, and world ***/
JOIN
(
/*** > set of cutpoints to calculate scaled values ****************************************************************************/
  SELECT *
    FROM
         (
           SELECT 
                   DISTINCT                                            /* so, no need to select year   */
                   [LP]         = [Level] + '|' + [Point]
                  ,[CutPoint]
                  ,[Field_type]
              FROM [forum].[dbo].[Pew_Index_Cut_Points]
                 , [forum].[dbo].[Pew_Field]
             WHERE
                   [Field_fk]
                  =[Field_pk]
                                                                ) AS P /* alias of table to be pivoted */
    PIVOT (AVG ([CutPoint]) 
           FOR  [LP]
            IN (
                      [low|lowest]
                    , [low|highest]
                    , [moderate|lowest]
                    , [moderate|highest]
                    , [high|lowest]
                    , [high|highest]
                    , [very high|lowest]
                    , [very high|highest]
                                            ))  as pivoted
/**************************************************************************** < set of cutpoints to calculate scaled values ***/
)                                                                                                                            CP
/******************************************************************************************************************************/
ON
         [Index_abbreviation]
       = [Field_type]
/******************************************************************************************************************************/
/**************************************************************** <<< country, region, and world joined to set of cutpoints ***/
/******************************************************************************************************************************/
)  formerview
--------------------------------------------------------------------------------------------------------------------------------
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _009_lt__w04_vrw_RIndex_by_CRY_________R.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/******************************************************************************************************************************/
/***                                                                                                                        ***/
/***    >>>>> This is the script for the lookup table [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]    <<<<<    ***/
/***                                                                                                                        ***/
/***     NOTES:                                                                                                             ***/
/***     For calculating the median value for the world or for a region:                                                    ***/
/***           The median is the numerical value separating the higher half from the lower half of the data                 ***/
/***           (it can differ from the mean). We find it by arranging all the observations from lowest value                ***/
/***           to highest value and picking the middle one. If there is an even number of observations,                     ***/
/***           median is defined  to be the mean of the two middle values.                                                  ***/
/***                                                                                                                        ***/
/***                                     > > >     lookup tables  work faster     < < <                                     ***/
/***                                                                                                                        ***/
/******************************************************************************************************************************/
USE [forum_ResAnal]
GO
/******************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
GO
/******************************************************************************************************************************/
WITH PREv4
  AS
      (
/******************************************************************************************************************************/
        SELECT
/*----------------------------------------------------------------------------------------------------------------------------*/
                [Nation_fk]
              , [Region5_code]   
                 =   CASE
                          WHEN [Region5] = 'Americas'                  THEN 1000
                          WHEN [Region5] = 'Europe'                    THEN 1003
                          WHEN [Region5] = 'Middle East-North Africa'  THEN 1004
                          WHEN [Region5] = 'Sub-Saharan Africa'        THEN 1005
                          WHEN [Region5] = 'Asia-Pacific'              THEN 1006
                          END
              , [Region6_code]
                 =   CASE
                          WHEN [Region6] = 'North America'             THEN 1001
                          WHEN [Region6] = 'Latin America-Caribbean'   THEN 1002
                          WHEN [Region6] = 'Europe'                    THEN 1003
                          WHEN [Region6] = 'Middle East-North Africa'  THEN 1004
                          WHEN [Region6] = 'Sub-Saharan Africa'        THEN 1005
                          WHEN [Region6] = 'Asia-Pacific'              THEN 1006
                          END
              , [Region5]
              , [Region6]
              , [Ctry_EditorialName]
              , [Index_Year]
                 =   CASE
                          WHEN [Question_Year] <  2011 THEN 'MID-' + STR([Question_Year], 4,0)
                          ELSE                              'END-' + STR([Question_Year], 4,0)
                          END
              , [Index_Abbreviation]
              , [Index_Name]
                 =   CASE
                          WHEN [Index_Abbreviation] = 'GRI' THEN 'Government Restrictions Index'
                          WHEN [Index_Abbreviation] = 'SHI' THEN 'Social Hostilities Index'
                          WHEN [Index_Abbreviation] = 'GFI' THEN 'Government Favoritism Index'
                          END
              , [Index_Value]
              , [I_Rounded_Value]
              , [I_Scaled_Value]
              , [Year]                   = [Question_Year]
        FROM
/******************************************************************************************************************************/
        (
/******************************************************************************************************************************/
        SELECT 
                  [Nation_fk]
              ,   [Ctry_EditorialName]
              ,   [Region5]
              ,   [Region6]
              ,   [Question_Year]
              ,   [GRI] -- as float works for rounding: don't re-cast
              ,   [SHI] -- as float works for rounding: don't re-cast
              ,   [GFI] -- as float works for rounding: don't re-cast
          FROM    [vr_03w_W&Extras_by_Ctry&Year]
/******************************************************************************************************************************/
        )                                                         B
/******************************************************************************************************************************/
        UNPIVOT
          (
             [Index_Value]
        FOR
             [Index_Abbreviation]
        in (
                       [GRI]  /*** GRI Yindex (d prec/scale)    ***/
                     , [SHI]  /*** SHI Yindex (d prec/scale)    ***/
                     , [GFI]  /*** GFI Yindex (d prec/scale)    ***/
                                                       ) ) as UNPIVTD1
/******************************************************************************************************************************/
        JOIN
/******************************************************************************************************************************/
        (
/******************************************************************************************************************************/
        SELECT 
                  [N2]        = [Nation_fk]
              ,   [Y2]        = [Question_Year]
              ,   [GRI]       = [GRI_rd_1d]    -- already rounded: don't re-cast
              ,   [SHI]       = [SHI_rd_1d]    -- already rounded: don't re-cast
              ,   [GFI]       = [GFI_rd_1d]    -- already rounded: don't re-cast
          FROM    [vr_03w_W&Extras_by_Ctry&Year]
/******************************************************************************************************************************/
        )                                                         B
/******************************************************************************************************************************/
        UNPIVOT
          (
             [I_Rounded_Value]
        FOR
             [I2]
        in (
                       [GRI]  /*** GRI Yindex rounded ***/
                     , [SHI]  /*** SHI Yindex rounded ***/
                     , [GFI]  /*** GFI Yindex rounded ***/
                                                       ) ) as UNPIVTD2
/******************************************************************************************************************************/
        ON        [N2]        = [Nation_fk]
        AND       [Y2]        = [Question_Year]
        AND       [I2]        = [Index_Abbreviation]
/******************************************************************************************************************************/
        JOIN
/******************************************************************************************************************************/
        (
/******************************************************************************************************************************/
        SELECT 
                  [N3]        = [Nation_fk]
              ,   [Y3]        = [Question_Year]
              ,   [GRI]       = [GRI_scaled]    -- already scaled: don't re-cast
              ,   [SHI]       = [SHI_scaled]    -- already scaled: don't re-cast
              ,   [GFI]       = [GFI_scaled]    -- already scaled: don't re-cast
          FROM    [vr_03w_W&Extras_by_Ctry&Year]
/******************************************************************************************************************************/
        )                                                         B
/******************************************************************************************************************************/
        UNPIVOT
          (
             [I_Scaled_Value]
        FOR
             [I3]
        in (
                       [GRI]  /*** GRI Yindex scaled ***/
                     , [SHI]  /*** SHI Yindex scaled ***/
                     , [GFI]  /*** GFI Yindex scaled ***/
                                                       ) ) as UNPIVTD3
/******************************************************************************************************************************/
        ON        [N3]        = [Nation_fk]
        AND       [Y3]        = [Question_Year]
        AND       [I3]        = [Index_Abbreviation]
/******************************************************************************************************************************/
      )
/******************************************************************************************************************************/
/******************************************************************************************************************************/

/******************************************************************************************************************************/
SELECT * INTO    [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
FROM
--------------------------------------------------------------------------------------------------------------------------------
(
/******************************************************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [RIYv_row]           =  ROW_NUMBER()
                                 OVER(ORDER BY
                                                 [level]              DESC
                                               , [Nation_fk]
                                               , [Index_abbreviation]
                                               , [Year]                     )
--------------------------------------------------------------------------------------------------------------------------------
       , [Index_Year]
       , [level]
       , [Region5_code]
       , [Region6_code]
       , [Nation_fk]
       , [Region5]
       , [Region6]
       , [Ctry_EditorialName]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]
       , [I_Rounded_value]
       , [I_Scaled_value]     = CASE
                                    WHEN     [I_Scaled_value] IS NOT NULL         THEN [I_Scaled_value]
                                    WHEN     [Index_value] >= [low|lowest]
                                         AND [Index_value] <= [low|highest]       THEN 1
                                    WHEN     [Index_value] >= [moderate|lowest]
                                         AND [Index_value] <= [moderate|highest]  THEN 2
                                    WHEN     [Index_value] >= [high|lowest]
                                         AND [Index_value] <= [high|highest]      THEN 3
                                    WHEN     [Index_value] >= [very high|lowest]
                                         AND [Index_value] <= [very high|highest] THEN 4
                                END
       , [Year]
       , [ByRegion6]          = CASE
                                    WHEN [level] IN ( 1, 2   ) THEN 1
                                    ELSE                            0
                                END
       , [ByRegion5]          = CASE
                                    WHEN [level] IN ( 1, 2.5 ) THEN 1
                                    ELSE                            0
                                END
       , [ByWorld]           = CASE
                                    WHEN [level] IN ( 1, 3   ) THEN 1
                                    ELSE                            0
                                END
       , [ByWorld&Region]    = CASE
                                    WHEN [level] IN ( 2, 3   ) THEN 1
                                    ELSE                            0
                                END
FROM
/*** >>> country, region, and world joined to set of cutpoints ****************************************************************/
/******************************************************************************************************************************/
/*** country, region, and world  **********************************************************************************************/
(
/*** country level ************************************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  1
       , [Region5_code]
       , [Region6_code]
       , [Nation_fk]
       , [Region5]
       , [Region6]
       , [Ctry_EditorialName]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]
       , [I_Rounded_value]
       , [I_Scaled_value]
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
/************************************************************************************************************ country level ***/
UNION ALL
/*** median index by year and region 6 ****************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  2
       , [Region5_code]          =  CASE
                                        WHEN [Region6_code] = 1001                   THEN 1000
                                        WHEN [Region6_code] = 1002                   THEN 1000
                                        ELSE [Region6_code]
                                    END
       , [Region6_code]
       , [Nation_fk]             =           [Region6_code]
       , [Region5]               =  CASE
                                        WHEN [Region6] = 'North America'             THEN 'Americas'
                                        WHEN [Region6] = 'Latin America-Caribbean'   THEN 'Americas'
                                        ELSE [Region6]
                                    END
       , [Region6]
       , [Ctry_EditorialName]    =  'All countires in ' + [Region6]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]           =       (AVG([Index_value]))    /* avg 2 middle values if needed */
       , [I_Rounded_value]       = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
       , [I_Scaled_value]        = NULL
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
FROM
--------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************/
(
/*** > include StOrd & MedPos *************************************************************************************************/
/*     Notice that:                                                                                                           */
/*                  [StOrd]  will have the numeric sorting order of rows by values                                            */
/*                  [MedPos] will have the position in the sorted list:                                                       */
/*                           in three cases:  | 1  |  2  | 3 |                                                                */
/*                           the median is the second value:  (3+1)/2 = 2                                                     */
/******************************************************************************************************************************/
SELECT 
--------------------------------------------------------------------------------------------------------------------------------
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region6]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region6]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                 ,[Region6]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Region6_code]
      ,[Nation_fk]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
--------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************* < include StOrd & MedPos ***/
)                                                                                                                             B
/******************************************************************************************************************************/
/*     Notice that: In an odd number of observations, the position is an integer, then we can say:                            */
/*                  [StOrd] = [MedPos]                                                                                        */
/*                  In an even number of observations, the position is between the two middle values, then we need:           */
/*                  [StOrd] = ([MedPos] +/- 0.5)                                                                              */
/******************************************************************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/******************************************************************************************************************************/
/*  We can have one or two middle values, we group by the other variables                                                     */
/******************************************************************************************************************************/
GROUP BY
         [Region6_code]
       , [Region6]
       , [Year]
       , [Index_Year]
       , [Index_name]
       , [Index_abbreviation]
/****************************************************************************************** median index by year and region ***/
UNION ALL
/*** median index by year and region 5 ****************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  2.5
       , [Region5_code]
       , [Region6_code]          =  CASE
                                        WHEN [Region5_code] = 1000                   THEN NULL
                                        ELSE [Region5_code]
                                    END
       , [Nation_fk]             =           [Region5_code]
       , [Region5]
       , [Region6]               =  CASE
                                        WHEN [Region5] = 'Americas'                  THEN 'N.A. & L.A.-C.'
                                        ELSE [Region5]
                                    END
       , [Ctry_EditorialName]    =  'All countires in ' + [Region5]
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]           =       (AVG([Index_value]))    /* avg 2 middle values if needed */
       , [I_Rounded_value]       = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
       , [I_Scaled_value]        = NULL
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
FROM
--------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************/
(
/*** > include StOrd & MedPos *************************************************************************************************/
/*     Notice that:                                                                                                           */
/*                  [StOrd]  will have the numeric sorting order of rows by values                                            */
/*                  [MedPos] will have the position in the sorted list:                                                       */
/*                           in three cases:  | 1  |  2  | 3 |                                                                */
/*                           the median is the second value:  (3+1)/2 = 2                                                     */
/******************************************************************************************************************************/
SELECT 
--------------------------------------------------------------------------------------------------------------------------------
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region5]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region5]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                 ,[Region5]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Region5_code]
      ,[Nation_fk]
      ,[Region5]
      ,[Ctry_EditorialName]
      ,[Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
--------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************* < include StOrd & MedPos ***/
)                                                                                                                             B
/******************************************************************************************************************************/
/*     Notice that: In an odd number of observations, the position is an integer, then we can say:                            */
/*                  [StOrd] = [MedPos]                                                                                        */
/*                  In an even number of observations, the position is between the two middle values, then we need:           */
/*                  [StOrd] = ([MedPos] +/- 0.5)                                                                              */
/******************************************************************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/******************************************************************************************************************************/
/*  We can have one or two middle values, we group by the other variables                                                     */
/******************************************************************************************************************************/
GROUP BY
         [Region5_code]
       , [Region5]
       , [Year]
       , [Index_Year]
       , [Index_name]
       , [Index_abbreviation]
/****************************************************************************************** median index by year and region ***/
UNION ALL
/*** world median index by year ***********************************************************************************************/
SELECT
--------------------------------------------------------------------------------------------------------------------------------
         [Index_Year]
       , [level]                 =  3
       , [Region5_code]          =  10000
       , [Region6_code]          =  10000
       , [Nation_fk]             =  10000
       , [Region5]               =  'World'
       , [Region6]               =  'World'
       , [Ctry_EditorialName]    =  'All countires in the world'
       , [Index_abbreviation]
       , [Index_name]
       , [Index_value]           =       (AVG([Index_value]))    /* avg 2 middle values if needed */
       , [I_Rounded_value]       = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
       , [I_Scaled_value]        = NULL
       , [Year]
--------------------------------------------------------------------------------------------------------------------------------
FROM
--------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************/
(
/*** > include StOrd & MedPos *************************************************************************************************/
/*     Notice that:                                                                                                           */
/*                  [StOrd]  will have the numeric sorting order of rows by values                                            */
/*                  [MedPos] will have the position in the sorted list:                                                       */
/*                           in three cases:  | 1  |  2  | 3 |                                                                */
/*                           the median is the second value:  (3+1)/2 = 2                                                     */
/******************************************************************************************************************************/
SELECT 
--------------------------------------------------------------------------------------------------------------------------------
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Nation_fk]
      ,[Ctry_EditorialName]
      ,[Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
  FROM
--------------------------------------------------------------------------------------------------------------------------------
       PREv4                                                                                   /*** common table expression ***/
--------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************* < include StOrd & MedPos ***/
)                                                                                                                             B
/******************************************************************************************************************************/
/*     Notice that: In an odd number of observations, the position is an integer, then we can say:                            */
/*                  [StOrd] = [MedPos]                                                                                        */
/*                  In an even number of observations, the position is between the two middle values, then we need:           */
/*                  [StOrd] = ([MedPos] +/- 0.5)                                                                              */
/******************************************************************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/******************************************************************************************************************************/
/*  We can have one or two middle values, we group by the other variables                                                     */
/******************************************************************************************************************************/
GROUP BY
         [Year]
       , [Index_Year]
       , [Index_name]
       , [Index_abbreviation]
/******************************************************************************************************************************/
)                                                                                                                           CRW
/*********************************************************************************************** country, region, and world ***/
JOIN
(
/*** > set of cutpoints to calculate scaled values ****************************************************************************/
  SELECT *
    FROM
         (
           SELECT 
                   DISTINCT                                            /* so, no need to select year   */
                   [LP]         = [Level] + '|' + [Point]
                  ,[CutPoint]
                  ,[Field_type]
              FROM [forum].[dbo].[Pew_Index_Cut_Points]
                 , [forum].[dbo].[Pew_Field]
             WHERE
                   [Field_fk]
                  =[Field_pk]
                                                                ) AS P /* alias of table to be pivoted */
    PIVOT (AVG ([CutPoint]) 
           FOR  [LP]
            IN (
                      [low|lowest]
                    , [low|highest]
                    , [moderate|lowest]
                    , [moderate|highest]
                    , [high|lowest]
                    , [high|highest]
                    , [very high|lowest]
                    , [very high|highest]
                                            ))  as pivoted
/**************************************************************************** < set of cutpoints to calculate scaled values ***/
)                                                                                                                            CP
/******************************************************************************************************************************/
ON
         [Index_abbreviation]
       = [Field_type]
/******************************************************************************************************************************/
/**************************************************************** <<< country, region, and world joined to set of cutpoints ***/
/******************************************************************************************************************************/
)  formerview
--------------------------------------------------------------------------------------------------------------------------------
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _010_lt__w05_vrw_SemiWd_byCnYr_________R.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]                           <<<<<     ***/
/***             This table only includes numeric values aggregated by country/religion & year (does not include descriptive wordings).                      ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]
SELECT * INTO    [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]
FROM
/***************************************************************************************************************************************************************/
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
(
SELECT 
           [byCY_row]           =  ROW_NUMBER()
                                   OVER(ORDER BY
                                                   [Nation_fk]
                                                 , [Question_Year] )
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
      ,    [Nation_fk]
      ,    [Ctry_EditorialName]
      ,    [UN_TotalPopulation]
      ,    [Region5]
      ,    [Region6]
      ,    [Question_Year]
      , IV.[GRI]
      , RV.[GRI_rd_1d]
      , SV.[GRI_scaled]
      , IV.[SHI]
      , RV.[SHI_rd_1d]
      , SV.[SHI_scaled]
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
(                                                                               /*** parenthesis to include query for the cell to be stuffed                ***/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [COLUMN_NAME]                                                         /*** Fiels including all Q Abb Std (StdVarName)                              ***/
    FROM                                                                        /*** from...                                                                 ***/
          [INFORMATION_SCHEMA].[COLUMNS]                                        /*** name of the sys view which includes all field (var) names as rows       ***/
WHERE                                                                           /*** FILTER:                                                                 ***/
          [TABLE_NAME] = 'vr_03w_W&Extras_by_Ctry&Year'                         /*** only the view vr_03                                                     ***/
  AND                                                                           /*** FILTER:                                                                 ***/
          [COLUMN_NAME] NOT IN (  'Nation_fk'                                   /*** exclude fileds initialy listed                                          ***/
                                 ,'Region5'                                     /***                                                                         ***/
                                 ,'Region6'                                     /***                                                                         ***/
                                 ,'Ctry_EditorialName'                          /***                                                                         ***/
                                 ,'Question_Year'                               /***                                                                         ***/
                                 ,'GRI'                                         /***                                                                         ***/
                                 ,'GRI_rd_1d'                                   /***                                                                         ***/
                                 ,'GRI_scaled'                                  /***                                                                         ***/
                                 ,'SHI'                                         /***                                                                         ***/
                                 ,'SHI_rd_1d'                                   /***                                                                         ***/
                                 ,'SHI_scaled'            )                     /***                                                                         ***/
         ORDER BY                                                               /*** sorting order usesd to order stored & extra variables alphabetically    ***/
          ', '                                                                  /*** including comma delimiter                        -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          [COLUMN_NAME]                                                         /*** Fiels including all Q Abb Std (StdVarName)       -> as part of sorting  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > main dataset ------------------------------------------------------------------------------------------------------------------------------------------*/
N'
  FROM [vr_03w_W&Extras_by_Ctry&Year]
'
/*--- < main dataset ------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > population --------------------------------------------------------------------------------------------------------------------------------------------*/
N'
     , (  SELECT 
                  [FYr]                 = [Field_year]
                , [Nfk]                 = [Nation_fk]
                , [UN_TotalPopulation]  =  CAST([Cnt] AS BIGINT)
             FROM [forum].[dbo].[Pew_Nation_Age_Sex_Value]
                , [forum].[dbo].[Pew_Field]
           WHERE  [Sex_fk]       = 0
             AND  [Age_fk]       = 0
             AND  [Scenario_id]  = 3
             AND  [Field_fk]
                = [Field_pk]                                ) POP
'
/*--- < population --------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > adjusted rounding of indexes --------------------------------------------------------------------------------------------------------------------------*/
N'
     , (  SELECT 
                  [Niv]        = [Nation_fk]
                , [Yiv]        = [YEAR]
                , [GRI]
                , [SHI]
            FROM  (  SELECT [level]
                           ,[Nation_fk]
                           ,[Year]
                           ,[Ctry_EditorialName]
                           ,[Index_abbreviation]
                           ,[Index_value]
                       FROM [vr_04w_R&H_Index_by_CtryRegion&Yr]
                      WHERE [level] = 1                                    ) rI
            PIVOT (AVG( [Index_value] )
                   FOR  [Index_abbreviation]
                    IN( [GRI]
                       ,[SHI] )) AS pvt                                         ) IV
     , (  SELECT 
                  [Nrv]        = [Nation_fk]
                , [Yrv]        = [YEAR]
                , [GRI_rd_1d]  = [GRI]
                , [SHI_rd_1d]  = [SHI]
            FROM  (  SELECT [level]
                           ,[Nation_fk]
                           ,[Year]
                           ,[Ctry_EditorialName]
                           ,[Index_abbreviation]
                           ,[I_Rounded_value]
                       FROM [vr_04w_R&H_Index_by_CtryRegion&Yr]
                      WHERE [level] = 1                                    ) rI
            PIVOT (AVG( [I_Rounded_value] )
                   FOR  [Index_abbreviation]
                    IN( [GRI]
                       ,[SHI] )) AS pvt                                         ) RV
     , (  SELECT 
                  [Nsv]        = [Nation_fk]
                , [Ysv]        = [YEAR]
                , [GRI_scaled] = CAST([GRI] AS DECIMAL(38,2))
                , [SHI_scaled] = CAST([SHI] AS DECIMAL(38,2))
            FROM  (  SELECT [level]
                           ,[Nation_fk]
                           ,[Year]
                           ,[Ctry_EditorialName]
                           ,[Index_abbreviation]
                           ,[I_Scaled_value]
                       FROM [vr_04w_R&H_Index_by_CtryRegion&Yr]
                      WHERE [level] = 1                                    ) rI
            PIVOT (AVG( [I_Scaled_value] )
                   FOR  [Index_abbreviation]
                    IN( [GRI]
                       ,[SHI] )) AS pvt                                         ) SV
'
/*--- < adjusted rounding of indexes --------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > join onditions ----------------------------------------------------------------------------------------------------------------------------------------*/
N'
WHERE         [Nfk]        = [Nation_fk]
  AND         [Niv]        = [Nation_fk]
  AND         [Nrv]        = [Nation_fk]
  AND         [Nsv]        = [Nation_fk]
  AND         [FYr]        = [Question_Year]
  AND         [Yiv]        = [Question_Year]
  AND         [Yrv]        = [Question_Year]
  AND         [Ysv]        = [Question_Year]
) formerview
'
/*--- < join onditions ----------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
	EXEC              (@ALLCODE)                                    /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _010_lt__w05_vrw_SemiWd_byCnYr_________R-test.sql                                                                                                                
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]                           <<<<<     ***/
/***             This table only includes numeric values aggregated by country/religion & year (does not include descriptive wordings).                      ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/*
N'
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]
SELECT * INTO    [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]
FROM
/***************************************************************************************************************************************************************/
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
*/

N'
SELECT * 
FROM
'
+


/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
(
SELECT 
           [byCY_row]           =  ROW_NUMBER()
                                   OVER(ORDER BY
                                                   [Nation_fk]
                                                 , [Question_Year] )
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
      ,    [Nation_fk]
      ,    [Ctry_EditorialName]
      ,    [UN_TotalPopulation]
      ,    [Region5]
      ,    [Region6]
      ,    [Question_Year]
      , IV.[GRI]
      , RV.[GRI_rd_1d]
      , SV.[GRI_scaled]
      , IV.[SHI]
      , RV.[SHI_rd_1d]
      , SV.[SHI_scaled]
'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
(                                                                               /*** parenthesis to include query for the cell to be stuffed                ***/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [COLUMN_NAME]                                                         /*** Fiels including all Q Abb Std (StdVarName)                              ***/
    FROM                                                                        /*** from...                                                                 ***/
          [INFORMATION_SCHEMA].[COLUMNS]                                        /*** name of the sys view which includes all field (var) names as rows       ***/
WHERE                                                                           /*** FILTER:                                                                 ***/
          [TABLE_NAME] = 'vr_03w_W&Extras_by_Ctry&Year'                         /*** only the view vr_03                                                     ***/
  AND                                                                           /*** FILTER:                                                                 ***/
          [COLUMN_NAME] NOT IN (  'Nation_fk'                                   /*** exclude fileds initialy listed                                          ***/
                                 ,'Region5'                                     /***                                                                         ***/
                                 ,'Region6'                                     /***                                                                         ***/
                                 ,'Ctry_EditorialName'                          /***                                                                         ***/
                                 ,'Question_Year'                               /***                                                                         ***/
                                 ,'GRI'                                         /***                                                                         ***/
                                 ,'GRI_rd_1d'                                   /***                                                                         ***/
                                 ,'GRI_scaled'                                  /***                                                                         ***/
                                 ,'SHI'                                         /***                                                                         ***/
                                 ,'SHI_rd_1d'                                   /***                                                                         ***/
                                 ,'SHI_scaled'            )                     /***                                                                         ***/
         ORDER BY                                                               /*** sorting order usesd to order stored & extra variables alphabetically    ***/
          ', '                                                                  /*** including comma delimiter                        -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          [COLUMN_NAME]                                                         /*** Fiels including all Q Abb Std (StdVarName)       -> as part of sorting  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > main dataset ------------------------------------------------------------------------------------------------------------------------------------------*/
N'
  FROM [vr___03_cDB_W&Xtra_byCtry&Year]
'
/*--- < main dataset ------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > population --------------------------------------------------------------------------------------------------------------------------------------------*/
N'
     , (  SELECT 
                  [FYr]                 = [Field_year]
                , [Nfk]                 = [Nation_fk]
                , [UN_TotalPopulation]  =  CAST([Cnt] AS BIGINT)
             FROM [forum].[dbo].[Pew_Nation_Age_Sex_Value]
                , [forum].[dbo].[Pew_Field]
           WHERE  [Sex_fk]       = 0
             AND  [Age_fk]       = 0
             AND  [Scenario_id]  = 3
             AND  [Field_fk]
                = [Field_pk]                                ) POP
'
/*--- < population --------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > adjusted rounding of indexes --------------------------------------------------------------------------------------------------------------------------*/
N'
     , (  SELECT 
                  [Niv]        = [Nation_fk]
                , [Yiv]        = [YEAR]
                , [GRI]
                , [SHI]
            FROM  (  SELECT [level]
                           ,[Nation_fk]
                           ,[Year]
                           ,[Ctry_EditorialName]
                           ,[Index_abbreviation]
                           ,[Index_value]
                       FROM [vr_04w_R&H_Index_by_CtryRegion&Yr]
                      WHERE [level] = 1                                    ) rI
            PIVOT (AVG( [Index_value] )
                   FOR  [Index_abbreviation]
                    IN( [GRI]
                       ,[SHI] )) AS pvt                                         ) IV
     , (  SELECT 
                  [Nrv]        = [Nation_fk]
                , [Yrv]        = [YEAR]
                , [GRI_rd_1d]  = [GRI]
                , [SHI_rd_1d]  = [SHI]
            FROM  (  SELECT [level]
                           ,[Nation_fk]
                           ,[Year]
                           ,[Ctry_EditorialName]
                           ,[Index_abbreviation]
                           ,[I_Rounded_value]
                       FROM [vr_04w_R&H_Index_by_CtryRegion&Yr]
                      WHERE [level] = 1                                    ) rI
            PIVOT (AVG( [I_Rounded_value] )
                   FOR  [Index_abbreviation]
                    IN( [GRI]
                       ,[SHI] )) AS pvt                                         ) RV
     , (  SELECT 
                  [Nsv]        = [Nation_fk]
                , [Ysv]        = [YEAR]
                , [GRI_scaled] = CAST([GRI] AS DECIMAL(38,2))
                , [SHI_scaled] = CAST([SHI] AS DECIMAL(38,2))
            FROM  (  SELECT [level]
                           ,[Nation_fk]
                           ,[Year]
                           ,[Ctry_EditorialName]
                           ,[Index_abbreviation]
                           ,[I_Scaled_value]
                       FROM [vr_04w_R&H_Index_by_CtryRegion&Yr]
                      WHERE [level] = 1                                    ) rI
            PIVOT (AVG( [I_Scaled_value] )
                   FOR  [Index_abbreviation]
                    IN( [GRI]
                       ,[SHI] )) AS pvt                                         ) SV
'
/*--- < adjusted rounding of indexes --------------------------------------------------------------------------------------------------------------------------*/
+
/*--- > join onditions ----------------------------------------------------------------------------------------------------------------------------------------*/
N'
WHERE         [Nfk]        = [Nation_fk]
  AND         [Niv]        = [Nation_fk]
  AND         [Nrv]        = [Nation_fk]
  AND         [Nsv]        = [Nation_fk]
  AND         [FYr]        = [Question_Year]
  AND         [Yiv]        = [Question_Year]
  AND         [Yrv]        = [Question_Year]
  AND         [Ysv]        = [Question_Year]
) formerview
'
/*--- < join onditions ----------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
--	EXEC              (@ALLCODE)                                    /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _011_lt__w06_vrw_LongData_ALL__________R.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
/***                                                                                                                                                  ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[vr_LongCodedData_in_DB]                                  <<<<<     ***/
/***             This view includes numeric values and wordings, as stored & aggregated by country/religion & year & variable (long format)           ***/
/***                                                                                                                                                  ***/
/********************************************************************************************************************************************************/
/*  complete (unfiltered) view could be stored in   *****************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE varchar(max)
declare @CODEBEG varchar(max)
declare @MYCODE1 varchar(max)
declare @MYCODE2 varchar(max)
declare @MYCODE3 varchar(max)
declare @MYCODE4 varchar(max)
declare @MYCODE5 varchar(max)
declare @ENDCODE varchar(max)
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @CODEBEG = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vr_06w_LongData_ALL]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
SELECT * INTO    [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
FROM
(
/***************************************************************************************************************************************************************/
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
       [v_Basic_row] = ROW_NUMBER()OVER(ORDER BY
                                                  [Nation_fk]
                                                 ,[Question_Year]
                                                 ,[QA_std]
                                                 ,[Locality_fk]
                                                 ,[Answer_fk]     )
      ,[ValSource]
      ,[entity]
      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[answer_wording_std]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
      ,[editable]               = CASE
                                       WHEN [note] LIKE ''%this field can be edited'' THEN 1
                                       WHEN [note] LIKE ''%eld should NOT be edited'' THEN 0
                                  END
      ,[CntWg]
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > (begin seleccion from) ALL SETS OF DATA  ****************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
FROM
(
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < (begin seleccion from) ALL SETS OF DATA  ****************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE1 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > Basic Data: NPR  ****************************************************************************************************************************************/
---   Long set of data including numeric values and descriptive wordings.
---   At levels: country, country/religious group, & country/province
---   Notes
---        - In order to keep consistent to previuos years, data by Province currently belonging to South Sudan
---          should considered data for Sudan before 2010
---        - In order to avoid changing the final set,data previously used for Northern Cyprus
---          should be excluded (current decision)
---        - Although we have REAL data by province for North Korea, we do not use them
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr01LNA''
      , [entity]             = CASE
                                    WHEN [entity]         = ''CR&P'' THEN ''Not Yet Stored in DB''
                                    WHEN [entity]         = ''Ctry'' THEN ''Stored by Country''
                                    WHEN [entity]         = ''RGrp'' THEN ''Stordred by Religion Group (& Ctry)''
                                    WHEN [Question_Year]  < 2012
                                     AND [entity]         = ''Prov'' THEN ''Stored by Locality (should be aggregated)''
                                    WHEN [Question_Year] >= 2012
                                     AND [entity]         = ''Prov'' THEN ''Stored by Country (using Locality code)''
                               END
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field can be edited''
      , [link_fk]
      , [Nation_fk]
      , [Locality_fk]
      , [Religion_fk]
      , [Region5]
      , [Region6]
      , [Ctry_EditorialName]
      , [Locality]           = CASE
                                    WHEN [Locality]       = '''' THEN ''not detailed''
                                    WHEN [Locality]      != '''' THEN [Locality]
                               END
      , [Religion]           = CASE
                                    WHEN [Religion]       = '''' THEN ''not detailed''
                                    WHEN [Religion]      != '''' THEN [Religion]
                               END
      , [Question_Year]
      , [QA_std]             = CASE
                                    WHEN [Question_Year]  < 2012
                                     AND [entity]         = ''Prov'' THEN [QA_std] + ''__p''
                                    ELSE                                  [QA_std]
                               END
      , [QW_std]
 --   , [Answer_value]
      , [Answer_value]       =      CAST([Answer_value] AS nvarchar)
      , [answer_wording]
      , [answer_wording_std]
      , [Question_fk]
      , [Answer_fk]
      , [Notes]
      , [CntWg]              = 1
FROM
        [vr___01_cDB_Long__NoAggregated]


'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*****************************************************************************************************************************************  Basic Data: NPR  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE2 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > PDAbC province data (before 2012) aggregated at country level  ******************************************************************************************/
---   Long set of data aggregating both numeric values and descriptive wordings.
---   (Notes same as above)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource]          = ''vr05WCY''
      , [entity]             = ''Province, aggregated by Country''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       D1.[Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       D1.[Region5]
      , [Region6]            =       D1.[Region6]
      , [Ctry_EditorialName] =       D1.[Ctry_EditorialName]
      , [Locality]           = ''aggregated by country''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       D2.[Question_Year]
      , [QA_std]             =       D2.[QA_std]
      , [QW_std]             =       D2.[QW_std]
      , [Answer_value]       = CASE
                               WHEN  D3.[Answer_value] IS NULL
                               THEN  ''0''
                               ELSE
                                CAST(D3.[Answer_value] AS nvarchar)
                               END
      , [Answer_wording]     = CASE
                               WHEN  D3.[Answer_wording] IS NULL
                               THEN  ''not detailed''
                               ELSE  D3.[Answer_wording]
                               END
      , [Answer_wording_std] = CASE
                               WHEN  D3.[Answer_wording_std] IS NULL
                               THEN  ''No cases were found''
                               ELSE  D3.[Answer_wording_std]
                               END
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
  FROM 
       ( SELECT 
                DISTINCT
                [Nation_fk]
               ,[Region5]
               ,[Region6]
               ,[Ctry_EditorialName]
               ,[Question_Year]      AS [QY]
           FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
          WHERE    [Question_Year]  < 2012                             )  D1
INNER JOIN
       ( SELECT 
                DISTINCT
                [Question_Year]
               ,[QA_std]         /* SHI_04_b not coded for 2008 */
               ,[QW_std]
               ,[Question_fk]
           FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
          WHERE    [entity]         = ''Prov''
            AND    [Question_Year]  < 2012                             )  D2
   ON      D1.[QY]
         = D2.[Question_Year]
LEFT JOIN
(
SELECT
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]         = SUM([Answer_value])
      ,[answer_wording]       = STUFF(
                                      ( SELECT 
                                                ''|''
                                              + ISNULL([Answer_wording], '''')
                                         FROM         
                                                    ( SELECT *
                                                        FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
                                                       WHERE    [entity]         = ''Prov''
                                                         AND    [Question_Year]  < 2012                             )  S2
                                        WHERE      S1.[Nation_fk]
                                                 = S2.[Nation_fk]
                                             AND   S1.[Question_Year]
                                                 = S2.[Question_Year]
                                             AND   S1.[QA_std]
                                                 = S2.[QA_std]
                                     FOR XML PATH('''') ), 1, 1, '''')
      ,[answer_wording_std]
      ,[Question_fk]
  FROM 
       ( SELECT *
           FROM    [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated]
          WHERE    [entity]         = ''Prov''
            AND    [Question_Year]  < 2012                             )  S1
GROUP BY
          [Nation_fk]
        , [Region5]
        , [Region6]
        , [Ctry_EditorialName]
        , [Question_Year]
        , [QA_std]
        , [QW_std]
        , [answer_wording_std]
        , [Question_fk]
                                                                                                                                                    )  D3
   ON      D1.[Nation_fk]
         = D3.[Nation_fk]
  AND      D2.[Question_Year]
         = D3.[Question_Year]
  AND      D2.[QA_std]
         = D3.[QA_std]
  AND      D2.[QW_std]
         = D3.[QW_std]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*************************************************************************************************************************************  province data PDAbC  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE3 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > ACVbC other aggregated and calculated variables by country  *********************************************************************************************/
---   Long set of data aggregating both numeric values and descriptive wordings.
/***************************************************************************************************************************************************************/
/*** > major select statement for ACVbC  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr05WCY''
--    ,                        ACVC.[QA_link]
--    ,                        ACVC.[AV_link]
      , [entity]             = ''Calculated & Aggregated variables''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       ACVC.[Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       ACVC.[Region5]
      , [Region6]            =       ACVC.[Region6]
      , [Ctry_EditorialName] =       ACVC.[Ctry_EditorialName]
      , [Locality]           = ''not detailed''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       ACVC.[Question_Year]
      , [QA_std]             =       ACVC.[QA_std]
      , [QW_std]             =       QAWD.[QW_std]
 --   , [Answer_value]       =       ACVC.[Answer_value]
      , [Answer_value]       =  CAST(ACVC.[Answer_value] AS nvarchar)
      , [Answer_wording]     = ''not detailed''
      , [Answer_wording_std] =       QAWD.[AW_std]
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
FROM
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < major select statement fro ACVbC  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** >                                .  ***********************************************************************************************************************/
/*=============================================================================================================================================================*/
                                                                                /*** begining of query Lev2 enclosed between parenthesis                     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
( SELECT
         [AV_link] = CASE WHEN [Answer_value] >= 2
                           AND [QA_std]        = ''GRI_19_x''
                          THEN  1
                          WHEN [QA_std]        = ''GRI_20''
                          THEN  0
                          ELSE [Answer_value]            END

      ,  [QA_link] =
             CASE 
                  WHEN                 [QA_std] LIKE ''%_ny%'' 
                  THEN STUFF(          [QA_std]      ,         
                  ((CHARINDEX(''_ny'', [QA_std])) + 3) , 1, '''')
                  ELSE                 [QA_std]
                  END
       , *
    FROM  [forum_ResAnal].[dbo].[vr___03_cDB_W&Xtra_byCtry&Year]   SWCY
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'  UNPIVOT  '
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** beginning of unpivoting specifications                                  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
  (
     [Answer_value]
FOR
     [QA_std]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** beginning of listing of variables                                       ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
in (
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** List variables: Begin stuffing function to remove the first comma in the list to be retrieved (parenthesis not needed) ************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [COLUMN_NAME]                                                         /*** field in system view which includes all field names                     ***/
    FROM                                                                        /*** from...                                                                 ***/
          [INFORMATION_SCHEMA].[COLUMNS]                                  TabA  /*** name of the system view which includes all field names                  ***/
	LEFT JOIN                                                                   /*** joined to a query...                                                    ***/
		( SELECT DISTINCT                                                       /*** SELECT (+ DISTINCT) statement                                           ***/
					[QA_std]                                                       /*** all variable names before aggregating data                              ***/
			FROM [forum_ResAnal].[dbo].[vr___01_cDB_Long__NoAggregated] ) TabB  /*** from NPR long view which includes all original variables' names         ***/
		ON                  [COLUMN_NAME] = [QA_std]                              /*** matching by field/variable names                                        ***/
	WHERE                                                                       /*** begining of filters to be applied...                                    ***/
          [TABLE_NAME]  = 'vr___03_cDB_W&Xtra_byCtry&Year'                      /*** TO INCLUDE ONLY desired view including calculated/aggegated fields      ***/
    AND                                                                         /*** second filter to be applied...                                          ***/
          [QA_std]         IS NULL                                              /*** new calculated/aggegated fields do not match                            ***/
    AND                                                                         /*** third filter to be applied...                                           ***/
          [COLUMN_NAME]    NOT IN (                                             /*** exclude field names not correspnding to calculated/aggegated vars       ***/
                                     'Nation_fk'                                /*** ...                                                                     ***/
                                   , 'Ctry_EditorialName'                       /*** ...                                                                     ***/
                                   , 'Question_Year'                            /*** ...                                                                     ***/
                                   , 'Region5'                                  /*** ...                                                                     ***/
                                   , 'Region6'                                  /*** ...                                                                     ***/
                             --    , 'UN_TotalPopulation'                       /*** ...  not added yet - 2016/01/14                                         ***/
                                   , 'GFI'                                      /*** ...  DECIMAL(38,32)  instead of  (38,2)                                 ***/
                                   , 'GRI'                                      /*** ...  DECIMAL(38,32)  instead of  (38,2)                                 ***/
                                   , 'SHI'                                      /*** ...  DECIMAL(38,32)  instead of  (38,2)                                 ***/
                                   , 'GFI_rd_1d'                                /*** ...  DECIMAL(38,1)   instead of  (38,2)                                 ***/
                                   , 'GRI_rd_1d'                                /*** ...  DECIMAL(38,1)   instead of  (38,2)                                 ***/
                                   , 'SHI_rd_1d'                                /*** ...  DECIMAL(38,1)   instead of  (38,2)                                 ***/
                                                                         )      /*** end of third filter                                                     ***/
    FOR XML PATH('')                                                            /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                               /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N' 
   )    '
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end of listing of variables                                             ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'    )                                                         AS   MUPV    '
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end (& alias) of unpivoting specifications                              ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
                                                                                                                                                     )  AS ACVC
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end & alias of query Lev2 enclosed between parenthesis                  ***/
/*=============================================================================================================================================================*/
/*** <                                .  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'LEFT JOIN'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** >                                .  ***********************************************************************************************************************/
/*=============================================================================================================================================================*/
                                                                                /*** begining of query Lev2 enclosed between parenthesis                     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
( SELECT 
         [QAStd_pk]
       , [QA_std]    = [Question_abbreviation_std]
       , [QW_std]    = [Question_wording_std]
       , [QsWstd]    = [Question_short_wording_std]
       , [AV_std]    = [Answer_value_std]
       , [AW_std]    = [Answer_Wording_std]
    FROM
         [forum].[dbo].[Pew_Q&A_Std]
   WHERE
         [Question_abbreviation_std] LIKE ''[S,G,X][F,H,R,S]%''                                                                  )  AS QAWD
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                /*** end & alias of query Lev2 enclosed between parenthesis                  ***/
/*=============================================================================================================================================================*/
/*** <                                .  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N' ON
     (       ACVC.[QA_link]
           = QAWD.[QA_std]
       AND   ACVC.[AV_link]
           = QAWD.[AV_std]         )
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************************************  aggregated/calculated data ACVbC  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE4 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > uIbCR (unrounded) indexes aggregated by country and median indexes by regions  **************************************************************************/
---   Long set of data coming directly from set of indexes.
/***************************************************************************************************************************************************************/
/*** > major select statement for uIbCR  ***********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr04uICY''
      , [entity]             = ''Indexes & Median Indexes''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       [Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       [Region5]
      , [Region6]            =       [Region6]
      , [Ctry_EditorialName] =       [Ctry_EditorialName]
      , [Locality]           = ''not detailed''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       [Year]
      , [QA_std]             =       [Index_abbreviation]
      , [QW_std]             =       [Index_name]
      , [Answer_value]       =  CASE
                                    WHEN                                       [Index_value]                       =  0    THEN  ''0''
                                    WHEN                                       [Index_value]                       = 10    THEN ''10''
                                    ELSE LEFT                           ((CAST([Index_value] AS nvarchar(max))), 
                                          (LEN                          ((CAST([Index_value] AS nvarchar(max))))
                                           - PATINDEX(''%[1-9]%'', REVERSE((CAST([Index_value] AS nvarchar(max))))) + 1)  )
                                    END
      , [Answer_wording]     = ''not detailed''
      , [Answer_wording_std] = ''scale 0 - [+.] - 10''
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
FROM
        [vr_04w_R&H_Index_by_CtryRegion&Yr]
'
/********************************************************************************************************  country indexes & by region median indexes uIbCR  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @MYCODE5 = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** > RIbCR indexes aggregated by country and median indexes by regions (rounded to one decimal)  *************************************************************/
---   Long set of data coming directly from set of indexes.
/***************************************************************************************************************************************************************/
/*** > major select statement for RIbCR  **********************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
SELECT
        [ValSource] =   ''vr04RICY''
      , [entity]             = ''Indexes & Median Indexes''
      , [note]               = ''updated on '' + CONVERT(VARCHAR(11),GETDATE(),9) + '' --  this field should NOT be edited''
      , [link_fk]            = NULL
      , [Nation_fk]          =       [Nation_fk]
      , [Locality_fk]        = NULL
      , [Religion_fk]        = NULL
      , [Region5]            =       [Region5]
      , [Region6]            =       [Region6]
      , [Ctry_EditorialName] =       [Ctry_EditorialName]
      , [Locality]           = ''not detailed''
      , [Religion]           = ''not detailed''
      , [Question_Year]      =       [Year]
      , [QA_std]             =       [Index_abbreviation] + ''_rd_1d''
      , [QW_std]             =       [Index_name]         + '' (rounded to one decimal)''
      , [Answer_value]       =  CAST([I_Rounded_value] AS nvarchar)
      , [Answer_wording]     = ''not detailed''
      , [Answer_wording_std] = ''scale 0.0 - [+.1] - 10.0''
      , [Question_fk]        =  NULL
      , [Answer_fk]          =  NULL
      , [Notes]              = ''not detailed''
      , [CntWg]              = 1
FROM
        [vr_04w_R&H_Index_by_CtryRegion&Yr]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/************************************************************************************************  rounded country indexes & by region median indexes RIbCR  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @ENDCODE = 
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > (finalize seleccion from) ALL SETS OF DATA  *************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
)  ASoD
)  FormerView
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < (finalize seleccion from) ALL SETS OF DATA  *************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<    <<<     ***/
/***************************************************************************************************************************************************************/


/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***     >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        @CODEBEG                                                    /***                - initial code -                                                     ***/
    +   @MYCODE1                                                    /***   NPR          [vr_01w_DB_Long_NoAggregated]            ------>     170,623         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE2                                                    /***   PDAbC       *Province, aggregated by Country          ------>      27,608         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE3                                                    /***   ACVbC       *Calculated & Aggregated variables        ------>      78,908         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE4                                                    /***   uIbCR       *Country & Region (unrounded) indexes     ------>       4,398         ***/
    + N'UNION ALL'                                                  /***                - link -                                                             ***/
    +   @MYCODE5                                                    /***   RIbCR       *Country & Region rounded indexes (.X)    ------>       4,398         ***/
    +   @ENDCODE                                                    /***                - final code -                                                       ***/
                                                                    /***                                                                     285,935         ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***     <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<     ***/
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--	EXEC dbo.LongPrint @CODEBEG                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE1                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE2                                     /***        display the currently stored code (to be executed)                           ***/
	EXEC dbo.LongPrint @MYCODE3                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE4                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @MYCODE5                                     /***        display the currently stored code (to be executed)                           ***/
--	EXEC dbo.LongPrint @ENDCODE                                     /***        display the currently stored code (to be executed)                           ***/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
/***************************************************************************************************************************************************************/
--	EXEC              (@MYCODE1)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE2)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE3)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE4)                                    /***        ... partial excecution ...                                                   ***/
--	EXEC              (@MYCODE5)                                    /***        ... partial excecution ...                                                   ***/
/***************************************************************************************************************************************************************/
--		EXEC dbo.LongPrint @ALLCODE                                 /***        display the currently stored code (to be executed)                           ***/
/***************************************************************************************************************************************************************/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
--		EXEC  (@ALLCODE)
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _012_lt__w07_vrw_weights_______________R.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
/***                                                                                                                                                  ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[vr_07w_weights]                                          <<<<<     ***/
/***             This view includes numeric weights by year at different levels of aggregation                                                        ***/
/***                                                                                                                                                  ***/
/********************************************************************************************************************************************************/
/*  complete (unfiltered) view could be stored in   *****************************************************************************************************/
USE [forum_ResAnal]
GO
/********************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal].[dbo].[vr_07w_weights]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal].[dbo].[vr_07w_weights]
SELECT * INTO   [forum_ResAnal].[dbo].[vr_07w_weights]
FROM
(
/********************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT 
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
      [v_Basic_row]  = ROW_NUMBER()OVER(ORDER BY [Nation_fk], [Question_Year])
    , [Nation_fk]
    , [Question_Year]
    , [WTWg]         = (CAST( (1/ (SUM([cw]) OVER(PARTITION BY [Question_Year]           ))) AS DECIMAL(10,8))) * 100
    , [R5Wg]         = (CAST( (1/ (SUM([cw]) OVER(PARTITION BY [Question_Year], [Region5]))) AS DECIMAL(10,8))) * 100
    , [R6Wg]         = (CAST( (1/ (SUM([cw]) OVER(PARTITION BY [Question_Year], [Region6]))) AS DECIMAL(10,8))) * 100
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
    (
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT 
       DISTINCT
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[cw]                = CAST([CntWg] AS DECIMAL(10,8))
  FROM [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
 WHERE
       [Nation_fk]  < 1000
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
    )                                                                                                                                            DistCtry
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
--ORDER BY [Nation_fk], [Question_Year]
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
/********************************************************************************************************************************************************/
    )                                                                                                                                          CalcWights
/********************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _013_lt__w08_vr__QAttributes___________R.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
/***                                                                                                                                                  ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[vr_07w_weights]                                          <<<<<     ***/
/***             This view includes numeric weights by year at different levels of aggregation                                                        ***/
/***                                                                                                                                                  ***/
/********************************************************************************************************************************************************/
/*  complete (unfiltered) view could be stored in   *****************************************************************************************************/
USE [forum_ResAnal]
GO
/********************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal].[dbo].[vr_08__QAttributes]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal].[dbo].[vr_08__QAttributes]
SELECT * INTO   [forum_ResAnal].[dbo].[vr_08__QAttributes]
FROM
(
-- query should be updated once [Pew_Question_Attribute] is properly created in [forum]
--- CHECK!!! script Chg__Pew_Question_Attribute_... in folder UpdateDatabase
/********************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT 
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
       [VxQAttr]
      ,[Question_Std_fk]
      ,[Variable]
      ,[attk]
      ,[attr]
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
       [forum_ResAnal].[dbo].[Pew_Question_Attribute]
/*------------------------------------------------------------------------------------------------------------------------------------------------------*/
/********************************************************************************************************************************************************/
    )                                                                                                                                          AttrsInUse
/********************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _014_lt__w99_trw____AFTER__ALL_________R.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>         This is the script used to recreate lookup tables in the database  [GRSHR_admin]                               <<<<<     ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
USE [GRSHR_admin]
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  cursor                                                                    ***/
DECLARE @CODEmain1 nvarchar(max)                          /***        declare variable for storing code during each data retreival              ***/
DECLARE @tablename nvarchar(max)                          /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor   CURSOR FOR                             /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
SELECT      [TABLE_NAME]                                  /*** >>>    select table names                                                        ***/
FROM        [INFORMATION_SCHEMA].[TABLES]                 /***        from the system view listing tables & views in the database               ***/
WHERE       [TABLE_TYPE] =    'BASE TABLE'                /*** <<<    filter to display only tables (excluding views)                           ***/
  AND  (    [TABLE_NAME] LIKE 'EnteredData_%'             /*** <<<    filter to display only selected tables (following name pattern)           ***/
         OR [TABLE_NAME] LIKE 'Index_by_%'                /*** <<<    filter to display only selected tables (following name pattern)           ***/
         OR [TABLE_NAME] LIKE 'AllData_%'           )     /*** <<<    filter to display only selected tables (following name pattern)           ***/


/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEmain1 =                                      /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
       DROP TABLE [' + @tablename + ']
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
PRINT  (@CODEmain1)                                       /***        display the currently stored code (to be executed)                        ***/
EXEC   (@CODEmain1)                                       /***        execute the code that has been stored as text                             ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  cursor                                                                    ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
DECLARE @CrDt      varchar(8)                             /***        declare variable for storing current date as YYYYMMDD                     ***/
SET     @CrDt      = (CONVERT(VARCHAR(8),GETDATE(),112))  /***        set variable value as current date (YYYYMMDD)                             ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
          SELECT *
                 INTO    [GRSHR_admin].[dbo].[EnteredData_long_wkv_not_loaded_yet_in_DB]
                 FROM  [forum_ResAnal].[dbo].[vr_01w_DB_Long_NoAggregated]
EXEC ( ' SELECT *
                 INTO    [GRSHR_admin].[dbo].[EnteredData_long_wkv_not_loaded_yet_in_DB_' + @CrDt + '_BackUp]
                 FROM  [forum_ResAnal].[dbo].[vr_01w_DB_Long_NoAggregated]'                                  )
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
          SELECT *
                 INTO    [GRSHR_admin].[dbo].[Index_by_CtryRegion&Yr_wkv_not_loaded_yet_in_DB]
                 FROM  [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
EXEC ( ' SELECT *
                 INTO    [GRSHR_admin].[dbo].[Index_by_CtryRegion&Yr_wkv_not_loaded_yet_in_DB_' + @CrDt + '_BackUp]
                 FROM  [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]'                   )
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
          SELECT *
                 INTO    [GRSHR_admin].[dbo].[AllData_workversion_not_loaded_yet_in_DB]
                 FROM  [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]
EXEC ( ' SELECT *
                 INTO    [GRSHR_admin].[dbo].[AllData_workversion_not_loaded_yet_in_DB_' + @CrDt + ']
                 FROM  [forum_ResAnal].[dbo].[vr_05w_SemiWide_by_Ctry&Year]'                                  )
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
          SELECT *
                 INTO    [GRSHR_admin].[dbo].[AllData_longversion_not_loaded_yet_in_DB]
                 FROM  [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
EXEC ( ' SELECT *
                 INTO    [GRSHR_admin].[dbo].[AllData_longversion_not_loaded_yet_in_DB_' + @CrDt + ']
                 FROM  [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]'                                  )
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _015_cp_create_x_t01_accdb__s01_t_AW___________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the pro-access-tool table [vrx_w_01_proGRSHRadm_01]                                             <<<<<     ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
---- THIS SCRIPT IS NOT CLEAN
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]
/***************************************************************************************************************************************************************/
/*** all combinations + distinct actual combinations of Q&A ****************************************************************************************************/
SELECT * 	INTO [forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
SELECT

           [QA_lnk]   = [QA_std]
      ,    [AV_std]
      ,    [AW_std]   = CASE
                             WHEN [Answer_Wording_std] IS NOT NULL
                             THEN [Answer_Wording_std]
                             ELSE 'THE VALUE IS NOT A VALID ANSWER'
                         END
FROM

(


SELECT *
  FROM
(
SELECT 
       DISTINCT
       [QA_std]
     , [QA_lnk] = CASE 
                       WHEN              [QA_std] LIKE '%__p' 
                       THEN STUFF(       [QA_std]      ,         
                       (CHARINDEX('__p', [QA_std])), 3, '')
                       ELSE              [QA_std]
                  END
  FROM [forum_ResAnal].[dbo].[vr_06w_LongData_ALL_bkup]
WHERE  [note] LIKE '%this field can be edited'                       )  KL

cross join

(SELECT * FROM
 (       SELECT [AV_std] = '0.00'
   UNION SELECT [AV_std] = '0.20'
   UNION SELECT [AV_std] = '0.25'
   UNION SELECT [AV_std] = '0.33'
   UNION SELECT [AV_std] = '0.40'
   UNION SELECT [AV_std] = '0.50'
   UNION SELECT [AV_std] = '0.60'
   UNION SELECT [AV_std] = '0.67'
   UNION SELECT [AV_std] = '0.75'
   UNION SELECT [AV_std] = '0.80'
   UNION SELECT [AV_std] = '1.00'   )  DE ) JJ
LEFT JOIN


( SELECT 
                           [Question_abbreviation_std]
                         , [Answer_Wording_std]
                         , [Answer_value_std]
    FROM
         [forum].[dbo].[Pew_Q&A_Std]   )   IIJIJ
ON
      [QA_lnk] = [Question_abbreviation_std]
AND   [AV_std] = [Answer_value_std]

) KKKL

/*********************** all combinations + distinct actual combinations of Q&A ***/
)                                                                         ACplusDAC
/**********************************************************************************/
pivot (MAX ([AW_std]) 
       for  [AV_std] in (
                                 [0.00]
                               , [0.20]
                               , [0.25]
                               , [0.33]
                               , [0.40]
                               , [0.50]
                               , [0.60]
                               , [0.67]
                               , [0.75]
                               , [0.80]
                               , [1.00]
                                          ))  AS ValidValues
/**********************************************************************************/
/**********************************************************************************/






-----------------------------------------------------------------------------------------------------------------------------------------------------------------



/**************************************************************************************************** all combinations + distinct actual combinations of Q&A ***/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
GO
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _016_cp_create_x_t01_accdb__s01_t_BASIC________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the pro-access-tool table [vrx_w_01_proGRSHRadm_01]                                             <<<<<     ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
---- THIS SCRIPT IS NOT CLEAN


USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
/***************************************************************************************************************************************************************/
CREATE TABLE 
      [dbo].[vrx_w_01_proGRSHRadm_01]
(
      [Basic_updatable_data_pk]            [int]            NOT NULL
 	, [entity]                             [varchar](45)        NULL
	, [note]                               [varchar](60)        NULL
	, [link_fk]                            [int]                NULL
	, [Nation_fk]                          [int]                NULL
	, [Locality_fk]                        [int]                NULL
	, [Religion_fk]                        [int]                NULL
	, [Ctry_EditorialName]                 [nvarchar](50)       NULL
	, [Locality]                           [nvarchar](50)       NULL
	, [Religion]                           [nvarchar](255)      NULL
	, [Question_Year]                      [int]                NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [QW_std]                             [nvarchar](500)      NULL
	, [Answer_value]                       [decimal](38, 2)     NULL
	, [answer_wording]                     [nvarchar](max)      NULL
	, [Question_fk]                        [int]                NULL
	, [Answer_fk]                          [int]                NULL
	, [Notes]                              [nvarchar](1000)     NULL
	, [v_000]                              [nvarchar](400)      NULL
	, [v_020]                              [nvarchar](400)      NULL
	, [v_025]                              [nvarchar](400)      NULL
	, [v_033]                              [nvarchar](400)      NULL
	, [v_040]                              [nvarchar](400)      NULL
	, [v_050]                              [nvarchar](400)      NULL
	, [v_060]                              [nvarchar](400)      NULL
	, [v_067]                              [nvarchar](400)      NULL
	, [v_075]                              [nvarchar](400)      NULL
	, [v_080]                              [nvarchar](400)      NULL
	, [v_100]                              [nvarchar](400)      NULL
	, [v_plu]                              [nvarchar](400)      NULL
	, [AV_std_CURRENT]                     [decimal](38, 2)     NULL
    , [AW_std_CURRENT]                     [nvarchar](400)      NULL
    , [AW_CURRENT]                         [nvarchar](max)      NULL
    , [editable]                           [int]                NULL
    , CONSTRAINT
      [PK_Basic_updatable_data]
    PRIMARY KEY CLUSTERED 
    (
	  [Basic_updatable_data_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  ) ON [PRIMARY]
                                                                               ) ON [PRIMARY]
GO
/***************************************************************************************************************************************************************/
SET ANSI_PADDING OFF
GO


IF OBJECT_ID('tempdb..#ACDAC') IS NOT NULL
DROP TABLE           [#ACDAC]
GO

/***************************************************************************************************************************************************************/
/*** all combinations + distinct actual combinations of Q&A ****************************************************************************************************/
SELECT *
INTO   [#ACDAC]
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
SELECT

           [QA_lnk]   = [QA_std]
      ,    [AV_std]
      ,    [AW_std]   = CASE
                             WHEN [Answer_Wording_std] IS NOT NULL
                             THEN [Answer_Wording_std]
                             ELSE 'THE VALUE IS NOT A VALID ANSWER'
                         END
FROM
(
SELECT *
  FROM
(
SELECT 
       DISTINCT
       [QA_std]
     , [QA_lnk] = CASE 
                       WHEN              [QA_std] LIKE '%__p' 
                       THEN STUFF(       [QA_std]      ,         
                       (CHARINDEX('__p', [QA_std])), 3, '')
                       ELSE              [QA_std]
                  END
  FROM [forum_ResAnal].[dbo].[vr_06w_LongData_ALL_bkup]
WHERE  [note] LIKE '%this field can be edited'                       )  KL

cross join

(SELECT * FROM
 (       SELECT [AV_std] = '0.00'
   UNION SELECT [AV_std] = '0.20'
   UNION SELECT [AV_std] = '0.25'
   UNION SELECT [AV_std] = '0.33'
   UNION SELECT [AV_std] = '0.40'
   UNION SELECT [AV_std] = '0.50'
   UNION SELECT [AV_std] = '0.60'
   UNION SELECT [AV_std] = '0.67'
   UNION SELECT [AV_std] = '0.75'
   UNION SELECT [AV_std] = '0.80'
   UNION SELECT [AV_std] = '1.00'   )  DE ) JJ
LEFT JOIN


( SELECT 
                           [Question_abbreviation_std]
                         , [Answer_Wording_std]
                         , [Answer_value_std]
    FROM
         [forum].[dbo].[Pew_Q&A_Std]   )   IIJIJ
ON
      [QA_lnk] = [Question_abbreviation_std]
AND   [AV_std] = [Answer_value_std]

) KKKL

/*********************** all combinations + distinct actual combinations of Q&A ***/

)                                                                         ACplusDAC
/**********************************************************************************/
pivot (MAX ([AW_std]) 
       for  [AV_std] in (
                                 [0.00]
                               , [0.20]
                               , [0.25]
                               , [0.33]
                               , [0.40]
                               , [0.50]
                               , [0.60]
                               , [0.67]
                               , [0.75]
                               , [0.80]
                               , [1.00]
                                          ))  AS ValidValues
/**********************************************************************************/
/**********************************************************************************/






-----------------------------------------------------------------------------------------------------------------------------------------------------------------


/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************** all combinations + distinct actual combinations of Q&A ***/
GO
/***************************************************************************************************************************************************************/






/***************************************************************************************************************************************************************/
/***  Complete 1st step of Table [Basic] ***********************************************************************************************************************/
INSERT INTO 
       [vrx_w_01_proGRSHRadm_01]
SELECT

       [Basic_updatable_data_pk]     = ROW_NUMBER()OVER(ORDER BY 
                                                                    [Question_Year] DESC
                                                                  , [Nation_fk]     DESC
                                                                  , [QA_std]             )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[entity]
      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[v_000]                       =  [0.00]
      ,[v_020]                       =  [0.20]
      ,[v_025]                       =  [0.25]
      ,[v_033]                       =  [0.33]
      ,[v_040]                       =  [0.40]
      ,[v_050]                       =  [0.50]
      ,[v_060]                       =  [0.60]
      ,[v_067]                       =  [0.67]
      ,[v_075]                       =  [0.75]
      ,[v_080]                       =  [0.80]
      ,[v_100]                       =  [1.00]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[v_plu]                       =  ''
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[AV_std_CURRENT]              =  [Answer_value]
      ,[AW_std_CURRENT]              =  [answer_wording_std]
      ,[AW_CURRENT]                  =  [answer_wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[editable]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
FROM
       [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
LEFT
JOIN
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [#ACDAC]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
ON
	   [QA_std]
	=  [QA_lnk]


GO




/**************************************************************************************************************************************************/
/***                                                     ******************************************************************************************/
/***                    S T E P     2                    ******************************************************************************************/
/***                                                     ******************************************************************************************/
/**************************************************************************************************************************************************/
/***  Add Computed Columns PERSISTED  *************************************************************************************************************/
SET ANSI_PADDING ON
GO
----------------------------------------------------------------------------------------------------------------------------------------------------
ALTER
TABLE
       [vrx_w_01_proGRSHRadm_01]
ADD
----------------------------------------------------------------------------------------------------------------------------------------------------
       [Answer_Wording_std]
                             AS
                               CASE 
                                   WHEN [Answer_value]  = [Av_STD_CURRENT] THEN [AW_std_CURRENT]
                                   -------------------------------------------------------------------------------------------
                                   WHEN [note]   LIKE    '%NOT be edited%'
                                    AND [Answer_value] != [Av_STD_CURRENT] THEN 'VALUE SHOULD NOT BE EDITED !!!'
                                   -------------------------------------------------------------------------------------------
                                   WHEN [note]   LIKE    '%can be edited%'
                                    AND [Answer_value] != [Av_STD_CURRENT]
                                    AND [Answer_value]  < 1.00
                                    AND [Answer_value]    NOT IN (
                                                                    0.00
                                                                  , 0.20
                                                                  , 0.25
                                                                  , 0.33
                                                                  , 0.40
                                                                  , 0.50
                                                                  , 0.60
                                                                  , 0.67
                                                                  , 0.75
                                                                  , 0.80
                                                                         ) THEN 'THE VALUE IS NOT A VALID ANSWER'
                                   -------------------------------------------------------------------------------------------
                                   WHEN [Answer_value]  = 0.00             THEN [v_000]
                                   WHEN [Answer_value]  = 0.20             THEN [v_020]
                                   WHEN [Answer_value]  = 0.25             THEN [v_025]
                                   WHEN [Answer_value]  = 0.33             THEN [v_033]
                                   WHEN [Answer_value]  = 0.40             THEN [v_040]
                                   WHEN [Answer_value]  = 0.50             THEN [v_050]
                                   WHEN [Answer_value]  = 0.60             THEN [v_060]
                                   WHEN [Answer_value]  = 0.67             THEN [v_067]
                                   WHEN [Answer_value]  = 0.75             THEN [v_075]
                                   WHEN [Answer_value]  = 0.80             THEN [v_080]
                                   WHEN [Answer_value] >= 1.00             THEN [v_100]
---                                   WHEN [Answer_value]  > 0.00             THEN [v_plu]
                                   -------------------------------------------------------------------------------------------
                                   ELSE                                         'program error: tell JC!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
    , [changeV]
                             AS
                               CASE 
                                   WHEN [AV_std_CURRENT] !=  [Answer_value] THEN 'value has been updated'
                                   WHEN [AV_std_CURRENT]  =  [Answer_value] THEN ''
                                   ELSE                                          'error!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
    , [changeW]
                             AS
                               CASE 
                                   WHEN [AW_CURRENT]     IS     NULL
                                    AND [Answer_Wording] IS     NULL      THEN ''
                                   WHEN [AW_CURRENT]     IS     NULL
                                    AND [Answer_Wording] IS NOT NULL      THEN 'descriptive wording has been updated'
                                   WHEN [AW_CURRENT]     IS NOT NULL
                                    AND [Answer_Wording] IS     NULL      THEN 'descriptive wording has been removed'
                                   WHEN [AW_CURRENT]  =  [Answer_Wording] THEN ''
                                   WHEN [AW_CURRENT] !=  [Answer_Wording] THEN 'descriptive wording has been updated'
                                   ELSE                                        'error!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
GO
/**************************************************************************************************************************************************/
SET ANSI_PADDING OFF
GO
/*************************************************************************************************************  Add Computed Columns PERSISTED  ***/
/**************************************************************************************************************************************************/


 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _017_cp_create_x_t01_accdb__s02_ts_C_Y_Cs_As_________R.sql                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the pro-access-tool table [vrx_w_01_proGRSHRadm_01]                                             <<<<<     ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
---- THIS SCRIPT IS NOT CLEAN


USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_02]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_02]
/***************************************************************************************************************************************************************/



/**********************************************************************************/
USE [GRSHR_admin]
GO
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[Country]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[Country]
------------------------------------------------------------------------------------
SELECT DISTINCT
       [Nation_fk]
      ,[Ctry_EditorialName]
  INTO [GRSHR_admin].[dbo].[Country]
  FROM [GRSHR_admin].[dbo].[Basic]
  ORDER BY
       [Ctry_EditorialName]
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[QYear]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[QYear]
------------------------------------------------------------------------------------
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
------------------------------------------------------------------------------------
CREATE TABLE 
      [dbo].[QYear]
(
      [QYear_pk]                           [int]            NOT NULL
	, [Question_Year]                      [int]                NULL
    , CONSTRAINT
      [QYear_pk]
    PRIMARY KEY CLUSTERED 
    (
	  [QYear_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  
                                                                ) ON [PRIMARY]
                                                                ) ON [PRIMARY]
GO
------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------
INSERT
  INTO
       [GRSHR_admin].[dbo].[QYear]
SELECT 
       [QYear_pk] = ROW_NUMBER()OVER(ORDER BY [Question_Year])
      ,[Question_Year]
  FROM 
       (  SELECT DISTINCT
                 [Question_Year]
            FROM [GRSHR_admin].[dbo].[Basic]  ) D
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[QStd]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[QStd]
------------------------------------------------------------------------------------
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
------------------------------------------------------------------------------------
CREATE TABLE 
      [dbo].[QStd]
(
      [QStd_pk]                            [int]            NOT NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [QW_std]                             [nvarchar](500)      NULL
	, [Question_Year]                      [int]                NULL
	, [Ctry_EditorialName]                 [nvarchar](50)       NULL
    , CONSTRAINT
      [QStd_pk]
    PRIMARY KEY CLUSTERED 
    (
	  [QStd_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  
                                                                ) ON [PRIMARY]
                                                                ) ON [PRIMARY]
GO
------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------
INSERT
  INTO
       [GRSHR_admin].[dbo].[QStd]
SELECT 
       [QStd_pk] = ROW_NUMBER()OVER(ORDER BY [QA_std], [QW_std])
      ,[QA_std]
      ,[QW_std]
      ,[Question_Year]
      ,[Ctry_EditorialName]
  FROM 
       (  SELECT DISTINCT
                 [QA_std]
                ,[QW_std]
                ,[Question_Year]
                ,[Ctry_EditorialName]
            FROM [GRSHR_admin].[dbo].[Basic]  ) D
/**********************************************************************************/
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[AStd]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[AStd]
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
------------------------------------------------------------------------------------
CREATE TABLE 
      [dbo].[AStd]
(
      [AStd_pk]                            [int]            NOT NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [AV_std]                             [decimal](38, 2)     NULL
	, [AW_std]                             [nvarchar](400)      NULL
	, [Year_from]                          [int]                NULL
	, [Year_to]                            [int]                NULL
    , CONSTRAINT
      [AStd_pk]
    PRIMARY KEY CLUSTERED 
    (
	  [AStd_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  
                                                                ) ON [PRIMARY]
                                                                ) ON [PRIMARY]
GO
------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
------------------------------------------------------------------------------------
INSERT
  INTO
       [GRSHR_admin].[dbo].[AStd]
------------------------------------------------------------------------------------
SELECT
       [AStd_pk]                     =  ROW_NUMBER()
                                        OVER(ORDER BY
                                                      [Question_abbreviation_std]
                                                    , [Answer_value]                )

	  ,[QA_std]                      =  [Question_abbreviation_std]
      ,[AV_std]                      =  [Answer_value]
      ,[AW_std]                      =  [Answer_Wording_std]
      ,[Year_from]                   =  [min_yr]
      ,[Year_to]                     =  [max_yr]
-- select *
FROM
/**********************************************************************************/
(
/**********************************************************************************/
SELECT
       DISTINCT
       [Question_abbreviation_std]
      ,[Answer_value]
      ,[answer_wording_std]
      ,[Answer_Val&StdWd]            =  CAST([Answer_value]      AS CHAR(8))
                                       +     [answer_wording_std]
      ,[AnsExists]                   =  1
      ,[min_yr]                      =  MIN([Question_Year]) OVER(PARTITION BY [Question_abbreviation_std])
      ,[max_yr]                      =  MAX([Question_Year]) OVER(PARTITION BY [Question_abbreviation_std])
  FROM [forum].[dbo].[Pew_Question]  
     , [forum].[dbo].[Pew_Answer]
WHERE
       [Question_pk]
      =[Question_fk]
AND
       [answer_wording_std]
       IS NOT NULL
------------------------------------------------------------------------------------       
-- clean out errors
--------AND
--------       [Question_abbreviation_std]
--------       NOT IN ( 'SHI_04_b_text', 'SHI_04_e_text' )
--------AND
--------       NOT
--------       ( [Question_abbreviation_std] = 'SHI_01_a' 
--------        AND
--------         [answer_wording_std]        = 'No cases were found' )
------------------------------------------------------------------------------------       
/**********************************************************************************/
)                                                                                 T
/**********************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _018_cp_create_x_tAccess_s01_t_Basic___________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
USE [GRSHR_admin]
GO
/**************************************************************************************************************************************************/
IF OBJECT_ID  (N'[GRSHR_admin].[dbo].[Basic]', N'U') IS NOT NULL
DROP   TABLE     [GRSHR_admin].[dbo].[Basic]
/**************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
/**************************************************************************************************************************************************/
CREATE TABLE 
      [dbo].[Basic]
(
      [Basic_updatable_data_pk]            [int]            NOT NULL
 	, [entity]                             [varchar](45)        NULL
	, [note]                               [varchar](60)        NULL
	, [link_fk]                            [int]                NULL
	, [Nation_fk]                          [int]                NULL
	, [Locality_fk]                        [int]                NULL
	, [Religion_fk]                        [int]                NULL
	, [Ctry_EditorialName]                 [nvarchar](50)       NULL
	, [Locality]                           [nvarchar](50)       NULL
	, [Religion]                           [nvarchar](255)      NULL
	, [Question_Year]                      [int]                NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [QW_std]                             [nvarchar](500)      NULL
	, [Answer_value]                       [decimal](38, 2)     NULL
	, [answer_wording]                     [nvarchar](max)      NULL
	, [Question_fk]                        [int]                NULL
	, [Answer_fk]                          [int]                NULL
	, [Notes]                              [nvarchar](1000)     NULL
	, [v_000]                              [nvarchar](400)      NULL
	, [v_020]                              [nvarchar](400)      NULL
	, [v_025]                              [nvarchar](400)      NULL
	, [v_033]                              [nvarchar](400)      NULL
	, [v_040]                              [nvarchar](400)      NULL
	, [v_050]                              [nvarchar](400)      NULL
	, [v_060]                              [nvarchar](400)      NULL
	, [v_067]                              [nvarchar](400)      NULL
	, [v_075]                              [nvarchar](400)      NULL
	, [v_080]                              [nvarchar](400)      NULL
	, [v_100]                              [nvarchar](400)      NULL
	, [v_plu]                              [nvarchar](400)      NULL
	, [AV_std_CURRENT]                     [decimal](38, 2)     NULL
    , [AW_std_CURRENT]                     [nvarchar](400)      NULL
    , [AW_CURRENT]                         [nvarchar](max)      NULL
    , [editable]                           [int]                NULL
    , CONSTRAINT
      [PK_Basic_updatable_data]
    PRIMARY KEY CLUSTERED 
    (
	  [Basic_updatable_data_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  ) ON [PRIMARY]
                                                                               ) ON [PRIMARY]
GO
/**************************************************************************************************************************************************/
SET ANSI_PADDING OFF
GO
/**************************************************************************************************************************************************/
/***  Complete 1st step of Table [Basic] **********************************************************************************************************/
INSERT INTO 
       [GRSHR_admin].[dbo].[Basic]
                                   (   [Basic_updatable_data_pk]
                                      ,[entity]
                                      ,[note]
                                      ,[link_fk]
                                      ,[Nation_fk]
                                      ,[Locality_fk]
                                      ,[Religion_fk]
                                      ,[Ctry_EditorialName]
                                      ,[Locality]
                                      ,[Religion]
                                      ,[Question_Year]
                                      ,[QA_std]
                                      ,[QW_std]
                                      ,[Answer_value]
                                      ,[answer_wording]
                                      ,[Question_fk]
                                      ,[Answer_fk]
                                      ,[Notes]
                                      ,[AV_std_CURRENT]
                                      ,[AW_std_CURRENT]
                                      ,[AW_CURRENT]
                                      ,[editable]                  )
SELECT
       [Basic_updatable_data_pk]     = ROW_NUMBER()OVER(ORDER BY 
                                                                    Question_Year DESC
                                                                  , Nation_fk     DESC
                                                                  , QA_std             )
      ,[entity]
      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
      ,[AV_std_CURRENT]              =  [Answer_value]
      ,[AW_std_CURRENT]              =  [answer_wording_std]
      ,[AW_CURRENT]                  =  [answer_wording]
      --,[Region5]
      --,[Region6]
      ,[editable]
FROM
       [GRSHR_admin].[dbo].[v_Basic]
-- (select top 100 * from [GRSHR_admin].[dbo].[v_Basic] ) T100
/**********************************************************************************************************  Complete 1st step of Table [Basic] ***/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _019_cp_create_x_tAccess_s02_t_AWstd___________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/********************************************************************************************************************************************************/
/********************************************************************************************************************************************************/
/***                                                                                                                                                  ***/
/***     >>>>>   This is the script used to create the table [GRSHR_admin].[dbo].[AW_std]                                                   <<<<<     ***/
/***                                                                                                                                                  ***/
/********************************************************************************************************************************************************/
USE [GRSHR_admin]
GO
/********************************************************************************************************************************************************/
IF OBJECT_ID  (N'[GRSHR_admin].[dbo].[AW_std]', N'U') IS NOT NULL
DROP   TABLE     [GRSHR_admin].[dbo].[AW_std]
/********************************************************************************************************************************************************/
SELECT
------------------------------------------------------------------------------------       
       *
------------------------------------------------------------------------------------       
INTO
               [dbo].[AW_std]

------------------------------------------------------------------------------------       
FROM
------------------------------------------------------------------------------------       
(
/*** all combinations + distinct actual combinations of Q&A ***********************/
SELECT
           [QA_std_a] = EQ.[QA_std]
      , EV.[AV_std]
      ,    [AW_std]   = CASE
                             WHEN [AW_std] IS NOT NULL
                             THEN [AW_std]
                             ELSE 'THE VALUE IS NOT A VALID ANSWER'
                         END
FROM
/*** all Q&A combinations for reshaping data **************************************/
------------------------------------------------------------------------------------       
       /* editable questions ******************************************************/
       ( SELECT DISTINCT 
                         [QA_std]
                                 = CASE 
                                       WHEN              [QA_std] LIKE '%__p' 
                                       THEN STUFF(       [QA_std]      ,         
                                       (CHARINDEX('__p', [QA_std])), 3, '')
                                       ELSE              [QA_std]
                                    END
           FROM          [GRSHR_admin].[dbo].[Basic]
          WHERE          [note] LIKE '%can be edited%'                        )  EQ
       /****************************************************** editable questions */
        CROSS JOIN
       /* values of editable questions ********************************************/
       ( SELECT DISTINCT 
                         [AV_std]
                                 = CASE
                                       WHEN [Answer_value] > 1 THEN 9
                                       ELSE [Answer_value]
                                   END
           FROM          [GRSHR_admin].[dbo].[Basic]
          WHERE          [note] LIKE '%can be edited%'                        )  EV
       /******************************************** values of editable questions */
------------------------------------------------------------------------------------       
/************************************** all Q&A combinations for reshaping data ***/
LEFT OUTER JOIN
/**********************************************************************************/
(
/*** distinct actual combinations of Q&A ******************************************/
SELECT  
       DISTINCT 
       [AV_std]
      ,[QA_std]
      ,[AW_std]
FROM
/**********************************************************************************/
(
/**********************************************************************************/
SELECT
       [Question_Year]
      ,[QA_std]                      = [Question_abbreviation_std]
      ,[AV_std]                      =  CASE
                                            WHEN [Answer_value] > 1 THEN 9
                                            ELSE [Answer_value]
                                        END
      ,[AW_std]                      =  CASE
                                            WHEN [answer_wording_std] IS NOT NULL
                                            THEN [answer_wording_std]
                                            ELSE 'no standard wording'
                                        END
-- SELECT DISTINCT [QA_std]
------------------------------------------------------------------------------------       
  FROM
       [forum].[dbo].[Pew_Question]                                               Q
------------------------------------------------------------------------------------       
  JOIN
       [forum].[dbo].[Pew_Answer]                                                 A
------------------------------------------------------------------------------------       
    ON
       [Question_pk]
      =[Question_fk]
------------------------------------------------------------------------------------       
       /* test consistency of answers&questions + FILTER editable answers *********/
       JOIN
       ----select * from
       /* editable questions ******************************************************/
       ( SELECT DISTINCT 
                         [QA_std]
                                 = CASE 
                                       WHEN              [QA_std] LIKE '%__p' 
                                       THEN STUFF(       [QA_std]      ,         
                                       (CHARINDEX('__p', [QA_std])), 3, '')
                                       ELSE              [QA_std]
                                    END
                        --,[AV_std]
                        --         = CASE
                        --               WHEN [Answer_value] > 1 THEN 9
                        --               ELSE [Answer_value]
                        --           END
                        --,[AW_std]
                        --         =          [answer_wording_std]
           FROM          [GRSHR_admin].[dbo].[Basic]
          WHERE          [note] LIKE '%can be edited%'                        )  QE
       /****************************************************** editable questions */
         --order by 
         --        [QA_std]
         --       ,[AV_std]
         --       ,[AW_std]
       -----------------------------------------------------------------------------       
          ON
                 [Question_abbreviation_std]
                =[QA_std]
       /*********************************************** test consistency & FILTER */
------------------------------------------------------------------------------------       
/**********************************************************************************/
--where 
--QA_std IN (
--'GRI_19_da',
--'GRI_19_db',
--'SHI_01_da',
--'SHI_01_db',
--'SHI_04_db',
--'GRI_20_05_x1',
--'SHI_04_da',
--'SHI_05_b',
--'SHI_05_da',
--'SHI_05_db' )
/**********************************************************************************/
)                                                                                ND
/**********************************************************************************/
--ORDER BY [AV_std]
/****************************************** distinct actual combinations of Q&A ***/
)                                                                                DD
/**********************************************************************************/
------------------------------------------------------------------------------------       
    ON
         EQ.[QA_std]
       = DD.[QA_std]
   AND       
         EV.[AV_std]
       = DD.[AV_std]
------------------------------------------------------------------------------------       
/*********************** all combinations + distinct actual combinations of Q&A ***/
)                                                                         ACplusDAC
/**********************************************************************************/
pivot (MAX ([AW_std]) 
       for  [AV_std] in (
                                 [0.00]
                               , [0.20]
                               , [0.25]
                               , [0.33]
                               , [0.40]
                               , [0.50]
                               , [0.60]
                               , [0.67]
                               , [0.75]
                               , [0.80]
                               , [1.00]
                               , [9.00]
                                          ))  AS ValidValues
/**********************************************************************************/
/**********************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _020_cp_create_x_tAccess_s03_t_4tables_________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**********************************************************************************/
USE [GRSHR_admin]
GO
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[Country]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[Country]
------------------------------------------------------------------------------------
SELECT DISTINCT
       [Nation_fk]
      ,[Ctry_EditorialName]
  INTO [GRSHR_admin].[dbo].[Country]
  FROM [GRSHR_admin].[dbo].[Basic]
  ORDER BY
       [Ctry_EditorialName]
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[QYear]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[QYear]
------------------------------------------------------------------------------------
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
------------------------------------------------------------------------------------
CREATE TABLE 
      [dbo].[QYear]
(
      [QYear_pk]                           [int]            NOT NULL
	, [Question_Year]                      [int]                NULL
    , CONSTRAINT
      [QYear_pk]
    PRIMARY KEY CLUSTERED 
    (
	  [QYear_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  
                                                                ) ON [PRIMARY]
                                                                ) ON [PRIMARY]
GO
------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------
INSERT
  INTO
       [GRSHR_admin].[dbo].[QYear]
SELECT 
       [QYear_pk] = ROW_NUMBER()OVER(ORDER BY [Question_Year])
      ,[Question_Year]
  FROM 
       (  SELECT DISTINCT
                 [Question_Year]
            FROM [GRSHR_admin].[dbo].[Basic]  ) D
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[QStd]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[QStd]
------------------------------------------------------------------------------------
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
------------------------------------------------------------------------------------
CREATE TABLE 
      [dbo].[QStd]
(
      [QStd_pk]                            [int]            NOT NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [QW_std]                             [nvarchar](500)      NULL
	, [Question_Year]                      [int]                NULL
	, [Ctry_EditorialName]                 [nvarchar](50)       NULL
    , CONSTRAINT
      [QStd_pk]
    PRIMARY KEY CLUSTERED 
    (
	  [QStd_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  
                                                                ) ON [PRIMARY]
                                                                ) ON [PRIMARY]
GO
------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------
INSERT
  INTO
       [GRSHR_admin].[dbo].[QStd]
SELECT 
       [QStd_pk] = ROW_NUMBER()OVER(ORDER BY [QA_std], [QW_std])
      ,[QA_std]
      ,[QW_std]
      ,[Question_Year]
      ,[Ctry_EditorialName]
  FROM 
       (  SELECT DISTINCT
                 [QA_std]
                ,[QW_std]
                ,[Question_Year]
                ,[Ctry_EditorialName]
            FROM [GRSHR_admin].[dbo].[Basic]  ) D
/**********************************************************************************/
/**********************************************************************************/
IF OBJECT_ID (N'[GRSHR_admin].[dbo].[AStd]', N'U') IS NOT NULL
DROP   TABLE    [GRSHR_admin].[dbo].[AStd]
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
------------------------------------------------------------------------------------
CREATE TABLE 
      [dbo].[AStd]
(
      [AStd_pk]                            [int]            NOT NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [AV_std]                             [decimal](38, 2)     NULL
	, [AW_std]                             [nvarchar](400)      NULL
	, [Year_from]                          [int]                NULL
	, [Year_to]                            [int]                NULL
    , CONSTRAINT
      [AStd_pk]
    PRIMARY KEY CLUSTERED 
    (
	  [AStd_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  
                                                                ) ON [PRIMARY]
                                                                ) ON [PRIMARY]
GO
------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
------------------------------------------------------------------------------------
INSERT
  INTO
       [GRSHR_admin].[dbo].[AStd]
------------------------------------------------------------------------------------
SELECT
       [AStd_pk]                     =  ROW_NUMBER()
                                        OVER(ORDER BY
                                                      [Question_abbreviation_std]
                                                    , [Answer_value]                )

	  ,[QA_std]                      =  [Question_abbreviation_std]
      ,[AV_std]                      =  [Answer_value]
      ,[AW_std]                      =  [Answer_Wording_std]
      ,[Year_from]                   =  [min_yr]
      ,[Year_to]                     =  [max_yr]
-- select *
FROM
/**********************************************************************************/
(
/**********************************************************************************/
SELECT
       DISTINCT
       [Question_abbreviation_std]
      ,[Answer_value]
      ,[answer_wording_std]
      ,[Answer_Val&StdWd]            =  CAST([Answer_value]      AS CHAR(8))
                                       +     [answer_wording_std]
      ,[AnsExists]                   =  1
      ,[min_yr]                      =  MIN([Question_Year]) OVER(PARTITION BY [Question_abbreviation_std])
      ,[max_yr]                      =  MAX([Question_Year]) OVER(PARTITION BY [Question_abbreviation_std])
  FROM [forum].[dbo].[Pew_Question]  
     , [forum].[dbo].[Pew_Answer]
WHERE
       [Question_pk]
      =[Question_fk]
AND
       [answer_wording_std]
       IS NOT NULL
------------------------------------------------------------------------------------       
-- clean out errors
AND
       [Question_abbreviation_std]
       NOT IN ( 'SHI_04_b_text', 'SHI_04_e_text' )
AND
       NOT
       ( [Question_abbreviation_std] = 'SHI_01_a' 
        AND
         [answer_wording_std]        = 'No cases were found' )
------------------------------------------------------------------------------------       
/**********************************************************************************/
)                                                                                 T
/**********************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _021_cp_create_x_tAccess_s04_modify_TBasic_____R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                     ******************************************************************************************/
/***             S T E P     B Y     S T E P             ******************************************************************************************/
/***                                                     ******************************************************************************************/
/***                    S T E P     1                    ******************************************************************************************/
/***                                                     ******************************************************************************************/
/**************************************************************************************************************************************************/
USE [GRSHR_admin]
GO
/***  Include wordings by values per each question  ***********************************************************************************************/
UPDATE
       [GRSHR_admin].[dbo].[Basic]
SET
          [v_000]
       = A.[0.00]  
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_020]
       = A.[0.20]  
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_025]
       = A.[0.25]  
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_033]
       = A.[0.33]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_040]
       = A.[0.40]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_050]
       = A.[0.50]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_060]
       = A.[0.60]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_067]
       = A.[0.67]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_075]
       = A.[0.75]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_080]
       = A.[0.80]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_100]
       = A.[1.00]
----------------------------------------------------------------------------------------------------------------------------------------------------
      ,   [v_plu]
       = A.[9.00]
----------------------------------------------------------------------------------------------------------------------------------------------------
FROM
       [GRSHR_admin].[dbo].[Basic]  B
JOIN
       [GRSHR_admin].[dbo].[AW_std] A
ON
         B.[QA_std]
       = A.[QA_std_a]
----------------------------------------------------------------------------------------------------------------------------------------------------
GO
/***********************************************************************************************  Include wordings by values per each question  ***/


/**************************************************************************************************************************************************/
/***                                                     ******************************************************************************************/
/***                    S T E P     2                    ******************************************************************************************/
/***                                                     ******************************************************************************************/
/**************************************************************************************************************************************************/
/***  Add Computed Columns PERSISTED  *************************************************************************************************************/
SET ANSI_PADDING ON
GO
----------------------------------------------------------------------------------------------------------------------------------------------------
ALTER
TABLE
       [GRSHR_admin].[dbo].[Basic]
ADD
----------------------------------------------------------------------------------------------------------------------------------------------------
       [Answer_Wording_std]
                             AS
                               CASE 
                                   WHEN [Answer_value]  = [Av_STD_CURRENT] THEN [AW_std_CURRENT]
                                   -------------------------------------------------------------------------------------------
                                   WHEN [note]   LIKE    '%NOT be edited%'
                                    AND [Answer_value] != [Av_STD_CURRENT] THEN 'VALUE SHOULD NOT BE EDITED !!!'
                                   -------------------------------------------------------------------------------------------
                                   WHEN [note]   LIKE    '%can be edited%'
                                    AND [Answer_value] != [Av_STD_CURRENT]
                                    AND [Answer_value]  < 1.00
                                    AND [Answer_value]    NOT IN (
                                                                    0.00
                                                                  , 0.20
                                                                  , 0.25
                                                                  , 0.33
                                                                  , 0.40
                                                                  , 0.50
                                                                  , 0.60
                                                                  , 0.67
                                                                  , 0.75
                                                                  , 0.80
                                                                         ) THEN 'THE VALUE IS NOT A VALID ANSWER'
                                   -------------------------------------------------------------------------------------------
                                   WHEN [Answer_value]  = 0.00             THEN [v_000]
                                   WHEN [Answer_value]  = 0.20             THEN [v_020]
                                   WHEN [Answer_value]  = 0.25             THEN [v_025]
                                   WHEN [Answer_value]  = 0.33             THEN [v_033]
                                   WHEN [Answer_value]  = 0.40             THEN [v_040]
                                   WHEN [Answer_value]  = 0.50             THEN [v_050]
                                   WHEN [Answer_value]  = 0.60             THEN [v_060]
                                   WHEN [Answer_value]  = 0.67             THEN [v_067]
                                   WHEN [Answer_value]  = 0.75             THEN [v_075]
                                   WHEN [Answer_value]  = 0.80             THEN [v_080]
                                   WHEN [Answer_value]  = 1.00             THEN [v_100]
                                   WHEN [Answer_value]  > 0.00             THEN [v_plu]
                                   -------------------------------------------------------------------------------------------
                                   ELSE                                         'program error: tell JC!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
    , [changeV]
                             AS
                               CASE 
                                   WHEN [AV_std_CURRENT] !=  [Answer_value] THEN 'value has been updated'
                                   WHEN [AV_std_CURRENT]  =  [Answer_value] THEN ''
                                   ELSE                                          'error!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
    , [changeW]
                             AS
                               CASE 
                                   WHEN [AW_CURRENT]     IS     NULL
                                    AND [Answer_Wording] IS     NULL      THEN ''
                                   WHEN [AW_CURRENT]     IS     NULL
                                    AND [Answer_Wording] IS NOT NULL      THEN 'descriptive wording has been updated'
                                   WHEN [AW_CURRENT]     IS NOT NULL
                                    AND [Answer_Wording] IS     NULL      THEN 'descriptive wording has been removed'
                                   WHEN [AW_CURRENT]  =  [Answer_Wording] THEN ''
                                   WHEN [AW_CURRENT] !=  [Answer_Wording] THEN 'descriptive wording has been updated'
                                   ELSE                                        'error!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
GO
/**************************************************************************************************************************************************/
SET ANSI_PADDING OFF
GO
/*************************************************************************************************************  Add Computed Columns PERSISTED  ***/
/**************************************************************************************************************************************************/


 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _022_cp_create_x_tXLSX_t01__BTopLines_by_W_____R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vr_9Xw_Basic_TopLines_by_Region]                        <<<<<     ***/
/***             This table only includes aggregated numeric values                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#MySQLCode]') IS NOT NULL
  DROP TABLE            [#MySQLCode]
CREATE TABLE            [#MySQLCode] ( [T] NVARCHAR(MAX) NULL )
GO
INSERT INTO             [#MySQLCode] SELECT [T] = 'SQL Script is:'
--SELECT [T]       FROM [#MySQLCode]
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#extracted]') IS NOT NULL
  DROP TABLE            [#extracted]
  SELECT * INTO         [#extracted]
  FROM
/***************************************************************************************************************************************************************/
(
/*** Selected Data from long set *******************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          SELECT
                 [Q_Year]    =                  CAST(D.[Question_Year] AS VARCHAR)
                ,[Variable]  = CASE
                                   WHEN                [QA_std] LIKE '%_ny%' 
                                   THEN STUFF(         [QA_std]      ,         
                                   ((CHARINDEX('_ny',  [QA_std])) + 3) , 1, '')
                                   ELSE                [QA_std]
                               END

                ,[Q_Wording] =                         [QW_std]
                ,[Value]     = CASE
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2)) > 1)
                                      AND(             [QA_std] LIKE 'GRI_19_'              +'[bcdefx]'
                                                    OR [QA_std] LIKE 'SHI_0'  +'[1,4,5]'+'_'+'[bcdefx]'  )
                                   THEN    '1.00'
                                   ELSE         ISNULL([Answer_value], '0.00')
                               END
                ,[A_Wording] = CASE
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2))  = 0)
                                      AND(             [QA_std] LIKE 'GRI_19_'              +'[bcdefx]'
                                                    OR [QA_std] LIKE 'SHI_0'  +'[1,4,5]'+'_'+'[bcdefx]'  )
                                   THEN    'No cases were found'
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2)) >= 1)
                                      AND(             [QA_std] LIKE 'GRI_19_'              +'[bcdefx]'
                                                    OR [QA_std] LIKE 'SHI_0'  +'[1,4,5]'+'_'+'[bcdefx]'  )
                                   THEN    '1+ cases were found'
                                   ELSE    [answer_wording_std]
                               END
                ,[CntWg]
                ,[WTWg]
            FROM [vr_06w_LongData_ALL] D
               , [vr_07w_weights]      W
           WHERE          D.[Nation_fk]
                        = W.[Nation_fk]
             AND          D.[Question_Year]
                        = W.[Question_Year]
             AND          D.[Locality]
                       IN            (
                                        'aggregated by country'
                                      , 'not detailed'           )
             AND          D.[QA_std] NOT IN   ('GFI', 'GRI', 'SHI', 'GRI_20_05_x1')
             AND          D.[QA_std] NOT LIKE 'XSG_S_%'
             AND          D.[QA_std] NOT LIKE '%_d'+'[a,b]'
             AND          D.[QA_std] NOT LIKE '%_rd_1d'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
             ------and D.[Question_Year]	= 2007
             ------and [QA_std]           = 'GRI_01'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************* Selected Data from long set ***/
)                                                                                                                                                      extracted
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  --IF OBJECT_ID (N'[forum_ResAnal].[dbo].[A_CYQA]', N'U') IS NOT NULL
  --DROP TABLE      [forum_ResAnal].[dbo].[A_CYQA]
  --SELECT * INTO   [forum_ResAnal].[dbo].[A_CYQA] FROM
  IF OBJECT_ID('tempdb..[#A_CYQA]') IS NOT NULL
  DROP TABLE            [#A_CYQA]
  SELECT * INTO         [#A_CYQA]  FROM
/***************************************************************************************************************************************************************/
(
/*** Aggregated data by C/Y/Q/A ********************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
          [RYCNT]       = 'N' + [Q_Year]
         ,[RYPCT]       = 'P' + [Q_Year]
         ,[Variable]
         ,[Value]
         ,[Number]      =     SUM([CntWg])
         ,[Percentage]  =     SUM([WTWg])
  FROM   
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          [#extracted]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        GROUP BY
                 [Q_Year]
                ,[Variable]
                ,[Value]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************** Aggregated data by C/Y/Q/A ***/
)                                                                                                                                                         A_CYQA
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/




--- in the future calculate totlas, but notice currently ny questions add top > 100%
----		select
----		Q_Year
----		,Variable
----		,Q_Wording
----		,Value      = '200.00'
----		,A_Wording  = ''
----		,SUM (CntWg)
----		,SUM (WTWg)
----		from #extracted
----		group by
----		Q_Year
----		,Variable
----		,Q_Wording



/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  --IF OBJECT_ID (N'[forum_ResAnal].[dbo].[heading]', N'U') IS NOT NULL
  --DROP TABLE      [forum_ResAnal].[dbo].[heading]
  --SELECT * INTO   [forum_ResAnal].[dbo].[heading] FROM
  IF OBJECT_ID('tempdb..[#heading]') IS NOT NULL
  DROP TABLE            [#heading]
  SELECT * INTO         [#heading]  FROM
/***************************************************************************************************************************************************************/
(
/*** Headings and other static rows by table *******************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
   SELECT                                                                       /*** SELECT statement                                                        ***/
                [M]
              , [x]  = '[' + [M] + '] = STR(ISNULL(MAX([' + [M] + [F]         /*** elements arranged to be used as code                                      ***/
              , [v]  = '[' + [M] + ']'                                        /*** field name to be used as code                                             ***/
              , [s]  = SUBSTRING([M],2,2) +'|'+ RIGHT([M],4) +'|'+ LEFT([M],1)
              , [a]  = SUBSTRING([M],2,2)
              , [y]  =                          RIGHT([M],4)
              , [f]  =                                             LEFT([M],1)
              , [e]  = ''
              , [d]  = CASE
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  )  = 2007
                       THEN                         'baseline year,'
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  )  = (SELECT ((MAX([Year])) - 1 ) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] )
                       THEN                         'previous year,'
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  )  = (SELECT ((MAX([Year]))     ) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] )
                       THEN                         'latest year,'
                       WHEN  LEFT([M], 1  )  = 'N'
                       THEN                         'year'
                       ELSE ' ending'
                        END
              , [p]  = CASE
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  ) <  2011
                       THEN                         'JUN '
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  ) >= 2011
                       THEN                         'DEC '
                       ELSE RIGHT([M], 4  )
                        END
              , [n]  = CASE
                       WHEN  LEFT([M], 1  )  = 'N'
                       THEN                         'NUMBER OF'
                       WHEN  LEFT([M], 1  )  = 'P'
                       THEN                         '  %  OF  '
                        END
              , [c]  = 'COUNTRIES'
              , [t]  = CASE
                       WHEN       LEFT([M], 1  )   = 'P'
                       THEN                               '100 %'
                       WHEN       LEFT([M], 1  )   = 'N'
                       AND       RIGHT([M], 4  )  <  2011
                       THEN                               '197'
                       WHEN       LEFT([M], 1  )   = 'N'
                       AND       RIGHT([M], 4  )  >= 2011
                       THEN                               '198'
                        END
              , [l]  = 
      '--------------------------------------------------------------------------------------------------------------------------------------------------------'
    FROM (                                                                      /*** from complex query, filters already included in it                      ***/
             SELECT                                                             /***                                                                         ***/
           DISTINCT [M] = [RYCNT]                                               /***                                                                         ***/
                  , [F] = ']),0),12,0)'                                         /***                                                                         ***/
               FROM                          [#A_CYQA]                          /***                                                                         ***/
           UNION                                                                /***                                                                         ***/
           ALL                                                                  /***                                                                         ***/
           SELECT                                                               /***                                                                         ***/
           DISTINCT [M] = [RYPCT]                                               /***                                                                         ***/
                  , [F] = ']),0), 3,0)+''%'''                                   /***                                                                         ***/
               FROM                          [#A_CYQA]                          /***                                                                         ***/
                                                                           ) CQ /*** end and alias of complex query used to extract code                     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************* Headings and other static rows by table ***/
)                                                                                                                                                     myheadings
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#AWording]') IS NOT NULL
  DROP TABLE            [#AWording]
  SELECT * INTO         [#AWording]  FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
          DISTINCT
          [Variable]
         ,[Q_Wording]
         ,[Value]
         ,[A_Wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM    [#extracted]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       AWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#QWording]') IS NOT NULL
  DROP TABLE            [#QWording]
  SELECT * INTO         [#QWording]  FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
          DISTINCT
          [Variable]
         ,[Q_Wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM    #AWording
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       QWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#QAttrib]') IS NOT NULL
  DROP TABLE            [#QAttrib]
  SELECT * INTO         [#QAttrib]  FROM
/***************************************************************************************************************************************************************/
---- currently from a table not properly finished, but this shape should be achieved using aproperly coded table
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT 
       [Variable]
      ,[attk]
      ,[attr]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM [forum_ResAnal].[dbo].[vr_08__QAttributes]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 WHERE [attk] IN ( 'TopLine label', 'XNote01', 'SortKey' )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       QWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#QLabel]') IS NOT NULL
  DROP TABLE            [#QLabel]
  SELECT * INTO         [#QLabel]  FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
        V.[Variable]
      ,   [label]    = CASE WHEN A.[attr] IS NOT NULL
                            THEN A.[attr]
                            ELSE ''                   END
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        ( SELECT * FROM #QWording                                 )   V
    LEFT
    JOIN
        ( SELECT * FROM [#QAttrib] WHERE [attk] = 'TopLine label' )   A
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
    ON
         V.[Variable]
       = A.[Variable]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       QWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#QNote]') IS NOT NULL
  DROP TABLE            [#QNote]
  SELECT * INTO         [#QNote]  FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
        V.[Variable]
      ,   [note]     = CASE WHEN A.[attr] IS NOT NULL
                            THEN A.[attr]
                            ELSE ''                   END
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        ( SELECT * FROM #QWording                                 )   V
    LEFT
    JOIN
        ( SELECT * FROM [#QAttrib] WHERE [attk] = 'XNote01' )   A
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
    ON
         V.[Variable]
       = A.[Variable]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       QWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE1 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE1 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_BodyMain]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_BodyMain]
SELECT * INTO    [forum_ResAnal]..[vr_temp_BodyMain]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
          M.Variable
        , M.Value
        ,   Wording   =  L.A_Wording
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #AWording                                                             L
INNER
JOIN
     (SELECT                                                                     /*** beginning of subquery M                                                ***/
          Variable
        , Value
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [x] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
N'
FROM
/*** Aggregated data by C/Y/Q/A ********************************************************************************************************************************/
                [#A_CYQA]
/******************************************************************************************************************************** Aggregated data by C/Y/Q/A ***/
/*** pivoting percentage ***************************************************************************************************************************************/
  PIVOT   (       MAX([Percentage])
            FOR       [RYPCT]
            IN       (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
      (                                                                         /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
   SELECT DISTINCT                                                              /*** SELECT statement                                                        ***/
          ', [' + [RYPCT] + ']'                                                 /*** comma delimiter and brackets enclosing (field) elements to be listed    ***/
    FROM  [#A_CYQA]                                                             /*** from CTE ; no filters needed                                            ***/
         ORDER BY                                                               /*** sorting order: alphabetically                                           ***/
          ', [' + [RYPCT] + ']'                                                 /*** using comma & brackets enclosing elements to be listed                  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
                                                                              ) /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S04 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'                       )   )   AS   pivt1       '                             /*** end of listing of variables & pivoting percentage                       ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
/*** pivoting percentage ***************************************************************************************************************************************/
  PIVOT   (       MAX([Number])
            FOR       [RYCNT]
            IN       (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S06 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                               /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
   SELECT DISTINCT                                                              /*** SELECT statement                                                        ***/
          ', [' + [RYCNT] + ']'                                                 /*** comma delimiter and brackets enclosing (field) elements to be listed    ***/
    FROM  [#A_CYQA]                                                             /*** from CTE ; no filters needed                                            ***/
         ORDER BY                                                               /*** sorting order: alphabetically                                           ***/
          ', [' + [RYCNT] + ']'                                                 /*** using comma & brackets enclosing elements to be listed                  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S06 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S07 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'                       )   )   AS   pivt2       '                             /*** end of listing of variables & pivoting percentage                       ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S07 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'  GROUP BY Variable, Value  '                                                  /*** Groupping (aggregation) statement                                      ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'                                                                         )  M' /*** end of subquery M                                                      ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  N'
     ON   M.Variable = L.Variable
    AND   M.Value    = L.Value
                                                                           )  Q' /*** end of main enclosed query                                             ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE1                                    /***        display the currently stored code (to be executed)                           ***/
INSERT INTO [#MySQLCode]                                            /***        save currently stored code in a temporary table                              ***/
     SELECT [T]      = @ALLCODE1                                    /***                                                                                     ***/
--   SELECT [T]                                                     /***                                                                                     ***/
--     FROM [#MySQLCode]                                            /***                                                                                     ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE1)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE3 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE3 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_BodyXRows]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_BodyXRows]
SELECT * INTO    [forum_ResAnal]..[vr_temp_BodyXRows]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
            Variable
        ,   Value
        ,   Wording   =  ''''
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #QWording                                                             Q
CROSS
JOIN
     (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04a ****************************************************************************************************************************************************/
N'
       SELECT *
         FROM (SELECT  [Value] =  -5.00, [d]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([d]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04a ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04b ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] =  -4.00, [p]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([p]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04b ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04c ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] =  -3.00, [n]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([n]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04c ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04d ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] =  -2.00, [c]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([c]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04d ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04e ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] = 200.00, [t]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([t]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04e ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04f ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] = 500.00, [e]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([e]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04f ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
N'                                                                  )  F )  x ' /*** end of query                                                            ***/
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE3                                    /***        display the currently stored code (to be executed)                           ***/
INSERT INTO [#MySQLCode]                                            /***        save currently stored code in a temporary table                              ***/
     SELECT [T]      = @ALLCODE3                                    /***                                                                                     ***/
--   SELECT [T]                                                     /***                                                                                     ***/
--     FROM [#MySQLCode]                                            /***                                                                                     ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE3)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
ALTER
TABLE
           [forum_ResAnal]..[vr_temp_BodyXRows]
ALTER
COLUMN                                          [Wording] VARCHAR(MAX)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
UPDATE
           [forum_ResAnal]..[vr_temp_BodyXRows]
SET        [forum_ResAnal]..[vr_temp_BodyXRows].[Wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
    = '--------------------------------------------------------------------------------------------------------------------------------------------------------'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
WHERE
           [forum_ResAnal]..[vr_temp_BodyXRows].[Value]   = 500
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE2 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE2 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_Title]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_Title]
SELECT * INTO    [forum_ResAnal]..[vr_temp_Title]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
            Variable
        ,   Value
        ,   Wording   =  Q_Wording
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #QWording                                                             Q
CROSS
JOIN
     ( SELECT *
         FROM (  SELECT  [Value] = -6.00
                        ,[e]
                        ,[M]
                   FROM  [#heading]       )   e
       PIVOT (MAX([e]) FOR [M] IN (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'                                                     ) ) tpivoted )  F )  x ' /*** end of query                                                            ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE2                                    /***        display the currently stored code (to be executed)                           ***/
INSERT INTO [#MySQLCode]                                            /***        save currently stored code in a temporary table                              ***/
     SELECT [T]      = @ALLCODE2                                    /***                                                                                     ***/
--   SELECT [T]                                                     /***                                                                                     ***/
--     FROM [#MySQLCode]                                            /***                                                                                     ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE2)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE4 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE4 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_Label]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_Label]
SELECT * INTO    [forum_ResAnal]..[vr_temp_Label]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
            Variable
        ,   Value
        ,   Wording   =  label
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #QLabel                                                             Q
CROSS
JOIN
     ( SELECT *
         FROM (  SELECT  [Value] = -7.00
                        ,[e]
                        ,[M]
                   FROM  [#heading]       )   e
       PIVOT (MAX([e]) FOR [M] IN (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'                                                     ) ) tpivoted )  F )  x ' /*** end of query                                                            ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE4                                    /***        display the currently stored code (to be executed)                           ***/
INSERT INTO [#MySQLCode]                                            /***        save currently stored code in a temporary table                              ***/
     SELECT [T]      = @ALLCODE4                                    /***                                                                                     ***/
--   SELECT [T]                                                     /***                                                                                     ***/
--     FROM [#MySQLCode]                                            /***                                                                                     ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE4)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE5 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE5 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_Note]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_Note]
SELECT * INTO    [forum_ResAnal]..[vr_temp_Note]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
            Variable
        ,   Value
        ,   Wording   =  note
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #QNote                                                             Q
CROSS
JOIN
     ( SELECT *
         FROM (  SELECT  [Value] = 201.00
                        ,[e]
                        ,[M]
                   FROM  [#heading]       )   e
       PIVOT (MAX([e]) FOR [M] IN (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'                                                     ) ) tpivoted )  F )  x ' /*** end of query                                                            ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE5                                    /***        display the currently stored code (to be executed)                           ***/
INSERT INTO [#MySQLCode]                                            /***        save currently stored code in a temporary table                              ***/
     SELECT [T]      = @ALLCODE5                                    /***                                                                                     ***/
--   SELECT [T]                                                     /***                                                                                     ***/
--     FROM [#MySQLCode]                                            /***                                                                                     ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE5)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vrx_w_01_Basic_TopLinesAll_00]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrx_w_01_Basic_TopLinesAll_00]
SELECT * INTO    [forum_ResAnal].[dbo].[vrx_w_01_Basic_TopLinesAll_00]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
N'
SELECT
          vx1Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [S]
                           , [Variable]
                           , [Value]
                                          )
        , Variable
        , Value
        , Wording
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
     ( SELECT * FROM [forum_ResAnal]..[vr_temp_BodyMain]
       UNION
       ALL
       SELECT * FROM [forum_ResAnal]..[vr_temp_Label]
       UNION
       ALL
       SELECT * FROM [forum_ResAnal]..[vr_temp_Title]
       UNION
       ALL
       SELECT * FROM [forum_ResAnal]..[vr_temp_Note]
       UNION
       ALL
       SELECT * FROM [forum_ResAnal]..[vr_temp_BodyXRows]  )  U
LEFT
JOIN
              (  SELECT  [V] = [Variable]
                        ,[S] = [attr]
                   FROM  [#QAttrib]
                   WHERE [attk] = ''SortKey''                       ) S

      ON                 [V] = [Variable]
                                                                    ) X
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
INSERT INTO [#MySQLCode]                                            /***        save currently stored code in a temporary table                              ***/
     SELECT [T]      = @ALLCODE                                     /***                                                                                     ***/
--   SELECT [T]                                                     /***                                                                                     ***/
--     FROM [#MySQLCode]                                            /***                                                                                     ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE)                                    /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
--	   SELECT [T]                                                   /***                                                                                     ***/
--	   FROM [#MySQLCode]                                            /***                                                                                     ***/
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_BodyMain]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_BodyMain]
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_Label]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_Label]
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_Title]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_Title]
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_Note]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_Note]
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_BodyXRows]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_BodyXRows]
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _023_cp_create_x_tXLSX_t02__TopLines___________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrx_wbk_03_proTopLines_00]                              <<<<<     ***/
/***             This table only includes aggregated numeric values                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
----  PENDING:  metacode for auto selection of latest years
/*** > S01 *****************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal].[dbo].[vrx_w_02_proTopLines_00]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal].[dbo].[vrx_w_02_proTopLines_00]
SELECT * INTO   [forum_ResAnal].[dbo].[vrx_w_02_proTopLines_00]
FROM  (
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          [vx2Row]
          =  ROW_NUMBER()
             OVER(ORDER BY [vx1Row] )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        , [Variable]
        , [Value]
        , [Wording]
        , [N2007]
        , [P2007]
        , [N2012]             ---for latest years use metacode later
        , [P2012]
        , [N2013]
        , [P2013]
        , [vx1Row]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          [forum_ResAnal].[dbo].[vrx_w_01_Basic_TopLinesAll_00]         T
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
   JOIN
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
         (  SELECT DISTINCT
                   [Variable] AS  [V]
              FROM [forum_ResAnal].[dbo].[vr_08__QAttributes]
             WHERE [attk] = 'Itl'
               AND [attr] = 1                                      )   F
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
     ON      [Variable]  =  [V]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                            AS FilteredTopLines
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S03 *****************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _024_cp_create_x_tXLSX_t03__BTopLines_by_Reg___R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrx_w_03_Basic_TopLines_by_Region_00]                   <<<<<     ***/
/***             This table only includes aggregated numeric values                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#extracted]') IS NOT NULL
  DROP TABLE            [#extracted]
  SELECT * INTO         [#extracted]  FROM
/***************************************************************************************************************************************************************/
(
/*** Selected Data from long set *******************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          SELECT
                 [REGCODE]   = CASE
                                        WHEN SUBSTRING([Region5], 1,3)   = 'Ame' THEN 'R1'
                                        WHEN SUBSTRING([Region5], 1,3)   = 'Asi' THEN 'R2'
                                        WHEN SUBSTRING([Region5], 1,3)   = 'Eur' THEN 'R3'
                                        WHEN SUBSTRING([Region5], 1,3)   = 'Mid' THEN 'R4'
                                        WHEN SUBSTRING([Region5], 1,3)   = 'Sub' THEN 'R5'
                               END
                ,[Region5]
                ,[Q_Year]    =                  CAST(D.[Question_Year] AS VARCHAR)
                ,[Variable]  = CASE
                                   WHEN                [QA_std] LIKE '%_ny%' 
                                   THEN STUFF(         [QA_std]      ,         
                                   ((CHARINDEX('_ny',  [QA_std])) + 3) , 1, '')
                                   ELSE                [QA_std]
                               END
                ,[Q_Wording] =                         [QW_std]
                ,[Value]     = CASE
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2)) > 1)
                                      AND(             [QA_std] LIKE 'GRI_19_'              +'[bcdefx]'
                                                    OR [QA_std] LIKE 'SHI_0'  +'[1,4,5]'+'_'+'[bcdefx]'  )
                                   THEN    '1.00'
                                   ELSE         ISNULL([Answer_value], '0.00')
                               END
                ,[A_Wording] = CASE
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2))  = 0)
                                      AND(             [QA_std] LIKE 'GRI_19_'              +'[bcdefx]'
                                                    OR [QA_std] LIKE 'SHI_0'  +'[1,4,5]'+'_'+'[bcdefx]'  )
                                   THEN    'No cases were found'
                                   WHEN
                                         (CAST((ISNULL([Answer_value], 0)) AS decimal(12,2)) >= 1)
                                      AND(             [QA_std] LIKE 'GRI_19_'              +'[bcdefx]'
                                                    OR [QA_std] LIKE 'SHI_0'  +'[1,4,5]'+'_'+'[bcdefx]'  )
                                   THEN    '1+ cases were found'
                                   ELSE    [answer_wording_std]
                               END
                ,[CntWg]
                ,[R5Wg]
            FROM [vr_06w_LongData_ALL] D
               , [vr_07w_weights]      W
           WHERE          D.[Nation_fk]
                        = W.[Nation_fk]
             AND          D.[Question_Year]
                        = W.[Question_Year]
             AND          D.[Locality]
                       IN            (
                                        'aggregated by country'
                                      , 'not detailed'           )
             AND          D.[QA_std] NOT IN   ('GFI', 'GRI', 'SHI', 'GRI_20_05_x1')
             AND          D.[QA_std] NOT LIKE 'XSG_S_%'
             AND          D.[QA_std] NOT LIKE '%_d'+'[a,b]'
             AND          D.[QA_std] NOT LIKE '%_rd_1d'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************* Selected Data from long set ***/
)                                                                                                                                                      extracted
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  --IF OBJECT_ID (N'[forum_ResAnal].[dbo].[A_CYQA]', N'U') IS NOT NULL
  --DROP TABLE      [forum_ResAnal].[dbo].[A_CYQA]
  --SELECT * INTO   [forum_ResAnal].[dbo].[A_CYQA] FROM
  IF OBJECT_ID('tempdb..[#A_CYQA]') IS NOT NULL
  DROP TABLE            [#A_CYQA]
  SELECT * INTO         [#A_CYQA]  FROM
/***************************************************************************************************************************************************************/
(
/*** Aggregated data by C/Y/Q/A ********************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
          [RYCNT]       = 'N' + [REGCODE] + [Q_Year]
         ,[RYPCT]       = 'P' + [REGCODE] + [Q_Year]
         ,[Variable]
         ,[Value]
         ,[Number]      =     SUM([CntWg])
         ,[Percentage]  =     SUM([R5Wg])
  FROM   
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          [#extracted]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        GROUP BY
                 [REGCODE]
                ,[Q_Year]
                ,[Variable]
                ,[Value]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************************** Aggregated data by C/Y/Q/A ***/
)                                                                                                                                                         A_CYQA
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  --IF OBJECT_ID (N'[forum_ResAnal].[dbo].[heading]', N'U') IS NOT NULL
  --DROP TABLE      [forum_ResAnal].[dbo].[heading]
  --SELECT * INTO   [forum_ResAnal].[dbo].[heading] FROM
  IF OBJECT_ID('tempdb..[#heading]') IS NOT NULL
  DROP TABLE            [#heading]
  SELECT * INTO         [#heading]  FROM
/***************************************************************************************************************************************************************/
(
/*** Headings and other static rows by table *******************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
   SELECT                                                                       /*** SELECT statement                                                        ***/
                [M]
              , [x]  = '[' + [M] + '] = STR(ISNULL(MAX([' + [M] + [F]         /*** elements arranged to be used as code                                      ***/
              , [v]  = '[' + [M] + ']'                                        /*** field name to be used as code                                             ***/
              , [s]  = SUBSTRING([M],2,2) +'|'+ RIGHT([M],4) +'|'+ LEFT([M],1)
              , [a]  = SUBSTRING([M],2,2)
              , [y]  =                          RIGHT([M],4)
              , [f]  =                                             LEFT([M],1)
              , [r]  = CASE
                       WHEN SUBSTRING([M],3,1) = '1' THEN  'Americas'
                       WHEN SUBSTRING([M],3,1) = '2' THEN  'Asia-Pacific'
                       WHEN SUBSTRING([M],3,1) = '3' THEN  'Europe'
                       WHEN SUBSTRING([M],3,1) = '4' THEN  'Middle East-North Africa'
                       WHEN SUBSTRING([M],3,1) = '5' THEN  'Sub-Saharan Africa'
                        END
              , [e]  = ''
              , [p]  = CASE
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  ) <  2011
                       THEN                         'MID-'
                       WHEN  LEFT([M], 1  )  = 'N'
                       AND  RIGHT([M], 4  ) >= 2011
                       THEN                         'Dec. 31,'
                       ELSE RIGHT([M], 4  )
                        END
              , [n]  = CASE
                       WHEN  LEFT([M], 1  )  = 'N'
                       THEN                         'NUMBER OF'
                       WHEN  LEFT([M], 1  )  = 'P'
                       THEN                         '  %  OF  '
                        END
              , [c]  = 'COUNTRIES'
              , [t]  = CASE
                       WHEN       LEFT([M], 1  )   = 'P'
                       THEN                               '100 %'
                       WHEN  SUBSTRING([M], 3,1)   = '1'
                       THEN                               '35'
                       WHEN  SUBSTRING([M], 3,1)   = '2'
                       THEN                               '50'
                       WHEN  SUBSTRING([M], 3,1)   = '3'
                       THEN                               '45'
                       WHEN  SUBSTRING([M], 3,1)   = '4'
                       THEN                               '20'
                       WHEN  SUBSTRING([M], 3,1)   = '5'
                       AND       RIGHT([M], 4  )  <  2011
                       THEN                               '47'
                       WHEN  SUBSTRING([M], 3,1)   = '5'
                       AND       RIGHT([M], 4  )  >= 2011
                       THEN                               '48'
                        END
    FROM (                                                                      /*** from complex query, filters already included in it                      ***/
             SELECT                                                             /***                                                                         ***/
           DISTINCT [M] = [RYCNT]                                               /***                                                                         ***/
                  , [F] = ']),0),12,0)'                                         /***                                                                         ***/
               FROM                          [#A_CYQA]                          /***                                                                         ***/
           UNION                                                                /***                                                                         ***/
           ALL                                                                  /***                                                                         ***/
           SELECT                                                               /***                                                                         ***/
           DISTINCT [M] = [RYPCT]                                               /***                                                                         ***/
                  , [F] = ']),0), 3,0)+''%'''                                   /***                                                                         ***/
               FROM                          [#A_CYQA]                          /***                                                                         ***/
                                                                           ) CQ /*** end and alias of complex query used to extract code                     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/******************************************************************************************************************* Headings and other static rows by table ***/
)                                                                                                                                                     myheadings
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#AWording]') IS NOT NULL
  DROP TABLE            [#AWording]
  SELECT * INTO         [#AWording]  FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
          DISTINCT
          [Variable]
         ,[Q_Wording]
         ,[Value]
         ,[A_Wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM    [#extracted]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       AWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
  IF OBJECT_ID('tempdb..[#QWording]') IS NOT NULL
  DROP TABLE            [#QWording]
  SELECT * INTO         [#QWording]  FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
          DISTINCT
          [Variable]
         ,[Q_Wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM    #AWording
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                       QWording
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE1 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE1 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_BodyMain]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_BodyMain]
SELECT * INTO    [forum_ResAnal]..[vr_temp_BodyMain]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
          M.Variable
        , M.Value
        ,   Wording   =  L.A_Wording
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #AWording                                                             L
INNER
JOIN
     (SELECT                                                                     /*** beginning of subquery M                                                ***/
          Variable
        , Value
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [x] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
N'
FROM
/*** Aggregated data by C/Y/Q/A ********************************************************************************************************************************/
                [#A_CYQA]
/******************************************************************************************************************************** Aggregated data by C/Y/Q/A ***/
/*** pivoting percentage ***************************************************************************************************************************************/
  PIVOT   (       MAX([Percentage])
            FOR       [RYPCT]
            IN       (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
      (                                                                         /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
   SELECT DISTINCT                                                              /*** SELECT statement                                                        ***/
          ', [' + [RYPCT] + ']'                                                 /*** comma delimiter and brackets enclosing (field) elements to be listed    ***/
    FROM  [#A_CYQA]                                                             /*** from CTE ; no filters needed                                            ***/
         ORDER BY                                                               /*** sorting order: alphabetically                                           ***/
          ', [' + [RYPCT] + ']'                                                 /*** using comma & brackets enclosing elements to be listed                  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
                                                                              ) /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S04 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'                       )   )   AS   pivt1       '                             /*** end of listing of variables & pivoting percentage                       ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
/*** pivoting percentage ***************************************************************************************************************************************/
  PIVOT   (       MAX([Number])
            FOR       [RYCNT]
            IN       (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S06 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                               /*** parenthesis to include query for the cell to be stuffed                 ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
   SELECT DISTINCT                                                              /*** SELECT statement                                                        ***/
          ', [' + [RYCNT] + ']'                                                 /*** comma delimiter and brackets enclosing (field) elements to be listed    ***/
    FROM  [#A_CYQA]                                                             /*** from CTE ; no filters needed                                            ***/
         ORDER BY                                                               /*** sorting order: alphabetically                                           ***/
          ', [' + [RYCNT] + ']'                                                 /*** using comma & brackets enclosing elements to be listed                  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S06 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S07 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'                       )   )   AS   pivt2       '                             /*** end of listing of variables & pivoting percentage                       ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S07 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'  GROUP BY Variable, Value  '                                                  /*** Groupping (aggregation) statement                                      ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'                                                                         )  M' /*** end of subquery M                                                      ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  N'
     ON   M.Variable = L.Variable
    AND   M.Value    = L.Value
                                                                           )  Q' /*** end of main enclosed query                                             ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE1                                    /***        display the currently stored code (to be executed)                           ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE1)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE2 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE2 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_BodyTitle]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_BodyTitle]
SELECT * INTO    [forum_ResAnal]..[vr_temp_BodyTitle]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
            Variable
        ,   Value
        ,   Wording   =  Q_Wording
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #QWording                                                             Q
CROSS
JOIN
     ( SELECT *
         FROM (  SELECT  [Value] = -6.00
                        ,[e]
                        ,[M]
                   FROM  [#heading]       )   e
       PIVOT (MAX([e]) FOR [M] IN (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'                                                     ) ) tpivoted )  F )  x ' /*** end of query                                                            ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE2                                    /***        display the currently stored code (to be executed)                           ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE2)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE3 nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE3 = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
IF OBJECT_ID (N''[forum_ResAnal]..[vr_temp_BodyXRows]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal]..[vr_temp_BodyXRows]
SELECT * INTO    [forum_ResAnal]..[vr_temp_BodyXRows]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
N'
SELECT
            Variable
        ,   Value
        ,   Wording   =  ''''
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
        #QWording                                                             Q
CROSS
JOIN
     (
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04a ****************************************************************************************************************************************************/
N'
       SELECT *
         FROM (SELECT  [Value] =  -5.00, [r]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([r]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04a ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04b ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] =  -4.00, [p]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([p]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04b ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04c ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] =  -3.00, [n]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([n]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04c ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04d ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] =  -2.00, [c]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([c]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04d ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S04e ****************************************************************************************************************************************************/
N'
       UNION ALL
       SELECT *
         FROM (SELECT  [Value] = 200.00, [t]     ,[M] FROM [#heading]) H 
                PIVOT               (MAX([t]) FOR [M] IN (
'
+
STUFF((SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')),1, 1,'') /*** STUFFED region/year headings nested in XML string cell in parentesis    ***/
+
N'                                                     ) ) tpivoted '           /*** end of subquery                                                         ***/
/*** < S04e ****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S05 *****************************************************************************************************************************************************/
N'                                                                  )  F )  x ' /*** end of query                                                            ***/
/*** < S05 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE3                                    /***        display the currently stored code (to be executed)                           ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE3)                                   /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
/***     >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>    >>>     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S01 *****************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N''[forum_ResAnal].[dbo].[vrx_w_03_Basic_TopLines_by_Region_00]'', N''U'') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrx_w_03_Basic_TopLines_by_Region_00]
SELECT * INTO    [forum_ResAnal].[dbo].[vrx_w_03_Basic_TopLines_by_Region_00]
FROM  (
'
/*** < S01 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S02 *****************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
N'
SELECT
          V5Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Variable]
                           , [Value]
                                          )
        , Variable
        , Value
        , Wording
'
/*** < S02 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 (   SELECT ',' + [v] FROM [#heading] ORDER BY [s] for xml path('')   )         /*** SELECT region/year headings nested in XML string cell in parentesis     ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** > S03 *****************************************************************************************************************************************************/
N'
FROM
     ( SELECT * FROM [forum_ResAnal]..[vr_temp_BodyMain]
       UNION
       ALL
       SELECT * FROM [forum_ResAnal]..[vr_temp_BodyTitle]
       UNION
       ALL
       SELECT * FROM [forum_ResAnal]..[vr_temp_BodyXRows]  )  U
                                                                    ) X
'
/*** < S03 *****************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
/***************************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @ALLCODE                                     /***        display the currently stored code (to be executed)                           ***/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
    EXEC              (@ALLCODE)                                    /***        execute the code that has been stored as text                                ***/
/***************************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_BodyMain]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_BodyMain]
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_BodyTitle]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_BodyTitle]
IF OBJECT_ID (N'[forum_ResAnal]..[vr_temp_BodyXRows]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal]..[vr_temp_BodyXRows]
/***************************************************************************************************************************************************************/
/*           - + -           - + -           - + -           - + -          - - + - -          - + -           - + -           - + -           - + -           */
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _025_cp_create_x_tXLSX_t04__BVars_by_Ctry______R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrx_w_04_Vars_by_Ctry_source_00]                        <<<<<     ***/
/***             This table only includes aggregated numeric values                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal].[dbo].[vrx_w_04_Vars_by_Ctry_source_00]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal].[dbo].[vrx_w_04_Vars_by_Ctry_source_00]
SELECT * INTO   [forum_ResAnal].[dbo].[vrx_w_04_Vars_by_Ctry_source_00]
FROM
/***************************************************************************************************************************************************************/
--SELECT * FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
( SELECT
          [Nation_fk]
        , [Ctry_EditorialName]
        , [Variable] = REPLACE([L], '.Q.', '_')
        , [AV]
        , [QY]
--      , [S]
    FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
    ( SELECT 
             [Nation_fk]
            ,[Ctry_EditorialName]
            ,[QA_std]
            ,[AV]       =       STR([Answer_value] , 6,2)
            ,[QY]       = 'Y' + STR([Question_Year], 4,0)
        FROM [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]              )                 T
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
INNER
JOIN
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
    ( SELECT 
             [V] = [Variable]
           , [S] = [SortKey]
           , [L] = [TLC label]
        FROM
            ( SELECT [Variable]
                    ,[attk]
                    ,[attr]
                FROM [forum_ResAnal].[dbo].[vr_08__QAttributes]
               WHERE [attk] IN ( 'iTLC',  'TLC label', 'SortKey' )  ) LABSORT
                     PIVOT
                           (MAX ([attr]) 
                            FOR  [attk]
                           IN (  [iTLC]
                               , [SortKey]
                               , [TLC label] )) AS WIDETB
       WHERE [iTLC] = 1                                               )                 F
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
   ON      [qa_std]  =  [v]                                                                   ) SELDATA
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 PIVOT
      (MAX ([AV]) 
       FOR  [QY]
        in (  [Y2007]
            , [Y2012]
            , [Y2013]   ))  AS ValuesPerYear
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _026_cp_create_x_tXLSX_t05__RRIdxSbyR__________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrx_w_05_proRRIdxSbyR_00]                           <<<<<     ***/
/***             This table only includes aggregated numeric values                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal].[dbo].[vrx_w_05_proRRIdxSbyR_00]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal].[dbo].[vrx_w_05_proRRIdxSbyR_00]
SELECT * INTO   [forum_ResAnal].[dbo].[vrx_w_05_proRRIdxSbyR_00]
FROM
/***************************************************************************************************************************************************************/
(
/*** > pivoted data ********************************************************************************************************************************************/
SELECT 
        [IdxS_row] =
                      ROW_NUMBER()
                      OVER(ORDER BY
                                     [Region]
                                    ,[CEN]
                                              )
      , [Nation_fk]
      , [Ctry_EditorialName]
      , [GRI - baseline year]
      , [SHI - baseline year]
      , [GRI - previous year]
      , [SHI - previous year]
      , [GRI - latest year]
      , [SHI - latest year]
      , [Region]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
(
/*** > pivotable data ******************************************************************************************************************************************/
SELECT 
       [Nation_fk]
      ,[Ctry_EditorialName]    =  CASE
                                  WHEN [Nation_fk] > 999 THEN   [Region]
                                                              + '     '
                                                              + 
                                                                CONVERT(VARCHAR(29),
                                                                 CAST(
                                                                  (ROUND(
                                                                     SUM([w])
                                                                     OVER(PARTITION BY [Region]) 
                                                                  , 0))
                                                                 AS DECIMAL(24,0)) 
                                                                )
                                                              + ' countries'
                                  ELSE [Ctry_EditorialName]
                                  END
      ,[Region]
      ,[CEN]
      ,[HEAD]
      ,[IRV]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT 
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Region]                =  [Region5]
      ,[CEN]                   =  CASE
                                  WHEN [Nation_fk] < 999
                                  THEN [Ctry_EditorialName]
                                  END
      ,[HEAD]                  =  CASE
                                  WHEN [Year] = ( SELECT ((MAX([Year]))    ) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] )
                                  THEN [Index_abbreviation] + ' - latest year'
                                  WHEN [Year] = ( SELECT ((MAX([Year])) - 1) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] )
                                  THEN [Index_abbreviation] + ' - previous year'
                                  WHEN [Year] = ( SELECT ((MIN([Year]))    ) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] )
                                  THEN [Index_abbreviation] + ' - baseline year'
                                  END
      ,[IRV]                   =  CASE
                                  WHEN [Nation_fk] < 999
                                  THEN CONVERT(VARCHAR(5),[I_Rounded_value])
                                  ELSE ''
                                  END
      ,[w]                     =  CASE
                                  WHEN [Nation_fk] < 999
                                  THEN (1/ (CAST
                                             (COUNT([Year]) 
                                              OVER
                                             (PARTITION BY [Nation_fk])
                                            AS DECIMAL(24,16)) ) )
                                  ELSE 0
                                  END
  FROM
       [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
WHERE
          [ByRegion5]  = 1
AND
          [Index_abbreviation] != 'GFI'
AND
      (   [Year] >= ( SELECT ((MAX([Year])) - 1) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] )
       OR [Year]  = ( SELECT ((MIN([Year]))    ) FROM [vr_04w_R&H_Index_by_CtryRegion&Yr] ) )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)                                                                                                                                                AS prePivtbDATA
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < pivotable data ******************************************************************************************************************************************/
)                                                                                                                                                AS    PivtbDATA
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
PIVOT  ( MAX([IRV])    
         FOR [HEAD]
IN ( 
       [GRI - baseline year]
     , [SHI - baseline year]
     , [GRI - previous year]
     , [SHI - previous year]
     , [GRI - latest year]
     , [SHI - latest year]
                             )
                                ) AS pivt
/*** < pivoted data ********************************************************************************************************************************************/
)                                                                                                                                                AS      PvtDATA
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _027_cp_create_x_tXLSX_t06__RRIdxMedbyR________R.sql                                                                                                             
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vrx_w_05_proRRIdxSbyR_00]                           <<<<<     ***/
/***             This table only includes aggregated numeric values                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID (N'[forum_ResAnal].[dbo].[vrx_w_06_proRRIdxMedians_00]', N'U') IS NOT NULL
DROP TABLE      [forum_ResAnal].[dbo].[vrx_w_06_proRRIdxMedians_00]
SELECT * INTO   [forum_ResAnal].[dbo].[vrx_w_06_proRRIdxMedians_00]
FROM
/***************************************************************************************************************************************************************/
(
/*** > extracted data ******************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT 
       [IdxM_row]           = ROW_NUMBER()
                              OVER(ORDER BY [Year]
                                          , [Index_abbreviation]
                                          , [Region5]             )  --[RIYv_row]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[Index_Year]
      ,[Region5]
      ,[Index_abbreviation]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[I_Rounded_value]    = STR([I_Rounded_value], 4,1)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM [forum_ResAnal].[dbo].[vr_04w_R&H_Index_by_CtryRegion&Yr]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 WHERE [level]               =    2.5
   AND [Index_abbreviation] IN ( 'GRI', 'SHI' )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** < extracted data ******************************************************************************************************************************************/
)                                                                                                                                                AS     extdDATA
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _028_cp_creteDB.sql                                                                                                                                              
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
USE [master]
GO
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***      Create working database for GR&SH R                                                                                                   ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
CREATE DATABASE [GRSHRcode];
GO
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
 ALTER DATABASE [GRSHRcode] SET RECOVERY SIMPLE 
GO





/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO


N'
CREATE DATABASE [GRSHR' + @CrY + '];
 ALTER DATABASE [GRSHR' + @CrY + '] SET RECOVERY SIMPLE 
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO



/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO









/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  cursor                                                                    ***/
DECLARE @CODEmain1 nvarchar(max)                          /***        declare variable for storing code during each data retreival              ***/
DECLARE @tablename nvarchar(max)                          /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor   CURSOR FOR                             /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [TABLE_NAME]                                  /*** >>>    select table names                                                        ***/
FROM        [INFORMATION_SCHEMA].[TABLES]                 /***        from the system view listing tables & views in the database               ***/
WHERE       [TABLE_TYPE] = 'BASE TABLE'                   /*** <<<    filter to display only tables (excluding views)                           ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/



--IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrc_01_DB_Long_NoAggregated]', N'U') IS NOT NULL

-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT * ---	INTO [#vrc_01_DB_Long_NoAggregated]
FROM
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
(
/***  Basic Data: Long NPR ******************************************************************************************/
----------------------------------------------------------------------------------------------------------------------
/*** Set of data at country level ***********************************************************************************/

) AS NPR
/***************************************************************************************************************************************************************/
WHERE
/* filters */
Ctry_EditorialName                                   != 'North Korea'                   /* Excluded from the analysis */
AND
Ctry_EditorialName + '_/_' + STR(Question_Year, 4,0) != 'South Sudan_/_2010'            /* although data are not aggregated for the other part of former Sudan */
/* filters */
AND
                             STR(Question_Year, 4,0)  =               '2013'            /* although data are not aggregated for the other part of former Sudan */
/***************************************************************************************************************************************************************/
GO



CREATE DATABASE [GRSHR2015] ON  PRIMARY 


USE master;
GO
CREATE DATABASE mytest;
GO
-- Verify the database files and sizes
SELECT name, size, size*1.0/128 AS [Size in MBs] 
FROM sys.master_files
WHERE name = N'mytest';
GO


/****** Object:  Database [GRSHR2015]    Script Date: 08/04/2015 16:45:30 ******/
CREATE DATABASE [GRSHR2015] ON  PRIMARY 
( NAME = N'GRSHR2015', FILENAME = N'E:\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\GRSHR2015.mdf' , SIZE = 218112KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'GRSHR2015_log', FILENAME = N'E:\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\GRSHR2015_log.ldf' , SIZE = 12352KB , MAXSIZE = 2048GB , FILEGROWTH = 10%)
GO

ALTER DATABASE [GRSHR2015] SET COMPATIBILITY_LEVEL = 100
GO

IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [GRSHR2015].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO

ALTER DATABASE [GRSHR2015] SET ANSI_NULL_DEFAULT OFF 
GO

ALTER DATABASE [GRSHR2015] SET ANSI_NULLS OFF 
GO

ALTER DATABASE [GRSHR2015] SET ANSI_PADDING OFF 
GO

ALTER DATABASE [GRSHR2015] SET ANSI_WARNINGS OFF 
GO

ALTER DATABASE [GRSHR2015] SET ARITHABORT OFF 
GO

ALTER DATABASE [GRSHR2015] SET AUTO_CLOSE OFF 
GO

ALTER DATABASE [GRSHR2015] SET AUTO_CREATE_STATISTICS ON 
GO

ALTER DATABASE [GRSHR2015] SET AUTO_SHRINK OFF 
GO

ALTER DATABASE [GRSHR2015] SET AUTO_UPDATE_STATISTICS ON 
GO

ALTER DATABASE [GRSHR2015] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO

ALTER DATABASE [GRSHR2015] SET CURSOR_DEFAULT  GLOBAL 
GO

ALTER DATABASE [GRSHR2015] SET CONCAT_NULL_YIELDS_NULL OFF 
GO

ALTER DATABASE [GRSHR2015] SET NUMERIC_ROUNDABORT OFF 
GO

ALTER DATABASE [GRSHR2015] SET QUOTED_IDENTIFIER OFF 
GO

ALTER DATABASE [GRSHR2015] SET RECURSIVE_TRIGGERS OFF 
GO

ALTER DATABASE [GRSHR2015] SET  DISABLE_BROKER 
GO

ALTER DATABASE [GRSHR2015] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO

ALTER DATABASE [GRSHR2015] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO

ALTER DATABASE [GRSHR2015] SET TRUSTWORTHY OFF 
GO

ALTER DATABASE [GRSHR2015] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO

ALTER DATABASE [GRSHR2015] SET PARAMETERIZATION SIMPLE 
GO

ALTER DATABASE [GRSHR2015] SET READ_COMMITTED_SNAPSHOT OFF 
GO

ALTER DATABASE [GRSHR2015] SET HONOR_BROKER_PRIORITY OFF 
GO

ALTER DATABASE [GRSHR2015] SET  READ_WRITE 
GO

ALTER DATABASE [GRSHR2015] SET RECOVERY SIMPLE 
GO

ALTER DATABASE [GRSHR2015] SET  MULTI_USER 
GO

ALTER DATABASE [GRSHR2015] SET PAGE_VERIFY CHECKSUM  
GO

ALTER DATABASE [GRSHR2015] SET DB_CHAINING OFF 
GO












/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>         This is the script used to remove all tables & set all views to [a] = a from the database  [GRSHRYYYY]         <<<<<     ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> remove all tables & set all views to [a]                                                 --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> these are general variables to be used                                    ***/
/**************************************************************************************************************************************************/
DECLARE @CrDt varchar( 8)                                 /***        declare variable for storing current date (as text)                       ***/
SET     @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))       /***        set value to current date in the format YYYYMMDD                          ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  cursor                                                                    ***/
DECLARE @CODEmain1 nvarchar(max)                          /***        declare variable for storing code during each data retreival              ***/
DECLARE @tablename nvarchar(max)                          /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor   CURSOR FOR                             /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [TABLE_NAME]                                  /*** >>>    select table names                                                        ***/
FROM        [INFORMATION_SCHEMA].[TABLES]                 /***        from the system view listing tables & views in the database               ***/
WHERE       [TABLE_TYPE] = 'BASE TABLE'                   /*** <<<    filter to display only tables (excluding views)                           ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEmain1 =                                      /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
--   N'SELECT * INTO [_bk_forum]..[XR_'+@tablename+'_'+@CrDt+']' /*        selection into backup table                                            */
-- + CHAR(10)                                                    /*         add CR (& spaces)                                                     */
-- + N'    FROM                      ['+@tablename+']'           /*        from table to be deleted                                               */
-- + CHAR(10)                                                    /*         add CR                                                                */
   + N'   DROP TABLE                 ['+@tablename+']'           /*        drop the table to be deleted                                           */
                                                          /*** <      the code to be stored as string ends here                                 ***/
	PRINT  (@CODEmain1)                                   /***        display the currently stored code (to be executed)                        ***/
	EXEC   (@CODEmain1)                                   /***        execute the code that has been stored as text                             ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  cursor                                                                    ***/
/**************************************************************************************************************************************************/
GO

/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  cursor                                                                    ***/
DECLARE @CODEmain2 nvarchar(max)                          /***        declare variable for storing code during each data retreival              ***/
DECLARE @viewname  nvarchar(max)                          /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor   CURSOR FOR                             /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [TABLE_NAME]                                  /*** >>>    select view names                                                         ***/
FROM        [INFORMATION_SCHEMA].[TABLES]                 /***        from the system view listing tables & views in the database               ***/
WHERE       [TABLE_TYPE] = 'VIEW'                         /*** <<<    filter to display only views (excluding tables)                           ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @viewname                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEmain2 =                                      /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'ALTER VIEW [' + @viewname + '] AS SELECT [a] = ''a'' '        /*         set the view to be blanked to "a"                                      */
                                                          /*** <      the code to be stored as string ends here                                 ***/
PRINT  (@CODEmain2)                                       /***        display the currently stored code (to be executed)                        ***/
EXEC   (@CODEmain2)                                       /***        execute the code that has been stored as text                             ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @viewname                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  cursor                                                                    ***/
/**************************************************************************************************************************************************/
GO







SELECT
           entity      = 'Ctry'
      ,    link_fk     = KN.[Nation_answer_pk]
      ,    Nation_fk   = N.[Nation_pk]
      ,    Locality_fk = NULL
      ,    Religion_fk = NULL
      ,    Region5     = N.[Region]
      ,    Region6     = N.[SubRegion6]
      , N.[Ctry_EditorialName]
      ,    Locality    = 'not detailed'
      ,    Religion    = ''
      , Q.[Question_Year]
   --  GET QS_fk  --- for coding process
      ,    QA_std      = Q.[Question_abbreviation_std]
      ,    QW_std      = Q.[Question_short_wording_std]
      , Q.[Answer_value]
      , Q.[answer_wording]
      , Q.[answer_wording_std]
      , Q.[Question_fk]
      , Q.[Answer_fk]
      , Q.[Notes]
  FROM [forum].[dbo].[Pew_Q&A]               Q
      ,[forum].[dbo].[Pew_Nation]            N
      ,[forum].[dbo].[Pew_Nation_Answer]     KN
WHERE Q.[Answer_fk]           = KN.[Answer_fk]
  AND N.[Nation_pk]           = KN.[Nation_fk]
                                /* Pull only data on Restrictions */
  AND Q.[Pew_Data_Collection] = 'Global Restriction on Religion Study'
/*********************************************************************************** Set of data at country level ***/
UNION
/*** Set of data at country/religious group level *******************************************************************/
SELECT
           entity      = 'RGrp'
      ,    link_fk     = KR.[Nation_religion_answer_pk]
      ,    Nation_fk   = N.[Nation_pk]
      ,    Locality_fk = NULL
      ,    Religion_fk = G.[Religion_group_pk]
      ,    Region5     = N.[Region]
      ,    Region6     = N.[SubRegion6]
      , N.[Ctry_EditorialName]
      ,    Locality    = 'not detailed'
      ,    Religion    = G.[Pew_religion]
      , Q.[Question_Year]
   --  GET QS_fk  --- for coding process
      ,    QA_std      = Q.[Question_abbreviation_std]
      ,    QW_std      = Q.[Question_short_wording_std]
      , Q.[Answer_value]
      , Q.[answer_wording]
      , Q.[answer_wording_std]
      , Q.[Question_fk]
      , Q.[Answer_fk]
      , Q.[Notes]
  FROM [forum].[dbo].[Pew_Q&A]                      Q
      ,[forum].[dbo].[Pew_Nation]                   N
      ,[forum].[dbo].[Pew_Religion_Group]           G
      ,[forum].[dbo].[Pew_Nation_Religion_Answer]   KR
WHERE Q.[Answer_fk]           = KR.[Answer_fk]
  AND KR.[Religion_group_fk]  =  G.[Religion_group_pk]
  AND  N.[Nation_pk]          = KR.[Nation_fk]
                                /* Pull only data on Restrictions */
  AND Q.[Pew_Data_Collection] = 'Global Restriction on Religion Study'
/******************************************************************* Set of data at country/religious group level ***/
UNION
/*** Set of data at country/province level **************************************************************************/
SELECT
           entity             = 'Prov'
      ,    link_fk     = KL.[Locality_answer_pk]
      ,    Nation_fk   = N.[Nation_pk]
      ,    Locality_fk = L.[Locality_pk]
      ,    Religion_fk = NULL
      ,    Region5     = N.[Region]
      ,    Region6     = N.[SubRegion6]
      , N.[Ctry_EditorialName]
      ,    Locality    = L.Locality
      ,    Religion    = ''
      , Q.[Question_Year]
   --  GET QS_fk  --- for coding process
      ,    QA_std      = Q.[Question_abbreviation_std]
      ,    QW_std      = Q.[Question_short_wording_std]
      , Q.[Answer_value]
      , Q.[answer_wording]
      , Q.[answer_wording_std]
      , Q.[Question_fk]
      , Q.[Answer_fk]
      , Q.[Notes]
  FROM [forum].[dbo].[Pew_Q&A]               Q
      ,[forum].[dbo].[Pew_Locality]          L
      ,[forum].[dbo].[Pew_Nation]            N
      ,[forum].[dbo].[Pew_Locality_Answer]   KL
WHERE Q.[Answer_fk]   = KL.[Answer_fk]
  AND L.[Locality_pk] = KL.[Locality_fk]
  AND N.[Nation_pk]   =
                                /* In order to keep consistent to previuos years 
                                   Data by Province currently belonging to South Sudan
                                   should considered data for Sudan before 2010: */
                     CASE 
                            WHEN L.[Nation_fk]     = 237 
                             AND Q.[Question_Year] < 2010 
                            THEN                           197
                            ELSE                           L.[Nation_fk]
                     END 
                                /* In order to avoid changing the final set,
                                   Data previously used for Northern Cyprus
                                   should be excluded: ????                                 */
                                /* Although we have REAL data by province for North Korea,
                                   we will not use them in this analysis: ????              */
                                /* Pull only data on Restrictions */
  AND Q.[Pew_Data_Collection] = 'Global Restriction on Religion Study'
/************************************************************************** Set of data at country/province level ***/
----------------------------------------------------------------------------------------------------------------------
/******************************************************************************************  Basic Data: Long NPR ***/
) AS NPR
/***************************************************************************************************************************************************************/
WHERE
/* filters */
Ctry_EditorialName                                   != 'North Korea'                   /* Excluded from the analysis */
AND
Ctry_EditorialName + '_/_' + STR(Question_Year, 4,0) != 'South Sudan_/_2010'            /* although data are not aggregated for the other part of former Sudan */
/* filters */
AND
                             STR(Question_Year, 4,0)  =               '2013'            /* although data are not aggregated for the other part of former Sudan */
/***************************************************************************************************************************************************************/
GO




 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _031_cp__cleanDB_________.sql                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 001    ----------------------------------------------------------------------------- '
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>         This script creates the database [GRSHRYYYY], removes all tables & views, and sets views to [a] = 'a'          <<<<<     ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/

/**************************************************************************************************************************************************/
/***      Create working database for GR&SH R                                                                                                   ***/
/**************************************************************************************************************************************************/
--/*----------------------------------------------------------------------------------------------------------------------------------------------*/
--	USE [master]
--	GO
--/*----------------------------------------------------------------------------------------------------------------------------------------------*/
--	CREATE DATABASE [GRSHRcode];
--	GO
--/*----------------------------------------------------------------------------------------------------------------------------------------------*/
--	 ALTER DATABASE [GRSHRcode] SET RECOVERY SIMPLE 
--	GO
--/*----------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/

USE [GRSHRcode]
GO

/**************************************************************************************************************************************************/
/***      Remove all tables and views                                                                                                           ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> these are general variables to be used                                    ***/
/**************************************************************************************************************************************************/
DECLARE @CrDt varchar( 8)                                 /***        declare variable for storing current date (as text)                       ***/
SET     @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))       /***        set value to current date in the format YYYYMMDD                          ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  cursor                                                                    ***/
DECLARE @CODEmain1 nvarchar(max)                          /***        declare variable for storing code during each data retreival              ***/
DECLARE @tablename nvarchar(max)                          /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor   CURSOR FOR                             /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT [ct] =                                             /*** >>>    select concatenated text                                                  ***/
                REPLACE([TABLE_TYPE], 'BASE ', '')        /***               edited table type (base )"TABLE' or "VIEW"                         ***/
              + '  [' + [TABLE_NAME] + ']'                /***               table/view names                                                   ***/
FROM        [INFORMATION_SCHEMA].[TABLES]                 /*** <<<    from the system view listing tables & views in the database               ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEmain1 =                                      /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
--/*----------------------------------------------------------------------------------------------------------------------------------------------*/
--   N'SELECT * INTO [_bk_forum]..[XR_'+@tablename+'_'+@CrDt+']' /*        selection into backup table                                            */
-- + CHAR(10)                                                    /*         add CR (& spaces)                                                     */
-- + N'    FROM                      ['+@tablename+']'           /*        from table to be deleted                                               */
-- + CHAR(10)                                                    /*         add CR                                                                */
--/*----------------------------------------------------------------------------------------------------------------------------------------------*/
   + N'                        DROP   '+@tablename+''           /*        drop the table to be deleted                                           */
                                                          /*** <      the code to be stored as string ends here                                 ***/
	PRINT  (@CODEmain1)                                   /***        display the currently stored code (to be executed)                        ***/
	EXEC   (@CODEmain1)                                   /***        execute the code that has been stored as text                             ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @tablename                               /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  cursor                                                                    ***/
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/***      Create views setting them to 'a'                                                                                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  cursor                                                                    ***/
DECLARE @CODEmain2 nvarchar(max)                          /***        declare variable for storing code during each data retreival              ***/
DECLARE @viewname  nvarchar(max)                          /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor   CURSOR FOR                             /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
      SELECT [VAR] =  'v01_EnteredValues'                 /*** >>>    select view names                                                         ***/
UNION SELECT [VAR] =  'v02_AllCodedValues'                /*** >>>       ... view names                                                         ***/
UNION SELECT [VAR] =  'v03_WideChanges'                   /*** >>>       ... view names                                                         ***/
UNION SELECT [VAR] =  'v04_Descriptions'                  /*** >>>       ... view names                                                         ***/
UNION SELECT [VAR] =  'v05_ReportData'                    /*** >>>       ... view names                                                         ***/
UNION SELECT [VAR] =  'v06_NDLongNoAggreg'                /*** >>>       ... view names                                                         ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @viewname                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEmain2 =                                      /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'CREATE VIEW [' + @viewname + '] AS SELECT [a] = ''a'' ' /*               set the view to be blanked to "a"                                      */
                                                          /*** <      the code to be stored as string ends here                                 ***/
PRINT  (@CODEmain2)                                       /***        display the currently stored code (to be executed)                        ***/
EXEC   (@CODEmain2)                                       /***        execute the code that has been stored as text                             ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @viewname                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  cursor                                                                    ***/
/**************************************************************************************************************************************************/
GO
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _032_cp_DBnBlank_ResDt.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the table view [GRSHRYYYY].[dbo].[AllLongData]                                     <<<<<     ***/
/***             (extracted data from [forum] and filter fields)                                                                                ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [AllLongData]                                                              --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/

---- NOTES: 
  -- this code should be modified after...
  -- these variables, calculated as persisted during coding period, should be also used in the aggregated data 
  -- currently used from [forum_ResAnal].[dbo].[vr_06w_LongData_ALL] but from final [forum] data once loaded...
  --    [GRI_19_x]
  --    [SHI_04_x]
  --    [SHI_05_x]
  --    [SHI_01_x]
  --    [SHI_01_summary_b]    --- should be rescaled to 1-6 for coding or scaled 1-6 for lookup table?




/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#LCD_DB')                        IS NOT NULL
DROP TABLE              #LCD_DB
/**************************************************************************************************************************************************/
/* >   1st long SET: current data in database *****************************************************************************************************/
SELECT
          [entity]
      ,   [link_fk]
      ,   [Nation_fk]
      ,   [Locality_fk]
      ,   [Religion_fk]
      ,   [Region5]
      ,   [Region6]
      ,   [Ctry_EditorialName]
      ,   [Locality]
      ,   [Religion]
      ,   [Question_Year]
      ,   [QS_fk]            =           [Question_Std_pk]
      ,   [QA_std]           =
                                /* [QA_std] is provisionally recoded here...       */
                                CASE
                                    WHEN [QA_std]       =    'SHI_11'
                                    THEN                     'SHI_11_b'
                                    ELSE [QA_std]
                                END
      ,   [QW_std]           =
                                /* [QA_std] is provisionally recoded here...       */
                                CASE
                                    WHEN [QA_std] = 'GRI_19_x'
                                    THEN            '0 - Total N of incidents resulting from government force'
                                    WHEN [QA_std] = 'SHI_11_a'
                                    THEN            'Were religious women harassed for violating secular dress norms?'
                                    ELSE [QW_std]
                                END
      ,   [Answer_value]     =
                                /* [Answer_value] is provisionally recoded here, 
                                   before we actually recode it in the database
                                   inorder to have just a consistent distridution
                                   Other variable will be added, if needed, for
                                   catching nuances.                               */
                                CASE
                                    WHEN       [QA_std]                       IN ( 'GRI_08' )
                                     AND CAST( [Answer_value] as decimal (38,2)) = '0.50'
                                    THEN CAST( [Answer_value] as decimal (38,2)) +  0.50
                                    WHEN       [QA_std]                       IN ( 'SHI_11' )
                                     AND CAST( [Answer_value] as decimal (38,2)) = '0.50'
                                    THEN CAST( [Answer_value] as decimal (38,2)) -  0.50
                                    ELSE CAST( [Answer_value] as decimal (38,2))
                                END
      ,   [answer_wording]
      ,   [answer_wording_std] =
                                /* [AW_std] is provisionally recoded here...       */
                                CASE
                                    WHEN       [QA_std]                          = 'SHI_11'
                                     AND CAST( [Answer_value] as decimal (38,2)) = '0.50'
                                    THEN                                           'No'
                                    ELSE       [answer_wording_std]
                                END
      ,   [Question_fk]
      ,   [Answer_fk]
      ,   [Notes]
      ,   [DB]                 =  1
/**************************************************************************************************************************************************/
INTO      [#LCD_DB]
/**************************************************************************************************************************************************/
FROM      [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]                        /* NOTICE THIS IS 2014 WORKING DATA => DATA FROM DB AFTER RLS REMOVED*/ 
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
LEFT JOIN [forum].[dbo].[Pew_Question_Std]                                   /* NOTICE WE'LL INCLUDE QS_fk IN FUTURE VERSION OF [...LongData_ALL] */ 
       ON
          [QA_std]
        = [Question_abbreviation_std]
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
WHERE
          [Ctry_EditorialName] NOT LIKE 'All count%'
      AND 
          [QA_std]
           NOT IN   (   
                         'GFI'                                                          --  aggregated/calculated
                       , 'GFI_rd_1d'                                                    --  aggregated/calculated
                       , 'GFI_scaled'                                                   --  aggregated/calculated
                       , 'GRI'                                                          --  aggregated/calculated
                       , 'GRI_01_x2'                                                    --  never used
                       , 'GRI_08_for_index'                                             --  will be calculated
                       , 'GRI_11_14'                                                    --  no longer used
                       , 'GRI_11_xG1'                                                   --  aggregated/calculated
                       , 'GRI_11_xG2'                                                   --  aggregated/calculated
                       , 'GRI_11_xG3'                                                   --  aggregated/calculated
                       , 'GRI_11_xG4'                                                   --  aggregated/calculated
                       , 'GRI_11_xG5'                                                   --  aggregated/calculated
                       , 'GRI_11_xG6'                                                   --  aggregated/calculated
                       , 'GRI_11_xG7'                                                   --  aggregated/calculated
                       , 'GRI_16_ny1'                                                   --  aggregated/calculated
                       , 'GRI_16_ny2'                                                   --  aggregated/calculated
                       , 'GRI_19_b__p'                                                  --  provincial data no longer coded
                       , 'GRI_19_c__p'                                                  --  provincial data no longer coded
                       , 'GRI_19_d__p'                                                  --  provincial data no longer coded
                       , 'GRI_19_da'                                                    --  no longer used
                       , 'GRI_19_da__p'                                                 --  no longer used
                       , 'GRI_19_db'                                                    --  no longer used
                       , 'GRI_19_db__p'                                                 --  no longer used
                       , 'GRI_19_e__p'                                                  --  provincial data no longer coded
                       , 'GRI_19_f__p'                                                  --  provincial data no longer coded
                       , 'GRI_19_filter'                                                --  aggregated/calculated & DIFFERRENT WORDING
                       , 'GRI_19_ny1'                                                   --  aggregated/calculated
                       , 'GRI_19_ny2'                                                   --  aggregated/calculated
                       , 'GRI_19_summ_ny1'                                              --  aggregated/calculated
                       , 'GRI_19_summ_ny2'                                              --  aggregated/calculated
                       , 'GRI_19_summ_ny3'                                              --  aggregated/calculated
                       , 'GRI_19_summ_ny4'                                              --  aggregated/calculated
                       , 'GRI_19_summ_ny5'                                              --  aggregated/calculated
                       , 'GRI_19_summ_ny6'                                              --  aggregated/calculated
                       , 'GRI_20'                                                       --  aggregated/calculated
                       , 'GRI_20_03_top'                                                --  aggregated/calculated
                       , 'GRI_20_05_x1'                                                 --  no longer used
                       , 'GRI_20_05_x1__p'                                              --  no longer used
                       , 'GRI_20_top'                                                   --  aggregated/calculated
                       , 'GRI_rd_1d'                                                    --  aggregated/calculated
                       , 'GRI_scaled'                                                   --  aggregated/calculated
                       , 'GRX_21_01'                                                    --  no longer used
                       , 'GRX_21_02'                                                    --  no longer used
                       , 'GRX_21_03'                                                    --  no longer used
                       , 'GRX_22'                                                       --  no longer used
                       , 'GRX_22_01_ny1'                                                --  aggregated/calculated
                       , 'GRX_22_01_ny2'                                                --  aggregated/calculated
                       , 'GRX_22_02_ny1'                                                --  aggregated/calculated
                       , 'GRX_22_02_ny2'                                                --  aggregated/calculated
                       , 'GRX_22_03_ny1'                                                --  aggregated/calculated
                       , 'GRX_22_03_ny2'                                                --  aggregated/calculated
                       , 'GRX_22_04_ny1'                                                --  aggregated/calculated
                       , 'GRX_22_04_ny2'                                                --  aggregated/calculated
                       , 'GRX_22_ny1'                                                   --  no longer used
                       , 'GRX_23'                                                       --  no longer used
                       , 'GRX_24'                                                       --  no longer used
                       , 'GRX_24_ny1'                                                   --  no longer used
                       , 'GRX_24_ny2'                                                   --  no longer used
                       , 'GRX_25_01'                                                    --  no longer used
                       , 'GRX_25_02'                                                    --  no longer used
                       , 'GRX_25_03'                                                    --  no longer used
                       , 'GRX_25_ny1'                                                   --  no longer used
                       , 'GRX_25_ny2'                                                   --  no longer used
                       , 'GRX_25_ny3'                                                   --  no longer used
                       , 'GRX_26_01'                                                    --  no longer used
                       , 'GRX_26_02'                                                    --  no longer used
                       , 'GRX_26_03'                                                    --  no longer used
                       , 'GRX_26_04'                                                    --  no longer used
                       , 'GRX_26_05'                                                    --  no longer used
                       , 'GRX_26_06'                                                    --  no longer used
                       , 'GRX_26_07'                                                    --  no longer used
                       , 'GRX_26_08'                                                    --  no longer used
                       , 'GRX_27_01'                                                    --  no longer used
                       , 'GRX_27_02'                                                    --  no longer used
                       , 'GRX_27_03'                                                    --  no longer used
                       , 'GRX_28_01'                                                    --  no longer used
                       , 'GRX_28_02'                                                    --  no longer used
                       , 'GRX_28_03'                                                    --  no longer used
                       , 'GRX_33'                                                       --  no longer used (summer 2015)
                       , 'SHI'                                                          --  aggregated/calculated
                       , 'SHI_01'                                                       --  aggregated/calculated
                       , 'SHI_01_a_dummy'                                               --  aggregated/calculated
                       , 'SHI_01_b__p'                                                  --  provincial data no longer coded
                       , 'SHI_01_b_dummy'                                               --  aggregated/calculated
                       , 'SHI_01_c__p'                                                  --  provincial data no longer coded
                       , 'SHI_01_c_dummy'                                               --  aggregated/calculated
                       , 'SHI_01_d__p'                                                  --  provincial data no longer coded
                       , 'SHI_01_d_dummy'                                               --  aggregated/calculated
                       , 'SHI_01_da'                                                    --  aggregated/calculated
                       , 'SHI_01_da__p'                                                 --  aggregated/calculated
                       , 'SHI_01_db'                                                    --  aggregated/calculated
                       , 'SHI_01_db__p'                                                 --  aggregated/calculated
                       , 'SHI_01_e__p'                                                  --  provincial data no longer coded
                       , 'SHI_01_e_dummy'                                               --  aggregated/calculated
                       , 'SHI_01_f__p'                                                  --  provincial data no longer coded
                       , 'SHI_01_f_dummy'                                               --  aggregated/calculated
                       , 'SHI_01_summary_a_ny0'                                         --  aggregated/calculated
                       , 'SHI_01_summary_a_ny1'                                         --  aggregated/calculated
                       , 'SHI_01_summary_a_ny2'                                         --  aggregated/calculated
                       , 'SHI_01_summary_a_ny3'                                         --  aggregated/calculated
                       , 'SHI_01_summary_a_ny4'                                         --  aggregated/calculated
                       , 'SHI_01_summary_a_ny5'                                         --  aggregated/calculated
                       , 'SHI_01_summary_a_ny6'                                         --  aggregated/calculated
                       , 'SHI_01_summary_b'                                             --  calculated as persisted
                       , 'SHI_01_x_14'                                                  --  aggregated/calculated
                       , 'SHI_01_xG1'                                                   --  aggregated/calculated
                       , 'SHI_01_xG2'                                                   --  aggregated/calculated
                       , 'SHI_01_xG3'                                                   --  aggregated/calculated
                       , 'SHI_01_xG4'                                                   --  aggregated/calculated
                       , 'SHI_01_xG5'                                                   --  aggregated/calculated
                       , 'SHI_01_xG6'                                                   --  aggregated/calculated
                       , 'SHI_01_xG7'                                                   --  aggregated/calculated
                       , 'SHI_04_b__p'                                                  --  provincial data no longer coded
                       , 'SHI_04_c__p'                                                  --  provincial data no longer coded
                       , 'SHI_04_d__p'                                                  --  provincial data no longer coded
                       , 'SHI_04_da'                                                    --  no longer used
                       , 'SHI_04_da__p'                                                 --  no longer used
                       , 'SHI_04_db'                                                    --  no longer used
                       , 'SHI_04_db__p'                                                 --  no longer used
                       , 'SHI_04_e__p'                                                  --  provincial data no longer coded
                       , 'SHI_04_f__p'                                                  --  provincial data no longer coded
                       , 'SHI_04_ny0'                                                   --  aggregated/calculated
                       , 'SHI_04_ny1'                                                   --  aggregated/calculated
                       , 'SHI_05_b'                                                     --  aggregated/calculated
                       , 'SHI_05_b__p'                                                  --  provincial data no longer coded
                       , 'SHI_05_c__p'                                                  --  provincial data no longer coded
                       , 'SHI_05_d__p'                                                  --  provincial data no longer coded
                       , 'SHI_05_da'                                                    --  aggregated/calculated
                       , 'SHI_05_da__p'                                                 --  no longer used
                       , 'SHI_05_db'                                                    --  no longer used
                       , 'SHI_05_db__p'                                                 --  no longer used
                       , 'SHI_05_e__p'                                                  --  no longer used
                       , 'SHI_05_f__p'                                                  --  provincial data no longer coded
                       , 'SHI_05_ny0'                                                   --  aggregated/calculated
                       , 'SHI_05_ny1'                                                   --  aggregated/calculated
                       , 'SHI_07_ny0'                                                   --  aggregated/calculated
                       , 'SHI_07_ny1'                                                   --  aggregated/calculated
                --     , 'SHI_11'                                                       --  will be calculated
                --     , 'SHI_11_a'                                                     --  will be modified later to include DES (summer 2015)
                       , 'SHI_11_for_index'                                             --  will be calculated
                       , 'SHI_11_x'                                                     --  no longer used AS IT IS will be modified later to exclude 11_a (summer 2015)
                       , 'SHI_rd_1d'                                                    --  aggregated/calculated
                       , 'SHI_scaled'                                                   --  aggregated/calculated
                       , 'SHX_14_01'                                                    --  no longer used
                       , 'SHX_14_02'                                                    --  no longer used
                       , 'SHX_14_03'                                                    --  no longer used
                       , 'SHX_14_04'                                                    --  no longer used
                       , 'SHX_15_01'                                                    --  no longer used
                       , 'SHX_15_02'                                                    --  no longer used
                       , 'SHX_15_03'                                                    --  no longer used
                       , 'SHX_15_04'                                                    --  no longer used
                       , 'SHX_15_05'                                                    --  no longer used
                       , 'SHX_15_06'                                                    --  no longer used
                       , 'SHX_15_07'                                                    --  no longer used
                       , 'SHX_15_08'                                                    --  no longer used
                       , 'SHX_15_09'                                                    --  no longer used
                       , 'SHX_15_10'                                                    --  no longer used
                       , 'SHX_25'                                                       --  no longer used
                       , 'SHX_25_ny1'                                                   --  no longer used
                       , 'SHX_25_ny2'                                                   --  no longer used
                       , 'SHX_26'                                                       --  no longer used
                       , 'SHX_26_ny1'                                                   --  no longer used
                       , 'SHX_26_ny2'                                                   --  no longer used
                       , 'SHX_27_01'                                                    --  no longer used
                       , 'SHX_27_02'                                                    --  no longer used
                       , 'SHX_27_03'                                                    --  no longer used
                       , 'SHX_27_ny1'                                                   --  no longer used
                       , 'SHX_27_ny2'                                                   --  no longer used
                       , 'SHX_27_ny3'                                                   --  no longer used
                       , 'SHX_28_01'                                                    --  no longer used
                       , 'SHX_28_02'                                                    --  no longer used
                       , 'SHX_28_03'                                                    --  no longer used
                       , 'SHX_28_04'                                                    --  no longer used
                       , 'SHX_28_05'                                                    --  no longer used
                       , 'SHX_28_06'                                                    --  no longer used
                       , 'SHX_28_07'                                                    --  no longer used
                       , 'SHX_28_08'                                                    --  no longer used
                       , 'XSG_01_xG1'                                                   --  aggregated/calculated
                       , 'XSG_01_xG2'                                                   --  aggregated/calculated
                       , 'XSG_01_xG3'                                                   --  aggregated/calculated
                       , 'XSG_01_xG4'                                                   --  aggregated/calculated
                       , 'XSG_01_xG5'                                                   --  aggregated/calculated
                       , 'XSG_01_xG6'                                                   --  aggregated/calculated
                       , 'XSG_01_xG7'                                                   --  aggregated/calculated
                       , 'XSG_24'                                                       --  no longer used
                       , 'XSG_242526_ny0'                                               --  no longer used
                       , 'XSG_242526_ny1'                                               --  no longer used
                       , 'XSG_25n27_ny1'                                                --  no longer used
                       , 'XSG_25n27_ny2'                                                --  no longer used
                       , 'XSG_25n27_ny3'                                                --  no longer used
                                                                                                                                  )
/* <   1st long SET: current data in database *****************************************************************************************************/
--select * from [#LCD_DB] where [QA_std]       IN ( 'GRI_08' , 'SHI_11' )  AND [Answer_value]  =   0.50
/**************************************************************************************************************************************************/



/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#LND_CC')                        IS NOT NULL
DROP TABLE              #LND_CC
/**************************************************************************************************************************************************/
/* >   2nd long SET: new data to be entered comparable to data in database ************************************************************************/
SELECT 
          [entity]             = 'Not Yet Stored in DB'
      ,   [link_fk]            = 0
      ,   [Nation_fk]
      ,   [Locality_fk]
      ,   [Religion_fk]
      ,   [Region5]
      ,   [Region6]
      ,   [Ctry_EditorialName]
      ,   [Locality]
      ,   [Religion]
      ,   [Question_Year]      =  (SELECT  DISTINCT
                                      MAX([Question_Year])
                                     FROM [#LCD_DB]        ) + 1  -- past year + 1
      ,   [QS_fk]
      ,   [QA_std]
      ,   [QW_std]
      ,   [Answer_value]       = CASE
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'GRI_08_a'
                                        OR [QA_std] LIKE 'GRI_10_0[1-3]'
                                        OR [QA_std] LIKE 'GRI_11_01[a-b]'
                                        OR [QA_std] LIKE 'GRI_11_[0-1][0-9]'
                                        OR [QA_std] LIKE 'GRI_19_[b-f&x]'                  -- no x
                                        OR [QA_std] LIKE 'GRI_20_01x_01[a-b]'
                                        OR [QA_std] LIKE 'GRI_20_01x_[0-1][0-9]'
--                                      OR [QA_std] LIKE 'GRI_0[1-2]_filter'
--                                      OR [QA_std] LIKE 'GRX_34_02_[a-g]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                        OR [QA_std] LIKE 'SHI_01_[b-f&x]'                  -- no x
                                        OR [QA_std] LIKE 'SHI_01_x_01[a-b]'
                                        OR [QA_std] LIKE 'SHI_01_x_[0-1][0-9]'
                                        OR [QA_std] LIKE 'SHI_04_[b-f&x]'                  -- no x
                                        OR [QA_std] LIKE 'SHI_05_[c-f&x]'                  -- no x
--                                      OR [QA_std] LIKE 'SHI_09_n'
--                                      OR [QA_std] LIKE 'SHI_10_n'
--                                      OR [QA_std] LIKE 'SHI_11_[a-b]_n'
                                        OR [QA_std] LIKE 'XSG_S_99_0[1-6]'                 -- NEW ROW/STATEMENT
                                      THEN 0.00
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'GRX_29_0[2-5]'
                                      THEN 1.00
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      ELSE NULL
                                       END
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,   [answer_wording]     = ''
      ,   [answer_wording_std] = CASE
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'GRI_08_a'
                                        OR [QA_std] LIKE 'GRI_10_0[1-3]'
                                        OR [QA_std] LIKE 'GRI_11_01[a-b]'
                                        OR [QA_std] LIKE 'GRI_11_[0-1][0-9]'
                                        OR [QA_std] LIKE 'GRI_20_01x_01[a-b]' 
                                        OR [QA_std] LIKE 'GRI_20_01x_[0-1][0-9]'
--                                      OR [QA_std] LIKE 'GRI_0[1-2]_filter'
--                                      OR [QA_std] LIKE 'GRX_34_02_[a-g]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                        OR [QA_std] LIKE 'SHI_01_x_01[a-b]'
                                        OR [QA_std] LIKE 'SHI_01_x_[0-1][0-9]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                        OR [QA_std] LIKE 'GRX_29_0[2-5]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      THEN 'No'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'GRI_19_[b-f&x]'                  -- no x
                                        OR [QA_std] LIKE 'SHI_01_[b-f&x]'                  -- no x
                                        OR [QA_std] LIKE 'SHI_04_[b-f&x]'                  -- no x
                                        OR [QA_std] LIKE 'SHI_05_[c-f&x]'                  -- no x
--                                       OR [QA_std] LIKE 'SHI_09_n'
--                                       OR [QA_std] LIKE 'SHI_10_n'
--                                       OR [QA_std] LIKE 'SHI_11_[a-b]_n'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      THEN '0 to N incidents'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'XSG_S_99_0[1-6]'                 -- NEW ROW/STATEMENT
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      THEN 'No supplemental source'                        -- ADD AS a new STANDARD ANSWER
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      ELSE ''
                                       END
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,   [Question_fk]        = 0
      ,   [Answer_fk]          = 0
      ,   [Notes]              = ''
      ,   [DB]                 =  1
/**************************************************************************************************************************************************/
INTO      [#LND_CC]
/**************************************************************************************************************************************************/
FROM      [#LCD_DB]

/**************************************************************************************************************************************************/
WHERE
          [Question_Year] =  (SELECT  DISTINCT
                                 MAX([Question_Year])
                                FROM [#LCD_DB]                   )  -- included questions for past year
/* <   2nd long SET: new data to be entered comparable to data in database ************************************************************************/



/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#LYD_CC')                        IS NOT NULL
DROP TABLE              #LYD_CC
/**************************************************************************************************************************************************/
/* >   3rd long SET: former year's data to be used if necessary in GRI_01 & GRI_02 ****************************************************************/
SELECT
          [entity]             = ''
      ,   [link_fk]            = 0
      ,   [Nation_fk]
      ,   [Locality_fk]
      ,   [Religion_fk]
      ,   [Region5]
      ,   [Region6]
      ,   [Ctry_EditorialName]
      ,   [Locality]
      ,   [Religion]
      ,   [Question_Year]       = [Question_Year] + 1                      -- past year + 1
      ,   [QS_fk]
      ,   [QA_std]             = [QA_std]        + '_yBe'
      ,   [QW_std]             = [QW_std]        + ' (*the prevoius year)'
      ,   [Answer_value]
      ,   [answer_wording]
      ,   [answer_wording_std]
      ,   [Question_fk]        = 0
      ,   [Answer_fk]          = 0
      ,   [Notes]              = ''
      ,   [DB]                 =  -1
/**************************************************************************************************************************************************/
INTO      [#LYD_CC]
/**************************************************************************************************************************************************/
FROM      [#LCD_DB]
/**************************************************************************************************************************************************/
WHERE
          [Question_Year] =  (SELECT  DISTINCT
                                 MAX([Question_Year])
                                FROM [#LCD_DB]                   )  -- included questions for past year
      AND
          [QA_std]              LIKE 'GRI_0[1-2]'
/* <   3rd long SET: former year's data to be used if necessary in GRI_01 & GRI_02 ****************************************************************/



/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#LND_NQ')                        IS NOT NULL
DROP TABLE              #LND_NQ
/**************************************************************************************************************************************************/
/* >   4th long SET: new data to be entered from added questions **********************************************************************************/
SELECT 
          [entity]             = 'Not Yet Stored in DB'
      ,   [link_fk]            = 0
      ,   [Nation_fk]
      ,   [Locality_fk]        = NULL
      ,   [Religion_fk]        = NULL
      ,   [Region5]
      ,   [Region6]
      ,   [Ctry_EditorialName]
      ,   [Locality]           = 'not detailed'
      ,   [Religion]           = 'not detailed'
      ,   [Question_Year]
      ,   [QS_fk]              = 0
      ,   [QA_std]
      ,   [QW_std]
      ,   [Answer_value]       = CASE
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'GRI_0[1-2]_filter'
--                                      OR [QA_std] LIKE 'GRI_08_a'
--                                      OR [QA_std] LIKE 'GRI_10_0[1-3]'
--                                      OR [QA_std] LIKE 'GRI_11_01[a-b]'
--                                      OR [QA_std] LIKE 'GRI_11_[0-1][0-9]'
--                                      OR [QA_std] LIKE 'GRI_19_[b-f&x]'
--                                      OR [QA_std] LIKE 'GRI_20_01x_01[a-b]'
--                                      OR [QA_std] LIKE 'GRI_20_01x_[0-1][0-9]'
                                        OR [QA_std] LIKE 'GRX_34_02_[a-g]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                        OR [QA_std] LIKE 'SHI_01_[b-f&x]'            --  x
--                                      OR [QA_std] LIKE 'SHI_01_x_01[a-b]'
--                                      OR [QA_std] LIKE 'SHI_01_x_[0-1][0-9]'
                                        OR [QA_std] LIKE 'SHI_04_[b-f&x]'            --  x
                                        OR [QA_std] LIKE 'SHI_05_[c-f&x]'            --  x
                                        OR [QA_std] LIKE 'SHI_09_n'
                                        OR [QA_std] LIKE 'SHI_10_n'
                                        OR [QA_std] LIKE 'SHI_11_[a-b]_n'
                                      THEN 0.00
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
--                                    WHEN [QA_std] LIKE 'GRX_29_0[2-5]'
--                                    THEN 1.00
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      ELSE NULL
                                       END
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,   [answer_wording]     = ''
      ,   [answer_wording_std] = CASE
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'GRI_0[1-2]_filter'
--                                      OR [QA_std] LIKE 'GRI_08_a'
--                                      OR [QA_std] LIKE 'GRI_10_0[1-3]'
--                                      OR [QA_std] LIKE 'GRI_11_01[a-b]'
--                                      OR [QA_std] LIKE 'GRI_11_[0-1][0-9]'
--                                      OR [QA_std] LIKE 'GRI_19_[b-f&x]'
--                                      OR [QA_std] LIKE 'GRI_20_01x_01[a-b]'
--                                      OR [QA_std] LIKE 'GRI_20_01x_[0-1][0-9]'
                                        OR [QA_std] LIKE 'GRX_34_02_[a-g]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
--                                      OR [QA_std] LIKE 'SHI_01_x_01[a-b]'
--                                      OR [QA_std] LIKE 'SHI_01_x_[0-1][0-9]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
--                                      OR [QA_std] LIKE 'GRX_29_0[2-5]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      THEN 'No'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE 'SHI_01_[b-f&x]'            --  x
                                        OR [QA_std] LIKE 'SHI_04_[b-f&x]'            --  x
                                        OR [QA_std] LIKE 'SHI_05_[c-f&x]'            --  x
                                        OR [QA_std] LIKE 'SHI_09_n'
                                        OR [QA_std] LIKE 'SHI_10_n'
                                        OR [QA_std] LIKE 'SHI_11_[a-b]_n'
--                                      OR [QA_std] LIKE 'GRI_19_[b-f]'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      THEN '0 to N incidents'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      ELSE ''
                                       END
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,   [Question_fk]        = 0
      ,   [Answer_fk]          = 0
      ,   [Notes]              = ''
      ,   [DB]                 = CASE
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                      WHEN [QA_std] LIKE '%_filter'
                                      THEN -1
                                      ELSE 0
                                       END
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
INTO      [#LND_NQ]
/**************************************************************************************************************************************************/
FROM
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(SELECT 
          DISTINCT
          [Nation_fk]
      ,   [Region5]
      ,   [Region6]
      ,   [Ctry_EditorialName]
      ,   [Question_Year]
                                 FROM      [#LYD_CC]               )  LYD
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
  CROSS JOIN 
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*--- filter questions ---------------------------------------------------------------------------------------------------------------------------*/
           SELECT QA_std = 'GRI_01_filter'    , QW_std =  '(If GRI_01_x is "yes") Did the change in the constitution alter any statement '
                                                        + 'of specific provision "freedom of religion"?'
 UNION ALL SELECT QA_std = 'GRI_02_filter'    , QW_std =  '(If GRI_01_x is "yes") Did the change in the constitution alter any '
                                                        + 'stipulation that appears to qualify or substantially contradict the concept '
                                                        + 'of "religious freedom"'
 UNION ALL SELECT QA_std = 'GRI_19_filter'    , QW_std =  'Were there incidents when any level of government use force toward religious '
                                                        + 'groups that resulted in individuals being killed, physically abused, '
                                                        + 'imprisoned, detained or displaced from their homes, or having their personal '
                                                        + 'or religious properties damaged or destroyed?'
 UNION ALL SELECT QA_std = 'SHI_04_filter'    , QW_std =  'Were religion-related terrorist groups active in the country?'
 UNION ALL SELECT QA_std = 'SHI_05_filter'    , QW_std =  'Was there a religion-related war or armed conflict in the country (including '
                                                        + 'ongoing displacements from previous wars)?'
 UNION ALL SELECT QA_std = 'XSG_S_99_filter'  , QW_std =  'How many supplemental sources have been used?'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--- persisted questions ------------------------------------------------------------------------------------------------------------------------*/
-- UNION ALL SELECT QA_std = 'GRI_19_x'         , QW_std = '0 - Total N of incidents resulting from government force'
   /* already there... should others be there? */
 UNION ALL SELECT QA_std = 'SHI_01_x'         , QW_std = '0 - Total N of incidents motivated by religious hatred or bias'
 UNION ALL SELECT QA_std = 'SHI_01_summary_b' , QW_std = '0-6 Types of incidents motivated by religious hatred or bias'
 UNION ALL SELECT QA_std = 'SHI_04_x'         , QW_std = '0 - Total N of incidents resulting from religion related terrorism'
 UNION ALL SELECT QA_std = 'SHI_05_x'         , QW_std = '0 - Total N of incidents resulting from religiously-related war'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--- NEW questions ------------------------------------------------------------------------------------------------------------------------------*/
 UNION ALL SELECT QA_std = 'GRX_34_01'         , QW_std =  'Does the government provide exemptions for religious groups from otherwise '
                                                        + 'universal laws?'
 UNION ALL SELECT QA_std = 'GRX_34_02'        , QW_std =  'If so, what areas do the exemptions cover? (check all that apply)'
 UNION ALL SELECT QA_std = 'GRX_34_02_a'      , QW_std =  'Work on religious holidays (for example, Christians being allowed to take off work '
                                                        + 'on Sundays)'
 UNION ALL SELECT QA_std = 'GRX_34_02_b'      , QW_std =  'Anti-discrimination laws (for example, giving religious business the right to not '
                                                        + 'serve or provide benefits to same-sex couples)'
 UNION ALL SELECT QA_std = 'GRX_34_02_c'      , QW_std =  'Military service (for example, allowing religious groups that oppose war or national '
                                                        + 'service to not participate in military training or activities)'
 UNION ALL SELECT QA_std = 'GRX_34_02_d'      , QW_std =  'Taxes (for example, allowing religious groups opposed to supporting states to not'
                                                        + ' pay taxes)'
 UNION ALL SELECT QA_std = 'GRX_34_02_e'      , QW_std =  'Health care provision (for example, allowing doctors to opt out of providing '
                                                        + 'contraception or abortion services, or allowing religious organizations to exclude '
                                                        + 'contraception of abortion services from health insurance coverage)'
 UNION ALL SELECT QA_std = 'GRX_34_02_f'      , QW_std =  'Education (for example, sending children to public schools)'
 UNION ALL SELECT QA_std = 'GRX_34_02_g'      , QW_std =  'Unknown (the sources indicate religious groups are granted exemptions, but provide '
                                                        + 'no details)'
 UNION ALL SELECT QA_std = 'GRX_34_03'        , QW_std =  'Were there any cases in which individuals challenged the lack of religious'
                                                        + ' exemptions from otherwise universal laws?'
 UNION ALL SELECT QA_std = 'GRX_35'           , QW_std =  'Does the government restrict individuals'' access to the internet?'
 UNION ALL SELECT QA_std = 'GRX_35_01'        , QW_std =  'Does the government restrict individuals'' access to the internet through arrests based'
                                                        + ' on internet activity?'
 UNION ALL SELECT QA_std = 'GRX_35_02'        , QW_std =  'Does the government restrict individuals'' access to the internet through censoring '
                                                        + 'of websites?'
 UNION ALL SELECT QA_std = 'SHI_09_n'         , QW_std =  'How many incidents in which individuals used violence or the threat of violence'
                                                        + 'including so-called honor killingsto try to enforce religious norms were directed'
                                                        + ' against women?'
 UNION ALL SELECT QA_std = 'SHI_10_n'         , QW_std =  'How many incidents in which individuals were assaulted or displaced from their '
                                                        + 'homes in retaliation for religious activities considered offensive or threatening '
                                                        + 'to the majority faith were directed against women?'
 UNION ALL SELECT QA_std = 'SHI_11_a_n'       , QW_std =  'How many incidents occurred in which women were harassed for violating secular '
                                                        + 'dress norms?'
 UNION ALL SELECT QA_std = 'SHI_11_b_n'       , QW_std =  'How many incidents occurred in which women were harassed for violating religious '
                                                        + 'dress codes?'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
)                                                                                                                                                 Q
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/* <   4th long SET: new data to be entered from added questions **********************************************************************************/




/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'AllLongData'                      ) = 1
DROP              TABLE         [AllLongData]
/***  All Long Data *******************************************************************************************************************************/
SELECT
          [entity]
      ,   [link_fk]
      ,   [Nation_fk]
      ,   [Locality_fk]
      ,   [Religion_fk]
      ,   [Region5]
      ,   [Region6]
      ,   [Ctry_EditorialName]
      ,   [Locality]
      ,   [Religion]
      ,   [Question_Year]
      ,   [QS_fk]
      ,   [QA_std]
      ,   [QW_std]
      ,   [Answer_value]
      ,   [answer_wording]     = CASE WHEN [answer_wording] = ''
                                      THEN NULL
                                      ELSE [answer_wording]
                                 END
      ,   [answer_wording_std] = CASE WHEN [answer_wording_std] = ''
                                      THEN NULL 
                                      ELSE [answer_wording_std]
                                 END
      ,   [Question_fk]
      ,   [Answer_fk]
      ,   [Notes]
      ,   [DB]
/**************************************************************************************************************************************************/
INTO    [AllLongData]
/**************************************************************************************************************************************************/
FROM
/**************************************************************************************************************************************************/
  (
          SELECT * FROM [#LCD_DB]
    UNION SELECT * FROM [#LND_CC]
    UNION SELECT * FROM [#LYD_CC]
    UNION SELECT * FROM [#LND_NQ]
                                   ) THE4SETS

/**************************************************************************************************************************************************/
/***  All Long Data *******************************************************************************************************************************/
/**************************************************************************************************************************************************/
GO


-- select * from [AllLongData]



 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _033_cp_SIX_toolTABLES.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the tables:                                                                        <<<<<     ***/
/***                                                           [GRSHRYYYY].[dbo].[Countries]                                                    ***/
/***                                                           [GRSHRYYYY].[dbo].[All_Questions]                                                ***/
/***                                                           [GRSHRYYYY].[dbo].[All_Answers]                                                  ***/
/***                                                           [GRSHRYYYY].[dbo].[Values]                                                       ***/
/***                                                           [GRSHRYYYY].[dbo].[WT_VNs] WideT: Var Names&Values                               ***/
/***                                                           [GRSHRYYYY].[dbo].[CQ]     Curr Questions to be CODED                            ***/
/***             (working tables for being used by the Access coding tool)                                                                      ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating tables [Countries], [All_Questions], [All_Answers], [Values], [WT_VNs] & [CQ]   --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/

/**************************************************************************************************************************/
/***                                                          *************************************************************/
/***     [Countries]                                          *************************************************************/
/***                                                          *************************************************************/
/**************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'Countries'                          ) = 1
DROP              TABLE         [Countries]
/**************************************************************************************************************************/
SELECT 
----------------------------------------------------------------------------------------------------------------------------
        DISTINCT
        [Nation_fk]
      , [Region5]
      , [Region6]
      , [Ctry_EditorialName]
----------------------------------------------------------------------------------------------------------------------------
INTO
          [Countries]
----------------------------------------------------------------------------------------------------------------------------
  FROM  [AllLongData] 
----------------------------------------------------------------------------------------------------------------------------
ORDER BY [Nation_fk]
--ORDER BY [Ctry_EditorialName]
/**************************************************************************************************************************/





/**************************************************************************************************************************/
/***                                                          *************************************************************/
/***     [All_Questions]                                      *************************************************************/
/***                                                          *************************************************************/
/**************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'All_Questions'                          ) = 1
DROP              TABLE         [All_Questions]
/**************************************************************************************************************************/
SELECT 
----------------------------------------------------------------------------------------------------------------------------
          [Q_Number]
          =  ROW_NUMBER()
             OVER(ORDER BY [QA_std] )
----------------------------------------------------------------------------------------------------------------------------
        , [QS_fk]   AS [Question_Std_fk]
        , [QA_std]  AS [Question_abbreviation_std]
        , [QW_std]  AS [Question_wording_std]
----------------------------------------------------------------------------------------------------------------------------
        , [QClass]  =  CASE
                       WHEN 
                                            [QA_std] LIKE 'GRI_19_[b-f]'
                                OR          [QA_std] LIKE 'SHI_01_[b-f]'
                                OR          [QA_std] LIKE 'SHI_04_[b-f]'
                                OR          [QA_std] LIKE 'SHI_05_[c-f]'
                                OR          [QA_std] LIKE 'SHI_09_n'
                                OR          [QA_std] LIKE 'SHI_10_n'
                                OR          [QA_std] LIKE 'SHI_11_a_n'
                                OR          [QA_std] LIKE 'SHI_11_b_n'
                                                                                 THEN 'COUNT'
                       WHEN 
                                            [QA_std] LIKE 'GRI_19_x'
                                OR          [QA_std] LIKE 'SHI_01_x'
                                OR          [QA_std] LIKE 'SHI_04_x'
                                OR          [QA_std] LIKE 'SHI_05_x'
                                OR          [QA_std] LIKE 'SHI_01_summary_b'
                                                                                 THEN 'PERSI'
                       WHEN 
                                            [QA_std] LIKE '%_yBe'            
                                                                                 THEN 'preyr'
                                                                                 ELSE 'CODED'
                           END 
        , [QDescr]  =  CASE
                       WHEN                 [QA_std] LIKE 'GRX_35%'              THEN 'N'
                       WHEN 
                              (         LEN([QA_std]) = 6
                                OR          [QA_std] LIKE 'GRI_01_x'
                                OR          [QA_std] LIKE 'GRI_0[1-2]_yBe'
                                OR          [QA_std] LIKE 'GRI_16_01'
                                OR          [QA_std] LIKE 'GRI_19_[b-f]'
                                OR (        [QA_std] LIKE 'GRI_20%' 
                                    AND LEN([QA_std])  <   12             )
                                --  AND     [QA_std]  !=  'GRI_20_05_x'   )          /* sharia will have description  */
                                OR          [QA_std] LIKE 'GRX_22_0[1-4]' 
                                OR          [QA_std] LIKE 'GRX_29_0[2-5]' 
                                OR          [QA_std] LIKE 'SHI_01_[a-f]'
                                OR          [QA_std] LIKE 'SHI_04_[b-f]'
                                OR          [QA_std] LIKE 'SHI_04_x01'
                                OR          [QA_std] LIKE 'SHI_05_[c-f]'
                                OR          [QA_std] LIKE 'SHI_11_[a-b]' 
                                OR          [QA_std] LIKE 'XSG_S_99_0[1-6]'   )
                             AND            [QA_std] NOT IN (  'GRI_19'
                                                             , 'SHI_05'       )
                                                                                 THEN 'Y'
                                                                                 ELSE 'N'
                           END 
        , [QTools]  =  CASE
                       WHEN                 [QA_std] LIKE '%_filter'             THEN 'filter'
                       WHEN                 [QA_std] LIKE '%_yBe'                THEN 'prevyr'
                                                                                 ELSE ''
                           END 
        , [QTable]  =  CASE
                       WHEN                 [QA_std] LIKE 'GR%'                  THEN 'GR'
                       WHEN                 [QA_std] LIKE 'SH%'                  THEN 'SH'
                       WHEN                 [QA_std] LIKE 'XS%'                  THEN 'xs'
                           END 
----------------------------------------------------------------------------------------------------------------------------
        , [Q_CCV1]  =  CASE                 /* this is a hard coded value: number of coded conditions of validity */
                       WHEN                 [QA_std] LIKE '%'                    THEN 'A'
                           END 
        , [Q_CCV2]  =  CASE                 /* this is a hard coded value: number of coded conditions of validity */
                       WHEN                 [QA_std] LIKE '%'                    THEN 'A'
                           END 
        , [Q_CCV3]  =  CASE                 /* this is a hard coded value: number of coded conditions of validity */
                       WHEN                 [QA_std] LIKE '%'                    THEN 'A'
                           END 
        , [Q_CCV4]  =  CASE                 /* this is a hard coded value: number of coded conditions of validity */
                       WHEN                 [QA_std] LIKE '%'                    THEN 'A'
                           END 
        , [Q_CCV5]  =  CASE                 /* this is a hard coded value: number of coded conditions of validity */
                       WHEN                 [QA_std] LIKE '%'                    THEN 'A'
                           END 
----------------------------------------------------------------------------------------------------------------------------
INTO
          [All_Questions]
----------------------------------------------------------------------------------------------------------------------------
  FROM
----------------------------------------------------------------------------------------------------------------------------
( SELECT 
          DISTINCT
          [QS_fk]
        , [QA_std]
        , [QW_std]
                                                   FROM  [AllLongData]   )  ALLQS
----------------------------------------------------------------------------------------------------------------------------
/**************************************************************************************************************************/
/*** select * from all_questions ******************************************************************************************/





/**************************************************************************************************************************/
/***                                                          *************************************************************/
/***     [All_Answers]                                        *************************************************************/
/***                                                          *************************************************************/
/**************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'All_Answers'                     ) = 1
DROP              TABLE         [All_Answers]

SELECT 
        [A_row]     =  ROW_NUMBER()
                       OVER(ORDER BY  [QA_std]
                                    , [AV_std] )
      , [Question_abbreviation_std] = [QA_std]
      , [Answer_value]              = [AV_std]
      , [Answer_wording_std]        = [AW_std]

INTO
          [All_Answers]
FROM
(
          SELECT 
                 DISTINCT
                 [QA_std]
               , [AV_std] = CASE
                                 WHEN [QA_std] LIKE 'GRI_19_[b-f&x]'
                                   OR [QA_std] LIKE 'SHI_01_[b-f&x]'
                                   OR [QA_std] LIKE 'SHI_04_[b-f&x]'
                                   OR [QA_std] LIKE 'SHI_05_[c-f&x]'
                                   OR [QA_std] LIKE 'SHI_09_n'
                                   OR [QA_std] LIKE 'SHI_10_n'
                                   OR [QA_std] LIKE 'SHI_11_[a-b]_n'
                                   THEN NULL
                                   ELSE [Answer_value]
                             END
               , [AW_std] = CASE
                                 WHEN [QA_std] LIKE 'GRI_19_[b-f&x]'
                                   OR [QA_std] LIKE 'SHI_01_[b-f&x]'
                                   OR [QA_std] LIKE 'SHI_04_[b-f&x]'
                                   OR [QA_std] LIKE 'SHI_05_[c-f&x]'
                                   OR [QA_std] LIKE 'SHI_09_n'
                                   OR [QA_std] LIKE 'SHI_10_n'
                                   OR [QA_std] LIKE 'SHI_11_[a-b]_n'
                                   THEN '0 to N incidents'
                                   ELSE [Answer_wording_std]
                             END
            FROM [AllLongData]
           WHERE [Answer_value] IS NOT NULL
           AND NOT (      [QA_std]          LIKE 'GRI_11_%'
                      AND [Answer_value]       = 0.50
                      AND [Answer_wording_std] = 'Yes, there was limited intimidation' )
           AND NOT (      [QA_std]          LIKE 'SHI_01_x_%'
                      AND [Answer_value]       = 0.50
                      AND [Answer_wording_std] = 'Yes, in limited ways'                )
     --    AND     (      [QA_std]          LIKE 'SHI_11%'                             )

UNION ALL SELECT 
  [QA_std] = [q]
, [AV_std] = [v]
, [AW_std] = [w] 
FROM
(
-- recoded questions * (to remember code):
          SELECT 
--[q] = 'SHI_11_a'       , [v] = 0.00, [w] = 'No'
--UNION ALL SELECT 
--[q] = 'SHI_11_a'       , [v] = 1.00, [w] = 'Yes'
--UNION ALL SELECT 
--[q] = 'SHI_11_b'       , [v] = 0.00, [w] = 'No'
--UNION ALL SELECT 
--[q] = 'SHI_11_b'       , [v] = 1.00, [w] = 'Yes'
---- filter questions:
--UNION ALL SELECT 
[q] = 'GRI_01_filter'  , [v] = 0.00, [w] = 'No'
UNION ALL SELECT 
[q] = 'GRI_01_filter'  , [v] = 1.00, [w] = 'Yes'
UNION ALL SELECT 
[q] = 'GRI_02_filter'  , [v] = 0.00, [w] = 'No'
UNION ALL SELECT 
[q] = 'GRI_02_filter'  , [v] = 1.00, [w] = 'Yes'
UNION ALL SELECT 
[q] = 'GRI_19_filter'  , [v] = 0.00, [w] = 'No'
UNION ALL SELECT 
[q] = 'GRI_19_filter'  , [v] = 1.00, [w] = 'Yes'
UNION ALL SELECT 
[q] = 'SHI_04_filter'  , [v] = 0.00, [w] = 'No'
UNION ALL SELECT 
[q] = 'SHI_04_filter'  , [v] = 0.25, [w] = 'Yes, but their activity was limited to recruit'
                                                                         + 'ment and fundraising'
UNION ALL SELECT 
[q] = 'SHI_04_filter'  , [v] = 0.50, [w] = 'or higher - Yes, and their activities included'
                                                                         + ' violence'
UNION ALL SELECT 
[q] = 'SHI_05_filter'  , [v] = 0.00, [w] = 'No'
UNION ALL SELECT 
[q] = 'SHI_05_filter'  , [v] = 1.00, [w] = 'Yes'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 0.00, [w] = 'No supplemental sources'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 1.00, [w] = 'Supplemental source'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 2.00, [w] = 'Supplemental sources'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 3.00, [w] = 'Supplemental sources'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 4.00, [w] = 'Supplemental sources'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 5.00, [w] = 'Supplemental sources'
UNION ALL SELECT 
[q] = 'XSG_S_99_filter', [v] = 6.00, [w] = 'Supplemental sources'
-- UNSELECTED ANSWERS - main questions:
UNION ALL SELECT 
[q] = 'GRX_22_03'      , [v] = 0.33, [w] = 'No, but such a policy is being considered'
UNION ALL SELECT 
[q] = 'XSG_S_02'       , [v] = 0.50, [w] = 'Country included in the source, but no new inf'
                                                                         + 'ormation obtained'
UNION ALL SELECT 
[q] = 'XSG_S_99_04'    , [v] = 0.50, [w] = 'Country included in the source, but no new inf'
                                                                         + 'ormation obtained'
UNION ALL SELECT 
[q] = 'XSG_S_99_05'    , [v] = 0.50, [w] = 'Country included in the source, but no new inf'
                                                                         + 'ormation obtained'
UNION ALL SELECT 
[q] = 'XSG_S_99_06'    , [v] = 0.50, [w] = 'Country included in the source, but no new inf'
                                         + 'ormation obtained'
-- questions added this year:
UNION ALL SELECT * FROM 
(
          SELECT
[q] = 'GRX_34_01'
UNION ALL SELECT 
[q] = 'GRX_34_02_a'
UNION ALL SELECT 
[q] = 'GRX_34_02_b'
UNION ALL SELECT 
[q] = 'GRX_34_02_c'
UNION ALL SELECT 
[q] = 'GRX_34_02_d'
UNION ALL SELECT 
[q] = 'GRX_34_02_e'
UNION ALL SELECT 
[q] = 'GRX_34_02_f'
UNION ALL SELECT 
[q] = 'GRX_34_02_g'
UNION ALL SELECT 
[q] = 'GRX_34_03'
UNION ALL SELECT 
[q] = 'GRX_35_01'
UNION ALL SELECT 
[q] = 'GRX_35_02'
                  ) Q
CROSS JOIN
(
           SELECT        [v] = 0.00, [w] = 'No'
 UNION ALL SELECT        [v] = 1.00, [w] = 'Yes'  ) VW
) ADDEDQs
                                                                                     ) QA_AV_QW
/**************************************************************************************************************************/





/**************************************************************************************************************************/
/***                                                          *************************************************************/
/***     [Values]                                             *************************************************************/
/***                                                          *************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'Values'                          ) = 1
DROP              TABLE         [Values]
/**************************************************************************************************************************/
/**************************************************************************************************************************/
SELECT 
----------------------------------------------------------------------------------------------------------------------------
         DISTINCT
        [V_row]     =  ROW_NUMBER()
                       OVER(ORDER BY  [A_row] )
----------------------------------------------------------------------------------------------------------------------------
      , [VarName] = [Question_abbreviation_std]
      , [Answer]  = STR((
                    CAST([Answer_value] as decimal (4,2))) , 4,2 ) + '   - ' + [Answer_wording_std]
----------------------------------------------------------------------------------------------------------------------------
  INTO
          [Values]
----------------------------------------------------------------------------------------------------------------------------
  FROM 
----------------------------------------------------------------------------------------------------------------------------
         [All_Answers]
----------------------------------------------------------------------------------------------------------------------------
WHERE    [Question_abbreviation_std] IN ( SELECT [Question_abbreviation_std]
                                            FROM [All_Questions]
                                           WHERE [QClass] = 'CODED'           )
/**************************************************************************************************************************/






/**************************************************************************************************************************************************/
/***                                                          *************************************************************************************/
/***     [WT_VNs] : Wide Table Variable Names & values        *************************************************************************************/
/***                                                          *************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'WT_VNs'                            ) = 1
DROP              TABLE         [WT_VNs]
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
SELECT 
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
          [WQ_Number]
          =  ROW_NUMBER()
             OVER(ORDER BY [QTOrdr] )
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,   *
/**************************************************************************************************************************************************/
INTO
          [WT_VNs]
/**************************************************************************************************************************************************/
FROM
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT 
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
       [WQA_std]
      ,[Q_Number]
      ,[Question_Std_fk]
      ,[Question_abbreviation_std]
      ,[Question_wording_std]
      ,[Answers]
      ,[Ans_as_CODE]
      ,[QClass]
      ,[QDescr]
      ,[QTools]
      ,[QTable]
      ,[Q_CCV1]
      ,[Q_CCV2]
      ,[Q_CCV3]
      ,[Q_CCV4]
      ,[Q_CCV5]
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[QTOrdr] = CASE                 /* this is a hard coded QA/QC step to validate variables currently in the form */
                  WHEN [WQA_Std] = 'GRI_01'              THEN '01|02|02v'
                  WHEN [WQA_Std] = 'GRI_01_DES'          THEN '01|02|03v'
                  WHEN [WQA_Std] = 'GRI_01_filter'       THEN '01|02|01v'
                  WHEN [WQA_Std] = 'GRI_01_x'            THEN '01|01|01v'
                  WHEN [WQA_Std] = 'GRI_01_x_DES'        THEN '01|01|02v'
                  WHEN [WQA_Std] = 'GRI_01_yBe'          THEN '01|02|02x'
                  WHEN [WQA_Std] = 'GRI_01_yBe_DES'      THEN '01|02|03x'
                  WHEN [WQA_Std] = 'GRI_02'              THEN '01|03|02v'
                  WHEN [WQA_Std] = 'GRI_02_DES'          THEN '01|03|03v'
                  WHEN [WQA_Std] = 'GRI_02_filter'       THEN '01|03|01v'
                  WHEN [WQA_Std] = 'GRI_02_yBe'          THEN '01|03|02x'
                  WHEN [WQA_Std] = 'GRI_02_yBe_DES'      THEN '01|03|03x'
                  WHEN [WQA_Std] = 'GRI_03'              THEN '01|04|01v'
                  WHEN [WQA_Std] = 'GRI_03_DES'          THEN '01|04|02v'
                  WHEN [WQA_Std] = 'GRI_04'              THEN '01|16|01v'
                  WHEN [WQA_Std] = 'GRI_04_DES'          THEN '01|16|02v'
                  WHEN [WQA_Std] = 'GRI_05'              THEN '01|11|01v'
                  WHEN [WQA_Std] = 'GRI_05_DES'          THEN '01|11|02v'
                  WHEN [WQA_Std] = 'GRI_06'              THEN '01|12|01v'
                  WHEN [WQA_Std] = 'GRI_06_DES'          THEN '01|12|02v'
                  WHEN [WQA_Std] = 'GRI_07'              THEN '01|15|01v'
                  WHEN [WQA_Std] = 'GRI_07_DES'          THEN '01|15|02v'
                  WHEN [WQA_Std] = 'GRI_08'              THEN '01|13|01v'
                  WHEN [WQA_Std] = 'GRI_08_a'            THEN '01|13|02v'   /* added */
                  WHEN [WQA_Std] = 'GRI_08_DES'          THEN '01|13|03v'
                  WHEN [WQA_Std] = 'GRI_09'              THEN '01|14|01v'
                  WHEN [WQA_Std] = 'GRI_09_DES'          THEN '01|14|02v'
                  WHEN [WQA_Std] = 'GRI_10'              THEN '01|10|01v'
                  WHEN [WQA_Std] = 'GRI_10_01'           THEN '01|10|03v'
                  WHEN [WQA_Std] = 'GRI_10_02'           THEN '01|10|04v'
                  WHEN [WQA_Std] = 'GRI_10_03'           THEN '01|10|05v'
                  WHEN [WQA_Std] = 'GRI_10_DES'          THEN '01|10|02v'
                  WHEN [WQA_Std] = 'GRI_11'              THEN '01|21|01v'
                  WHEN [WQA_Std] = 'GRI_11_01a'          THEN '01|21|03v'
                  WHEN [WQA_Std] = 'GRI_11_01b'          THEN '01|21|04v'
                  WHEN [WQA_Std] = 'GRI_11_02'           THEN '01|21|05v'
                  WHEN [WQA_Std] = 'GRI_11_03'           THEN '01|21|06v'
                  WHEN [WQA_Std] = 'GRI_11_04'           THEN '01|21|07v'
                  WHEN [WQA_Std] = 'GRI_11_05'           THEN '01|21|08v'
                  WHEN [WQA_Std] = 'GRI_11_06'           THEN '01|21|09v'
                  WHEN [WQA_Std] = 'GRI_11_07'           THEN '01|21|10v'
                  WHEN [WQA_Std] = 'GRI_11_08'           THEN '01|21|11v'
                  WHEN [WQA_Std] = 'GRI_11_09'           THEN '01|21|12v'
                  WHEN [WQA_Std] = 'GRI_11_10'           THEN '01|21|13v'
                  WHEN [WQA_Std] = 'GRI_11_11'           THEN '01|21|14v'
                  WHEN [WQA_Std] = 'GRI_11_12'           THEN '01|21|15v'
                  WHEN [WQA_Std] = 'GRI_11_13'           THEN '01|21|16v'
                  WHEN [WQA_Std] = 'GRI_11_15'           THEN '01|21|17v'
                  WHEN [WQA_Std] = 'GRI_11_16'           THEN '01|21|18v'
                  WHEN [WQA_Std] = 'GRI_11_17'           THEN '01|21|19v'
                  WHEN [WQA_Std] = 'GRI_11_DES'          THEN '01|21|02v'
                  WHEN [WQA_Std] = 'GRI_12'              THEN '01|23|01v'
                  WHEN [WQA_Std] = 'GRI_12_DES'          THEN '01|23|02v'
                  WHEN [WQA_Std] = 'GRI_13'              THEN '01|24|01v'
                  WHEN [WQA_Std] = 'GRI_13_DES'          THEN '01|24|02v'
                  WHEN [WQA_Std] = 'GRI_14'              THEN '01|25|01v'
                  WHEN [WQA_Std] = 'GRI_14_DES'          THEN '01|25|02v'
                  WHEN [WQA_Std] = 'GRI_15'              THEN '01|20|01v'
                  WHEN [WQA_Std] = 'GRI_15_DES'          THEN '01|20|02v'
                  WHEN [WQA_Std] = 'GRI_16'              THEN '01|19|01v'
                  WHEN [WQA_Std] = 'GRI_16_01'           THEN '01|19|04v'
                  WHEN [WQA_Std] = 'GRI_16_01_DES'       THEN '01|19|02v'
                  WHEN [WQA_Std] = 'GRI_16_DES'          THEN '01|19|03v'
                  WHEN [WQA_Std] = 'GRI_17'              THEN '01|22|01v'
                  WHEN [WQA_Std] = 'GRI_17_DES'          THEN '01|22|02v'
                  WHEN [WQA_Std] = 'GRI_18'              THEN '01|17|01v'
                  WHEN [WQA_Std] = 'GRI_18_DES'          THEN '01|17|02v'
                  WHEN [WQA_Std] = 'GRI_19'              THEN '01|37|06v'
                  WHEN [WQA_Std] = 'GRI_19_b'            THEN '01|36|02v'
                  WHEN [WQA_Std] = 'GRI_19_b_DES'        THEN '01|36|03v'
                  WHEN [WQA_Std] = 'GRI_19_c'            THEN '01|36|04v'
                  WHEN [WQA_Std] = 'GRI_19_c_DES'        THEN '01|36|05v'
                  WHEN [WQA_Std] = 'GRI_19_d'            THEN '01|36|06v'
                  WHEN [WQA_Std] = 'GRI_19_d_DES'        THEN '01|36|07v'
                  WHEN [WQA_Std] = 'GRI_19_e'            THEN '01|37|01v'
                  WHEN [WQA_Std] = 'GRI_19_e_DES'        THEN '01|37|02v'
                  WHEN [WQA_Std] = 'GRI_19_f'            THEN '01|37|03v'
                  WHEN [WQA_Std] = 'GRI_19_f_DES'        THEN '01|37|04v'
                  WHEN [WQA_Std] = 'GRI_19_filter'       THEN '01|36|01v'
                  WHEN [WQA_Std] = 'GRI_19_x'            THEN '01|37|05v'
                  WHEN [WQA_Std] = 'GRI_20_01'           THEN '01|05|01v'
                  WHEN [WQA_Std] = 'GRI_20_01_DES'       THEN '01|05|02v'
                  WHEN [WQA_Std] = 'GRI_20_01x_01a'      THEN '01|05|03v'
                  WHEN [WQA_Std] = 'GRI_20_01x_01b'      THEN '01|05|04v'
                  WHEN [WQA_Std] = 'GRI_20_01x_02'       THEN '01|05|05v'
                  WHEN [WQA_Std] = 'GRI_20_01x_03'       THEN '01|05|06v'
                  WHEN [WQA_Std] = 'GRI_20_01x_04'       THEN '01|05|07v'
                  WHEN [WQA_Std] = 'GRI_20_01x_05'       THEN '01|05|08v'
                  WHEN [WQA_Std] = 'GRI_20_01x_06'       THEN '01|05|09v'
                  WHEN [WQA_Std] = 'GRI_20_01x_07'       THEN '01|05|10v'
                  WHEN [WQA_Std] = 'GRI_20_01x_08'       THEN '01|05|11v'
                  WHEN [WQA_Std] = 'GRI_20_01x_09'       THEN '01|05|12v'
                  WHEN [WQA_Std] = 'GRI_20_01x_10'       THEN '01|05|13v'
                  WHEN [WQA_Std] = 'GRI_20_02'           THEN '01|06|01v'
                  WHEN [WQA_Std] = 'GRI_20_02_DES'       THEN '01|06|02v'
                  WHEN [WQA_Std] = 'GRI_20_03_a'         THEN '01|07|01v'
                  WHEN [WQA_Std] = 'GRI_20_03_a_DES'     THEN '01|07|02v'
                  WHEN [WQA_Std] = 'GRI_20_03_b'         THEN '01|07|03v'
                  WHEN [WQA_Std] = 'GRI_20_03_b_DES'     THEN '01|07|04v'
                  WHEN [WQA_Std] = 'GRI_20_03_c'         THEN '01|07|05v'
                  WHEN [WQA_Std] = 'GRI_20_03_c_DES'     THEN '01|07|06v'
                  WHEN [WQA_Std] = 'GRI_20_04'           THEN '01|08|03v'
                  WHEN [WQA_Std] = 'GRI_20_04_DES'       THEN '01|08|04v'
                  WHEN [WQA_Std] = 'GRI_20_04_x'         THEN '01|08|01v'
                  WHEN [WQA_Std] = 'GRI_20_04_x_DES'     THEN '01|08|02v'
                  WHEN [WQA_Std] = 'GRI_20_05'           THEN '01|09|01v'
                  WHEN [WQA_Std] = 'GRI_20_05_DES'       THEN '01|09|02v'
                  WHEN [WQA_Std] = 'GRI_20_05_x'         THEN '01|09|03v'
                  WHEN [WQA_Std] = 'GRI_20_05_x_DES'     THEN '01|09|04v'
                  WHEN [WQA_Std] = 'GRX_22_01'           THEN '01|26|01v'
                  WHEN [WQA_Std] = 'GRX_22_01_DES'       THEN '01|26|02v'
                  WHEN [WQA_Std] = 'GRX_22_02'           THEN '01|27|01v'
                  WHEN [WQA_Std] = 'GRX_22_02_DES'       THEN '01|27|02v'
                  WHEN [WQA_Std] = 'GRX_22_03'           THEN '01|28|01v'
                  WHEN [WQA_Std] = 'GRX_22_03_DES'       THEN '01|28|02v'
                  WHEN [WQA_Std] = 'GRX_22_04'           THEN '01|29|01v'
                  WHEN [WQA_Std] = 'GRX_22_04_DES'       THEN '01|29|02v'
                  WHEN [WQA_Std] = 'GRX_29_01'           THEN '01|30|01v'
                  WHEN [WQA_Std] = 'GRX_29_02'           THEN '01|30|02v'
                  WHEN [WQA_Std] = 'GRX_29_02_DES'       THEN '01|30|03v'
                  WHEN [WQA_Std] = 'GRX_29_03'           THEN '01|30|04v'
                  WHEN [WQA_Std] = 'GRX_29_03_DES'       THEN '01|30|05v'
                  WHEN [WQA_Std] = 'GRX_29_04'           THEN '01|31|01v'
                  WHEN [WQA_Std] = 'GRX_29_04_DES'       THEN '01|31|02v'
                  WHEN [WQA_Std] = 'GRX_29_05'           THEN '01|31|03v'
                  WHEN [WQA_Std] = 'GRX_29_05_DES'       THEN '01|31|04v'
                  WHEN [WQA_Std] = 'GRX_30'              THEN '01|32|01v'
                  WHEN [WQA_Std] = 'GRX_30_DES'          THEN '01|32|02v'
                  WHEN [WQA_Std] = 'GRX_31'              THEN '01|33|01v'
                  WHEN [WQA_Std] = 'GRX_31_DES'          THEN '01|33|02v'
                  WHEN [WQA_Std] = 'GRX_32'              THEN '01|33|03v'
                  WHEN [WQA_Std] = 'GRX_32_DES'          THEN '01|33|04v'
                  WHEN [WQA_Std] = 'GRX_34_01'           THEN '01|34|01v'   /* added */
                  WHEN [WQA_Std] = 'GRX_34_02'           THEN '01|34|02v'
                  WHEN [WQA_Std] = 'GRX_34_02_a'         THEN '01|34|03v'
                  WHEN [WQA_Std] = 'GRX_34_02_b'         THEN '01|34|04v'
                  WHEN [WQA_Std] = 'GRX_34_02_c'         THEN '01|34|05v'
                  WHEN [WQA_Std] = 'GRX_34_02_d'         THEN '01|34|06v'
                  WHEN [WQA_Std] = 'GRX_34_02_e'         THEN '01|34|07v'
                  WHEN [WQA_Std] = 'GRX_34_02_f'         THEN '01|34|08v'
                  WHEN [WQA_Std] = 'GRX_34_02_g'         THEN '01|34|09v'
                  WHEN [WQA_Std] = 'GRX_34_03'           THEN '01|34|10v'
                  WHEN [WQA_Std] = 'GRX_35_01'           THEN '01|35|01v'
                  WHEN [WQA_Std] = 'GRX_35_02'           THEN '01|35|02v'
                  WHEN [WQA_Std] = 'SHI_01_a'            THEN '02|01|01v'
                  WHEN [WQA_Std] = 'SHI_01_a_DES'        THEN '02|01|02v'
                  WHEN [WQA_Std] = 'SHI_01_b'            THEN '02|02|01v'
                  WHEN [WQA_Std] = 'SHI_01_b_DES'        THEN '02|02|02v'
                  WHEN [WQA_Std] = 'SHI_01_c'            THEN '02|02|03v'
                  WHEN [WQA_Std] = 'SHI_01_c_DES'        THEN '02|02|04v'
                  WHEN [WQA_Std] = 'SHI_01_d'            THEN '02|02|05v'
                  WHEN [WQA_Std] = 'SHI_01_d_DES'        THEN '02|02|06v'
                  WHEN [WQA_Std] = 'SHI_01_e'            THEN '02|03|01v'
                  WHEN [WQA_Std] = 'SHI_01_e_DES'        THEN '02|03|02v'
                  WHEN [WQA_Std] = 'SHI_01_f'            THEN '02|03|03v'
                  WHEN [WQA_Std] = 'SHI_01_f_DES'        THEN '02|03|04v'
                  WHEN [WQA_Std] = 'SHI_01_summary_b'    THEN '02|03|06v'
                  WHEN [WQA_Std] = 'SHI_01_x'            THEN '02|03|05v'
                  WHEN [WQA_Std] = 'SHI_01_x_01a'        THEN '02|01|03v'
                  WHEN [WQA_Std] = 'SHI_01_x_01b'        THEN '02|01|04v'
                  WHEN [WQA_Std] = 'SHI_01_x_02'         THEN '02|01|05v'
                  WHEN [WQA_Std] = 'SHI_01_x_03'         THEN '02|01|06v'
                  WHEN [WQA_Std] = 'SHI_01_x_04'         THEN '02|01|07v'
                  WHEN [WQA_Std] = 'SHI_01_x_05'         THEN '02|01|08v'
                  WHEN [WQA_Std] = 'SHI_01_x_06'         THEN '02|01|09v'
                  WHEN [WQA_Std] = 'SHI_01_x_07'         THEN '02|01|10v'
                  WHEN [WQA_Std] = 'SHI_01_x_08'         THEN '02|01|11v'
                  WHEN [WQA_Std] = 'SHI_01_x_09'         THEN '02|01|12v'
                  WHEN [WQA_Std] = 'SHI_01_x_10'         THEN '02|01|13v'
                  WHEN [WQA_Std] = 'SHI_01_x_11'         THEN '02|01|14v'
                  WHEN [WQA_Std] = 'SHI_01_x_12'         THEN '02|01|15v'
                  WHEN [WQA_Std] = 'SHI_01_x_13'         THEN '02|01|16v'
                  WHEN [WQA_Std] = 'SHI_01_x_15'         THEN '02|01|17v'
                  WHEN [WQA_Std] = 'SHI_01_x_16'         THEN '02|01|18v'
                  WHEN [WQA_Std] = 'SHI_01_x_17'         THEN '02|01|19v'
                  WHEN [WQA_Std] = 'SHI_02'              THEN '02|04|01v'
                  WHEN [WQA_Std] = 'SHI_02_01'           THEN '02|04|03v'
                  WHEN [WQA_Std] = 'SHI_02_DES'          THEN '02|04|02v'
                  WHEN [WQA_Std] = 'SHI_03'              THEN '02|05|01v'
                  WHEN [WQA_Std] = 'SHI_03_DES'          THEN '02|05|02v'
                  WHEN [WQA_Std] = 'SHI_04'              THEN '02|08|06v'
                  WHEN [WQA_Std] = 'SHI_04_b'            THEN '02|07|01v'
                  WHEN [WQA_Std] = 'SHI_04_b_DES'        THEN '02|07|02v'
                  WHEN [WQA_Std] = 'SHI_04_c'            THEN '02|07|03v'
                  WHEN [WQA_Std] = 'SHI_04_c_DES'        THEN '02|07|04v'
                  WHEN [WQA_Std] = 'SHI_04_d'            THEN '02|07|05v'
                  WHEN [WQA_Std] = 'SHI_04_d_DES'        THEN '02|06|02v'
                  WHEN [WQA_Std] = 'SHI_04_DES'          THEN '02|07|06v'
                  WHEN [WQA_Std] = 'SHI_04_e'            THEN '02|08|01v'
                  WHEN [WQA_Std] = 'SHI_04_e_DES'        THEN '02|08|02v'
                  WHEN [WQA_Std] = 'SHI_04_f'            THEN '02|08|03v'
                  WHEN [WQA_Std] = 'SHI_04_f_DES'        THEN '02|08|04v'
                  WHEN [WQA_Std] = 'SHI_04_filter'       THEN '02|06|01v'
                  WHEN [WQA_Std] = 'SHI_04_x'            THEN '02|08|05v'
                  WHEN [WQA_Std] = 'SHI_04_x01'          THEN '02|06|04v'
                  WHEN [WQA_Std] = 'SHI_04_x01_DES'      THEN '02|06|03v'
                  WHEN [WQA_Std] = 'SHI_05'              THEN '02|10|06v'
                  WHEN [WQA_Std] = 'SHI_05_c'            THEN '02|09|02v'
                  WHEN [WQA_Std] = 'SHI_05_c_DES'        THEN '02|09|03v'
                  WHEN [WQA_Std] = 'SHI_05_d'            THEN '02|09|04v'
                  WHEN [WQA_Std] = 'SHI_05_d_DES'        THEN '02|09|05v'
                  WHEN [WQA_Std] = 'SHI_05_e'            THEN '02|10|01v'
                  WHEN [WQA_Std] = 'SHI_05_e_DES'        THEN '02|10|02v'
                  WHEN [WQA_Std] = 'SHI_05_f'            THEN '02|10|03v'
                  WHEN [WQA_Std] = 'SHI_05_f_DES'        THEN '02|10|04v'
                  WHEN [WQA_Std] = 'SHI_05_filter'       THEN '02|09|01v'
                  WHEN [WQA_Std] = 'SHI_05_x'            THEN '02|10|05v'
                  WHEN [WQA_Std] = 'SHI_06'              THEN '02|11|01v'
                  WHEN [WQA_Std] = 'SHI_06_DES'          THEN '02|11|02v'
                  WHEN [WQA_Std] = 'SHI_07'              THEN '02|15|01v'
                  WHEN [WQA_Std] = 'SHI_07_DES'          THEN '02|15|02v'
                  WHEN [WQA_Std] = 'SHI_08'              THEN '02|14|01v'
                  WHEN [WQA_Std] = 'SHI_08_DES'          THEN '02|14|02v'
                  WHEN [WQA_Std] = 'SHI_09'              THEN '02|18|01v'
                  WHEN [WQA_Std] = 'SHI_09_DES'          THEN '02|18|02v'
                  WHEN [WQA_Std] = 'SHI_09_n'            THEN '02|18|03v'
                  WHEN [WQA_Std] = 'SHI_10'              THEN '02|19|01v'
                  WHEN [WQA_Std] = 'SHI_10_DES'          THEN '02|19|02v'
                  WHEN [WQA_Std] = 'SHI_10_n'            THEN '02|19|03v'
                  WHEN [WQA_Std] = 'SHI_11_b'            THEN '02|16|01v'   /* added */
                  WHEN [WQA_Std] = 'SHI_11_b_DES'        THEN '02|16|02v'
                  WHEN [WQA_Std] = 'SHI_11_b_n'          THEN '02|16|03v'
                  WHEN [WQA_Std] = 'SHI_11_a'            THEN '02|17|01v'   /* added */
                  WHEN [WQA_Std] = 'SHI_11_a_DES'        THEN '02|17|02v'
                  WHEN [WQA_Std] = 'SHI_11_a_n'          THEN '02|17|03v'
                  WHEN [WQA_Std] = 'SHI_12'              THEN '02|13|01v'
                  WHEN [WQA_Std] = 'SHI_12_DES'          THEN '02|13|02v'
                  WHEN [WQA_Std] = 'SHI_13'              THEN '02|12|01v'
                  WHEN [WQA_Std] = 'SHI_13_DES'          THEN '02|12|02v'
                  WHEN [WQA_Std] = 'XSG_S_01'            THEN '03|01|01v'
                  WHEN [WQA_Std] = 'XSG_S_02'            THEN '03|01|02v'
                  WHEN [WQA_Std] = 'XSG_S_03'            THEN '03|01|03v'
                  WHEN [WQA_Std] = 'XSG_S_04'            THEN '03|01|04v'
                  WHEN [WQA_Std] = 'XSG_S_05'            THEN '03|01|05v'
                  WHEN [WQA_Std] = 'XSG_S_06'            THEN '03|01|06v'
                  WHEN [WQA_Std] = 'XSG_S_07'            THEN '03|01|07v'
                  WHEN [WQA_Std] = 'XSG_S_08'            THEN '03|01|08v'
                  WHEN [WQA_Std] = 'XSG_S_09'            THEN '03|01|09v'
                  WHEN [WQA_Std] = 'XSG_S_10'            THEN '03|01|10v'
                  WHEN [WQA_Std] = 'XSG_S_11'            THEN '03|01|11v'
                  WHEN [WQA_Std] = 'XSG_S_12'            THEN '03|01|12v'
                  WHEN [WQA_Std] = 'XSG_S_13'            THEN '03|02|01v'
                  WHEN [WQA_Std] = 'XSG_S_14'            THEN '03|02|02v'
                  WHEN [WQA_Std] = 'XSG_S_15'            THEN '03|02|03v'
                  WHEN [WQA_Std] = 'XSG_S_16'            THEN '03|02|04v'
                  WHEN [WQA_Std] = 'XSG_S_17'            THEN '03|02|05v'
                  WHEN [WQA_Std] = 'XSG_S_18'            THEN '03|02|06v'
                  WHEN [WQA_Std] = 'XSG_S_19'            THEN '03|02|07v'
                  WHEN [WQA_Std] = 'XSG_S_20'            THEN '03|02|08v'
                  WHEN [WQA_Std] = 'XSG_S_21'            THEN '03|02|09v'
                  WHEN [WQA_Std] = 'XSG_S_22'            THEN '03|02|10v'
                  WHEN [WQA_Std] = 'XSG_S_23'            THEN '03|02|11v'
                  WHEN [WQA_Std] = 'XSG_S_99_01'         THEN '03|03|02v'
                  WHEN [WQA_Std] = 'XSG_S_99_01_DES'     THEN '03|03|01v'
                  WHEN [WQA_Std] = 'XSG_S_99_02'         THEN '03|03|04v'
                  WHEN [WQA_Std] = 'XSG_S_99_02_DES'     THEN '03|03|03v'
                  WHEN [WQA_Std] = 'XSG_S_99_03'         THEN '03|03|06v'
                  WHEN [WQA_Std] = 'XSG_S_99_03_DES'     THEN '03|03|05v'
                  WHEN [WQA_Std] = 'XSG_S_99_04'         THEN '03|03|08v'
                  WHEN [WQA_Std] = 'XSG_S_99_04_DES'     THEN '03|03|07v'
                  WHEN [WQA_Std] = 'XSG_S_99_05'         THEN '03|03|10v'
                  WHEN [WQA_Std] = 'XSG_S_99_05_DES'     THEN '03|03|09v'
                  WHEN [WQA_Std] = 'XSG_S_99_06'         THEN '03|03|12v'
                  WHEN [WQA_Std] = 'XSG_S_99_06_DES'     THEN '03|03|11v'
                  WHEN [WQA_Std] = 'XSG_S_99_filter'     THEN '03|02|12v'
                                                         ELSE 'VEXCLUDED'
                  END
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
            SELECT   
                     [WQA_Std] = [Question_abbreviation_std]
                   , [Q_Number]
                   , [Question_Std_fk]
                   , [Question_abbreviation_std]
                   , [Question_wording_std]
                   , [Answers]                   = CASE
                                                   WHEN         [Ans_as_CODE] IS NOT NULL
                                                   THEN REPLACE([Ans_as_CODE],CHAR(39)+CHAR(39),CHAR(39))
                                                   WHEN         [QClass] IN ( 'COUNT', 'PERSI' )
                                                   THEN 'any possitive integer from 0 to N'
                                                   WHEN         [QClass] IN ( 'preyr' )
                                                   THEN ''
                                                    END
                   , [Ans_as_CODE]
                   , [QClass]
                   , [QDescr]
                   , [QTools]
                   , [QTable]
                   , [Q_CCV1]
                   , [Q_CCV2]
                   , [Q_CCV3]
                   , [Q_CCV4]
                   , [Q_CCV5]
              FROM   [All_Questions]
    LEFT OUTER JOIN
/**************************************************************************************************************************************************/
                    (
/**************************************************************************************************************************************************/
SELECT                                                    /*** >>>    begin main select statement of Q&A                                        ***/
              [QAS]           =  Q.[VarName]              /***        include variable name (once since comes from the selection of questions   ***/
/*================================================================================================================================================*/
          ,   [Ans_as_CODE]   =                           /***        include set of answers (nested in XML string cell) by distinct question   ***/
            STUFF((                                       /*** >>     begin stuffing function & parenthesis for query XML cell to be stuffed    ***/
                    SELECT ', ''' +                       /*** >      select answers, adding string (, ') before each answer                    ***/
                    REPLACE                               /***        replace substring to avoid code to produce error:                         ***/
                    ([Answer],CHAR(39),CHAR(39)+CHAR(39)) /***        each quotation mark should be two quotation marks (one after the other)   ***/
                                                   + '''' /*** >      and adding string (') after each answer                                   ***/
                        AS [text()]                       /***        specification that answers will be selected as text                       ***/
                      FROM [Values]                  A    /***        table to select answers (one distinct by row) and alias of the table      ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                            WHERE   A.[VarName]           /***        merging statement of the selection of answers                             ***/
                                  = Q.[VarName]           /***        corresponding to the selection of questions                               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                     FOR XML PATH('')                     /*** <      end of selection of answers, nesting all cells into an XML string cell    ***/
                                      ), 1, 1, '' )       /*** <<     end stuffing from position 1, change 1 character (the 1st comma) into ''  ***/
/*================================================================================================================================================*/
FROM                                                      /***        statement refered to the main source (of unique questions)                ***/
         (          SELECT  DISTINCT   [VarName]          /*** >>     select distinct questions                                                 ***/
                                 FROM  [Values]   )  Q    /*** <<     from the table including questions and alias / end selection of Q&A       ***/
/**************************************************************************************************************************************************/
                    ) QA
/**************************************************************************************************************************************************/
                 ON    [Question_abbreviation_std]
                     = [QAS]
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
  UNION ALL SELECT   [WQA_Std]                   = [Question_abbreviation_std] + '_DES'
                   , [Q_Number]
                   , [Question_Std_fk]
                   , [Question_abbreviation_std]
                   , [Question_wording_std]
                   , [Answers]                   = 'text description when scaled value is not zero'
                   , [Ans_as_CODE]               = NULL
                   , [QClass]                    = 'DESCR'
                   , [QDescr]
                   , [QTools]
                   , [QTable]
                   , [Q_CCV1]                    = NULL
                   , [Q_CCV2]                    = NULL
                   , [Q_CCV3]                    = NULL
                   , [Q_CCV4]                    = NULL
                   , [Q_CCV5]                    = NULL
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
              FROM   [All_Questions]
             WHERE   [QDescr] = 'Y'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
) WTQ
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
) WTQ_and_O
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/






/**************************************************************************************************************************/
/***                                                          *************************************************************/
/***     [CQ]: Current Questions to be CODED                  *************************************************************/
/***                                                          *************************************************************/
/**************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'CQ'                             ) = 1
DROP              TABLE         [CQ]
/**************************************************************************************************************************/
SELECT 
----------------------------------------------------------------------------------------------------------------------------
          [CQY_n]
          =  ROW_NUMBER()
             OVER(ORDER BY [Nation_fk], [QTOrdr] )
----------------------------------------------------------------------------------------------------------------------------
      , [Nation_fk]
      , [Region5]
      , [Region6]
      , [Ctry_EditorialName]
      , [Question_Year]        =  'Year_' + CAST((SELECT MAX([Question_Year]) FROM [AllLongData]) AS NVARCHAR)

      , [QS_fk]
	  , [QA_std]
	  , [QW_std]
      , [QTOrdr]

----------------------------------------------------------------------------------------------------------------------------
INTO
          [CQ]
----------------------------------------------------------------------------------------------------------------------------

FROM      [Countries]
CROSS JOIN
( SELECT 
         [QA_std]  =  [WQA_std]
        ,[QS_fk]   =  [Question_Std_fk]
        ,[QW_std]  =  [Question_wording_std]
    --  ,[QClass]
    --  ,[QTools]
        ,[QTOrdr]
    FROM [WT_VNs]
   WHERE [QClass] != 'DESCR'
     AND [QTools]  = ''                                                ) MYV
----------------------------------------------------------------------------------------------------------------------------
/**************************************************************************************************************************/
GO
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _034_cp_WideTable_____.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the table view [GRSHRYYYY].[dbo].[GRSH_C]                                          <<<<<     ***/
/***             (cells for current year coding values and corresponding former year)                                                           ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating table [GRSH_C]                                                                  --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/

/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#WRK')                        IS NOT NULL
DROP TABLE              #WRK
/**************************************************************************************************************************************************/
/***  working set of data including additional values *********************************************************************************************/
              SELECT  *
               INTO  [#WRK]
               FROM  [AllLongData]
         INNER JOIN  [ALL_Questions]
                 ON  [QA_std]
                    =[Question_abbreviation_std]
/**************************************************************************************************************************************************/
-- select * from #WRK

/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#TCV')                        IS NOT NULL
DROP TABLE              #TCV
/**************************************************************************************************************************************************/
/***  coded values ********************************************************************************************************************************/
SELECT 
        Ctry_EditorialName                             -- name only for this set
     ,  Nation_fk                                      -- key only for this set
     ,  Region5
     ,  Region6
     ,  Question_Year                                  -- year only for this set
     ,  YNc   = (Question_Year * 10000) + Nation_fk
     ,  QA    = QA_std
     ,  AX    = --(ISNULL ((CAST(Answer_value as decimal (10,0))) , 0))
                STR((CAST(Answer_value as decimal (4,2))) , 4,2 ) + '   - ' + Answer_wording_std
INTO
                     [#TCV]
FROM
                     [#WRK]
WHERE 
               [QClass] IN ( 'CODED', 'preyr' )
/**************************************************************************************************************************************************/



/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#TNV')                        IS NOT NULL
DROP TABLE              #TNV
/**************************************************************************************************************************************************/
/***  count (numeric) values **********************************************************************************************************************/
SELECT 
        YNn   = (Question_Year * 10000) + Nation_fk
     ,  QA    = QA_std
--   ,  AX    = (ISNULL ((CAST(Answer_value as decimal (10,0))) , 0))    /* default count to zero */ 
     ,  AX    =           CAST(Answer_value as decimal (10,0))           /* defaulted before      */
INTO
                     [#TNV]
FROM
                     [#WRK]
WHERE 
               [QClass] IN ( 'COUNT' )
/**************************************************************************************************************************************************/

/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#TAW')                        IS NOT NULL
DROP TABLE              #TAW
/**************************************************************************************************************************************************/
/***  wordings ************************************************************************************************************************************/
SELECT 
        YNw   = (Question_Year * 10000) + Nation_fk
     ,  QA    = QA_std + '_DES'
     ,  AX    = Answer_Wording
INTO
                     [#TAW]
FROM
                     [#WRK]
WHERE 
               [QDescr] IN ( 'Y' )
/**************************************************************************************************************************************************/
GO

/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#TQN')                        IS NOT NULL
DROP TABLE              #TQN
/**************************************************************************************************************************************************/
/***  variable (question) names *******************************************************************************************************************/
          SELECT DISTINCT [QA]
                               INTO [#TQN]
                               FROM [#TCV]
UNION ALL SELECT DISTINCT [QA] FROM [#TNV]
UNION ALL SELECT DISTINCT [QA] FROM [#TAW]
/**************************************************************************************************************************************************/

/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'TCVpv'                          ) = 1
DROP              TABLE         [TCVpv]
GO
/**************************************************************************************************************************************************/
declare @CODECV nvarchar(max)
set     @CODECV = 
/**************************************************************************************************************************************************/
                                                                   /*** >>>>   include all new pivoted values in wide shape                     ***/
 N'
      SELECT * INTO [TCVpv]'
                                                                   /*** >>>    include CODED values                                             ***/
+N'
               FROM [#TCV]
        pivot (max ([AX]) 
               for  [QA]
                in ( 
                   ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    STUFF( (                                                       /*** >>     stuff function & parenthesis for query XML cell to be stuffed    ***/
    SELECT                                                         /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          DISTINCT                                                 /***        should be distinct to include once each variable name            ***/
          ', ' + [QA]                                              /***        comma delimiter concatenated to field QA (to be used as varname) ***/
    FROM  [#TCV]                                                   /***        from table including var names as rows (NO flters/NO sorting)    ***/
    for xml path('')                                               /*** <      End of the selection, nesting all cells into an XML string cell  ***/
                    ),1, 1, '')                                    /*** <<     stuff from position 1, change 1 character into ''                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
    ) ) AS pivt '
                                                                   /*** <<<    include CODED values (end listing, alias pivoting & selection)   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODECV                                     /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODECV)                                    /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
--    SELECT * FROM TCVpv
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'TNVpv'                          ) = 1
DROP              TABLE         [TNVpv]
GO
/**************************************************************************************************************************************************/
declare @CODENV nvarchar(max)
set     @CODENV = 
/**************************************************************************************************************************************************/
                                                                   /*** >>>>   include all new pivoted values in wide shape                     ***/
 N'
      SELECT * INTO [TNVpv]'
                                                                   /*** >>>    include NUMERIC values                                           ***/
+N'
               FROM [#TNV]
        pivot (max ([AX]) 
               for  [QA]
                in ( 
                   ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
STUFF( (                                                           /*** >>     stuff function & parenthesis for query XML cell to be stuffed    ***/
    SELECT                                                         /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          DISTINCT                                                 /***        should be distinct to include once each variable name            ***/
          ', ' + [QA]                                              /***        comma delimiter concatenated to field QA (to be used as varname) ***/
    FROM  [#TNV]                                                   /***        from table including var names as rows (NO flters/NO sorting)    ***/
    for xml path('')                                               /*** <      End of the selection, nesting all cells into an XML string cell  ***/
                    ),1, 1, '')                                    /*** <<     stuff from position 1, change 1 character into ''                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
    ) ) AS pivt '
                                                                   /*** <<<    include NUMERIC values (end listing, alias pivoting & selection) ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODENV                                     /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODENV)                                    /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
--    SELECT * FROM TNVpv
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'TAWpv'                          ) = 1
DROP              TABLE         [TAWpv]
GO
/**************************************************************************************************************************************************/
declare @CODEAW nvarchar(max)
set     @CODEAW = 
/**************************************************************************************************************************************************/
                                                                   /*** >>>>   include all new pivoted values in wide shape                     ***/
 N'
      SELECT * INTO [TAWpv]'
                                                                   /*** >>>    include NUMERIC values                                           ***/
+N'
               FROM [#TAW]
        pivot (max ([AX]) 
               for  [QA]
                in ( 
                   ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
STUFF( (                                                           /*** >>     stuff function & parenthesis for query XML cell to be stuffed    ***/
    SELECT                                                         /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          DISTINCT                                                 /***        should be distinct to include once each variable name            ***/
          ', ' + [QA]                                              /***        comma delimiter concatenated to field QA (to be used as varname) ***/
    FROM  [#TAW]                                                   /***        from table including var names as rows (NO flters/NO sorting)    ***/
    for xml path('')                                               /*** <      End of the selection, nesting all cells into an XML string cell  ***/
                    ),1, 1, '')                                    /*** <<     stuff from position 1, change 1 character into ''                ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
    ) ) AS pivt '
                                                                   /*** <<<    include NUMERIC values (end listing, alias pivoting & selection) ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEAW                                     /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODEAW)                                    /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
--    SELECT * FROM TAWpv
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/



/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'GRSH_C'                          ) = 1
DROP              TABLE         [GRSH_C]
GO
/**************************************************************************************************************************************************/
declare @CODET nvarchar(max)
set     @CODET = 
/**************************************************************************************************************************************************/
                                                                   /*** >>>    order variables from pivoted data to store into wide shape       ***/
 N'
      SELECT
               [RowID]               = ROW_NUMBER() OVER(ORDER BY Question_Year DESC, Nation_fk )
             , [Question_Year]
             , [Region5]
             , [Region6]
             , [Nation_fk]
             , [Ctry_EditorialName]
             ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(    SELECT                                                        /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          DISTINCT                                                 /***        should be distinct to include once each variable name            ***/
          ', ' + [QA]                                              /***        comma delimiter concatenated to field QA (to be used as varname) ***/
    FROM  [#TQN]                                                   /***        from table including var names as rows (NO flters)               ***/
    ORDER
       BY ', ' + [QA]
    for xml path('')          )                                    /*** <      End of the selection, nesting all cells into an XML string cell  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
        INTO [GRSH_C] 
        FROM 
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
             [TCVpv]                                               /*          coded values                                                       */
       INNER
        JOIN
             [TNVpv]                                               /*          number values                                                      */
          ON        YNc = YNn                                      /***        join condition                                                   ***/
       INNER
        JOIN
             [TAWpv]                                               /*          answer wording                                                     */
          ON        YNc = YNw                                      /***        join condition                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    '
                                                                   /*** >>>    store ordered variables in wide shape                            ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODET                                      /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODET)                                     /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
-- select * from [GRSH_C] order by RowID


/***  manual setting *****************************************************************************************************************************/
/***         By default the SQL Server Agent does not set QUOTED_IDENTIFIER: in the Transact-SQL command SET OPTIONS must be added             ***/
SET QUOTED_IDENTIFIER ON
GO
/**************************************************************************************************************************************************/


/**************************************************************************************************************************************************/
/***  Final steps: ********************************************************************************************************************************/
/**************************************************************************************************************************************************/
/***  Change ID field configuration as integer and non-nullable  **********************************************************************************/
ALTER TABLE [GRSH_C]
ALTER COLUMN RowID INT NOT NULL
GO
/**********************************************************************************  Change ID field configuration as integer and non-nullable  ***/
/**************************************************************************************************************************************************/
/***  Change ID field configuration as real pk  ***************************************************************************************************/
ALTER TABLE      [GRSH_C]
ADD   CONSTRAINT GRSHC_pk PRIMARY KEY(RowID)
GO
/***************************************************************************************************  Change ID field configuration as real pk  ***/
/**************************************************************************************************************************************************/
/***  Add Computed Columns PERSISTED  *************************************************************************************************************/
ALTER TABLE [GRSH_C]
ADD GRI_19_x         AS
                          GRI_19_b
                        + GRI_19_c
                        + GRI_19_d
                        + GRI_19_e
                        + GRI_19_f   PERSISTED
   ,SHI_04_x         AS
                          SHI_04_b
                        + SHI_04_c
                        + SHI_04_d
                        + SHI_04_e
                        + SHI_04_f   PERSISTED
   ,SHI_05_x         AS
                          SHI_05_c  -- notice SHI_05_b_x has been dropped / never used for the index
                        + SHI_05_d
                        + SHI_05_e
                        + SHI_05_f   PERSISTED
   ,SHI_01_x         AS 
                          SHI_01_b
                        + SHI_01_c
                        + SHI_01_d
                        + SHI_01_e
                        + SHI_01_f   PERSISTED
   ,SHI_01_summary_b AS 
                          CASE WHEN SHI_01_a = '0.50   - Yes, in limited ways'              THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_a = '1.00   - Yes, widespread social harassment' THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_b > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_c > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_d > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_e > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_f > 0                                            THEN 1 ELSE 0 END   PERSISTED
GO
/*************************************************************************************************************  Add Computed Columns PERSISTED  ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'TCVpv'                          ) = 1
DROP              TABLE         [TCVpv]
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'TNVpv'                          ) = 1
DROP              TABLE         [TNVpv]
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'TAWpv'                          ) = 1
DROP              TABLE         [TAWpv]
GO
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _035_cp_coders_cleanTs.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the tables:                                                                        <<<<<     ***/
/***                                                           [GRSHRYYYY].[dbo].[GRI_Ctry]                                                     ***/
/***                                                           [GRSHRYYYY].[dbo].[SHI_Ctry]                                                     ***/
/***                                                           [GRSHRYYYY].[dbo].[Sources]                                                      ***/
/***                                                       =>  (working tables for coding values & corresponding descriptions in current year)  ***/
/***                                                                                                                                            ***/
/***                           * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                          ***/
/***                           * NOTICE: This script should be excecuted before coders start enetering data          *                          ***/
/***                           *         after data entering starts this & previous scripts SHOULD NOT BE EXCECUTED! *                          ***/
/***                           * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                          ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2014 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating tables [GRI_Ctry], [SHI_Ctry] & [Sources]                                       --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
/***  BackUp current tables  **********************************************************************************************************************/
  DECLARE @CrDt    varchar(13)
  DECLARE @TofI    varchar(50)
  SET     @CrDt    =           (CONVERT(VARCHAR(8),GETDATE(),112))                                      /***      - date: YYYYMMDD              ***/
              + '_' + (REPLACE((CONVERT(VARCHAR(5),GETDATE(),114)), ':', ''))                           /***      - time:         _hhmm         ***/
  DECLARE MyCursor CURSOR FOR                                                                           /***      cursor to take values from... ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                 SELECT   'GRI_Ctry'
           UNION SELECT   'SHI_Ctry'
           UNION SELECT   'Sources'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   OPEN            MyCursor                    -- cursor name
   FETCH NEXT FROM MyCursor
              INTO @TofI
			 WHILE  @@FETCH_STATUS = 0
   BEGIN
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
EXEC ( ' IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
              WHERE       [TABLE_NAME] = ''' + @TofI               + '''  ) = 1
            SELECT * INTO                 [' + @TofI + '_' + @CrDt + ']
                     FROM                 [' + @TofI               + ']'           )
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   FETCH NEXT FROM MyCursor
              INTO @TofI
   END
   CLOSE           MyCursor
   DEALLOCATE      MyCursor
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
GO
/**********************************************************************************************************************  BackUp current tables  ***/
/**************************************************************************************************************************************************/


/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'GRI_Ctry'                          ) = 1
DROP              TABLE         [GRI_Ctry]
/**************************************************************************************************************************************************/
/***  Government Restrictions table to ENTER data:  ***********************************************************************************************/
/**************************************************************************************************************************************************/
declare @CODEGRI nvarchar(max)
set     @CODEGRI = 
/**************************************************************************************************************************************************/
                                                                   /*** >>     ordered selection of GRI variables                               ***/
 N'
      SELECT
               [RowID]
             , [Nation_fk]
             , [Ctry_EditorialName]
             , [Question_Year]
             ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(    SELECT                                                        /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          ', ' + [WQA_std]                                         /***        comma delimiter concatenated to WQA (field WT varname)           ***/
    FROM         [WT_VNs]                                          /***        from table including var names as rows                           ***/
    WHERE        [QTable]  = 'GR'                                  /***        include GR coded questions                                       ***/
      AND        [QClass] != 'PERSI'                               /***        does not include persisted field                                 ***/
    for xml path('')  )                                            /*** <      End of the selection, nesting all cells into an XML string cell  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
    INTO      [GRI_Ctry]
    FROM      [GRSH_C]
    WHERE     [Question_Year] = ( SELECT DISTINCT
                                     MAX([Question_Year])
                                    FROM [AllLongData]        )  '
                                                                   /*** >>>    store ordered GRI variables in wide shape                        ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEGRI                                    /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODEGRI)                                   /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/

/***  manual setting ******************************************************************************************************************************/
/***         By default the SQL Server Agent does not set QUOTED_IDENTIFIER:                                                                    ***/
/***         in the Transact-SQL command you must add the needed SET OPTIONS                                                                    ***/
SET QUOTED_IDENTIFIER ON
GO
/**************************************************************************************************************************************************/

/***  IDs as PKs & Computed Fields ****************************************************************************************************************/
ALTER TABLE [GRI_Ctry]
ADD   CONSTRAINT GR_pk PRIMARY KEY(RowID)
GO
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
ALTER TABLE [GRI_Ctry]
ADD GRI_19_x         AS
                          GRI_19_b
                        + GRI_19_c
                        + GRI_19_d
                        + GRI_19_e
                        + GRI_19_f   PERSISTED
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/


/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'SHI_Ctry'                          ) = 1
DROP              TABLE         [SHI_Ctry]
/**************************************************************************************************************************************************/
/***  Government Restrictions table to ENTER data:  ***********************************************************************************************/
/**************************************************************************************************************************************************/
declare @CODESHI nvarchar(max)
set     @CODESHI = 
/**************************************************************************************************************************************************/
                                                                   /*** >>     ordered selection of GRI variables                               ***/
 N'
      SELECT
               [RowID]
             , [Nation_fk]
             , [Ctry_EditorialName]
             , [Question_Year]
             ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(    SELECT                                                        /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          ', ' + [WQA_std]                                         /***        comma delimiter concatenated to WQA (field WT varname)           ***/
    FROM         [WT_VNs]                                          /***        from table including var names as rows                           ***/
    WHERE        [QTable]  = 'SH'                                  /***        include SH coded questions                                       ***/
      AND        [QClass] != 'PERSI'                               /***        does not include persisted field                                 ***/
    for xml path('')  )                                            /*** <      End of the selection, nesting all cells into an XML string cell  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
    INTO      [SHI_Ctry]
    FROM      [GRSH_C]
    WHERE     [Question_Year] = ( SELECT DISTINCT
                                     MAX([Question_Year])
                                    FROM [AllLongData]        )  '
                                                                   /*** >>>    store ordered GRI variables in wide shape                        ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODESHI                                    /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODESHI)                                   /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/***  IDs as PKs & Computed Fields ****************************************************************************************************************/
ALTER TABLE [SHI_Ctry]
ADD   CONSTRAINT SH_pk PRIMARY KEY(RowID)
GO
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
ALTER TABLE [SHI_Ctry]
ADD SHI_04_x         AS
                          SHI_04_b
                        + SHI_04_c
                        + SHI_04_d
                        + SHI_04_e
                        + SHI_04_f   PERSISTED
   ,SHI_05_x         AS
                          SHI_05_c                                              -- notice SHI_05_b_x has been dropped / never used for the index
                        + SHI_05_d
                        + SHI_05_e
                        + SHI_05_f   PERSISTED
   ,SHI_01_x         AS 
                          SHI_01_b
                        + SHI_01_c
                        + SHI_01_d
                        + SHI_01_e
                        + SHI_01_f   PERSISTED
   ,SHI_01_summary_b AS 
                          CASE WHEN SHI_01_a = '0.50   - Yes, in limited ways'              THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_a = '1.00   - Yes, widespread social harassment' THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_b > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_c > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_d > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_e > 0                                            THEN 1 ELSE 0 END
                        + CASE WHEN SHI_01_f > 0                                            THEN 1 ELSE 0 END   PERSISTED
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/


/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF (SELECT COUNT([TABLE_NAME]) FROM [INFORMATION_SCHEMA].[TABLES]
     WHERE       [TABLE_NAME] = 'Sources'                          ) = 1
DROP              TABLE         [Sources]
/**************************************************************************************************************************************************/
/***  Government Restrictions table to ENTER data:  ***********************************************************************************************/
/**************************************************************************************************************************************************/
declare @CODESou nvarchar(max)
set     @CODESou = 
/**************************************************************************************************************************************************/
                                                                   /*** >>     ordered selection of GRI variables                               ***/
 N'
      SELECT
               [RowID]
             , [Nation_fk]
             , [Ctry_EditorialName]
             , [Question_Year]
             ' +
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
(    SELECT                                                        /*** >      Begin selection (into text, in a cell, comma delimited list)     ***/
          ', ' + [WQA_std]                                         /***        comma delimiter concatenated to WQA (field WT varname)           ***/
    FROM         [WT_VNs]                                          /***        from table including var names as rows                           ***/
    WHERE        [QTable]  = 'xs'          /***        include xs coded questions (no persisted fields)                 ***/
    for xml path('')  )                                            /*** <      End of the selection, nesting all cells into an XML string cell  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+N'
    INTO      [Sources]
    FROM      [GRSH_C]
    WHERE     [Question_Year] = ( SELECT DISTINCT
                                     MAX([Question_Year])
                                    FROM [AllLongData]        )  '
                                                                   /*** >>>    store ordered GRI variables in wide shape                        ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODESou                                    /***        display the currently stored code (to be executed)               ***/
	EXEC              (@CODESou)                                   /***        execute the code that has been stored as text                    ***/
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/***  IDs as PKs & Computed Fields ****************************************************************************************************************/
ALTER TABLE [Sources]
ADD   CONSTRAINT SRC_pk PRIMARY KEY(RowID)
/**************************************************************************************************************************************************/
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _036_cp_EnteredValues_.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v01_EnteredValues]                                     <<<<<     ***/
/***             (all new currently enetered values)                                                                                            ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v01_EnteredValues]                                                        --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
IF OBJECT_ID  ('tempdb..#vars')                        IS NOT NULL
DROP TABLE              #vars
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/***  view [EnteredValues] ************************************************************************************************************************/
/**************************************************************************************************************************************************/
declare @CODEnew nvarchar(max)
set     @CODEnew = 
/**************************************************************************************************************************************************/
                                                       /*** >>>    ...                                                                          ***/
 N'
ALTER VIEW     [v01_EnteredValues]
AS
      SELECT
               [RowID]
             , [Question_Year]
             , [Nation_fk]
             , [Ctry_EditorialName]
             ' +
/**************************************************************************************************************************************************/
(           SELECT ', ' + [WQA_std] FROM [WT_VNs]      /*** >      Begin selection (into text, in a cell, comma delimited list of varnames)     ***/
          ORDER BY        [WQA_std]                    /***        keep alphabetical order of fields in the selection                           ***/
                             FOR XML PATH('')    )     /*** <      End of the selection, nesting all cells into an XML string cell              ***/
/**************************************************************************************************************************************************/
+N'
                   FROM [GRI_Ctry]   G
          INNER JOIN
        ( SELECT 
                   [N_fk] = [Nation_fk]
                 ' +
/**************************************************************************************************************************************************/
      (    SELECT ', ' + [WQA_std] FROM [WT_VNs]       /*** >      Begin selection (into text, in a cell, comma delimited list of varnames)     ***/
            WHERE        [QTable]  = 'SH'              /***        include SH* variables (also persisted field)                                 ***/
                         FOR XML PATH('')       )      /*** <      End of the selection, nesting all cells into an XML string cell              ***/
/**************************************************************************************************************************************************/
+N'
                   FROM [SHI_Ctry] ) S
          ON          G.[Nation_fk] 
                   =  S.[N_fk]
          INNER JOIN
        ( SELECT 
                   [N_fk] = [Nation_fk]
                 ' +
/**************************************************************************************************************************************************/
      (    SELECT ', ' + [WQA_std] FROM [WT_VNs]       /*** >      Begin selection (into text, in a cell, comma delimited list of varnames)     ***/
            WHERE        [QTable]  = 'xs'              /***        include xs* variables                                                        ***/
                         FOR XML PATH('')       )      /*** <      End of the selection, nesting all cells into an XML string cell              ***/
/**************************************************************************************************************************************************/
+N'
                   FROM [Sources] ) X
          ON          G.[Nation_fk] 
                   =  X.[N_fk]
                 '
                                                       /*** <<<    ...                                                                          ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEnew                        /***        display the currently stored code (to be executed)                           ***/
	EXEC              (@CODEnew)                       /***        execute the code that has been stored as text                                ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
GO

 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _037_cp_AllCodedValues.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v02_AllCodedValues]                                    <<<<<     ***/
/***             (all new & formerly enetered values in wide format by country/year)                                                            ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v02_AllCodedValues]                                                       --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the first part of the code                                        ***/
N'
ALTER VIEW     [v02_AllCodedValues]
AS
  SELECT
          [Nation_fk]	
        , [Ctry_EditorialName]
        , [Question_Year]      = ''Year_'' + STR([Question_Year] , 4,0 )
        , [Q_Yr]               =                 [Question_Year]
          '
/*********************************************************     <<<<<  this has been the first part of the code                                  ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this section creates code corresponding to coded questions                ***/
DECLARE @CODEvar1 nvarchar(max)                           /***        declare variable for storing code during each data retreival              ***/
DECLARE @varname1 nvarchar(max)                           /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor  CURSOR FOR                              /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [WQA_std]                                     /*** >>>    select variable name (once since comes from the selection of questions    ***/
FROM        [WT_VNs]                                      /***        statement refered to the main source (of unique questions)                ***/
WHERE       [QClass] IN ( 'CODED', 'preyr' )              /*** <<<    filter questions to be selected and finalize select statement             ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname1                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEvar1 =                                       /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
        , '
          + @varname1 + '
                                  = CASE
                                         WHEN left('      + @varname1 + '
                                                                        , 4) = '''' THEN NULL
                                         ELSE CAST(left(' + @varname1 + '
                                                                        , 4)AS DECIMAL (12,2)) END
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
/* -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - */
set     @CODEmain = @CODEmain + @CODEvar1                 /***        this adds from 'CODEvar' to code already stored in 'CODEmain' (by row)    ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname1                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  this section has created code for coded questions                         ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this section creates code corresponding to numeric/count questions        ***/
DECLARE @CODEvar2 nvarchar(max)                           /***        declare variable for storing code during each data retreival              ***/
DECLARE @varname2 nvarchar(max)                           /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor  CURSOR FOR                              /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [WQA_std]                                     /*** >>>    select variable name (once since comes from the selection of questions    ***/
FROM        [WT_VNs]                                      /***        statement refered to the main source (of unique questions)                ***/
WHERE       [QClass] IN ( 'COUNT', 'PERSI' )              /*** <<<    filter questions to be selected and finalize select statement             ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname2                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEvar2 =                                       /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
        , '
          + @varname2 + '
                                  = CAST( ' + @varname2 + '
                                                          AS DECIMAL (12,2))
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
/* -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - */
set     @CODEmain = @CODEmain + @CODEvar2                 /***        this adds from 'CODEvar' to code already stored in 'CODEmain' (by row)    ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname2                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  this section has created code for numeric/count questions                 ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this section creates code corresponding to descriptive texts              ***/
DECLARE @CODEvar3 nvarchar(max)                           /***        declare variable for storing code during each data retreival              ***/
DECLARE @varname3 nvarchar(max)                           /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor  CURSOR FOR                              /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [WQA_std]                                     /*** >>>    select variable name (once since comes from the selection of questions    ***/
FROM        [WT_VNs]                                      /***        statement refered to the main source (of unique questions)                ***/
WHERE       [QClass] IN ( 'DESCR' )                       /*** <<<    filter questions to be selected and finalize select statement             ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname3                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEvar3 =                                       /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
        , ' + @varname3 + '
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
/* -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - */
set     @CODEmain = @CODEmain + @CODEvar3                 /***        this adds from 'CODEvar' to code already stored in 'CODEmain' (by row)    ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname3                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  this section has created code for numeric/count questions                 ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
                                                          /*** >>>                                                                              ***/
/*********************************************************     >>>>>  this adds the final part of the code                                      ***/
set     @CODEmain = @CODEmain 
+ N'
                    from ( '
                                                          /*** >>>    this is the first section of the final part of the code to be executed    ***/
+ N'
SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Question_Year]
'                                                         /*** <<<<<  this completes the first section of the final part of the code            ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the second section of the final part of the code to be executed   ***/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    (        SELECT ', ' + [WQA_std]                      /*** >      Begin selection (into text, in a cell, comma delimited list: add string)  ***/
               FROM [WT_VNs]                              /***        from previously filtered ('CODED'/'COUNT'/'PERSI') questions              ***/
             FOR XML PATH('')           )                 /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<<<<  this completes the second section of the final part of the code           ***/
/**************************************************************************************************************************************************/
                                                          /*** >>>>>  this is the third section of the final part of the code to be executed    ***/
+ N'
 FROM [GRSH_C]
 WHERE [Question_Year] < (SELECT MAX([Question_Year]) FROM [AllLongData])

UNION ALL

SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Question_Year]
'                                                         /*** <<<<<  this completes the third section of the final part of the code            ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the fourth section of the final part of the code to be executed   ***/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    (        SELECT ', ' + [WQA_std]                      /*** >      Begin selection (into text, in a cell, comma delimited list: add string)  ***/
               FROM [WT_VNs]                              /***        from previously filtered ('CODED'/'COUNT'/'PERSI') questions              ***/
             FOR XML PATH('')           )                 /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+ N'
 FROM [v01_EnteredValues]  ) EV
'                                                         /*** <<<<<  this completes the fourth section of the final part of the code           ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<  this added the final part of the code                                     ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _037_cp_AllCodedValues__NEW.sql                                                                                                                                  
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v02_AllCodedValues]                                    <<<<<     ***/
/***             (all new & formerly enetered values in wide format by country/year)                                                            ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v02_AllCodedValues]                                                       --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the first part of the code                                        ***/
N'
ALTER VIEW     [v02_AllCodedValues]
AS



other select adding the new variable here...



  SELECT
          [Nation_fk]	
        , [Ctry_EditorialName]
        , [Question_Year]      = ''Year_'' + STR([Question_Year] , 4,0 )
        , [Q_Yr]               =                 [Question_Year]
          '
/*********************************************************     <<<<<  this has been the first part of the code                                  ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this section creates code corresponding to coded questions                ***/
DECLARE @CODEvar1 nvarchar(max)                           /***        declare variable for storing code during each data retreival              ***/
DECLARE @varname1 nvarchar(max)                           /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor  CURSOR FOR                              /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [WQA_std]                                     /*** >>>    select variable name (once since comes from the selection of questions    ***/
FROM        [WT_VNs]                                      /***        statement refered to the main source (of unique questions)                ***/
WHERE       [QClass] IN ( 'CODED', 'preyr' )              /*** <<<    filter questions to be selected and finalize select statement             ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname1                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEvar1 =                                       /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
        , '
          + @varname1 + '
                                  = CASE
                                         WHEN left('      + @varname1 + '
                                                                        , 4) = '''' THEN NULL
                                         ELSE CAST(left(' + @varname1 + '
                                                                        , 4)AS DECIMAL (12,2)) END
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
/* -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - */
set     @CODEmain = @CODEmain + @CODEvar1                 /***        this adds from 'CODEvar' to code already stored in 'CODEmain' (by row)    ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname1                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  this section has created code for coded questions                         ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this section creates code corresponding to numeric/count questions        ***/
DECLARE @CODEvar2 nvarchar(max)                           /***        declare variable for storing code during each data retreival              ***/
DECLARE @varname2 nvarchar(max)                           /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor  CURSOR FOR                              /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [WQA_std]                                     /*** >>>    select variable name (once since comes from the selection of questions    ***/
FROM        [WT_VNs]                                      /***        statement refered to the main source (of unique questions)                ***/
WHERE       [QClass] IN ( 'COUNT', 'PERSI' )              /*** <<<    filter questions to be selected and finalize select statement             ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname2                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEvar2 =                                       /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
        , '
          + @varname2 + '
                                  = CAST( ' + @varname2 + '
                                                          AS DECIMAL (12,2))
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
/* -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - */
set     @CODEmain = @CODEmain + @CODEvar2                 /***        this adds from 'CODEvar' to code already stored in 'CODEmain' (by row)    ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname2                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  this section has created code for numeric/count questions                 ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this section creates code corresponding to descriptive texts              ***/
DECLARE @CODEvar3 nvarchar(max)                           /***        declare variable for storing code during each data retreival              ***/
DECLARE @varname3 nvarchar(max)                           /***        declare variable for storing data from cursor                             ***/
DECLARE MyCursor  CURSOR FOR                              /*** >>>>   declare cursor to take values from the following select sataement         ***/
/**************************************************************************************************************************************************/
SELECT      [WQA_std]                                     /*** >>>    select variable name (once since comes from the selection of questions    ***/
FROM        [WT_VNs]                                      /***        statement refered to the main source (of unique questions)                ***/
WHERE       [QClass] IN ( 'DESCR' )                       /*** <<<    filter questions to be selected and finalize select statement             ***/
/**************************************************************************************************************************************************/
OPEN             MyCursor                                 /*** >>>    open cursor by its name                                                   ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname3                                /***        store it into the corresponding variable(s)                               ***/
          WHILE  @@FETCH_STATUS = 0                       /***        while the status of the last retreival has been successful                ***/
BEGIN                                                     /*** >>     BEGIN the procedures using values of each row of the cursor               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
SET     @CODEvar3 =                                       /*** >      the code to be stored as string (for each row of the cursor) begins here: ***/
N'
        , ' + @varname3 + '
 '                                                        /*** <      the code to be stored as string ends here                                 ***/
/* -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - */
set     @CODEmain = @CODEmain + @CODEvar3                 /***        this adds from 'CODEvar' to code already stored in 'CODEmain' (by row)    ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<     ENDING of the procedures using values of each row of the cursor           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
FETCH NEXT FROM  MyCursor                                 /***        retrieve the next row from cursor                                         ***/
           INTO  @varname3                                /***        store it into the corresponding variable(s)                               ***/
           END                                            /***        and end when last row has been retreived                                  ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
   CLOSE         MyCursor                                 /*** <<<    close cursor by its name                                                  ***/
DEALLOCATE       MyCursor                                 /*** <<<<   remove reference and relase from memory by cursor name                    ***/
/*********************************************************     <<<<<  this section has created code for numeric/count questions                 ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
                                                          /*** >>>                                                                              ***/
/*********************************************************     >>>>>  this adds the final part of the code                                      ***/
set     @CODEmain = @CODEmain 
+ N'
                    from ( '
                                                          /*** >>>    this is the first section of the final part of the code to be executed    ***/
+ N'
SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Question_Year]
'                                                         /*** <<<<<  this completes the first section of the final part of the code            ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the second section of the final part of the code to be executed   ***/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    (        SELECT ', ' + [WQA_std]                      /*** >      Begin selection (into text, in a cell, comma delimited list: add string)  ***/
               FROM [WT_VNs]                              /***        from previously filtered ('CODED'/'COUNT'/'PERSI') questions              ***/
             FOR XML PATH('')           )                 /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
                                                          /*** <<<<<  this completes the second section of the final part of the code           ***/
/**************************************************************************************************************************************************/
                                                          /*** >>>>>  this is the third section of the final part of the code to be executed    ***/
+ N'
 FROM [GRSH_C]
 WHERE [Question_Year] < (SELECT MAX([Question_Year]) FROM [AllLongData])

UNION ALL

SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Question_Year]
'                                                         /*** <<<<<  this completes the third section of the final part of the code            ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the fourth section of the final part of the code to be executed   ***/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    (        SELECT ', ' + [WQA_std]                      /*** >      Begin selection (into text, in a cell, comma delimited list: add string)  ***/
               FROM [WT_VNs]                              /***        from previously filtered ('CODED'/'COUNT'/'PERSI') questions              ***/
             FOR XML PATH('')           )                 /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+ N'
 FROM [v01_EnteredValues]  ) EV
'                                                         /*** <<<<<  this completes the fourth section of the final part of the code           ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<  this added the final part of the code                                     ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _038_cp_WideChanges___.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v03_WideChanges]                                       <<<<<     ***/
/***             (compare all new entered values to formerly entered values and display differences in wide format by country)                  ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v03_WideChanges]                                                          --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the first part of the code                                        ***/
N'
ALTER VIEW     [v03_WideChanges]
AS
SELECT [Nation_fk]
      ,[Ctry_EditorialName]
          '
/*********************************************************     <<<<<  this has been the first part of the code                                  ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the second part of the code to be executed                        ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+   (     SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std] + ' = CASE '         /***        distinct comma delimiter concatenated to field QA modified (as varname)   ***/
              + ' WHEN ' + [WQA_std] + '_curr IS NULL'    /***        condition: no data for current year                                       ***/
              + '  AND ' + [WQA_std] + '_past IS NULL'    /***        condition: no data for former year                                        ***/
              + ' THEN ''both_NULL'' '                    /***        message                                                                   ***/
              + ' WHEN ' + [WQA_std] + '_curr IS NULL'    /***        condition: no data for current year                                       ***/
              + ' THEN ''curr_NULL'' '                    /***        message                                                                   ***/
              + ' WHEN ' + [WQA_std] + '_past IS NULL'    /***        condition: no data for former year                                        ***/
              + ' THEN ''past_NULL'' '                    /***        message                                                                   ***/
              + ' WHEN ' + [WQA_std] + '_curr != '        /***        diffeerent data for current year...                                       ***/
                         + [WQA_std] + '_past    '        /***        compared to data for former year                                          ***/
              + ' THEN ''difference'' '                   /***        message                                                                   ***/
              + ' WHEN ' + [WQA_std] + '_curr  = '        /***        same data for current year...                                             ***/
                         + [WQA_std] + '_past    '        /***        compared to data for former year                                          ***/
              + ' THEN    ''same''   '                    /***        message                                                                   ***/
              + ' ELSE ''ERROR !!!''              END'    /***        final message and end of 'when'                                           ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'CODED'           /***        include Q with coded answers                                              ***/
                                      , 'COUNT'           /***        include Q with count answers                                              ***/
                                      , 'PERSI'  )        /***        and include Q with answers automatically calculated                       ***/
            AND     [QTools] NOT IN (   'filter'  )       /***        vars to be excluded: filter questions (usually coded)                     ***/
             FOR XML PATH('')                       )     /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<<  this has been the second part of the code                                 ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the third part of the code to be executed                         ***/
+ N'
FROM
(
SELECT [Nation_fk]
      ,[Ctry_EditorialName]
          '
/*********************************************************     <<<<<  this has been the first part of the code                                  ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the second part of the code to be executed                        ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+   (     SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std] + '_curr ='          /***        distinct comma delimiter concatenated to field QA modified (as varname)   ***/ 
                         + [WQA_std]                      /***        equal to the original field QA (current varname)                          ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'CODED'           /***        include Q with coded answers                                              ***/
                                      , 'COUNT'           /***        include Q with count answers                                              ***/
                                      , 'PERSI'  )        /***        and include Q with answers automatically calculated                       ***/
            AND     [QTools] NOT IN (   'filter'  )       /***        vars to be excluded: filter questions (usually coded)                     ***/
             FOR XML PATH('')                       )     /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<<  this has been the second part of the code                                 ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the third part of the code to be executed                         ***/
+ N'
  FROM [v02_AllCodedValues]
 WHERE [Question_Year] = ''Year_'' + CAST((SELECT MAX([Question_Year]) FROM [AllLongData]) AS NVARCHAR)
) AS DCURR

INNER JOIN 

(
SELECT [Nk2] = [Nation_fk]
          '
/*********************************************************     <<<<<  this has been the first part of the code                                  ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the second part of the code to be executed                        ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+   (     SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std] + '_past =' 
                         + [WQA_std]                      /***        distinct comma delimiter concatenated to field QA (as varname)            ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'CODED'           /***        include Q with coded answers                                              ***/
                                      , 'COUNT'           /***        include Q with count answers                                              ***/
                                      , 'PERSI'  )        /***        and include Q with answers automatically calculated                       ***/
            AND     [QTools] NOT IN (   'filter'  )       /***        vars to be excluded: filter questions (usually coded)                     ***/
             FOR XML PATH('')                       )     /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<<  this has been the second part of the code                                 ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the third part of the code to be executed                         ***/
+ N'
  FROM [v02_AllCodedValues]
 WHERE [Question_Year] = ''Year_'' + CAST( ((SELECT MAX([Question_Year]) FROM [AllLongData]) - 1) AS NVARCHAR)
) AS DPAST
    ON [Nation_fk]  = [Nk2]
'                                                         /*** <<<<<  this completes the seventh and final part of the code                     ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _039_cp_Descriptions__.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v04_Descriptions]                                      <<<<<     ***/
/***             (descriptions provided current year & descriptions enetered the former coding year - in wide format by country)                ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v04_Descriptions]                                                         --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
/**************************************************************************************************************************************************/
declare @CURR nvarchar(4)                                 /***        declare variable for storing current year (number as text)                ***/
set     @CURR = (SELECT (MAX([Q_Yr]) - 0)                 /***        set value to current year                                                 ***/
                 FROM [v02_AllCodedValues]  )             /***        from main view used as source                                             ***/
declare @PAST nvarchar(4)                                 /***        declare variable for storing former year (number as text)                 ***/
set     @PAST = (SELECT (MAX([Q_Yr]) - 1)                 /***        set value to former year = current year minus 1                           ***/
                 FROM [v02_AllCodedValues]  )             /***        from main view used as source                                             ***/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the first part w/temp. set known as common table expression CTE   ***/
N'
ALTER VIEW     [v04_Descriptions]     AS
WITH [CTE]
  AS
    (
      SELECT [Nation_fk]
            ,[Ctry_EditorialName]
            ,[Year]                = SUBSTRING([Question_Year], 6, 8)
           '
/*********************************************************     <<<<<  this has been the first part of the code                                  ***/
/**************************************************************************************************************************************************/
/*-------------------------------------------------------*     >>>>>  this is the second part of the code to be executed                        ***/
+   (     SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std]                      /***        distinct comma delimiter concatenated to field QA modified (as varname)   ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'DESCR'  )        /***        include Q with descriptions                                               ***/
            AND     [QTable] NOT IN (    'xs'    )        /***        vars to be excluded: sources (and former year's ???)                      ***/
             FOR XML PATH('')                       )     /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*-------------------------------------------------------*     <<<<<  this has been the second part of the code                                 ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the third part of the code to be executed                         ***/
+ N'
FROM  [v02_AllCodedValues]
WHERE [Q_Yr] > ( SELECT (MAX([Q_Yr]) - 2) FROM [v02_AllCodedValues] )     )
          '
/*********************************************************     <<<<<  this has been the third part of the code (end of  CTA)                    ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the fourth part of the code to be executed                        ***/
+ N'
SELECT CURR.[Nation_fk]
      ,CURR.[Ctry_EditorialName]
          '
/*********************************************************     <<<<<  this has been the fourth part of the code                                 ***/
/**************************************************************************************************************************************************/
/*-------------------------------------------------------*     >>>>>  this is the fifth part of the code to be executed                         ***/
+   (     SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std]                      /***        distinct comma delimiter concatenated to field QA modified (as varname)   ***/
         + '_' + @PAST                                    /***        adding numeric-code identifier for former year                            ***/
         +    ' = PAST.' + [WQA_std]                      /***        set equal to former year description                                      ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'DESCR'  )        /***        include Q with descriptions                                               ***/
            AND     [QTable] NOT IN (    'xs'    )        /***        vars to be excluded: sources (and former year's ???)                      ***/
             FOR XML PATH('')                       )     /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*-------------------------------------------------------*     <<<<<  this has been the fifth part of the code                                  ***/
/**************************************************************************************************************************************************/
/*-------------------------------------------------------*     >>>>>  this is the sixth part of the code to be executed                         ***/
+   (     SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std]                      /***        distinct comma delimiter concatenated to field QA modified (as varname)   ***/
         + '_' + @CURR                                    /***        adding numeric-code identifier for former year                            ***/
         +    ' = CURR.' + [WQA_std]                      /***        set equal to former year description                                      ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'DESCR'  )        /***        include Q with descriptions                                               ***/
            AND     [QTable] NOT IN (    'xs'    )        /***        vars to be excluded: sources (and former year's ???)                      ***/
             FOR XML PATH('')                       )     /*** <      End of selection, nesting all cells into an XML string cell               ***/
/*-------------------------------------------------------*     <<<<<  this has been the sixth part of the code                                  ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the seventh part of the code to be executed                       ***/
+ N'
FROM  [CTE]  CURR
JOIN  [CTE]  PAST
ON    CURR.Nation_fk
    = PAST.Nation_fk
WHERE CURR.[Year] = ( SELECT (MAX([Q_Yr]) - 0) FROM [v02_AllCodedValues] )
  AND PAST.[Year] = ( SELECT (MAX([Q_Yr]) - 1) FROM [v02_AllCodedValues] )
          '
/*********************************************************     <<<<<  this has been the seventh and final part of the code                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _040_cp_ReportData____.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v05_ReportData]                                        <<<<<     ***/
/***             (values and descriptions for current & former coding years - in long format by country & variable)                             ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v05_ReportData]                                                           --- '
/**************************************************************************************************************************************************/


USE              [GRSHR2016]
GO

CREATE PROCEDURE uspGetAddress
AS

/*********************************************************     >>>>>> extract year to be used                                                   ***/
/**************************************************************************************************************************************************/
DECLARE @CrY    varchar( 4)                               /***        declare variable for storing current YEAR (as text)                       ***/
SET     @CrY  =(SELECT STR(MAX(Question_Year)+3, 4,0)     /***        set value to current year ( coded yr + 1[yr to be coded[ + 1[current]     ***/
                FROM  [forum].[dbo].[Pew_Q&A]             /***        extracted frm Q&A lookup table                                            ***/
                WHERE [Pew_Data_Collection]               /***        filtering,,,                                                              ***/
                = 'Global Restriction on Religion Study') /***        restrictions data                                                         ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the code to be executed                                           ***/
N'
USE [GRSHR' + @CrY + '];
'
/*********************************************************     <<<<<  this has been the code to be execute                                      ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
GO




/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> these are the variables to be used                                        ***/
/**************************************************************************************************************************************************/
declare @CURR nvarchar(10)                                /***        declare variable for storing current year (as text)                       ***/
set     @CURR = (SELECT DISTINCT [Question_Year]          /***        set text value to current year                                            ***/
                 FROM [v02_AllCodedValues]                /***        from main view used as source                                             ***/
                 WHERE  [Q_Yr] = ( (SELECT MAX([Q_Yr])    /***        filtered using max numeric year value                                     ***/
                        FROM [v02_AllCodedValues]) - 0 )) /***        from the same main view used as source  (as the value is)                 ***/
declare @NCUR nvarchar(4)                                 /***        declare variable for storing current year (as text)                       ***/
set     @NCUR = (SELECT DISTINCT CAST([Q_Yr] AS NVARCHAR) /***        set value to current year                                                 ***/
                 FROM [v02_AllCodedValues]                /***        from main view used as source                                             ***/
                 WHERE  [Q_Yr] = ( (SELECT MAX([Q_Yr])    /***        filtered using max numeric year value                                     ***/
                        FROM [v02_AllCodedValues]) - 0 )) /***        from the same main view used as source  (as the value is)                 ***/
declare @PAST nvarchar(10)                                /***        declare variable for storing former year (as text)                        ***/
set     @PAST = (SELECT DISTINCT [Question_Year]          /***        set text value to past year (from current year)                           ***/
                 FROM [v02_AllCodedValues]                /***        from main view used as source                                             ***/
                 WHERE  [Q_Yr] = ( (SELECT MAX([Q_Yr])    /***        filtered using max numeric year value                                     ***/
                        FROM [v02_AllCodedValues]) - 1 )) /***        from the same main view used as source  (minus one for former year)       ***/
declare @NPAS nvarchar(4)                                 /***        declare variable for storing former year (as text)                        ***/
set     @NPAS = (SELECT DISTINCT CAST([Q_Yr] AS NVARCHAR) /***        set value to past year (from current year)                                ***/
                 FROM [v02_AllCodedValues]                /***        from main view used as source                                             ***/
                 WHERE  [Q_Yr] = ( (SELECT MAX([Q_Yr])    /***        filtered using max numeric year value                                     ***/
                        FROM [v02_AllCodedValues]) - 1 )) /***        from the same main view used as source  (minus one for former year)       ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< these have been the variables to be used                                  ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> this is the code to be executed                                           ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is part 1 of the code: main select statement                         ***/
/**************************************************************************************************************************************************/
N'
ALTER VIEW     [v05_ReportData]
AS

SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Variable]            =  [QA_std]
      ,[Change]              =  [AnswerNewVal]
	                          - [Answer_value]
      ,   [AnswerNewVal]        AS Value_' + @CURR + '
      ,   [AnswWordStdN]        AS Wrdng_' + @CURR + '
      ,   [AnswNewWordg]        AS Descr_' + @CURR + '
      ,   [Answer_value]        AS Value_' + @PAST + '
      ,   [answer_wording_std]  AS Wrdng_' + @PAST + '
      ,   [answer_wording]      AS Descr_' + @PAST + '
  FROM
'
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<  this has been part 1 of the code: main select statement                   ***/
/**************************************************************************************************************************************************/
+
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is part 2 of the code: select data of last year & added vars         ***/
/**************************************************************************************************************************************************/
N'
(  SELECT 
          [Nation_fk]
        , [Ctry_EditorialName]
        , [QA_std]
        , [Answer_value]        = NULL
        , [answer_wording]      = ''''
        , [answer_wording_std]  = ''''
     FROM [AllLongData]
    WHERE [Question_Year] = ' + @Ncur + '
     AND  [DB]            = 0
UNION
ALL  
   SELECT 
          [Nation_fk]
        , [Ctry_EditorialName]
        , [QA_std]
        , [Answer_value]
        , [answer_wording]
        , [answer_wording_std]
     FROM [AllLongData]
    WHERE [Question_Year] = ' + @NPAS + '                                                                                     )  [LastYr]
'
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<  this has been part 2 of the code: select data of last year & added vars   ***/
/**************************************************************************************************************************************************/
+
N'LEFT JOIN  '                                            /***        MAIN join statement                                                       ***/
+
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is part 3 of the code: select data of current year                   ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>   this is part 3.1.1 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
(  SELECT
          [V_Nfk]         = [Nation_fk]
         ,[V_VAR]
         ,[AnswerNewVal]
         ,[AnswNewWordg]
         ,[AnswWordStdN]  = [Answer_wording_std]
     FROM
         ( SELECT *
             FROM [v02_AllCodedValues]
            WHERE [Q_Yr] = ' + @NCUR + ' )  [YrVals]
          unpivot ([AnswerNewVal]
              for  [V_VAR]
               in (
                   '
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.1.1 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     >>>>   this is part 3.1.2 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+   STUFF( (                                              /*** >>     stuff function & parenthesis for query XML cell to be stuffed             ***/
          SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std]                      /***        distinct comma delimiter concatenated to field QA (as varname)            ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'CODED'           /***        include Q with coded answers                                              ***/
                                      , 'COUNT'           /***        include Q with count answers                                              ***/
                                      , 'PERSI'  )        /***        and include Q with answers automatically calculated                       ***/
            AND     [QTools] NOT IN (   'filter'  )       /***        vars to be excluded: filter questions (usually coded)                     ***/
             FOR XML PATH('')                             /*** <      End of selection, nesting all cells into an XML string cell               ***/
                               ),1, 1, '')                /*** <<     stuff from position 1, change 1st comma into ''                           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.1.2 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     >>>>   this is part 3.1.3 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  ) )AS LongVals
'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.1.3 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+
N'   LEFT JOIN  '                                         /***        join statement                                                            ***/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     >>>>   this is part 3.2.1 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
(  SELECT
          [D_Nfk]         = [Nation_fk]
         ,[D_VAR]         = REPLACE([Variable],''_DES'','''')
         ,[AnswNewWordg]
     FROM
         ( SELECT *
             FROM [v02_AllCodedValues]
            WHERE [Q_Yr] = ' + @NCUR + ' )  [YrDVal]
          unpivot ([AnswNewWordg]
              for  [Variable]
               in (
                   '
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.2.1 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     >>>>   this is part 3.2.2 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
    STUFF( (                                              /*** >>     stuff function & parenthesis for query XML cell to be stuffed             ***/
          SELECT                                          /*** >      Begin selection (into text, in a cell, comma delimited list)              ***/
                    ', ' + [WQA_std]                      /***        distinct comma delimiter concatenated to field QA (as varname)            ***/
          FROM      [WT_VNs]                              /***        from table including var names & classifications as rows                  ***/
          WHERE     [QClass]     IN (   'DESCR'  )        /***        include Q with descriptive answers                                        ***/
            AND     [QTools] NOT IN (   'prevyr'  )       /***        vars to be excluded: descriptions used for the previous year              ***/
             FOR XML PATH('')                             /*** <      End of selection, nesting all cells into an XML string cell               ***/
                               ),1, 1, '')                /*** <<     stuff from position 1, change 1st comma into ''                           ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.2.2 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     >>>>   this is part 3.2.3 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
                  ) )AS LongDescr  ) LD
    ON    [D_Nfk] = [Nation_fk]
    AND   [D_VAR] = [V_VAR]
'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.2.3 of the code                                            ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
+
N'   LEFT JOIN  '                                         /***        join statement                                                            ***/
+
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     >>>>   this is part 3.3 of the code                                              ***/
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
N'
   [All_Answers]
    ON    [V_VAR]        =  [Question_abbreviation_std]
    AND   [AnswerNewVal] =  [Answer_value]
                                                                                                                             ) [MyNewVals]
    ON    [V_Nfk] = [Nation_fk]
    AND   [V_VAR] = [QA_std]
'
/*------------------------------------------------------------------------------------------------------------------------------------------------*/
/*********************************************************     <<<<   this is part 3.3 of the code                                              ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<  this has been part 3 of the code: select data of current year             ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< this has been the code to be executed                                     ***/
/**************************************************************************************************************************************************/


/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> statements to display/execute code stored in the variable @CODEmain       ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< statements to display/execute code stored in the variable @CODEmain       ***/
/**************************************************************************************************************************************************/
GO
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _041_cp_NDLongNoAggreg.sql                                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/**************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v06_NDLongNoAggreg]                                    <<<<<     ***/
/***             (Data to be appended to [forum_ResAnal]..[vrc_01_DB_Long_NoAggregated] --in the SAME FORMAT)                                   ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
/*                                                                                                                                                */
/*  REFERENCE to 2015 appears JUST ONCE in the script                                                                                             */
/*                                                                                                                                                */
/**************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==> creating view [v06_NDLongNoAggreg]                                                       --- '
/**************************************************************************************************************************************************/
USE              [GRSHR2015]
GO
---- NOTES: 
  -- these variables, calculated as persisted during coding period, should be also used in the aggregated data 
  -- currently used from [forum_ResAnal].[dbo].[vr_06w_LongData_ALL] but from final [forum] data once loaded...
  --    [GRI_19_x]
  --    [SHI_04_x]
  --    [SHI_05_x]
  --    [SHI_01_x]
  --    [SHI_01_summary_b]    --- should be rescaled to 1-6 for coding or scaled 1-6 for lookup table?



/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> these are the variables to be used                                        ***/
/**************************************************************************************************************************************************/
declare @NCUR nvarchar(4)                                 /***        declare variable for storing current year (as text)                       ***/
set     @NCUR = (SELECT DISTINCT CAST([Q_Yr] AS NVARCHAR) /***        set value to current year                                                 ***/
                 FROM [v02_AllCodedValues]                /***        from main view used as source                                             ***/
                 WHERE  [Q_Yr] = ( (SELECT MAX([Q_Yr])    /***        filtered using max numeric year value                                     ***/
                        FROM [v02_AllCodedValues]) - 0 )) /***        from the same main view used as source  (as the value is)                 ***/
/**************************************************************************************************************************************************/
declare @CODEmain nvarchar(max)                           /***        declare variable for storing the main code to be executed                 ***/
set     @CODEmain =                                       /***        start storing text as part of the main code to be executed                ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< these have been the variables to be used                                  ***/
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> this is the code to be executed                                           ***/
/**************************************************************************************************************************************************/
N'
ALTER VIEW     [v06_NDLongNoAggreg]
AS

SELECT
           entity              = ''CR&P''
      ,    link_fk             = 0
      ,   [VRD].[Nation_fk]
      ,         [Locality_fk]         = NULL
      ,         [Religion_fk]         = NULL
      ,   [COU].[Region5]
      ,   [COU].[Region6]
      ,   [VRD].[Ctry_EditorialName]
      ,         [Locality]            = ''''
      ,         [Religion]            = ''''
      ,         [Question_Year]       = '                            + @NCUR + '
      ,         [QA_std]              = [VRD].[Variable]
      ,         [QW_std]              = [AQU].[Question_wording_std]
      ,         [Answer_value]        = [VRD].[Value_Year_'          + @NCUR + ']
      ,         [answer_wording]      = [VRD].[Descr_Year_'          + @NCUR + ']
      ,         [answer_wording_std]  = [VRD].[Wrdng_Year_'          + @NCUR + ']
      ,         [Question_fk]         = 0
      ,         [Answer_fk]           = 0
      ,         [Notes]               = ''January - December '       + @NCUR + '''

  FROM          [v05_ReportData]                               [VRD]
     ,          [Countries]                                    [COU]
     ,          [All_Questions]                                [AQU]

 WHERE    [VRD].[Nation_fk]
        = [COU].[Nation_fk]
   AND    [VRD].[Variable]
        = [AQU].[Question_abbreviation_std]
'
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< this has been the code to be executed                                     ***/
/**************************************************************************************************************************************************/

/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> statements to display/execute code stored in the variable @CODEmain       ***/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEmain                          /***        display the currently stored code (to be executed)                        ***/
	EXEC              (@CODEmain)                         /***        execute the code that has been stored as text                             ***/
/**************************************************************************************************************************************************/
/*********************************************************     <<<<<< statements to display/execute code stored in the variable @CODEmain       ***/
/**************************************************************************************************************************************************/
GO

/**************************************************************************************************************************************************/
/*********************************************************     >>>>>> statements to TEST the VIEW                                               ***/
--	          SELECT * FROM                   [v06_NDLongNoAggreg]
--	UNION ALL SELECT * FROM  [forum_ResAnal]..[vrc_01_DB_Long_NoAggregated]
/*********************************************************     <<<<<< statements to TEST the VIEW                                               ***/
/**************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _042_cp_CompareIndexes_by_JCEO.sql                                                                                                                               
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 006    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vr_03w_W&Extras_by_Ctry&Year]                           <<<<<     ***/
/***             This table only includes numeric values aggregated by country/religion & year (does not include descriptive wordings).                      ***/
/***             The table adds calculated variables using the basic variables stored in the database.                                                       ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [GRSHR2015]
GO
/***************************************************************************************************************************************************************/
--ALTER VIEW     [v07_CompareIndexes]
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--AS
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
----SELECT






----FROM
----(
----/***************************************************************************************************************************************************************/

----SELECT
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* NOTE: scaled GRI_19_ b to f requested by Peter Henne in 2015 */
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* GRI_scaled index */
----      ,  GRI_scaled 
----         =        CAST ((
----                  CASE
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'low'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 1.00
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'moderate'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 2.00
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 3.00
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'very high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 4.00
----                  END
----                                                               ) AS DECIMAL (38,2))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* SHI_scaled index */
----      ,  SHI_scaled 
----         =        CAST ((
----                  CASE
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'low'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 1.00
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'moderate'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 2.00
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 3.00
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'very high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 4.00
----                  END
----                                                               ) AS DECIMAL (38,2))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----       , *

----FROM
----/***************************************************************************************************************************************************************/
----(
----/*** table including numeric values + Step-2 calculated variables **********************************************************************************************/
----SELECT
----/* Indexes wiolll NOT fit previously published data  ----------------------------------------------------------------------------------------------------------*/
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* GRI index */
----         GRI 
----         =
----                  CAST ((((
----                                [GRI_01]
----                         +      [GRI_02]
----                         +      [GRI_03]
----                         +      [GRI_04]
----                         +      [GRI_05]
----                         +      [GRI_06]
----                         +      [GRI_07]
----                         +      [GRI_08_for_index]
----                         +      [GRI_09]
----                         +      [GRI_10]
----                         +      [GRI_11]
----                         +      [GRI_12]
----                         +      [GRI_13]
----                         +      [GRI_14]
----                         +      [GRI_15]
----                         +      [GRI_16]
----                         +      [GRI_17]
----                         +      [GRI_18]
----                         +      [GRI_19]
----                         +      [GRI_20]
----                                                       ) / 2    )
----                                                                  ) AS DECIMAL (38,32))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* SHI index */
----       , SHI 
----         =        CAST ((((
----                                [SHI_01]
----                         +      [SHI_02]
----                         +      [SHI_03]
----                         +      [SHI_04]
----                         +      [SHI_05]
----                         +      [SHI_06]
----                         +      [SHI_07]
----                         +      [SHI_08]
----                         +      [SHI_09]
----                         +      [SHI_10]
----                         +      [SHI_11_for_index]
----                         +      [SHI_12]
----                         +      [SHI_13]
----                                                       ) / 1.3  )
----                                                                  ) AS DECIMAL (38,32))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----       , *
----FROM
----/***************************************************************************************************************************************************************/
----(
SELECT
       [v_CI_row]          = ROW_NUMBER()
                             OVER
                            (ORDER BY
                                      [Nation_fk]
                                     ,[Index_abbreviation]
                                                            )
      ,*
      ,[DIFF] = ROUND([Value_Year_2013],1,1) - [Index_value]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*--- query including INDEX values for current and former year -------------------------------------------------------------------------------------------------*/
SELECT
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Index_abbreviation]
      --,[Variable]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[NIncrease]         = SUM([I])
      ,[NDecrease]         = SUM([I])
      ,[Value_Year_2014]   = CASE
                                  WHEN [Index_abbreviation] = 'GRI'
                                  THEN  SUM([Value_Year_2014]) / 2
                                  WHEN [Index_abbreviation] = 'SHI'
                                  THEN  SUM([Value_Year_2014]) / 1.3
                                  ELSE  NULL
                             END
      ,[Value_Year_2013]   = CASE
                                  WHEN [Index_abbreviation] = 'GRI'
                                  THEN  SUM([Value_Year_2013]) / 2
                                  WHEN [Index_abbreviation] = 'SHI'
                                  THEN  SUM([Value_Year_2013]) / 1.3
                                  ELSE  NULL
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*--- query including recoded values for current and former year (not aggregated) -----------------------------------------------------------------------------*/
SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[Variable]          = CASE
                                  WHEN [Variable]        = 'GRI_08'
                                  THEN                     'GRI_08_for_index'
                                  WHEN [Variable]        = 'SHI_11'
                                  THEN                     'SHI_11_for_index'
                                  WHEN [Variable]     LIKE 'GRI_20_0%'
                                  THEN                     'GRI_20'
                                  WHEN [Variable]     LIKE 'SHI_01_%'
                                  THEN                     'SHI_01'
                                  ELSE [Variable]
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[Index_abbreviation]= SUBSTRING([Variable], 1,3)
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[I]                 = CASE WHEN [Change] > 0 THEN 1 ELSE 0 END
      ,[D]                 = CASE WHEN [Change] < 0 THEN 1 ELSE 0 END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 --   ,[v2014]= [Value_Year_2014]
      ,[Value_Year_2014]   = CASE
                                  WHEN [Variable]        = 'GRI_08'
                                   AND [Value_Year_2014] = 0.5
                                  THEN                     1
                                  WHEN [Variable]        = 'SHI_11'
                                   AND [Value_Year_2014] = 0.5
                                  THEN                     1
                                  WHEN [Variable]     LIKE 'GRI_20_0[1245]'
                                  THEN [Value_Year_2014] / 5
                                  WHEN [Variable]     LIKE 'GRI_20_03_[abc]'
                                  THEN [Value_Year_2014] / 15
                                  WHEN [Variable]     LIKE 'SHI_01_%'
                                   AND [Value_Year_2014] > 0
                                  THEN                     0.1666
                                  ELSE [Value_Year_2014]
                             END
      ,[Value_Year_2013]   = CASE
                                  WHEN [Variable]        = 'GRI_08'
                                   AND [Value_Year_2013] = 0.5
                                  THEN                     1
                                  WHEN [Variable]        = 'SHI_11'
                                   AND [Value_Year_2013] = 0.5
                                  THEN                     1
                                  WHEN [Variable]     LIKE 'GRI_20_0[1245]'
                                  THEN [Value_Year_2013] / 5
                                  WHEN [Variable]     LIKE 'GRI_20_03_[abc]'
                                  THEN [Value_Year_2013] / 15
                                  WHEN [Variable]     LIKE 'SHI_01_%'
                                   AND [Value_Year_2013] > 0
                                  THEN                     0.166666
                                  ELSE [Value_Year_2013]
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--SELECT *
FROM
/*** View including values for current and former year *********************************************************************************************************/
               [dbo].[v05_ReportData]
/********************************************************************************************************* View including values for current and former year ***/
WHERE
       [Variable]       IN (
                                'GRI_01'  
                         ,      'GRI_02'  
                         ,      'GRI_03'  
                         ,      'GRI_04'  
                         ,      'GRI_05'  
                         ,      'GRI_06'  
                         ,      'GRI_07'  
                         ,      'GRI_08'  
                         ,      'GRI_09'  
                         ,      'GRI_10'  
                         ,      'GRI_11'  
                         ,      'GRI_12'  
                         ,      'GRI_13'  
                         ,      'GRI_14'  
                         ,      'GRI_15'  
                         ,      'GRI_16'  
                         ,      'GRI_17'  
                         ,      'GRI_18'  
                         ,      'GRI_19'  
                         ,      'GRI_20_01'  
                         ,      'GRI_20_02'  
                         ,      'GRI_20_03_a'  
                         ,      'GRI_20_03_b'  
                         ,      'GRI_20_03_c'  
                         ,      'GRI_20_04'  
                         ,      'GRI_20_05'  
                         ,      'SHI_01_a'  
                         ,      'SHI_01_b'  
                         ,      'SHI_01_c'  
                         ,      'SHI_01_d'  
                         ,      'SHI_01_e'  
                         ,      'SHI_01_f'  
                         ,      'SHI_02'  
                         ,      'SHI_03'  
                         ,      'SHI_04'  
                         ,      'SHI_05'  
                         ,      'SHI_06'  
                         ,      'SHI_07'  
                         ,      'SHI_08'  
                         ,      'SHI_09'  
                         ,      'SHI_10'  
                         ,      'SHI_11'  
                         ,      'SHI_12'  
                         ,      'SHI_13'  
                                                                  )
/*----------------------------------------------------------------------------- query including recoded values for current and former year (not aggregated) ---*/
)   BASREC
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 GROUP
    BY
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Index_abbreviation]
      --,[Variable]
/*------------------------------------------------------------------------------------------------ query including INDEX values for current and former year ---*/
)   INDVALS
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/


       LEFT JOIN 
     /*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
      (
     /*--- INDEX values for former year -----------------------------------------------------------------------------------------------------------------------*/
          SELECT 
                 [n] = [Nation_fk]
                ,[i] = [Index_abbreviation]
                ,[Index_value]
            FROM [forum].[dbo].[vi_Restrictions_Index_by_CtryRegion&Yr]
           WHERE [Year] = 2013
     /*--------------------------------------------------------------------------------------------------------------------------- INDEX values former year ---*/
      )   OLDVALS
     /*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
        ON
                 [n] = [Nation_fk]
       AND
                 [i] = [Index_abbreviation]

/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/




/*


/********************************************************************************************** table including numeric values + Step-1 calculated variables ***/
)                                                                                                                                                       AS NV_S1
/***************************************************************************************************************************************************************/
)                                                                                                                                                       AS NV_S2
/********************************************************************************************** table including numeric values + Step-2 calculated variables ***/
/********************************************************************************************** table including numeric values + Step-3 calculated variables ***/
/************************************************************************************************************************************* main select statement ***/
/***************************************************************************************************************************************************************/
) formerview
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
*/ 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  _042_cp_CompareIndexes_by_JCEO2.sql                                                                                                                              
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
Print 
'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 006    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the lookup table [forum_ResAnal].[dbo].[vr_03w_W&Extras_by_Ctry&Year]                           <<<<<     ***/
/***             This table only includes numeric values aggregated by country/religion & year (does not include descriptive wordings).                      ***/
/***             The table adds calculated variables using the basic variables stored in the database.                                                       ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [GRSHR2015]
GO
/***************************************************************************************************************************************************************/
--ALTER VIEW     [v07_CompareIndexes]
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--AS
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
----SELECT


ALSO AGGREGATE 11



----FROM
----(
----/***************************************************************************************************************************************************************/

----SELECT
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* NOTE: scaled GRI_19_ b to f requested by Peter Henne in 2015 */
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* GRI_scaled index */
----      ,  GRI_scaled 
----         =        CAST ((
----                  CASE
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'low'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 1.00
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'moderate'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 2.00
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 3.00
----                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'very high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'GRI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 4.00
----                  END
----                                                               ) AS DECIMAL (38,2))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* SHI_scaled index */
----      ,  SHI_scaled 
----         =        CAST ((
----                  CASE
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'low'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 1.00
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'moderate'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 2.00
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 3.00
----                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
----                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
----                                WHERE  [Field_fk]   = [Field_pk]
----                                  AND  [Level]      = 'very high'
----                                  AND  [Point]      = 'highest'
----                                  AND  [Field_type] = 'SHI'
----                                  AND  [Field_year] = '2007'
----                              )
----                  THEN 4.00
----                  END
----                                                               ) AS DECIMAL (38,2))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----       , *

----FROM
----/***************************************************************************************************************************************************************/
----(
----/*** table including numeric values + Step-2 calculated variables **********************************************************************************************/
----SELECT
----/* Indexes wiolll NOT fit previously published data  ----------------------------------------------------------------------------------------------------------*/
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* GRI index */
----         GRI 
----         =
----                  CAST ((((
----                                [GRI_01]
----                         +      [GRI_02]
----                         +      [GRI_03]
----                         +      [GRI_04]
----                         +      [GRI_05]
----                         +      [GRI_06]
----                         +      [GRI_07]
----                         +      [GRI_08_for_index]
----                         +      [GRI_09]
----                         +      [GRI_10]
----                         +      [GRI_11]
----                         +      [GRI_12]
----                         +      [GRI_13]
----                         +      [GRI_14]
----                         +      [GRI_15]
----                         +      [GRI_16]
----                         +      [GRI_17]
----                         +      [GRI_18]
----                         +      [GRI_19]
----                         +      [GRI_20]
----                                                       ) / 2    )
----                                                                  ) AS DECIMAL (38,32))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----/* SHI index */
----       , SHI 
----         =        CAST ((((
----                                [SHI_01]
----                         +      [SHI_02]
----                         +      [SHI_03]
----                         +      [SHI_04]
----                         +      [SHI_05]
----                         +      [SHI_06]
----                         +      [SHI_07]
----                         +      [SHI_08]
----                         +      [SHI_09]
----                         +      [SHI_10]
----                         +      [SHI_11_for_index]
----                         +      [SHI_12]
----                         +      [SHI_13]
----                                                       ) / 1.3  )
----                                                                  ) AS DECIMAL (38,32))
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
----       , *
----FROM
----/***************************************************************************************************************************************************************/
----(
SELECT
       [v_CI_row]          = ROW_NUMBER()
                             OVER
                            (ORDER BY
                                      [Nation_fk]
                                     ,[Index_abbreviation]
                                                            )
      ,*
      ,[DIFF] = ROUND([Value_Year_2013],1,1) - [Index_value]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--- query including INDEX values for current and former year -------------------------------------------------------------------------------------------------*/
SELECT
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Index_abbreviation]
      ,[Variable]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[NIncrease]         = SUM([I])
      ,[NDecrease]         = SUM([I])
      ,[Value_Year_2014]   = CASE
                                  WHEN [Index_abbreviation] = 'GRI'
                                  THEN  SUM([Value_Year_2014]) / 2
                                  WHEN [Index_abbreviation] = 'SHI'
                                  THEN  SUM([Value_Year_2014]) / 1.3
                                  ELSE  NULL
                             END
      ,[Value_Year_2013]   = CASE
                                  WHEN [Index_abbreviation] = 'GRI'
                                  THEN  SUM([Value_Year_2013]) / 2
                                  WHEN [Index_abbreviation] = 'SHI'
                                  THEN  SUM([Value_Year_2013]) / 1.3
                                  ELSE  NULL
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*--- query including values of main variables for current and former year ------------------------------------------------------------------------------------*/
SELECT
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Index_abbreviation]
      ,[Variable]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[NIncrease]         = SUM([I])
      ,[NDecrease]         = SUM([I])
      ,[Value_Year_2014]   = CASE
                                  WHEN [Index_abbreviation] = 'GRI'
                                  THEN  SUM([Value_Year_2014]) / 2
                                  WHEN [Index_abbreviation] = 'SHI'
                                  THEN  SUM([Value_Year_2014]) / 1.3
                                  ELSE  NULL
                             END
      ,[Value_Year_2013]   = CASE
                                  WHEN [Index_abbreviation] = 'GRI'
                                  THEN  SUM([Value_Year_2013]) / 2
                                  WHEN [Index_abbreviation] = 'SHI'
                                  THEN  SUM([Value_Year_2013]) / 1.3
                                  ELSE  NULL
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
/*--- query including recoded values for current and former year (not aggregated) -----------------------------------------------------------------------------*/
SELECT
       [Nation_fk]
      ,[Ctry_EditorialName]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[Variable]          = CASE
                                  WHEN [Variable]        = 'GRI_08'
                                  THEN                     'GRI_08_for_index'
                                  WHEN [Variable]        = 'SHI_11'
                                  THEN                     'SHI_11_for_index'
                                  WHEN [Variable]     LIKE 'GRI_20_0%'
                                  THEN                     'GRI_20'
                                  WHEN [Variable]     LIKE 'SHI_01_%'
                                  THEN                     'SHI_01'
                                  ELSE [Variable]
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[Index_abbreviation]= SUBSTRING([Variable], 1,3)
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      ,[I]                 = CASE WHEN [Change] > 0 THEN 1 ELSE 0 END
      ,[D]                 = CASE WHEN [Change] < 0 THEN 1 ELSE 0 END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 --   ,[v2014]= [Value_Year_2014]
      ,[Value_Year_2014]   = CASE
                                  WHEN [Variable]        = 'GRI_08'
                                   AND [Value_Year_2014] = 0.5
                                  THEN                     1
                                  WHEN [Variable]        = 'SHI_11'
                                   AND [Value_Year_2014] = 0.5
                                  THEN                     1
                                  WHEN [Variable]     LIKE 'GRI_20_0[1245]'
                                  THEN [Value_Year_2014] / 5
                                  WHEN [Variable]     LIKE 'GRI_20_03_[abc]'
                                  THEN [Value_Year_2014] / 15
                                  WHEN [Variable]     LIKE 'SHI_01_%'
                                   AND [Value_Year_2014] > 0
                                  THEN                     0.1666
                                  ELSE [Value_Year_2014]
                             END
      ,[Value_Year_2013]   = CASE
                                  WHEN [Variable]        = 'GRI_08'
                                   AND [Value_Year_2013] = 0.5
                                  THEN                     1
                                  WHEN [Variable]        = 'SHI_11'
                                   AND [Value_Year_2013] = 0.5
                                  THEN                     1
                                  WHEN [Variable]     LIKE 'GRI_20_0[1245]'
                                  THEN [Value_Year_2013] / 5
                                  WHEN [Variable]     LIKE 'GRI_20_03_[abc]'
                                  THEN [Value_Year_2013] / 15
                                  WHEN [Variable]     LIKE 'SHI_01_%'
                                   AND [Value_Year_2013] > 0
                                  THEN                     0.166666
                                  ELSE [Value_Year_2013]
                             END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--SELECT *
FROM
/*** View including values for current and former year *********************************************************************************************************/
               [dbo].[v05_ReportData]
/********************************************************************************************************* View including values for current and former year ***/
WHERE
       [Variable]       IN (
                                'GRI_01'  
                         ,      'GRI_02'  
                         ,      'GRI_03'  
                         ,      'GRI_04'  
                         ,      'GRI_05'  
                         ,      'GRI_06'  
                         ,      'GRI_07'  
                         ,      'GRI_08'  
                         ,      'GRI_09'  
                         ,      'GRI_10'  
                         ,      'GRI_11'  
                         ,      'GRI_12'  
                         ,      'GRI_13'  
                         ,      'GRI_14'  
                         ,      'GRI_15'  
                         ,      'GRI_16'  
                         ,      'GRI_17'  
                         ,      'GRI_18'  
                         ,      'GRI_19'  
                         ,      'GRI_20_01'  
                         ,      'GRI_20_02'  
                         ,      'GRI_20_03_a'  
                         ,      'GRI_20_03_b'  
                         ,      'GRI_20_03_c'  
                         ,      'GRI_20_04'  
                         ,      'GRI_20_05'  
                         ,      'SHI_01_a'  
                         ,      'SHI_01_b'  
                         ,      'SHI_01_c'  
                         ,      'SHI_01_d'  
                         ,      'SHI_01_e'  
                         ,      'SHI_01_f'  
                         ,      'SHI_02'  
                         ,      'SHI_03'  
                         ,      'SHI_04'  
                         ,      'SHI_05'  
                         ,      'SHI_06'  
                         ,      'SHI_07'  
                         ,      'SHI_08'  
                         ,      'SHI_09'  
                         ,      'SHI_10'  
                         ,      'SHI_11'  
                         ,      'SHI_12'  
                         ,      'SHI_13'  
                                                                  )
/*----------------------------------------------------------------------------- query including recoded values for current and former year (not aggregated) ---*/
)   BASREC
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 GROUP
    BY
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Index_abbreviation]
      ,[Variable]
/*------------------------------------------------------------------------------------------------ query including INDEX values for current and former year ---*/
)   INDVALS
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/


       LEFT JOIN 
     /*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
      (
     /*--- INDEX values for former year -----------------------------------------------------------------------------------------------------------------------*/
          SELECT 
                 [n] = [Nation_fk]
                ,[i] = [Index_abbreviation]
                ,[Index_value]
            FROM [forum].[dbo].[vi_Restrictions_Index_by_CtryRegion&Yr]
           WHERE [Year] = 2013
     /*--------------------------------------------------------------------------------------------------------------------------- INDEX values former year ---*/
      )   OLDVALS
     /*--------------------------------------------------------------------------------------------------------------------------------------------------------*/
        ON
                 [n] = [Nation_fk]
       AND
                 [i] = [Index_abbreviation]

/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/




/*


/********************************************************************************************** table including numeric values + Step-1 calculated variables ***/
)                                                                                                                                                       AS NV_S1
/***************************************************************************************************************************************************************/
)                                                                                                                                                       AS NV_S2
/********************************************************************************************** table including numeric values + Step-2 calculated variables ***/
/********************************************************************************************** table including numeric values + Step-3 calculated variables ***/
/************************************************************************************************************************************* main select statement ***/
/***************************************************************************************************************************************************************/
) formerview
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
*/ 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  1__cp_next_step_____________________.sql                                                                                                                         
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the pro-access-tool table [vrx_w_01_proGRSHRadm_01]                                             <<<<<     ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
---- THIS SCRIPT IS NOT CLEAN


USE [forum_ResAnal]
GO

something as following 
no zero values
differences 
check matching, 210 now are 218


/****** Script for SelectTopNRows command from SSMS  ******/
SELECT [Basic_updatable_data_pk]
      ,[entity]
      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
      ,[v_000]
      ,[v_020]
      ,[v_025]
      ,[v_033]
      ,[v_040]
      ,[v_050]
      ,[v_060]
      ,[v_067]
      ,[v_075]
      ,[v_080]
      ,[v_100]
      ,[v_plu]
      ,[AV_std_CURRENT]
      ,[AW_std_CURRENT]
      ,[AW_CURRENT]
      ,[editable]
      ,[Answer_Wording_std]
      ,[changeV]
      ,[changeW]



/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
select
        C.[Ctry_EditorialName]
      , P.[Ctry_EditorialName]
      , C.[Locality]
      , P.[Locality]
      , C.[Religion]
      , P.[Religion]
      , C.[Question_Year]
      , P.[Question_Year]
      , C.[QA_std]
      , P.[QA_std]
      , C.[QW_std]
      , P.[QW_std]
      , *
from


  (  select *
    FROM [forum_ResAnal].[dbo].[vrd_w_01_proGRSHRadm_01]
    where Question_Year = 2013                           ) C -- current
  
  full join

  (  select *
    FROM [forum_ResAnal].[dbo].[vrd_w_01_proGRSHRadm_01]
    where Question_Year = 2012                           ) P -- previous
ON 

        C.[Ctry_EditorialName]
      = P.[Ctry_EditorialName]
    AND C.[Locality]
      = P.[Locality]
    AND C.[Religion]
      = P.[Religion]
    AND C.[Question_Year]
      = P.[Question_Year] + 1
    AND C.[QA_std]
      = P.[QA_std]
    AND C.[QW_std]
      = P.[QW_std]

        --C.[Locality]
        --C.[Religion]
        --C.[Question_Year]
        --C.[QA_std]
        --C.[QW_std]



where 

C.QA_std = 'GFI'
or
P.QA_std = 'GFI'
 
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  







/***************************************************************************************************************************************************************/
IF OBJECT_ID  (N'[forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]', N'U') IS NOT NULL
DROP TABLE       [forum_ResAnal].[dbo].[vrx_w_01_proGRSHRadm_01]
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
/***************************************************************************************************************************************************************/
CREATE TABLE 
      [dbo].[vrx_w_01_proGRSHRadm_01]
(
      [Basic_updatable_data_pk]            [int]            NOT NULL
 	, [entity]                             [varchar](45)        NULL
	, [note]                               [varchar](60)        NULL
	, [link_fk]                            [int]                NULL
	, [Nation_fk]                          [int]                NULL
	, [Locality_fk]                        [int]                NULL
	, [Religion_fk]                        [int]                NULL
	, [Ctry_EditorialName]                 [nvarchar](50)       NULL
	, [Locality]                           [nvarchar](50)       NULL
	, [Religion]                           [nvarchar](255)      NULL
	, [Question_Year]                      [int]                NULL
	, [QA_std]                             [nvarchar](50)       NULL
	, [QW_std]                             [nvarchar](500)      NULL
	, [Answer_value]                       [decimal](38, 2)     NULL
	, [answer_wording]                     [nvarchar](max)      NULL
	, [Question_fk]                        [int]                NULL
	, [Answer_fk]                          [int]                NULL
	, [Notes]                              [nvarchar](1000)     NULL
	, [v_000]                              [nvarchar](400)      NULL
	, [v_020]                              [nvarchar](400)      NULL
	, [v_025]                              [nvarchar](400)      NULL
	, [v_033]                              [nvarchar](400)      NULL
	, [v_040]                              [nvarchar](400)      NULL
	, [v_050]                              [nvarchar](400)      NULL
	, [v_060]                              [nvarchar](400)      NULL
	, [v_067]                              [nvarchar](400)      NULL
	, [v_075]                              [nvarchar](400)      NULL
	, [v_080]                              [nvarchar](400)      NULL
	, [v_100]                              [nvarchar](400)      NULL
	, [v_plu]                              [nvarchar](400)      NULL
	, [AV_std_CURRENT]                     [decimal](38, 2)     NULL
    , [AW_std_CURRENT]                     [nvarchar](400)      NULL
    , [AW_CURRENT]                         [nvarchar](max)      NULL
    , [editable]                           [int]                NULL
    , CONSTRAINT
      [PK_Basic_updatable_data]
    PRIMARY KEY CLUSTERED 
    (
	  [Basic_updatable_data_pk]
	                      ASC
                         ) WITH (  PAD_INDEX             = OFF,
                                  STATISTICS_NORECOMPUTE = OFF,
                                  IGNORE_DUP_KEY         = OFF,
                                  ALLOW_ROW_LOCKS        = ON ,
                                  ALLOW_PAGE_LOCKS       = ON  ) ON [PRIMARY]
                                                                               ) ON [PRIMARY]
GO
/***************************************************************************************************************************************************************/
SET ANSI_PADDING OFF
GO


IF OBJECT_ID('tempdb..#ACDAC') IS NOT NULL
DROP TABLE           [#ACDAC]
GO

/***************************************************************************************************************************************************************/
/*** all combinations + distinct actual combinations of Q&A ****************************************************************************************************/
SELECT *
INTO   [#ACDAC]
FROM
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
(
SELECT

           [QA_lnk]   = [QA_std]
      ,    [AV_std]
      ,    [AW_std]   = CASE
                             WHEN [Answer_Wording_std] IS NOT NULL
                             THEN [Answer_Wording_std]
                             ELSE 'THE VALUE IS NOT A VALID ANSWER'
                         END
FROM
(
SELECT *
  FROM
(
SELECT 
       DISTINCT
       [QA_std]
     , [QA_lnk] = CASE 
                       WHEN              [QA_std] LIKE '%__p' 
                       THEN STUFF(       [QA_std]      ,         
                       (CHARINDEX('__p', [QA_std])), 3, '')
                       ELSE              [QA_std]
                  END
  FROM [forum_ResAnal].[dbo].[vr_06w_LongData_ALL_bkup]
WHERE  [note] LIKE '%this field can be edited'                       )  KL

cross join

(SELECT * FROM
 (       SELECT [AV_std] = '0.00'
   UNION SELECT [AV_std] = '0.20'
   UNION SELECT [AV_std] = '0.25'
   UNION SELECT [AV_std] = '0.33'
   UNION SELECT [AV_std] = '0.40'
   UNION SELECT [AV_std] = '0.50'
   UNION SELECT [AV_std] = '0.60'
   UNION SELECT [AV_std] = '0.67'
   UNION SELECT [AV_std] = '0.75'
   UNION SELECT [AV_std] = '0.80'
   UNION SELECT [AV_std] = '1.00'   )  DE ) JJ
LEFT JOIN


( SELECT 
                           [Question_abbreviation_std]
                         , [Answer_Wording_std]
                         , [Answer_value_std]
    FROM
         [forum].[dbo].[Pew_Q&A_Std]   )   IIJIJ
ON
      [QA_lnk] = [Question_abbreviation_std]
AND   [AV_std] = [Answer_value_std]

) KKKL

/*********************** all combinations + distinct actual combinations of Q&A ***/

)                                                                         ACplusDAC
/**********************************************************************************/
pivot (MAX ([AW_std]) 
       for  [AV_std] in (
                                 [0.00]
                               , [0.20]
                               , [0.25]
                               , [0.33]
                               , [0.40]
                               , [0.50]
                               , [0.60]
                               , [0.67]
                               , [0.75]
                               , [0.80]
                               , [1.00]
                                          ))  AS ValidValues
/**********************************************************************************/
/**********************************************************************************/






-----------------------------------------------------------------------------------------------------------------------------------------------------------------


/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/**************************************************************************************************** all combinations + distinct actual combinations of Q&A ***/
GO
/***************************************************************************************************************************************************************/






/***************************************************************************************************************************************************************/
/***  Complete 1st step of Table [Basic] ***********************************************************************************************************************/
INSERT INTO 
       [basic]
SELECT

       [Basic_updatable_data_pk]     = ROW_NUMBER()OVER(ORDER BY 
                                                                    [Question_Year] DESC
                                                                  , [Nation_fk]     DESC
                                                                  , [QA_std]             )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[entity]
      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[v_000]                       =  [0.00]
      ,[v_020]                       =  [0.20]
      ,[v_025]                       =  [0.25]
      ,[v_033]                       =  [0.33]
      ,[v_040]                       =  [0.40]
      ,[v_050]                       =  [0.50]
      ,[v_060]                       =  [0.60]
      ,[v_067]                       =  [0.67]
      ,[v_075]                       =  [0.75]
      ,[v_080]                       =  [0.80]
      ,[v_100]                       =  [1.00]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[v_plu]                       =  ''
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[AV_std_CURRENT]              =  [Answer_value]
      ,[AW_std_CURRENT]              =  [answer_wording_std]
      ,[AW_CURRENT]                  =  [answer_wording]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      ,[editable]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
FROM
       [forum_ResAnal].[dbo].[vr_06w_LongData_ALL]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
LEFT
JOIN
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [#ACDAC]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
ON
	   [QA_std]
	=  [QA_lnk]


GO




/**************************************************************************************************************************************************/
/***                                                     ******************************************************************************************/
/***                    S T E P     2                    ******************************************************************************************/
/***                                                     ******************************************************************************************/
/**************************************************************************************************************************************************/
/***  Add Computed Columns PERSISTED  *************************************************************************************************************/
SET ANSI_PADDING ON
GO
----------------------------------------------------------------------------------------------------------------------------------------------------
ALTER
TABLE
       [basic]
ADD
----------------------------------------------------------------------------------------------------------------------------------------------------
       [Answer_Wording_std]
                             AS
                               CASE 
                                   WHEN [Answer_value]  = [Av_STD_CURRENT] THEN [AW_std_CURRENT]
                                   -------------------------------------------------------------------------------------------
                                   WHEN [note]   LIKE    '%NOT be edited%'
                                    AND [Answer_value] != [Av_STD_CURRENT] THEN 'VALUE SHOULD NOT BE EDITED !!!'
                                   -------------------------------------------------------------------------------------------
                                   WHEN [note]   LIKE    '%can be edited%'
                                    AND [Answer_value] != [Av_STD_CURRENT]
                                    AND [Answer_value]  < 1.00
                                    AND [Answer_value]    NOT IN (
                                                                    0.00
                                                                  , 0.20
                                                                  , 0.25
                                                                  , 0.33
                                                                  , 0.40
                                                                  , 0.50
                                                                  , 0.60
                                                                  , 0.67
                                                                  , 0.75
                                                                  , 0.80
                                                                         ) THEN 'THE VALUE IS NOT A VALID ANSWER'
                                   -------------------------------------------------------------------------------------------
                                   WHEN [Answer_value]  = 0.00             THEN [v_000]
                                   WHEN [Answer_value]  = 0.20             THEN [v_020]
                                   WHEN [Answer_value]  = 0.25             THEN [v_025]
                                   WHEN [Answer_value]  = 0.33             THEN [v_033]
                                   WHEN [Answer_value]  = 0.40             THEN [v_040]
                                   WHEN [Answer_value]  = 0.50             THEN [v_050]
                                   WHEN [Answer_value]  = 0.60             THEN [v_060]
                                   WHEN [Answer_value]  = 0.67             THEN [v_067]
                                   WHEN [Answer_value]  = 0.75             THEN [v_075]
                                   WHEN [Answer_value]  = 0.80             THEN [v_080]
                                   WHEN [Answer_value] >= 1.00             THEN [v_100]
---                                   WHEN [Answer_value]  > 0.00             THEN [v_plu]
                                   -------------------------------------------------------------------------------------------
                                   ELSE                                         'program error: tell JC!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
    , [changeV]
                             AS
                               CASE 
                                   WHEN [AV_std_CURRENT] !=  [Answer_value] THEN 'value has been updated'
                                   WHEN [AV_std_CURRENT]  =  [Answer_value] THEN ''
                                   ELSE                                          'error!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
    , [changeW]
                             AS
                               CASE 
                                   WHEN [AW_CURRENT]     IS     NULL
                                    AND [Answer_Wording] IS     NULL      THEN ''
                                   WHEN [AW_CURRENT]     IS     NULL
                                    AND [Answer_Wording] IS NOT NULL      THEN 'descriptive wording has been updated'
                                   WHEN [AW_CURRENT]     IS NOT NULL
                                    AND [Answer_Wording] IS     NULL      THEN 'descriptive wording has been removed'
                                   WHEN [AW_CURRENT]  =  [Answer_Wording] THEN ''
                                   WHEN [AW_CURRENT] !=  [Answer_Wording] THEN 'descriptive wording has been updated'
                                   ELSE                                        'error!'
                                                                                                               END   PERSISTED
----------------------------------------------------------------------------------------------------------------------------------------------------
GO
/**************************************************************************************************************************************************/
SET ANSI_PADDING OFF
GO
/*************************************************************************************************************  Add Computed Columns PERSISTED  ***/
/**************************************************************************************************************************************************/


 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S00_CrT_CodedAnswers_________v03__RUN.sql                                                                                                                        
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                  ******************************************************************************************/
/***************************************************************************************************************************************************************/
-- this should be a view later
-- all answers should be part of answers table
USE 
            [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID
         (N'[forum_ResAnal].[dbo].[CodedAnswers]', N'U') IS NOT NULL
DROP TABLE
            [forum_ResAnal].[dbo].[CodedAnswers]
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE
               [CodedAnswers]
                                      (
                                       [QA_Number]           [bigint]         NULL
                                     , [Variable]            [nvarchar](128)  NULL
                                     , [Value]               [decimal](38,2)  NULL
                                     , [Answer_wording_std]  [nvarchar](max)  NULL
                                      )
ON [PRIMARY]
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
/***************************************************************************************************************************************************************/
/****** Load values using code from Excel **********************************************************************************************************************/
-- Using the document all_coded_Q&A_std__vNNN.xlsx, copy 'QA+wordings'!L:L
/***************************************************************************************************************************************************************/
INSERT INTO
               [CodedAnswers]
                                      (
                                       [Variable]
                                     , [Value]
                                     , [Answer_wording_std]
                                      )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                 'GRI_scaled'          , 1.00 , 'Low'
UNION ALL SELECT 'GRI_scaled'          , 2.00 , 'Moderate'
UNION ALL SELECT 'GRI_scaled'          , 3.00 , 'High'
UNION ALL SELECT 'GRI_scaled'          , 4.00 , 'Very High'
UNION ALL SELECT 'SHI_scaled'          , 1.00 , 'Low'
UNION ALL SELECT 'SHI_scaled'          , 2.00 , 'Moderate'
UNION ALL SELECT 'SHI_scaled'          , 3.00 , 'High'
UNION ALL SELECT 'SHI_scaled'          , 4.00 , 'Very High'
UNION ALL SELECT 'GFI_scaled'          , 1.00 , 'Low'
UNION ALL SELECT 'GFI_scaled'          , 2.00 , 'Moderate'
UNION ALL SELECT 'GFI_scaled'          , 3.00 , 'High'
UNION ALL SELECT 'GFI_scaled'          , 4.00 , 'Very High'
UNION ALL SELECT 'GRI_rd_1d'           , 0.00 , 'scale 0 - [+.1] - 10'
UNION ALL SELECT 'SHI_rd_1d'           , 0.00 , 'scale 0 - [+.1] - 10'
UNION ALL SELECT 'GFI_rd_1d'           , 0.00 , 'scale 0 - [+.1] - 10'
UNION ALL SELECT 'GRI'                 , 0.00 , 'scale 0 - [+.] - 10'
UNION ALL SELECT 'SHI'                 , 0.00 , 'scale 0 - [+.] - 10'
UNION ALL SELECT 'GFI'                 , 0.00 , 'scale 0 - [+.] - 10'
UNION ALL SELECT 'GRI_01_x'            , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_01_x2'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x2'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_01_x2_a'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x2_a'         , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_01'              , 0.00 , 'Yes'
UNION ALL SELECT 'GRI_01'              , 0.50 , 'The constitution or basic law does not specifically provide for freedom of religion but does protect some religious practices'
UNION ALL SELECT 'GRI_01'              , 1.00 , 'No'
UNION ALL SELECT 'GRI_01_x2_b'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x2_b'         , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_02'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_02'              , 0.33 , 'Yes, there is a qualification'
UNION ALL SELECT 'GRI_02'              , 0.67 , 'Yes, there is a substantial contradiction and only some religious practices are protected'
UNION ALL SELECT 'GRI_02'              , 1.00 , 'Religious freedom is not provided in the first place'
UNION ALL SELECT 'GRI_03'              , 0.00 , 'National laws and policies provide for religious freedom, and the national government respects religious freedom in practice'
UNION ALL SELECT 'GRI_03'              , 0.33 , 'National laws and policies provide for religious freedom, and the national government generally respects religious freedom in practice; but there are some instances (e.g., in certain localities) where religious freedom is not respected in practice'
UNION ALL SELECT 'GRI_03'              , 0.67 , 'There are limited national legal protections for religious freedom, but the national government does not generally respect religious freedom in practice'
UNION ALL SELECT 'GRI_03'              , 1.00 , 'National laws and policies do not provide for religious freedom and the national government does not respect religious freedom in practice'
UNION ALL SELECT 'GRI_04'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_04'              , 0.33 , 'Yes, in a few cases'
UNION ALL SELECT 'GRI_04'              , 0.67 , 'Yes, in many cases'
UNION ALL SELECT 'GRI_04'              , 1.00 , 'Government prohibits worship or religious practices of one or more religious groups as a general policy'
UNION ALL SELECT 'GRI_05'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_05'              , 0.50 , 'Yes, for some religious groups'
UNION ALL SELECT 'GRI_05'              , 1.00 , 'Yes, for all religious groups'
UNION ALL SELECT 'GRI_06'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_06'              , 0.50 , 'Yes, for some religious groups'
UNION ALL SELECT 'GRI_06'              , 1.00 , 'Yes, for all religious groups'
UNION ALL SELECT 'GRI_07'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_07'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_08_for_index'    , 0.00 , 'No'
UNION ALL SELECT 'GRI_08_for_index'    , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_08'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_08'              , 0.50 , 'Yes'
UNION ALL SELECT 'GRI_08'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_09'              , 0.00 , 'Yes'
UNION ALL SELECT 'GRI_09'              , 0.50 , 'Yes, but with restrictions'
UNION ALL SELECT 'GRI_09'              , 1.00 , 'No'
UNION ALL SELECT 'GRI_10'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_10'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_10_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_10_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_10_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_10_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_10_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_10_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_11'              , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11'              , 1.00 , 'Yes, there was widespread intimidation'
UNION ALL SELECT 'GRI_11_01a'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_01a'          , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_01a'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_01b'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_01b'          , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_01b'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_02'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_03'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_04'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_05'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_06'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_06'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_07'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_07'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_08'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_08'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_09'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_09'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_09'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_10'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_10'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_10'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_11'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_11'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_11'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_12'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_12'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_12'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_13'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_13'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_13'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_14'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_14'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_14'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_15'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_15'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_16'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_16'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_17'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_17'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG1'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG1'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG2'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG2'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG3'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG3'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG4'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG4'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG5'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG5'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG6'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG6'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG7'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG7'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_12'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_12'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_13'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_13'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_14'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_14'              , 0.33 , 'No, but the government consults a nongovernmental religious advisory board'
UNION ALL SELECT 'GRI_14'              , 0.67 , 'Yes, but the organization is noncoercive toward religious groups'
UNION ALL SELECT 'GRI_14'              , 1.00 , 'Yes, and the organization is coercive toward religious groups'
UNION ALL SELECT 'GRI_15'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_15'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_16'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_16'              , 0.33 , 'Yes, security reasons stated as rationale'
UNION ALL SELECT 'GRI_16'              , 0.67 , 'Yes, nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16'              , 1.00 , 'Yes, both security and nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_16_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRI_16_ny'           , 0.33 , 'Security reasons stated as rationale'
UNION ALL SELECT 'GRI_16_ny'           , 0.67 , 'Nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16_ny'           , 1.00 , 'Both security and nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16_01'           , 0.00 , 'No groups'
UNION ALL SELECT 'GRI_16_01'           , 1.00 , 'One or more groups'
UNION ALL SELECT 'GRI_17'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_17'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_18'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_18'              , 0.33 , 'Yes, but in a nondiscriminatory way'
UNION ALL SELECT 'GRI_18'              , 0.67 , 'Yes, the process adversely affects the ability of some religious groups to operate'
UNION ALL SELECT 'GRI_18'              , 1.00 , 'Yes, and the process clearly discriminates against some religious groups'
UNION ALL SELECT 'GRI_19'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_19'              , 0.20 , 'Yes, 1-9 cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.40 , 'Yes, 10-200 cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.60 , 'Yes, 201-1,000 cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.80 , 'Yes, 1,001-9,999 cases of government force'
UNION ALL SELECT 'GRI_19'              , 1.00 , 'Yes, 10,000+ cases of government force'
UNION ALL SELECT 'GRI_19_filter'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_19_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_19_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_19_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRI_19_ny'           , 0.20 , '1-9 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 0.40 , '10-200 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 0.60 , '201-1,000 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 0.80 , '1,001-9,999 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 1.00 , '10,000+ cases of government force'
UNION ALL SELECT 'GRI_19_summ_ny'      , 0.00 , 'No'
UNION ALL SELECT 'GRI_19_summ_ny'      , 0.01 , 'Yes ^'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.02 , 'Property damage'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.03 , 'Detentions / abductions'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.04 , 'Displacement from homes'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.05 , 'Physical assaults'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.06 , 'Deaths'
UNION ALL SELECT 'GRI_19_x'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'GRI_19_x'            , 1.00 , ' case(s) found (in total)'
UNION ALL SELECT 'GRI_19_b'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_b'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_19_c'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_c'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_19_d'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_d'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_19_e'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_e'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_19_f'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_f'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_19_da'           , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_da'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_19_db'           , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_db'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'GRI_20'              , 0.00 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.02 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.03 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.05 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.07 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.08 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.10 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.12 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.13 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.15 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.17 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.18 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.20 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.22 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.23 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.25 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.27 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.28 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.30 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.32 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.33 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.35 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.37 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.38 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.40 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.42 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.43 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.45 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.47 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.48 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.50 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.52 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.53 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.55 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.57 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.58 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.60 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.62 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.63 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.65 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.67 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.68 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.70 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.72 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.73 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.75 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.77 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.78 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.80 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.82 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.83 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.85 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.87 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.88 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.90 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.92 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.93 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.95 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.97 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.98 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 1.00 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20_top'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_top'          , 0.50 , 'Yes, the government provides support  to religious groups, but it does so on a more-or-less fair and equal basis'
UNION ALL SELECT 'GRI_20_top'          , 1.00 , 'Yes, the government gives preferential support or favors to some religious group(s) and clearly discriminates against others'
UNION ALL SELECT 'GRI_20_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_01a'      , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_01a'      , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_01b'      , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_01b'      , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_02'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_02'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_03'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_03'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_04'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_04'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_05'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_05'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_06'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_06'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_07'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_07'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_08'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_08'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_09'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_09'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_10'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_10'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_02'           , 0.00 , 'All religious groups are generally treated the same'
UNION ALL SELECT 'GRI_20_02'           , 0.25 , 'Some religious groups have minimal privileges unavailable to other religious groups, limited to things such as inheriting buildings or properties'
UNION ALL SELECT 'GRI_20_02'           , 0.50 , 'Some religious groups have general privileges or government access unavailable to other religious groups'
UNION ALL SELECT 'GRI_20_02'           , 0.75 , 'One religious group has privileges or government access unavailable to other religious groups, but it is not recognized as the country''s official religion'
UNION ALL SELECT 'GRI_20_02'           , 1.00 , 'One religious group has privileges or government access unavailable to other religious groups, and it is recognized by the national government as the official religion'
UNION ALL SELECT 'GRI_20_03_top'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_top'       , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_top'       , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_a'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_a'         , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_a'         , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_b'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_b'         , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_b'         , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_c'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_c'         , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_c'         , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_04'           , 0.50 , 'Yes, by at least some local governments'
UNION ALL SELECT 'GRI_20_04'           , 1.00 , 'Yes, by the national government'
UNION ALL SELECT 'GRI_20_04_x'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_04_x'         , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_05_x'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_05_x'         , 0.50 , 'Yes, in some Provinces'
UNION ALL SELECT 'GRI_20_05_x'         , 1.00 , 'Yes, in the whole country'
UNION ALL SELECT 'GRI_20_05_x1'        , 1.00 , '(probably means no)'
UNION ALL SELECT 'GRI_20_05_x1'        , 2.00 , '(probably means yes)'
UNION ALL SELECT 'SHI_01'              , 0.00 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.17 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.33 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.50 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.67 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.83 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 1.00 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 0.01 , 'Yes ^'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.01 , 'Harassment/Intimidation'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.02 , 'Property damage'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.03 , 'Detentions/abductions'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.04 , 'Displacement from homes'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.05 , 'Physical assaults'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.06 , 'Deaths'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.00 , 'scale 0 - [+.1667] - 0'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.17 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.33 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.50 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.67 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.83 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 1.00 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_b'    , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_summary_b'    , 1.00 , 'Yes: 1 type of '
UNION ALL SELECT 'SHI_01_summary_b'    , 2.00 , 'Yes: 2 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 3.00 , 'Yes: 3 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 4.00 , 'Yes: 4 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 5.00 , 'Yes: 5 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 6.00 , 'Yes: 6 types of '
UNION ALL SELECT 'SHI_01_x'            , 0.00 , ' cases found (in total, except harassment)'
UNION ALL SELECT 'SHI_01_x'            , 1.00 , ' case(s) found (in total, except harassment)'
UNION ALL SELECT 'SHI_01_a_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_a_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_b_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_b_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_c_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_c_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_d_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_d_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_e_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_e_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_f_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_f_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_a'            , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_a'            , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_a'            , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_01a'        , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_01a'        , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_01a'        , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_01b'        , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_01b'        , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_01b'        , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_02'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_02'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_02'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_03'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_03'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_03'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_04'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_04'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_04'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_05'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_05'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_05'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_06'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_06'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_06'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_07'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_07'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_07'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_08'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_08'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_08'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_09'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_09'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_09'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_10'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_10'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_10'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_11'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_11'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_11'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_12'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_12'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_12'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_13'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_13'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_13'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_14'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_14'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_14'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_15'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_15'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_15'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_16'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_16'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_16'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_17'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_17'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_17'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_xG1'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG1'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG2'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG2'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG3'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG3'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG4'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG4'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG5'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG5'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG6'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG6'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG7'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG7'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_b'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_b'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_01_c'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_c'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_01_d'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_d'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_01_e'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_e'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_01_f'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_f'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_01_da'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_da'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_01_db'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_db'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_02'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_02'              , 0.50 , 'Yes, but there were no deaths reported'
UNION ALL SELECT 'SHI_02'              , 1.00 , 'Yes, and there were deaths reported'
UNION ALL SELECT 'SHI_02_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_02_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_03'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_03'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_04'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_04'              , 0.25 , 'Yes, but their activity was limited to recruitment and fundraising'
UNION ALL SELECT 'SHI_04'              , 0.50 , 'Yes, with violence that resulted in some casualties (1-9 injuries or deaths)'
UNION ALL SELECT 'SHI_04'              , 0.75 , 'Yes, with violence that resulted in multiple casualties (10-50 injuries or deaths)'
UNION ALL SELECT 'SHI_04'              , 1.00 , 'Yes, with violence that resulted in many casualties (more than 50 injuries or deaths)'
UNION ALL SELECT 'SHI_04_filter'       , 0.00 , 'No'
UNION ALL SELECT 'SHI_04_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_04_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_04_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHI_04_ny'           , 0.25 , 'Yes, but their activity was limited to recruitment or fundraising'
UNION ALL SELECT 'SHI_04_ny'           , 0.50 , 'Yes, with violence that resulted in some casualties (1-9 injuries or deaths)'
UNION ALL SELECT 'SHI_04_ny'           , 0.75 , 'Yes, with violence that resulted in multiple casualties (10-50 injuries or deaths)'
UNION ALL SELECT 'SHI_04_ny'           , 1.00 , 'Yes, with violence that resulted in many casualties (more than 50 injuries or deaths)'
UNION ALL SELECT 'SHI_04_x'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_x'            , 1.00 , ' case(s) found (in total)'
UNION ALL SELECT 'SHI_04_b'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_b'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_c'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_c'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_d'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_d'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_e'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_e'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_f'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_f'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_da'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_da'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_db'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_04_db'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_04_x01'          , 0.00 , 'No groups'
UNION ALL SELECT 'SHI_04_x01'          , 1.00 , 'One or more groups'
UNION ALL SELECT 'SHI_05'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_05'              , 0.25 , 'Yes, with fewer than 10,000 casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 0.50 , 'Yes, with tens of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 0.75 , 'Yes, with hundreds of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 1.00 , 'Yes, with millions of casualties or people displaced'
UNION ALL SELECT 'SHI_05_filter'       , 0.00 , 'No'
UNION ALL SELECT 'SHI_05_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_05_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_05_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHI_05_ny'           , 0.25 , 'Yes, with fewer than 10,000 casualties or people displaced'
UNION ALL SELECT 'SHI_05_ny'           , 0.50 , 'Yes, with tens of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05_ny'           , 0.75 , 'Yes, with hundreds of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05_ny'           , 1.00 , 'Yes, with millions of casualties or people displaced'
UNION ALL SELECT 'SHI_05_x'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_x'            , 1.00 , ' case(s) found (in total)'
UNION ALL SELECT 'SHI_05_b'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_b'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_05_c'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_c'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_05_d'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_d'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_05_e'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_e'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_05_f'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_f'            , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_05_da'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_da'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_05_db'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_05_db'           , 1.00 , ' case(s) found'
UNION ALL SELECT 'SHI_06'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_06'              , 0.33 , 'There were public tensions between religious groups, but they fell short of hostilities involving physical violence'
UNION ALL SELECT 'SHI_06'              , 0.67 , 'Yes, with physical violence in a few cases'
UNION ALL SELECT 'SHI_06'              , 1.00 , 'Yes, with physical violence in numerous cases'
UNION ALL SELECT 'SHI_07'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_07'              , 0.33 , 'Yes, at the local level'
UNION ALL SELECT 'SHI_07'              , 0.67 , 'Yes, at the regional level'
UNION ALL SELECT 'SHI_07'              , 1.00 , 'Yes, at the national level'
UNION ALL SELECT 'SHI_07_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_07_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHI_07_ny'           , 0.33 , 'At the local level'
UNION ALL SELECT 'SHI_07_ny'           , 0.67 , 'At the regional level'
UNION ALL SELECT 'SHI_07_ny'           , 1.00 , 'At the national level'
UNION ALL SELECT 'SHI_08'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_08'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_09'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_09'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_10'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_10'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_11_for_index'    , 0.00 , 'No'
UNION ALL SELECT 'SHI_11_for_index'    , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_11'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_11'              , 0.50 , 'Yes'
UNION ALL SELECT 'SHI_11'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_11_x'            , 0.00 , 'No'
UNION ALL SELECT 'SHI_11_x'            , 0.50 , 'No, but religious women were harassed for violating secular norms'
UNION ALL SELECT 'SHI_11_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_12'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_12'              , 0.50 , 'Yes, but they fell short of physical violence'
UNION ALL SELECT 'SHI_12'              , 1.00 , 'Yes, and they included physical violence'
UNION ALL SELECT 'SHI_13'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_13'              , 0.50 , 'Yes, but they fell short of physical violence'
UNION ALL SELECT 'SHI_13'              , 1.00 , 'Yes, and they included physical violence'
UNION ALL SELECT 'GRX_21_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_21_01'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'GRX_21_01'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'GRX_21_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_21_02'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'GRX_21_02'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'GRX_21_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_21_03'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'GRX_21_03'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'GRX_22_filter'       , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_22_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_ny'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_ny'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22'              , 0.00 , 'No'
UNION ALL SELECT 'GRX_22'              , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22'              , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22'              , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_01'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_01'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_01'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_01_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_01_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_01_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_01_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_02'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_02'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_02'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_02_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_02_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_02_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_02_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_03'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_03'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_03'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_04_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_04_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_04_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_04_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_03_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_03_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_03_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_03_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_04'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_04'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_04'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.00 , 'No'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.02 , 'Yes, but the implicated events, groups or individuals were entirely outside the country'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.03 , 'Yes, and the implicated events, groups or individuals were in the country'
UNION ALL SELECT 'GRX_23'              , 0.00 , 'No'
UNION ALL SELECT 'GRX_23'              , 0.50 , 'No, but by social norms'
UNION ALL SELECT 'GRX_23'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_25_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_25_ny'           , 0.02 , 'Yes, but the implicated events, groups or individuals were entirely outside the country'
UNION ALL SELECT 'GRX_25_ny'           , 0.03 , 'Yes, and the implicated events, groups or individuals were in the country'
UNION ALL SELECT 'GRX_25_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_25_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_25_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_27_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHX_27_ny'           , 0.02 , 'Yes, but the implicated events, groups or individuals were entirely outside the country'
UNION ALL SELECT 'SHX_27_ny'           , 0.03 , 'Yes, and the implicated events, groups or individuals were in the country'
UNION ALL SELECT 'SHX_27_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_27_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_27_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_242526_ny'       , 0.00 , 'No'
UNION ALL SELECT 'XSG_242526_ny'       , 0.01 , 'Yes'
UNION ALL SELECT 'XSG_242526_ny'       , 0.33 , 'Yes, there was no physical violence'
UNION ALL SELECT 'XSG_242526_ny'       , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'XSG_242526_ny'       , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'GRX_24_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_24_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_24_ny'           , 0.33 , 'Yes, there were cases of obvious government discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'GRX_24_ny'           , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'GRX_24_ny'           , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'GRX_24'              , 0.00 , 'No'
UNION ALL SELECT 'GRX_24'              , 0.33 , 'Yes, there were cases of obvious government discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'GRX_24'              , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'GRX_24'              , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_25_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_25_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHX_25_ny'           , 0.33 , 'Yes, there were cases of obvious social discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'SHX_25_ny'           , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_25_ny'           , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_25'              , 0.00 , 'No'
UNION ALL SELECT 'SHX_25'              , 0.33 , 'Yes, there were cases of obvious social discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'SHX_25'              , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_25'              , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_26_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_26_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHX_26_ny'           , 0.33 , 'Yes, but they engaged in crimes or malicious acts motivated by religious hatred or bias that fell short of violence'
UNION ALL SELECT 'SHX_26_ny'           , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_26_ny'           , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_26'              , 0.00 , 'No'
UNION ALL SELECT 'SHX_26'              , 0.33 , 'Yes, but they engaged in crimes or malicious acts motivated by religious hatred or bias that fell short of violence'
UNION ALL SELECT 'SHX_26'              , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_26'              , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'GRX_26_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_06'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_07'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_08'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_27_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_27_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_27_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_27_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_27_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_27_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_28_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_28_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_28_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_28_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_28_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_28_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_14_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_01'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_01'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_14_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_02'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_02'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_14_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_03'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_03'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_14_04'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_04'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_04'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_15_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_04'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_05'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_06'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_07'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_08'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_09'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_09'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_10'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_10'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_04'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_05'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_06'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_07'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_08'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG1'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG1'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG2'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG2'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG3'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG3'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG4'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG4'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG5'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG5'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG6'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG6'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG7'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG7'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_24'              , 0.00 , 'No'
UNION ALL SELECT 'XSG_24'              , 0.50 , 'Yes, but nongovernmental'
UNION ALL SELECT 'XSG_24'              , 1.00 , 'Yes, and governmental'
UNION ALL SELECT 'XSG_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_filter'     , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_99_filter'     , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_01'              , 0.00 , 'Yes, the law provides for freedom of speech and the government generally respected this right in practice'
UNION ALL SELECT 'CSR_01'              , 0.25 , 'Yes, but the government sometimes restricts freedom of speech in practice'
UNION ALL SELECT 'CSR_01'              , 0.50 , 'Yes, but the government frequently restricts freedom of speech in practice'
UNION ALL SELECT 'CSR_01'              , 0.75 , 'No, the law does not provide for freedom of speech but the government generally respected this right in practice'
UNION ALL SELECT 'CSR_01'              , 1.00 , 'No, the law does not provide for freedom of speech and the government frequently restricts this right in practice'
UNION ALL SELECT 'CSR_02'              , 0.00 , 'Yes, the law provides for freedom of the press and the government generally respected this right in practice'
UNION ALL SELECT 'CSR_02'              , 0.25 , 'Yes, but the government sometimes restricts freedom of the press in practice'
UNION ALL SELECT 'CSR_02'              , 0.50 , 'Yes, but the government frequently restricts freedom of the press in practice'
UNION ALL SELECT 'CSR_02'              , 0.75 , 'No, the law does not provide for freedom of the press but the government generally respected this right in practice'
UNION ALL SELECT 'CSR_02'              , 1.00 , 'No, the law does not provide for freedom of the press and the government frequently restricts this right in practice'
UNION ALL SELECT 'CSR_02_a'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_02_a'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_02_b'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_02_b'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_02_c'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_02_c'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_02_d'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_02_d'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_03_a'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_03_a'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_03_b'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_03_b'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_03_c'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_03_c'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_04_a'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_04_a'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_04_b'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_04_b'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_04_c'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_04_c'            , 1.00 , 'Yes'
UNION ALL SELECT 'CSR_05'              , 0.00 , 'No'
UNION ALL SELECT 'CSR_05'              , 0.33 , 'Yes, for security purposes'
UNION ALL SELECT 'CSR_05'              , 0.67 , 'Yes, for non-security purposes'
UNION ALL SELECT 'CSR_05'              , 1.00 , 'Yes, for security and non-security purposes'
UNION ALL SELECT 'CSR_06'              , 0.00 , 'No'
UNION ALL SELECT 'CSR_06'              , 0.33 , 'Yes, for security purposes'
UNION ALL SELECT 'CSR_06'              , 0.67 , 'Yes, for non-security purposes'
UNION ALL SELECT 'CSR_06'              , 1.00 , 'Yes, for security and non-security purposes'
UNION ALL SELECT 'CSR_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_24'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_24'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_24'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_25'            , 0.00 , 'No'
UNION ALL SELECT 'CSR_S_25'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_25'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'CSR_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'CSR_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_01'              , 0.00 , 'The law provides criminal penalties for official corruption and the government generally implemented these laws effectively'
UNION ALL SELECT 'ERI_01'              , 0.50 , 'Although the law provides for criminal penalties for official corruption, the government did not implement the law effectively'
UNION ALL SELECT 'ERI_01'              , 1.00 , 'No, the law does not provided criminal penalties for official corruption'
UNION ALL SELECT 'ERI_02'              , 0.00 , 'There are no reports'
UNION ALL SELECT 'ERI_02'              , 0.50 , 'There are isolated reports of corruption'
UNION ALL SELECT 'ERI_02'              , 1.00 , 'Reports indicate that corruption is pervasive or widespread'
UNION ALL SELECT 'ERI_03'              , 0.00 , 'Yes, intellectual property is well protected by the law'
UNION ALL SELECT 'ERI_03'              , 0.33 , 'Yes, but these laws are not effectively implemented'
UNION ALL SELECT 'ERI_03'              , 0.67 , 'No, but no problems were reported'
UNION ALL SELECT 'ERI_03'              , 1.00 , 'No, and problems were reported'
UNION ALL SELECT 'ERI_04'              , 0.00 , 'Yes, the government employs a transparent and effective policy framework that fosters competition between private businesses in a non-discriminatory fashion'
UNION ALL SELECT 'ERI_04'              , 0.25 , 'Yes, and the legal and regulatory systems are relatively transparent and in accordance with international standards'
UNION ALL SELECT 'ERI_04'              , 0.50 , 'Somewhat, and although legal and regulatory systems are consistent with international norms, enforcement is uneven'
UNION ALL SELECT 'ERI_04'              , 0.75 , 'Although laws are present, enforcement is ineffective and/or the system is largely nontransparent'
UNION ALL SELECT 'ERI_04'              , 1.00 , 'No, the legal and regulatory system is underdeveloped, opaque, or unpredictable'
UNION ALL SELECT 'ERI_05'              , 0.00 , 'No'
UNION ALL SELECT 'ERI_05'              , 0.50 , 'No, but there are minimum wages in some provinces or work sectors'
UNION ALL SELECT 'ERI_05'              , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_06'              , 0.00 , 'No'
UNION ALL SELECT 'ERI_06'              , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_06_a'            , 0.00 , 'Yes'
UNION ALL SELECT 'ERI_06_a'            , 1.00 , 'No'
UNION ALL SELECT 'ERI_06_b'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_06_b'            , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_06_b_x'          , 0.00 , 'No'
UNION ALL SELECT 'ERI_06_b_x'          , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_06_c'            , 0.00 , 'The government does not control or significantly interfere with unions'
UNION ALL SELECT 'ERI_06_c'            , 1.00 , 'The government controls or significantly interferes with unions'
UNION ALL SELECT 'ERI_06_c_x'          , 0.00 , 'No'
UNION ALL SELECT 'ERI_06_c_x'          , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_06_x'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_06_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_07'              , 0.00 , 'No'
UNION ALL SELECT 'ERI_07'              , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_07_a'            , 0.00 , 'Yes'
UNION ALL SELECT 'ERI_07_a'            , 1.00 , 'No'
UNION ALL SELECT 'ERI_07_b'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_07_b'            , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_07_b_x'          , 0.00 , 'No'
UNION ALL SELECT 'ERI_07_b_x'          , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_07_c'            , 0.00 , 'The government does not control or significantly interfere with strikes'
UNION ALL SELECT 'ERI_07_c'            , 1.00 , 'The government controls or significantly interferes with strikes'
UNION ALL SELECT 'ERI_07_c_x'          , 0.00 , 'No'
UNION ALL SELECT 'ERI_07_c_x'          , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_07_x'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_07_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_08'              , 0.00 , 'No'
UNION ALL SELECT 'ERI_08'              , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_08_a'            , 0.00 , 'Yes'
UNION ALL SELECT 'ERI_08_a'            , 1.00 , 'No'
UNION ALL SELECT 'ERI_08_b'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_08_b'            , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_08_b_x'          , 0.00 , 'No'
UNION ALL SELECT 'ERI_08_b_x'          , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_08_c'            , 0.00 , 'The government does not control or significantly interfere with collective bargaining'
UNION ALL SELECT 'ERI_08_c'            , 1.00 , 'The government controls or significantly interferes with collective bargaining'
UNION ALL SELECT 'ERI_08_c_x'          , 0.00 , 'No'
UNION ALL SELECT 'ERI_08_c_x'          , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_08_x'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_08_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'ERI_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_24'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_24'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_24'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_25'            , 0.00 , 'No'
UNION ALL SELECT 'ERI_S_25'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_25'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'ERI_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'ERI_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_01'              , 0.00 , 'No'
UNION ALL SELECT 'IEI_01'              , 1.00 , 'Yes'
UNION ALL SELECT 'IEI_02'              , 0.00 , 'No'
UNION ALL SELECT 'IEI_02'              , 0.25 , 'Yes, in a few instances, but the government attempted to resolve the situation'
UNION ALL SELECT 'IEI_02'              , 0.50 , 'Yes, in a few instances, and the government did not attempt to resolve the situation'
UNION ALL SELECT 'IEI_02'              , 0.75 , 'Yes, in numerous instances, but the government attempted to resolve the situation'
UNION ALL SELECT 'IEI_02'              , 1.00 , 'Yes, in numerous instances, and the government did not attempt to resolve the situation'
UNION ALL SELECT 'IEI_A_01'            , 0.00 , 'Yes'
UNION ALL SELECT 'IEI_A_01'            , 1.00 , 'No, "0" entered for "N.A."'
UNION ALL SELECT 'IEI_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_24'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_24'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_24'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_25'            , 0.00 , 'No'
UNION ALL SELECT 'IEI_S_25'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_25'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'IEI_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'IEI_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_01'              , 0.00 , '(no year coded for most recent national legislative election)'
UNION ALL SELECT 'PPR_01'              , 2000.00 , '(year of most recent national legislative election)'
UNION ALL SELECT 'PPR_01_a'            , 0.00 , 'Yes'
UNION ALL SELECT 'PPR_01_a'            , 0.33 , 'It met most international standards for openness and fairness, with minor irregularities reported'
UNION ALL SELECT 'PPR_01_a'            , 0.67 , 'It did not meet standards for openness or fairness, with numerous irregularities reported'
UNION ALL SELECT 'PPR_01_a'            , 1.00 , 'There were no elections in the country since 2000 and/or the law does not provide citizens the right to change their national legislature through an electoral process'
UNION ALL SELECT 'PPR_02'              , 0.00 , '(no year coded for most recent national executive election)'
UNION ALL SELECT 'PPR_02'              , 2000.00 , '(year of most recent national executive election)'
UNION ALL SELECT 'PPR_02_a'            , 0.00 , 'Yes'
UNION ALL SELECT 'PPR_02_a'            , 0.33 , 'It met most international standards for openness and fairness, with minor irregularities reported'
UNION ALL SELECT 'PPR_02_a'            , 0.67 , 'It did not meet standards for openness or fairness, with numerous irregularities reported'
UNION ALL SELECT 'PPR_02_a'            , 1.00 , 'There were no elections in the country since 2000 and/or the law does not provide citizens the right to change their executive branch through an electoral process'
UNION ALL SELECT 'PPR_03'              , 0.00 , 'None reported'
UNION ALL SELECT 'PPR_03'              , 0.50 , 'Yes, but they are not enforced'
UNION ALL SELECT 'PPR_03'              , 1.00 , 'Yes, and they are enforced'
UNION ALL SELECT 'PPR_04'              , 0.00 , 'No, there are no reports of political prisoners or detainees'
UNION ALL SELECT 'PPR_04'              , 0.20 , 'Yes, there is reported to be at least one political prisoner or detainee'
UNION ALL SELECT 'PPR_04'              , 0.40 , 'Yes, there are between 2-20 political prisoners or detainees'
UNION ALL SELECT 'PPR_04'              , 0.60 , 'Yes, there are between 21-99 political prisoners or detainees'
UNION ALL SELECT 'PPR_04'              , 0.80 , 'Yes, there are between 100-999 political prisoners or detainees'
UNION ALL SELECT 'PPR_04'              , 1.00 , 'Yes, there are between 1000 or more political prisoners or detainees'
UNION ALL SELECT 'PPR_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_24'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_24'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_24'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_25'            , 0.00 , 'No'
UNION ALL SELECT 'PPR_S_25'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_25'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'PPR_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'PPR_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_01'              , 0.00 , 'Yes'
UNION ALL SELECT 'RIR_01'              , 1.00 , 'No'
UNION ALL SELECT 'RIR_02'              , 0.00 , 'No'
UNION ALL SELECT 'RIR_02'              , 0.25 , 'No, but instances of excessive force, ill treatment, or neglect were reported'
UNION ALL SELECT 'RIR_02'              , 0.50 , 'Yes, but there were one or two isolated reports'
UNION ALL SELECT 'RIR_02'              , 0.75 , 'Yes, and there were multiple reports'
UNION ALL SELECT 'RIR_02'              , 1.00 , 'Yes, and there were widespread reports'
UNION ALL SELECT 'RIR_03'              , 0.00 , 'Yes, and no restrictions were reported'
UNION ALL SELECT 'RIR_03'              , 0.33 , 'Yes, but in practice the government limited these rights'
UNION ALL SELECT 'RIR_03'              , 0.67 , 'No, but no restrictions were reported'
UNION ALL SELECT 'RIR_03'              , 1.00 , 'No, and in practice the government limited these rights'
UNION ALL SELECT 'RIR_03_a'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_03_a'            , 0.50 , 'The government restricts internal movement, for instance, through police and military security checkpoints'
UNION ALL SELECT 'RIR_03_a'            , 1.00 , 'The government requires internal passports, residency permits, or other severe internal travel restrictions'
UNION ALL SELECT 'RIR_03_b'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_03_b'            , 0.50 , 'Yes, limited restrictions on foreign travel, including restrictions on traveling to certain countries'
UNION ALL SELECT 'RIR_03_b'            , 1.00 , 'Yes, severe government restrictions on citizens' ability to travel abroad'
UNION ALL SELECT 'RIR_03_c'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_03_c'            , 1.00 , 'Yes, permission to travel (within or outside of the country) is or can be required from, for instance, a husband or male relative'
UNION ALL SELECT 'RIR_04'              , 0.00 , 'No'
UNION ALL SELECT 'RIR_04'              , 0.33 , 'Yes, but the government makes a good faith effort to combat human trafficking'
UNION ALL SELECT 'RIR_04'              , 0.67 , 'Yes, and the government expends little effort to combat human trafficking'
UNION ALL SELECT 'RIR_04'              , 1.00 , 'Yes, and some level of government is involved in the trafficking'
UNION ALL SELECT 'RIR_04_a_01'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_a_01'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_a_02'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_a_02'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_a_03'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_a_03'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_a_04'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_a_04'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_b_01'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_b_01'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_b_02'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_b_02'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_b_03'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_b_03'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_04_b_04'         , 0.00 , 'No'
UNION ALL SELECT 'RIR_04_b_04'         , 1.00 , 'Yes'
UNION ALL SELECT 'RIR_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_24'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_24'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_24'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_25'            , 0.00 , 'No'
UNION ALL SELECT 'RIR_S_25'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_25'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'RIR_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'RIR_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
GO
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S00_CrT_CodedQuestions_______v01__RUN.sql                                                                                                                        
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                  ******************************************************************************************/
/***************************************************************************************************************************************************************/
-- this works as a STEP BY STEP procedure
-- in the future we should have this data as part of the std question table or as a view having some of the notes in other table
USE 
            [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID
         (N'[forum_ResAnal].[dbo].[CodedQuestions]', N'U') IS NOT NULL
DROP TABLE
            [forum_ResAnal].[dbo].[CodedQuestions]
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE
               [CodedQuestions]
                                      (
                                       [Q_Number]        [bigint]          NULL
                                     , [Variable]        [nvarchar] (128)  NULL
                                     , [Label_minus4]    [nvarchar]  (50)  NULL
                                     , [Wording_minus3]  [nvarchar] (max)  NULL
                                     , [Notes1_plus201]  [nvarchar] (max)  NULL
                                     , [Notes2_plus202]  [nvarchar] (max)  NULL
                                     , [Notes3_plus203]  [nvarchar] (max)  NULL
                                      )
ON [PRIMARY]
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
/***************************************************************************************************************************************************************/
/****** Load values using code from Excel **********************************************************************************************************************/
-- Using the document all_coded_Q&A_std__vNNN.xlsx, copy 'Q+wrd+notes'!B:B
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO
               [CodedQuestions]
                                      (
                                       [Q_Number]
                                     , [Variable]
                                     , [Label_minus4]
                                     , [Wording_minus3]
                                     , [Notes1_plus201]
                                     , [Notes2_plus202]
                                     , [Notes3_plus203]
                                                       )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                 1 , 'GRI_scaled', 'GRI', 'Government Restrictions Index (GRI)', '', '', ''
UNION ALL SELECT 2 , 'SHI_scaled', 'SHI', 'Social Hostilities Index (SHI)', '', '', ''
UNION ALL SELECT 3 , 'GFI_scaled', 'GFI', 'Government Favoritism Index (GFI)', '', 'In this analysis, GRI.Q.20 is treated as a Government Favoritism Index. The Pew Forum categorizes the levels of government favoritism of religion by percentiles. Countries with scores in the top 5% on GRI.Q.20 were categorized as "very high." The next highest 15% of scores were categorized as "high," and the following 20% were categorized as "moderate." The bottom 60% of scores were categorized as "low."', 'In this analysis, GRI.Q.20 is treated as a Government Favoritism Index (see page TK). The Pew Forum categorizes the levels of government favoritism of religion by percentiles. Countries with scores in the top 5% on GRI.Q.20 were categorized as "very high." The next highest 15% of scores were categorized as "high," and the following 20% were categorized as "moderate." The bottom 60% of scores were categorized as "low."'
UNION ALL SELECT 4 , 'GRI_rd_1d', 'GRI', 'Calculated Year Value of the Government Restrictions Index (rounded to one decimal)', '', '', ''
UNION ALL SELECT 5 , 'SHI_rd_1d', 'SHI', 'Calculated Year Value of the Social Hostilities Index (rounded to one decimal)', '', '', ''
UNION ALL SELECT 6 , 'GFI_rd_1d', 'GFI', 'Calculated Year Value of the Government Favoritism Index (rounded to one decimal)', '', '', ''
UNION ALL SELECT 7 , 'GRI', 'GRI', 'Calculated Year Value of the Government Restrictions Index', '', '', ''
UNION ALL SELECT 8 , 'SHI', 'SHI', 'Calculated Year Value of the Social Hostilities Index', '', '', ''
UNION ALL SELECT 9 , 'GFI', 'GFI', 'Calculated Year Value of the Government Favoritism Index', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 10 , 'GRI_01_x', 'GRI_01_x', 'Is there any evidence that the constitution changed since the former coding period?', '', '', ''
UNION ALL SELECT 11 , 'GRI_01_x2', 'GRI_01_x2', 'Did the constitution change make a change in either GRI_01 and GRI_02?', '', '', ''
UNION ALL SELECT 12 , 'GRI_01_x2_a', 'GRI_01_x2_a', 'Did the constitution change make a change in GRI_01?', '', '', ''
UNION ALL SELECT 13 , 'GRI_01', 'GRI.Q.1', 'Does the constitution, or law that functions in the place of a constitution (basic law), specifically provide for "freedom of religion" or include language used in Article 18 of the United Nations Universal Declaration of Human Rights? *', '* Article 18 states: "Everyone has the right to freedom of thought, conscience and religion; this right includes freedom to change his religion or belief, and freedom, either alone or in community with others and in public or private, to manifest his religion or belief in teaching, practice, worship and observance."', '', ''
UNION ALL SELECT 14 , 'GRI_01_x2_b', 'GRI_01_x2_b', 'Did the constitution change make a change in GRI_02?', '', '', ''
UNION ALL SELECT 15 , 'GRI_02', 'GRI.Q.2', 'Does the constitution or basic law include stipulations that appear to qualify or substantially contradict the concept of "religious freedom"?', ' ', '', ''
UNION ALL SELECT 16 , 'GRI_03', 'GRI.Q.3', 'Taken together, how do the constitution/basic law and other national laws and policies affect religious freedom?', ' ', '', ''
UNION ALL SELECT 17 , 'GRI_04', 'GRI.Q.4', 'Does any level of government interfere with worship or other religious practices?', ' ', '', ''
UNION ALL SELECT 18 , 'GRI_05', 'GRI.Q.5', 'Is public preaching by religious groups limited by any level of government?', ' ', '', ''
UNION ALL SELECT 19 , 'GRI_06', 'GRI.Q.6', 'Is proselytizing limited by any level of government?', ' ', '', ''
UNION ALL SELECT 20 , 'GRI_07', 'GRI.Q.7', 'Is converting from one religion to another limited by any level of government?', ' ', '', ''
UNION ALL SELECT 21 , 'GRI_08_for_index', 'GRI.Q.8', 'Is religious literature or broadcasting limited by any level of government?', ' ', '', ''
UNION ALL SELECT 22 , 'GRI_08', 'GRI_08', 'Is religious literature or broadcasting limited by any level of government?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 23 , 'GRI_09', 'GRI.Q.9', 'Are foreign missionaries allowed to operate?', ' ', '', ''
UNION ALL SELECT 24 , 'GRI_10', 'GRI.Q.10', 'Is the wearing of religious symbols, such as head coverings for women and facial hair for men, regulated by law or by any level of government?', ' ', '', ''
UNION ALL SELECT 25 , 'GRI_10_01', 'GRI_10_01', 'Is the wearing of scarves or head coverings for women regulated by law or by any level of government?', '', '', ''
UNION ALL SELECT 26 , 'GRI_10_02', 'GRI_10_02', 'Is the wearing of beards or facial hair for men regulated by law or by any level of government?', '', '', ''
UNION ALL SELECT 27 , 'GRI_10_03', 'GRI_10_03', 'Is the wearing of other religious symbols, besides head coverings for women and facial hair for men, regulated by law or by any level of government?', '', '', ''
UNION ALL SELECT 28 , 'GRI_11', 'GRI.Q.11', 'Was there harassment or intimidation of religious groups by any level of government?', ' ', '', ''
UNION ALL SELECT 29 , 'GRI_11_01a', 'GRI_11_01a', 'Was there harassment or intimidation of Orthodox Christianity by any level of government?', '', '', ''
UNION ALL SELECT 30 , 'GRI_11_01b', 'GRI_11_01b', 'Was there harassment or intimidation of Catholic Christianity by any level of government?', '', '', ''
UNION ALL SELECT 31 , 'GRI_11_02', 'GRI_11_02', 'Was there harassment or intimidation of Protestant/Anglican Christianity by any level of government?', '', '', ''
UNION ALL SELECT 32 , 'GRI_11_03', 'GRI_11_03', 'Was there harassment or intimidation of Christianity (unspecified) by any level of government?', '', '', ''
UNION ALL SELECT 33 , 'GRI_11_04', 'GRI_11_04', 'Was there harassment or intimidation of Sunni Islam by any level of government?', '', '', ''
UNION ALL SELECT 34 , 'GRI_11_05', 'GRI_11_05', 'Was there harassment or intimidation of Shia Islam by any level of government?', '', '', ''
UNION ALL SELECT 35 , 'GRI_11_06', 'GRI_11_06', 'Was there harassment or intimidation of Islam (unspecified) by any level of government?', '', '', ''
UNION ALL SELECT 36 , 'GRI_11_07', 'GRI_11_07', 'Was there harassment or intimidation of Buddhism by any level of government?', '', '', ''
UNION ALL SELECT 37 , 'GRI_11_08', 'GRI_11_08', 'Was there harassment or intimidation of Hinduism by any level of government?', '', '', ''
UNION ALL SELECT 38 , 'GRI_11_09', 'GRI_11_09', 'Was there harassment or intimidation of Judaism by any level of government?', '', '', ''
UNION ALL SELECT 39 , 'GRI_11_10', 'GRI_11_10', 'Was there harassment or intimidation of other "new" religions (Scientology or Bahai) by any level of government?', '', '', ''
UNION ALL SELECT 40 , 'GRI_11_11', 'GRI_11_11', 'Was there harassment or intimidation of other schismatic Christian sects (Mormons or Jehovah Witnesses) by any level of government?', '', '', ''
UNION ALL SELECT 41 , 'GRI_11_12', 'GRI_11_12', 'Was there harassment or intimidation of other schismatic Muslim sects (Ahmadiyya or Druze) by any level of government?', '', '', ''
UNION ALL SELECT 42 , 'GRI_11_13', 'GRI_11_13', 'Was there harassment or intimidation of other ethnic or tribal religions (Voodoo or Witchcraft) by any level of government?', '', '', ''
UNION ALL SELECT 43 , 'GRI_11_14', 'GRI_11_14', 'Was there harassment or intimidation of other ancient religions (Zoroastrianism or Sikhs) by any level of government?', '', '', ''
UNION ALL SELECT 44 , 'GRI_11_15', 'GRI_11_15', 'Was there harassment or intimidation of Sikhs by any level of government?', '', '', ''
UNION ALL SELECT 45 , 'GRI_11_16', 'GRI_11_16', 'Was there harassment or intimidation of other ancient religions (Zoroastrianism) by any level of government?', '', '', ''
UNION ALL SELECT 46 , 'GRI_11_17', 'GRI_11_17', 'Was there harassment or intimidation of atheists by any level of government?', '', '', ''
UNION ALL SELECT 47 , 'GRI_11_xG1', 'GRI_11_xG1', 'Was there harassment or intimidation of Christianity by any level of government?', '', '', ''
UNION ALL SELECT 48 , 'GRI_11_xG2', 'GRI_11_xG2', 'Was there harassment or intimidation of Islam by any level of government?', '', '', ''
UNION ALL SELECT 49 , 'GRI_11_xG3', 'GRI_11_xG3', 'Was there harassment or intimidation of Buddhism by any level of government?', '', '', ''
UNION ALL SELECT 50 , 'GRI_11_xG4', 'GRI_11_xG4', 'Was there harassment or intimidation of Hinduism by any level of government?', '', '', ''
UNION ALL SELECT 51 , 'GRI_11_xG5', 'GRI_11_xG5', 'Was there harassment or intimidation of Judaism by any level of government?', '', '', ''
UNION ALL SELECT 52 , 'GRI_11_xG6', 'GRI_11_xG6', 'Was there harassment or intimidation of other religions by any level of government?', '', '', ''
UNION ALL SELECT 53 , 'GRI_11_xG7', 'GRI_11_xG7', 'Was there harassment or intimidation of ethnic or tribal religions by any level of government?', '', '', ''
UNION ALL SELECT 54 , 'GRI_12', 'GRI.Q.12', 'Did the national government display hostility involving physical violence toward minority or nonapproved religious groups?', ' ', '', ''
UNION ALL SELECT 55 , 'GRI_13', 'GRI.Q.13', 'Where there instances when the national government did not intervene in cases of discrimination or abuses against religious groups?', ' ', '', ''
UNION ALL SELECT 56 , 'GRI_14', 'GRI.Q.14', 'Does the national government have an established organization to regulate or manage religious affairs?', ' ', '', ''
UNION ALL SELECT 57 , 'GRI_15', 'GRI.Q.15', 'Did the national government denounce one or more religious groups by characterizing them as dangerous "cults" or "sects"?', ' ', '', ''
UNION ALL SELECT 58 , 'GRI_16', 'GRI_16', 'Does any level of government formally ban any religious group?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 59 , 'GRI_16_ny', 'GRI.Q.16', 'Does any level of government formally ban any religious group?', ' ', '', ''
UNION ALL SELECT 60 , 'GRI_16_01', 'GRI_16_01', 'List group(s) banned by  any level of government.', '', '', ''
UNION ALL SELECT 61 , 'GRI_17', 'GRI.Q.17', 'Were there instances when the national government attempted to eliminate an entire religious group's presence in the country?', ' ', '', ''
UNION ALL SELECT 62 , 'GRI_18', 'GRI.Q.18', 'Did any level of government ask religious groups to register for any reason, including to be eligible for benefits such as tax exemption?', ' ', '', ''
UNION ALL SELECT 63 , 'GRI_19', 'GRI_19', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 64 , 'GRI_19_filter', 'GRI_19_filter', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', '', '', ''
UNION ALL SELECT 65 , 'GRI_19_ny', 'GRI.Q.19', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', ' ', '', ''
UNION ALL SELECT 66 , 'GRI_19_summ_ny', 'GRI.Q.19b', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', 'Percentages add to more than 100 because countries can have multiple types of cases of government force.
^ This line represents the number or percentage of countries in which at least one of the following types of government force occurred.', '', ''
UNION ALL SELECT 67 , 'GRI_19_x', 'GRI_19_x', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', '', '', ''
UNION ALL SELECT 68 , 'GRI_19_b', 'GRI_19_b', 'Was property damaged, due to religion, as a result of any level of government action or policy?', '', '', ''
UNION ALL SELECT 69 , 'GRI_19_c', 'GRI_19_c', 'Were there detentions or abductions, due to religion, as a result of any level of government action or policy?', '', '', ''
UNION ALL SELECT 70 , 'GRI_19_d', 'GRI_19_d', 'Were individuals displaced from their homes, due to religion, by any level of government action or policy?', '', '', ''
UNION ALL SELECT 71 , 'GRI_19_e', 'GRI_19_e', 'Were there physical assaults, due to religion, motivated by any level of government action or policy in this country?', '', '', ''
UNION ALL SELECT 72 , 'GRI_19_f', 'GRI_19_f', 'Were there deaths, due to religion, motivated by any level of government action or policy in this country?', '', '', ''
UNION ALL SELECT 73 , 'GRI_19_da', 'GRI_19_da', 'Were individuals internally displaced, due to religion, by any level of government action or policy?', '', '', ''
UNION ALL SELECT 74 , 'GRI_19_db', 'GRI_19_db', 'Were individuals displaced to another country, due to religion, by any level of government action or policy?', '', '', ''
UNION ALL SELECT 75 , 'GRI_20', 'GRI_20', 'Do some religious groups receive government support or favors, such as funding, official recognition or special access?', '', '', ''
UNION ALL SELECT 76 , 'GRI_20_top', 'GRI.Q.20', 'Do some religious groups receive government support or favors, such as funding, official recognition or special access?', 'This is a summary table that puts the restrictions identified in Questions 20.1, 20.2, 20.3a-c, 20.4, and 20.5 into a single measure indicating the level to which a government supports religious groups in the country.
Government support of a religion or religions is considered restrictive only when preferential treatment of one or more religious groups puts other religious groups at a disadvantage. ', '', ''
UNION ALL SELECT 77 , 'GRI_20_01', 'GRI.Q.20.1', 'Does the country''s constitution or basic law recognize a favored religion or religions?', 'This question is a component of GRI.Q.20.
For GRI.Q.20.1, the differences between the coding periods may not be as significant as they appear due to minor changes in coding procedures.', '', ''
UNION ALL SELECT 78 , 'GRI_20_01x_01a', 'GRI_20_01x_01a', 'Is Orthodox Christianity recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 79 , 'GRI_20_01x_01b', 'GRI_20_01x_01b', 'Is Catholic Christianity recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 80 , 'GRI_20_01x_02', 'GRI_20_01x_02', 'Is Protestant/Anglican Christianity recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 81 , 'GRI_20_01x_03', 'GRI_20_01x_03', 'Is Christianity (unspecified) recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 82 , 'GRI_20_01x_04', 'GRI_20_01x_04', 'Is Sunni Islam recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 83 , 'GRI_20_01x_05', 'GRI_20_01x_05', 'Is Shia Islam recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 84 , 'GRI_20_01x_06', 'GRI_20_01x_06', 'Is Islam (unspecified) recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 85 , 'GRI_20_01x_07', 'GRI_20_01x_07', 'Is Buddhism recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 86 , 'GRI_20_01x_08', 'GRI_20_01x_08', 'Is Hinduism recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 87 , 'GRI_20_01x_09', 'GRI_20_01x_09', 'Is Judaism recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 88 , 'GRI_20_01x_10', 'GRI_20_01x_10', 'Are other religions recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 89 , 'GRI_20_02', 'GRI.Q.20.2', 'Do all religious groups receive the same level of government access and privileges?', 'This question is a component of GRI.Q.20.', '', ''
UNION ALL SELECT 90 , 'GRI_20_03_top', 'GRI.Q.20.3', 'Does any level of government provide funds or other resources to religious groups?', 'This question is a component of GRI.Q.20.
This is a summary table that puts the restrictions identified in Questions 20.3a-c into a single measure indicating the level to which a government supports religious groups in the country.
Government support of a religion or religions is considered restrictive only when preferential treatment of one or more religious groups puts other religious groups at a disadvantage.', '', ''
UNION ALL SELECT 91 , 'GRI_20_03_a', 'GRI.Q.20.3.a', 'Does any level of government provide funds or other resources for religious education programs and/or religious schools?', 'This question is a component of GRI.Q.20.3.', '', ''
UNION ALL SELECT 92 , 'GRI_20_03_b', 'GRI.Q.20.3.b', 'Does any level of government provide funds or other resources for religious property (e.g., buildings, upkeep, repair or land)?', 'This question is a component of GRI.Q.20.3.', '', ''
UNION ALL SELECT 93 , 'GRI_20_03_c', 'GRI.Q.20.3.c', 'Does any level of government provide funds or other resources for religious activities other than education or property?', 'This question is a component of GRI.Q.20.3.', '', ''
UNION ALL SELECT 94 , 'GRI_20_04', 'GRI.Q.20.4', 'Is religious education required in public schools?', 'This question is a component of GRI.Q.20.', '', ''
UNION ALL SELECT 95 , 'GRI_20_04_x', 'GRI_20_04_x', 'Is religious education offered in public schools?', '', '', ''
UNION ALL SELECT 96 , 'GRI_20_05', 'GRI.Q.20.5', 'Does the national government defer in some way to religious authorities, texts or doctrines on legal issues?', 'This question is a component of GRI.Q.20.', '', ''
UNION ALL SELECT 97 , 'GRI_20_05_x', 'GRI_20_05_x', 'Have provisions of sharia law been adopted in the country?', '', '', ''
UNION ALL SELECT 98 , 'GRI_20_05_x1', 'GRI_20_05_x1', 'Have provisions of sharia law been adopted in the province?', '', '', ''
UNION ALL SELECT 99 , 'SHI_01', 'SHI.Q.1', 'Were there crimes, malicious acts or violence motivated by religious hatred or bias?', 'This is a summary table that captures the hostilities identified in questions 1.a-f into a single measure indicating the severity of religious hatred or bias in each country.
If one type of hostility occurred the country received 1/6 point for that year. Countries can have multiple types of hostilities. The scores on this question are cumulative; a country with three types of malicious acts would score 0.50 for that period and a country with all six types in any of both years would score 1.00.', '', ''
UNION ALL SELECT 100 , 'SHI_01_summary_a_ny', 'SHI.Q.1a', 'Were there crimes, malicious acts or violence motivated by religious hatred or bias?', 'This is a summary table that captures the hostilities identified in questions 1.a-f indicating the types of religious hatred or bias.
Percentages add to more than 100 because countries can have multiple types of hostilities.
^ This line represents the number or percentage of countries in which at least one of the following hostilities occurred.', '', ''
UNION ALL SELECT 101 , 'SHI_01_summary_a', 'SHI_01_summary_a', 'Were there crimes, malicious acts or violence motivated by religious hatred or bias?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 102 , 'SHI_01_summary_b', 'SHI.Q.1b', 'How many different types of crimes, malicious acts or violence motivated by religious hatred or bias occured? The six different types considered include: harassment/intimidation, property damage, detentions/abductions, displacement from homes, physcal assaults and killings.', 'This is a summary table that captures the different types of hostilities into a single measure indicating the severity of religious hatred or bias.', '', ''
UNION ALL SELECT 103 , 'SHI_01_x', 'SHI_01_x', 'Did individuals face harassment or intimidation motivated by religious hatred or bias?', '', '', ''
UNION ALL SELECT 104 , 'SHI_01_a_dummy', 'SHI.Q.1a', 'Did individuals face harassment or intimidation motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 105 , 'SHI_01_b_dummy', 'SHI.Q.1b', 'Was property damaged as a result of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 106 , 'SHI_01_c_dummy', 'SHI.Q.1c', 'Were there detentions or abductions motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 107 , 'SHI_01_d_dummy', 'SHI.Q.1d', 'Were individuals displaced from their homes because of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 108 , 'SHI_01_e_dummy', 'SHI.Q.1e', 'Were there physical assaults motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 109 , 'SHI_01_f_dummy', 'SHI.Q.1f', 'Were there deaths motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 110 , 'SHI_01_a', 'SHI.Q.1a', 'Did individuals face harassment or intimidation motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 111 , 'SHI_01_x_01a', 'SHI_01_x_01a', 'Has there been any alleged harassment of Orthodox Christianity by social groups?', '', '', ''
UNION ALL SELECT 112 , 'SHI_01_x_01b', 'SHI_01_x_01b', 'Has there been any alleged harassment of Catholic Christianity by social groups?', '', '', ''
UNION ALL SELECT 113 , 'SHI_01_x_02', 'SHI_01_x_02', 'Has there been any alleged harassment of Protestant/Anglican Christianity by social groups?', '', '', ''
UNION ALL SELECT 114 , 'SHI_01_x_03', 'SHI_01_x_03', 'Has there been any alleged harassment of Christianity (unspecified) by social groups?', '', '', ''
UNION ALL SELECT 115 , 'SHI_01_x_04', 'SHI_01_x_04', 'Has there been any alleged harassment of Sunni Islam by social groups?', '', '', ''
UNION ALL SELECT 116 , 'SHI_01_x_05', 'SHI_01_x_05', 'Has there been any alleged harassment of Shia Islam by social groups?', '', '', ''
UNION ALL SELECT 117 , 'SHI_01_x_06', 'SHI_01_x_06', 'Has there been any alleged harassment of Islam (unspecified) by social groups?', '', '', ''
UNION ALL SELECT 118 , 'SHI_01_x_07', 'SHI_01_x_07', 'Has there been any alleged harassment of Buddhism by social groups?', '', '', ''
UNION ALL SELECT 119 , 'SHI_01_x_08', 'SHI_01_x_08', 'Has there been any alleged harassment of Hinduism by social groups?', '', '', ''
UNION ALL SELECT 120 , 'SHI_01_x_09', 'SHI_01_x_09', 'Has there been any alleged harassment of Judaism by social groups?', '', '', ''
UNION ALL SELECT 121 , 'SHI_01_x_10', 'SHI_01_x_10', 'Has there been any alleged harassment of other "new" religions (Scientology or Bahai) by social groups?', '', '', ''
UNION ALL SELECT 122 , 'SHI_01_x_11', 'SHI_01_x_11', 'Has there been any alleged harassment of other schismatic Christian sects (Mormons or Jehovah Witnesses) by social groups?', '', '', ''
UNION ALL SELECT 123 , 'SHI_01_x_12', 'SHI_01_x_12', 'Has there been any alleged harassment of other schismatic Muslim sects (Ahmadiyya or Druze) by social groups?', '', '', ''
UNION ALL SELECT 124 , 'SHI_01_x_13', 'SHI_01_x_13', 'Has there been any alleged harassment of other ethnic or tribal religions (Voodoo or Witchcraft) by social groups?', '', '', ''
UNION ALL SELECT 125 , 'SHI_01_x_14', 'SHI_01_x_14', 'Has there been any alleged harassment of other ancient religions (Zoroastrianism or Sikhs) by social groups?', '', '', ''
UNION ALL SELECT 126 , 'SHI_01_x_15', 'SHI_01_x_15', 'Has there been any alleged harassment of Sikhs by social groups?', '', '', ''
UNION ALL SELECT 127 , 'SHI_01_x_16', 'SHI_01_x_16', 'Has there been any alleged harassment of other ancient religions (Zoroastrianism) by social groups?', '', '', ''
UNION ALL SELECT 128 , 'SHI_01_x_17', 'SHI_01_x_17', 'Has there been any alleged harassment of atheists by social groups?', '', '', ''
UNION ALL SELECT 129 , 'SHI_01_xG1', 'SHI_01_xG1', 'Has there been any alleged harassment of Christianity by social groups?', '', '', ''
UNION ALL SELECT 130 , 'SHI_01_xG2', 'SHI_01_xG2', 'Has there been any alleged harassment of Islam by social groups?', '', '', ''
UNION ALL SELECT 131 , 'SHI_01_xG3', 'SHI_01_xG3', 'Has there been any alleged harassment of Buddhism by social groups?', '', '', ''
UNION ALL SELECT 132 , 'SHI_01_xG4', 'SHI_01_xG4', 'Has there been any alleged harassment of Hinduism by social groups?', '', '', ''
UNION ALL SELECT 133 , 'SHI_01_xG5', 'SHI_01_xG5', 'Has there been any alleged harassment of Judaism by social groups?', '', '', ''
UNION ALL SELECT 134 , 'SHI_01_xG6', 'SHI_01_xG6', 'Has there been any alleged harassment of other religions by social groups?', '', '', ''
UNION ALL SELECT 135 , 'SHI_01_xG7', 'SHI_01_xG7', 'Has there been any alleged harassment of ethnic or tribal religions by social groups?', '', '', ''
UNION ALL SELECT 136 , 'SHI_01_b', 'SHI.Q.1b', 'Was property damaged as a result of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 137 , 'SHI_01_c', 'SHI.Q.1c', 'Were there detentions or abductions motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 138 , 'SHI_01_d', 'SHI.Q.1d', 'Were individuals displaced from their homes because of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 139 , 'SHI_01_e', 'SHI.Q.1e', 'Were there physical assaults motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 140 , 'SHI_01_f', 'SHI.Q.1f', 'Were there deaths motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 141 , 'SHI_01_da', 'SHI_01_da', 'Were individuals internally displaced because of religious hatred or bias?', '', '', ''
UNION ALL SELECT 142 , 'SHI_01_db', 'SHI_01_db', 'Were individuals displaced to another country because of religious hatred or bias?', '', '', ''
UNION ALL SELECT 143 , 'SHI_02', 'SHI.Q.2', 'Was there mob violence related to religion?', ' ', '', ''
UNION ALL SELECT 144 , 'SHI_02_01', 'SHI_02_01', 'Was there "ethnic cleansing" or "genocide" related to religion?', '', '', ''
UNION ALL SELECT 145 , 'SHI_03', 'SHI.Q.3', 'Were there acts of sectarian or communal violence between religious groups?', ' Sectarian or communal violence involves two or more religious groups facing off in repeated clashes.', '', ''
UNION ALL SELECT 146 , 'SHI_04', 'SHI_04', 'Were religion-related terrorist groups active in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 147 , 'SHI_04_filter', 'SHI_04_filter', 'Were religion-related terrorist groups active in the country?', '', '', ''
UNION ALL SELECT 148 , 'SHI_04_ny', 'SHI.Q.4', 'Were religion-related terrorist groups active in the country?', 'Religion-related terrorism is defined as politically motivated violence agaisnt noncombatants by subnational groups or clandestine agents with a religious justification or intent. 
Some of the increase in religion-related terrorism between the year ending in mid-2007 and the year ending in mid-2009 could reflect the use of new source material providing greater detail on terrorist activities than was provided by sources used in the baseline report.', '', ''
UNION ALL SELECT 149 , 'SHI_04_x', 'SHI_04_x', 'How many religion-related terrorist crimes, malicious acts or events of violence were found in the country?', '', '', ''
UNION ALL SELECT 150 , 'SHI_04_b', 'SHI_04_b', 'Was property damaged due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 151 , 'SHI_04_c', 'SHI_04_c', 'Were there detentions or abductions due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 152 , 'SHI_04_d', 'SHI_04_d', 'Were individuals displaced from their homes due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 153 , 'SHI_04_e', 'SHI_04_e', 'Were there physical assaults due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 154 , 'SHI_04_f', 'SHI_04_f', 'Were there deaths due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 155 , 'SHI_04_da', 'SHI_04_da', 'Were individuals internally displaced due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 156 , 'SHI_04_db', 'SHI_04_db', 'Were individuals displaced to another country due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 157 , 'SHI_04_x01', 'SHI_04_x01', 'List the religion-related terrorist groups active in the country.', '', '', ''
UNION ALL SELECT 158 , 'SHI_05', 'SHI_05', 'Was there a religion-related war or armed conflict in the country (including ongoing displacements from previous wars)?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 159 , 'SHI_05_filter', 'SHI_05_filter', 'Was there a religion-related war or armed conflict in the country (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 160 , 'SHI_05_ny', 'SHI.Q.5', 'Was there a religion-related war or armed conflict in the country?', 'Religion-related war is defined as armed conflict (involving sustained casualties over time or more than 1,000 battle deaths) in which religious rhetoric is commonly employed to justify the use of force, or in which one or more of the combatants primarily identifies itself or the opposings side by religion. 
Some of the increase shown above for 2011 reflects ongoing displacements that were not coded in previous years, including the religion-related conflicts in such places as Cyprus.', '', ''
UNION ALL SELECT 161 , 'SHI_05_x', 'SHI_05_x', 'How many religion-related war  crimes, malicious acts or events of violence were found in the country?', '', '', ''
UNION ALL SELECT 162 , 'SHI_05_b', 'SHI_05_b', 'By province, count the number of people who, due to religion, had property damaged/defaced or destroyed during a religiously-related war/revolution/armed conflict', '', '', ''
UNION ALL SELECT 163 , 'SHI_05_c', 'SHI_05_c', 'Were there detentions or abductions due to religion-related war or armed conflict?', '', '', ''
UNION ALL SELECT 164 , 'SHI_05_d', 'SHI_05_d', 'Were individuals displaced from their homes due to religion-related war or armed conflict (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 165 , 'SHI_05_e', 'SHI_05_e', 'Were there physical assaults due to religion-related war or armed conflict?', '', '', ''
UNION ALL SELECT 166 , 'SHI_05_f', 'SHI_05_f', 'Were there deaths due to religion-related war or armed conflict?', '', '', ''
UNION ALL SELECT 167 , 'SHI_05_da', 'SHI_05_da', 'Were individuals internally displaced due to religion-related war or armed conflict (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 168 , 'SHI_05_db', 'SHI_05_db', 'Were individuals displaced to another country due to religion-related war or armed conflict (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 169 , 'SHI_06', 'SHI.Q.6', 'Did violence result from tensions between religious groups?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 170 , 'SHI_07', 'SHI_07', 'Did organized groups use force or coercion in an attempt to dominate public life with their perspective on religion, including preventing some religious groups from operating in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 171 , 'SHI_07_ny', 'SHI.Q.7', 'Did organized groups use force or coercion in an attempt to dominate public life with their perspective on religion, including preventing some religious groups from operating in the country?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 172 , 'SHI_08', 'SHI.Q.8', 'Did religious groups themselves attempt to prevent other religious groups from being able to operate?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 173 , 'SHI_09', 'SHI.Q.9', 'Did individuals or groups use violence or the threat of violence, including so-called honor killings, to try to enforce religious norms?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 174 , 'SHI_10', 'SHI.Q.10', 'Were individuals assaulted or displaced from their homes in retaliation for religious activities, including preaching and other forms of religious expression, considered offensive or threatening to the majority faith?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 175 , 'SHI_11_for_index', 'SHI.Q.11', 'Were women harassed for violating religious dress codes?', 'The data for each year also takes into account information from the two previous years. ', '', ''
UNION ALL SELECT 176 , 'SHI_11', 'SHI_11', 'Were women harassed for violating religious dress codes?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 177 , 'SHI_11_x', 'SHI_11_x', 'Are women socially discriminated against or harassed due to violating religious norms or precepts, including being harassed for violating religious dress codes?', '', '', ''
UNION ALL SELECT 178 , 'SHI_12', 'SHI.Q.12', 'Were there incidents of hostility over proselytizing?', 'The data for each year also takes into account information from the two previous years. ', '', ''
UNION ALL SELECT 179 , 'SHI_13', 'SHI.Q.13', 'Were there incidents of hostility over conversions from one religion to another?', 'The data for each year also takes into account information from the two previous years. ', '', ''
UNION ALL SELECT 180 , 'GRX_21_01', 'GRX_21_01', 'Did religious issues trigger the use of force toward religious individuals or groups by government actors?', '', '', ''
UNION ALL SELECT 181 , 'GRX_21_02', 'GRX_21_02', 'Did political issues trigger the use of force toward religious individuals or groups by government actors?', '', '', ''
UNION ALL SELECT 182 , 'GRX_21_03', 'GRX_21_03', 'Did other socio-economic isues trigger the use of force toward religious individuals or groups by government actors?', '', '', ''
UNION ALL SELECT 183 , 'GRX_22_filter', 'GRX_22_filter', 'Does any level of government penalize the defamation of religion, including penalizing such things as blasphemy, apostasy, and criticism or critiques of a religion or religions?', '', '', ''
UNION ALL SELECT 184 , 'GRX_22_ny', 'Additional Question 1', 'Does any level of government penalize the defamation of religion, including penalizing such things as blasphemy, apostasy, and criticism or critiques of a religion or religions?', 'Additional Question 1 was only coded beginning with the year ending in mid-2009.', '', ''
UNION ALL SELECT 185 , 'GRX_22', 'GRX_22', 'Does any level of government penalize the defamation of religion, including penalizing such things as blasphemy, apostasy, and criticism or critiques of a religion or religions?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 186 , 'GRX_22_01', 'GRX_22_01', 'Does any level of government penalize blasphemy?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 187 , 'GRX_22_01_ny', 'Additional Question 1a', 'Does any level of government penalize blasphemy?', 'This question is a component of the Additional Question 1.
Additional Question 1a is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 188 , 'GRX_22_02', 'GRX_22_02', 'Does any level of government penalize apostasy?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 189 , 'GRX_22_02_ny', 'Additional Question 1b', 'Does any level of government penalize apostasy?', 'This question is a component of the Additional Question 1.
Additional Question 1b is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 190 , 'GRX_22_03', 'GRX_22_03', 'Does any level of government penalize hate speech about a religion or religions?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 191 , 'GRX_22_04_ny', 'Additional Question 1c', 'Does any level of government penalize criticism or critiques of a religion or religions?', 'This question is a component of the Additional Question 1.
Additional Question 1c is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 192 , 'GRX_22_03_ny', 'Additional Question 2', 'Does any level of government penalize hate speech about a religion or religions?', 'Additional Question 2 is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 193 , 'GRX_22_04', 'GRX_22_04', 'Does any level of government penalize criticism or critiques of a religion or religions?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 194 , 'XSG_25n27_ny', 'Additional Question 3', 'Did events, groups or individuals from outside the country contribute to government restrictions on religion or social hostilities involving religion in the country?', 'Additional Question 3 is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 195 , 'GRX_23', 'GRX_23', 'Are public expressions of faith or religiously based socio-political arguments restricted by any level of government?', '', '', ''
UNION ALL SELECT 196 , 'GRX_25_ny', 'Additional Question 3a', 'Did events, groups or individuals from outside the country contribute to government restrictions on religion in the country?', 'This question is a component of the Additional Question 3.
Additional Question 3a is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 197 , 'GRX_25_01', 'GRX_25_01', 'Did events, groups or individuals from outside the country contribute to government restrictions on religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 198 , 'GRX_25_02', 'GRX_25_02', 'Did events, groups or individuals from outside the country, which were entirely outside the country, contribute to government restrictions on religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 199 , 'GRX_25_03', 'GRX_25_03', 'Did events, groups or individuals from outside the country, which were in the country, contribute to government restrictions on religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 200 , 'SHX_27_ny', 'Additional Question 3b', 'Did events, groups or individuals from outside the country contribute to social hostilities involving religion in the country?', 'This question is a component of the Additional Question 3.
Additional Question 3b is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 201 , 'SHX_27_01', 'SHX_27_01', 'Did events, groups or individuals from outside the country contribute to social hostilities involving religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 202 , 'SHX_27_02', 'SHX_27_02', 'Did events, groups or individuals from outside the country, which were entirely outside the country, contribute to social hostilities involving religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 203 , 'SHX_27_03', 'SHX_27_03', 'Did events, groups or individuals from outside the country, which were in the country, contribute to social hostilities involving religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 204 , 'XSG_242526_ny', 'Additional Question 4', 'Was there discrimination, harassment or violence in the country related to immigrants, in whole or part because of religion?', 'Additional Question 4 is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 205 , 'GRX_24_ny', 'Additional Question 4a', 'Did any level of government discriminate against, harass or use physical force toward immigrants or those seeking to immigrate in whole or part because of the immigrants'' religion?', 'This question is a component of the Additional Question 4.
Additional Question 4a is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 206 , 'GRX_24', 'GRX_24', 'Did any level of government discriminate against, harass or use physical force toward immigrants or those seeking to immigrate in whole or part because of the immigrants'' religion?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 207 , 'SHX_25_ny', 'Additional Question 4b', 'Did individuals or groups in society discriminate against, harass or commit acts of violence toward immigrants or those seeking to immigrate in whole or part because of the immigrants' religion?', 'This question is a component of the Additional Question 4.
Additional Question 4b is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 208 , 'SHX_25', 'SHX_25', 'Did individuals or groups in society discriminate against, harass or commit acts of violence toward immigrants or those seeking to immigrate in whole or part because of the immigrants' religion?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 209 , 'SHX_26_ny', 'Additional Question 4c', 'Did immigrants in the country engage in religion-related acts of violence?', 'This question is a component of the Additional Question 4.
Additional Question 4c is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 210 , 'SHX_26', 'SHX_26', 'Did immigrants in the country engage in religion-related acts of discrimination, harassment or violence?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 211 , 'GRX_26_01', 'GRX_26_01', 'Did religion-related armed conflict that crosses a border contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 212 , 'GRX_26_02', 'GRX_26_02', 'Did religion-related terrorism with cross-border ties or acts contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 213 , 'GRX_26_03', 'GRX_26_03', 'Did the influence of foreign governments contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 214 , 'GRX_26_04', 'GRX_26_04', 'Did problems involving international immigrants contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 215 , 'GRX_26_05', 'GRX_26_05', 'Did extremist influences (alleged or real) contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 216 , 'GRX_26_06', 'GRX_26_06', 'Did hostile reactions to foreign (non-citizen) preachers contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 217 , 'GRX_26_07', 'GRX_26_07', 'Did hostile reactions to incidents that occurred in other countries contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 218 , 'GRX_26_08', 'GRX_26_08', 'Did other events, groups or individuals from outside the country contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 219 , 'GRX_27_01', 'GRX_27_01', 'There is no reported initiative that aimed to help improve respect for religious freedom in the country.', '', '', ''
UNION ALL SELECT 220 , 'GRX_27_02', 'GRX_27_02', 'Were initiatives reported at the local level that aimed to help improve respect for religious freedom in the country?', '', '', ''
UNION ALL SELECT 221 , 'GRX_27_03', 'GRX_27_03', 'Were initiatives reported at the national level that aimed to help improve respect for religious freedom in the country?', '', '', ''
UNION ALL SELECT 222 , 'GRX_28_01', 'GRX_28_01', 'There is no reported improvement in the respect for religious freedom by any level of the government.', '', '', ''
UNION ALL SELECT 223 , 'GRX_28_02', 'GRX_28_02', 'Was there an improvement reported at the local level in the respect for religious freedom by any level of the government?', '', '', ''
UNION ALL SELECT 224 , 'GRX_28_03', 'GRX_28_03', 'Was there an improvement reported at the national level in the respect for religious freedom by any level of the government?', '', '', ''
UNION ALL SELECT 225 , 'GRX_29_01', 'GRX_29_01', 'Were initiatives or actions reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 226 , 'GRX_29_02', 'GRX_29_02', 'Were interfaith dialogues reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 227 , 'GRX_29_03', 'GRX_29_03', 'Were antidiscrimination policies of actions reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 228 , 'GRX_29_04', 'GRX_29_04', 'Were educational and training initiatives reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 229 , 'GRX_29_05', 'GRX_29_05', 'Were land and property initiatives reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 230 , 'SHX_14_01', 'SHX_14_01', 'Did a reaction to religious issues trigger the nongovernmental violence related to religion?', '', '', ''
UNION ALL SELECT 231 , 'SHX_14_02', 'SHX_14_02', 'Did a reaction to political issues trigger the nongovernmental violence related to religion?', '', '', ''
UNION ALL SELECT 232 , 'SHX_14_03', 'SHX_14_03', 'Did a reaction to other socio-economic issues trigger the nongovernmental violence related to religion?', '', '', ''
UNION ALL SELECT 233 , 'SHX_14_04', 'SHX_14_04', 'Sources do not specify the immediate triggering situation that led to the nongovernmental violence related to religion.', '', '', ''
UNION ALL SELECT 234 , 'SHX_15_01', 'SHX_15_01', 'Did Christians harass Christians?', '', '', ''
UNION ALL SELECT 235 , 'SHX_15_02', 'SHX_15_02', 'Did Christians harass Muslims?', '', '', ''
UNION ALL SELECT 236 , 'SHX_15_03', 'SHX_15_03', 'Did Christians harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 237 , 'SHX_15_04', 'SHX_15_04', 'Did Muslims harass Muslims?', '', '', ''
UNION ALL SELECT 238 , 'SHX_15_05', 'SHX_15_05', 'Did Muslims harass Christians?', '', '', ''
UNION ALL SELECT 239 , 'SHX_15_06', 'SHX_15_06', 'Did Muslims harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 240 , 'SHX_15_07', 'SHX_15_07', 'Did non-specifically identified group(s) harass Christians?', '', '', ''
UNION ALL SELECT 241 , 'SHX_15_08', 'SHX_15_08', 'Did non-specifically identified group(s) harass Muslims?', '', '', ''
UNION ALL SELECT 242 , 'SHX_15_09', 'SHX_15_09', 'Did non-specifically identified group(s) harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 243 , 'SHX_15_10', 'SHX_15_10', 'Did followers of religion(s) other than Christianity or Islam harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 244 , 'SHX_28_01', 'SHX_28_01', 'Did religion-related armed conflict that crosses a border contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 245 , 'SHX_28_02', 'SHX_28_02', 'Did religion-related terrorism with cross-border ties or acts contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 246 , 'SHX_28_03', 'SHX_28_03', 'Did the influence of foreign governments contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 247 , 'SHX_28_04', 'SHX_28_04', 'Did problems involving international immigrants contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 248 , 'SHX_28_05', 'SHX_28_05', 'Did extremist influences (alleged or real) contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 249 , 'SHX_28_06', 'SHX_28_06', 'Did hostile reactions to foreign (non-citizen) preachers contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 250 , 'SHX_28_07', 'SHX_28_07', 'Did hostile reactions to incidents that occurred in other countries contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 251 , 'SHX_28_08', 'SHX_28_08', 'Did other events, groups or individuals from outside the country contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 252 , 'XSG_01_xG1', 'XSG_01_xG1', 'Has there been any alleged harassment of Christianity by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 253 , 'XSG_01_xG2', 'XSG_01_xG2', 'Has there been any alleged harassment of Islam by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 254 , 'XSG_01_xG3', 'XSG_01_xG3', 'Has there been any alleged harassment of Buddhism by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 255 , 'XSG_01_xG4', 'XSG_01_xG4', 'Has there been any alleged harassment of Hinduism by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 256 , 'XSG_01_xG5', 'XSG_01_xG5', 'Has there been any alleged harassment of Judaism by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 257 , 'XSG_01_xG6', 'XSG_01_xG6', 'Has there been any alleged harassment of other religions by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 258 , 'XSG_01_xG7', 'XSG_01_xG7', 'Has there been any alleged harassment of ethnic or tribal religions by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 259 , 'XSG_24', 'XSG_24', 'Is there a police force that enforces religious norms?', '', '', ''
UNION ALL SELECT 260 , 'XSG_S_01', 'XSG_S_01', 'Was the country Constitution used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 261 , 'XSG_S_02', 'XSG_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 262 , 'XSG_S_03', 'XSG_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 263 , 'XSG_S_04', 'XSG_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 264 , 'XSG_S_05', 'XSG_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 265 , 'XSG_S_06', 'XSG_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 266 , 'XSG_S_07', 'XSG_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 267 , 'XSG_S_08', 'XSG_S_08', 'Was the Freedom House report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 268 , 'XSG_S_09', 'XSG_S_09', 'Was the Human Rights Watch topical report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 269 , 'XSG_S_10', 'XSG_S_10', 'Was the International Crisis Group country report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 270 , 'XSG_S_11', 'XSG_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 271 , 'XSG_S_12', 'XSG_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 272 , 'XSG_S_13', 'XSG_S_13', 'Was the Council of the European Union annual report on human rights used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 273 , 'XSG_S_14', 'XSG_S_14', 'Was the Amnesty International report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 274 , 'XSG_S_15', 'XSG_S_15', 'Was the European Network Against Racism Shadow Report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 275 , 'XSG_S_16', 'XSG_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 276 , 'XSG_S_17', 'XSG_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 277 , 'XSG_S_18', 'XSG_S_18', 'Was the TBC source on terrorism used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 278 , 'XSG_S_19', 'XSG_S_19', 'Was the Anti-Defamation League report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 279 , 'XSG_S_20', 'XSG_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 280 , 'XSG_S_21', 'XSG_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 281 , 'XSG_S_22', 'XSG_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 282 , 'XSG_S_23', 'XSG_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 283 , 'XSG_S_99_filter', 'XSG_S_99_filter', 'How many other sources were used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 284 , 'XSG_S_99_01', 'XSG_S_99_01', 'Was any other source [1] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 285 , 'XSG_S_99_02', 'XSG_S_99_02', 'Was any other source [2] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 286 , 'XSG_S_99_03', 'XSG_S_99_03', 'Was any other source [3] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 287 , 'XSG_S_99_04', 'XSG_S_99_04', 'Was any other source [4] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 288 , 'XSG_S_99_05', 'XSG_S_99_05', 'Was any other source [5] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 289 , 'XSG_S_99_06', 'XSG_S_99_06', 'Was any other source [6] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 290 , 'CSR_01', 'CSR_01', 'Does the law guarantee the right to free speech?', '', '', ''
UNION ALL SELECT 291 , 'CSR_02', 'CSR_02', 'Does the law provide for freedom of the press?', '', '', ''
UNION ALL SELECT 292 , 'CSR_02_a', 'CSR_02_a', 'Were there cases of self-censorship in response to perceived government pressure or intimidation?', '', '', ''
UNION ALL SELECT 293 , 'CSR_02_b', 'CSR_02_b', 'Were there cases of journalists being harassed by any level of government?', '', '', ''
UNION ALL SELECT 294 , 'CSR_02_c', 'CSR_02_c', 'Were there cases of journalists being arrested or detained by any level of government?', '', '', ''
UNION ALL SELECT 295 , 'CSR_02_d', 'CSR_02_d', 'Were there cases of journalists being killed by any level of government?', '', '', ''
UNION ALL SELECT 296 , 'CSR_03', 'CSR_03', 'Aside from in schools or other institutionalized situations, did the government monitor, censor or ban publications during the year being coded?', '', '', ''
UNION ALL SELECT 297 , 'CSR_03_a', 'CSR_03_a', 'Aside from in schools or other institutionalized situations, did the government monitor publications during the year being coded?', '', '', ''
UNION ALL SELECT 298 , 'CSR_03_b', 'CSR_03_b', 'Aside from in schools or other institutionalized situations, did the government censor publications during the year being coded?', '', '', ''
UNION ALL SELECT 299 , 'CSR_03_c', 'CSR_03_c', 'Aside from in schools or other institutionalized situations, did the government ban publications during the year being coded?', '', '', ''
UNION ALL SELECT 300 , 'CSR_04', 'CSR_04', 'Aside from in schools or other institutionalized situations, did the government monitor, censor or restrict access to the Internet during the year being coded?', '', '', ''
UNION ALL SELECT 301 , 'CSR_04_a', 'CSR_04_a', 'Aside from in schools or other institutionalized situations, did the government monitor access to the Internet during the year being coded?', '', '', ''
UNION ALL SELECT 302 , 'CSR_04_b', 'CSR_04_b', 'Aside from in schools or other institutionalized situations, did the government censor access to the Internet during the year being coded?', '', '', ''
UNION ALL SELECT 303 , 'CSR_04_c', 'CSR_04_c', 'Aside from in schools or other institutionalized situations, did the government restrict access to the Internet during the year being coded?', '', '', ''
UNION ALL SELECT 304 , 'CSR_05', 'CSR_05', 'Aside from in schools or other institutionalized situations, are there legal or policy limits of freedom of association?', '', '', ''
UNION ALL SELECT 305 , 'CSR_06', 'CSR_06', 'Aside from in schools or other institutionalized situations, are there legal or policy limits of freedom of assembly?', '', '', ''
UNION ALL SELECT 306 , 'CSR_S_01', 'CSR_S_01', 'Was the country Constitution used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 307 , 'CSR_S_02', 'CSR_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 308 , 'CSR_S_03', 'CSR_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 309 , 'CSR_S_04', 'CSR_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 310 , 'CSR_S_05', 'CSR_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 311 , 'CSR_S_06', 'CSR_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 312 , 'CSR_S_07', 'CSR_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 313 , 'CSR_S_08', 'CSR_S_08', 'Was the Freedom House report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 314 , 'CSR_S_09', 'CSR_S_09', 'Was the Human Rights Watch topical report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 315 , 'CSR_S_10', 'CSR_S_10', 'Was the International Crisis Group country report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 316 , 'CSR_S_11', 'CSR_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 317 , 'CSR_S_12', 'CSR_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 318 , 'CSR_S_13', 'CSR_S_13', 'Was the Council of the European Union annual report on human rights used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 319 , 'CSR_S_14', 'CSR_S_14', 'Was the Amnesty International report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 320 , 'CSR_S_15', 'CSR_S_15', 'Was the European Network Against Racism Shadow Report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 321 , 'CSR_S_16', 'CSR_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 322 , 'CSR_S_17', 'CSR_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 323 , 'CSR_S_18', 'CSR_S_18', 'Was the TBC source on terrorism used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 324 , 'CSR_S_19', 'CSR_S_19', 'Was the Anti-Defamation League report used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 325 , 'CSR_S_20', 'CSR_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 326 , 'CSR_S_21', 'CSR_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 327 , 'CSR_S_22', 'CSR_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 328 , 'CSR_S_23', 'CSR_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 329 , 'CSR_S_24', 'CSR_S_24', 'Was the U.S. Trade Representative Annual Special 301 Report on Intellectual Property Rights used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 330 , 'CSR_S_25', 'CSR_S_25', 'Was the U.S. Country Commercial Guide [current year] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 331 , 'CSR_S_99_01', 'CSR_S_99_01', 'Was any other source [1] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 332 , 'CSR_S_99_02', 'CSR_S_99_02', 'Was any other source [2] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 333 , 'CSR_S_99_03', 'CSR_S_99_03', 'Was any other source [3] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 334 , 'CSR_S_99_04', 'CSR_S_99_04', 'Was any other source [4] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 335 , 'CSR_S_99_05', 'CSR_S_99_05', 'Was any other source [5] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 336 , 'CSR_S_99_06', 'CSR_S_99_06', 'Was any other source [6] used for coding Civil Society Restrictions?', '', '', ''
UNION ALL SELECT 337 , 'ERI_01', 'ERI_01', 'Does the law provide criminal penalties for official corruption?', '', '', ''
UNION ALL SELECT 338 , 'ERI_02', 'ERI_02', 'To what extent does official corruption occur within the country?', '', '', ''
UNION ALL SELECT 339 , 'ERI_03', 'ERI_03', 'Does the government protect intellectual property rights (IPR)?', '', '', ''
UNION ALL SELECT 340 , 'ERI_04', 'ERI_04', 'Is the commercial legal and regulatory system transparent?', '', '', ''
UNION ALL SELECT 341 , 'ERI_05', 'ERI_05', 'Is there a national minimum wage?', '', '', ''
UNION ALL SELECT 342 , 'ERI_06', 'ERI_06', 'Do laws protect the formation of independent unions?', '', '', ''
UNION ALL SELECT 343 , 'ERI_06_a', 'ERI_06_a', 'Are there other laws that significantly qualify or contradict the legal protections of the formation of independent unions?', '', '', ''
UNION ALL SELECT 344 , 'ERI_06_b', 'ERI_06_b', 'Are the laws that protect the formation of independent unions always respected by the government in practice?', '', '', ''
UNION ALL SELECT 345 , 'ERI_06_b_x', 'ERI_06_b_x', 'Is there information on whether the laws that protect the formation of independent unions are respected by the government?', '', '', ''
UNION ALL SELECT 346 , 'ERI_06_c', 'ERI_06_c', 'Does the government controls or significantly interferes with unions?', '', '', ''
UNION ALL SELECT 347 , 'ERI_06_c_x', 'ERI_06_c_x', 'Is there information on whether unions are present in the country?', '', '', ''
UNION ALL SELECT 348 , 'ERI_06_x', 'ERI_06_x', 'Is there information about laws that protect the formation of independent unions?', '', '', ''
UNION ALL SELECT 349 , 'ERI_07', 'ERI_07', 'Do laws protect conducting strikes?', '', '', ''
UNION ALL SELECT 350 , 'ERI_07_a', 'ERI_07_a', 'Are there other laws that significantly qualify or contradict the legal protections of conducting strikes?', '', '', ''
UNION ALL SELECT 351 , 'ERI_07_b', 'ERI_07_b', 'Are the laws that protect conducting strikes always respected by the government in practice?', '', '', ''
UNION ALL SELECT 352 , 'ERI_07_b_x', 'ERI_07_b_x', 'Is there information on whether the laws that protect conducting strikes are respected by the government?', '', '', ''
UNION ALL SELECT 353 , 'ERI_07_c', 'ERI_07_c', 'Does the government controls or significantly interferes with strikes?', '', '', ''
UNION ALL SELECT 354 , 'ERI_07_c_x', 'ERI_07_c_x', 'Is there information on whether strikes occur in the country?', '', '', ''
UNION ALL SELECT 355 , 'ERI_07_x', 'ERI_07_x', 'Is there information about laws that protect conducting strikes?', '', '', ''
UNION ALL SELECT 356 , 'ERI_08', 'ERI_08', 'Do laws protect collective bargaining?', '', '', ''
UNION ALL SELECT 357 , 'ERI_08_a', 'ERI_08_a', 'Are there other laws that significantly qualify or contradict the legal protections of collective bargaining?', '', '', ''
UNION ALL SELECT 358 , 'ERI_08_b', 'ERI_08_b', 'Are the laws laws that protect collective bargaining always respected by the government in practice?', '', '', ''
UNION ALL SELECT 359 , 'ERI_08_b_x', 'ERI_08_b_x', 'Is there information on whether the laws that protect collective bargaining are respected by the government?', '', '', ''
UNION ALL SELECT 360 , 'ERI_08_c', 'ERI_08_c', 'Does the government controls or significantly interferes with collective bargaining?', '', '', ''
UNION ALL SELECT 361 , 'ERI_08_c_x', 'ERI_08_c_x', 'Is there information on whether collective bargaining occurs in the country?', '', '', ''
UNION ALL SELECT 362 , 'ERI_08_x', 'ERI_08_x', 'Is there information about laws that protect collective bargaining?', '', '', ''
UNION ALL SELECT 363 , 'ERI_S_01', 'ERI_S_01', 'Was the country Constitution used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 364 , 'ERI_S_02', 'ERI_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 365 , 'ERI_S_03', 'ERI_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 366 , 'ERI_S_04', 'ERI_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 367 , 'ERI_S_05', 'ERI_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 368 , 'ERI_S_06', 'ERI_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 369 , 'ERI_S_07', 'ERI_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 370 , 'ERI_S_08', 'ERI_S_08', 'Was the Freedom House report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 371 , 'ERI_S_09', 'ERI_S_09', 'Was the Human Rights Watch topical report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 372 , 'ERI_S_10', 'ERI_S_10', 'Was the International Crisis Group country report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 373 , 'ERI_S_11', 'ERI_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 374 , 'ERI_S_12', 'ERI_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 375 , 'ERI_S_13', 'ERI_S_13', 'Was the Council of the European Union annual report on human rights used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 376 , 'ERI_S_14', 'ERI_S_14', 'Was the Amnesty International report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 377 , 'ERI_S_15', 'ERI_S_15', 'Was the European Network Against Racism Shadow Report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 378 , 'ERI_S_16', 'ERI_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 379 , 'ERI_S_17', 'ERI_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 380 , 'ERI_S_18', 'ERI_S_18', 'Was the TBC source on terrorism used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 381 , 'ERI_S_19', 'ERI_S_19', 'Was the Anti-Defamation League report used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 382 , 'ERI_S_20', 'ERI_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 383 , 'ERI_S_21', 'ERI_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 384 , 'ERI_S_22', 'ERI_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 385 , 'ERI_S_23', 'ERI_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 386 , 'ERI_S_24', 'ERI_S_24', 'Was the U.S. Trade Representative Annual Special 301 Report on Intellectual Property Rights used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 387 , 'ERI_S_25', 'ERI_S_25', 'Was the U.S. Country Commercial Guide [current year] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 388 , 'ERI_S_99_01', 'ERI_S_99_01', 'Was any other source [1] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 389 , 'ERI_S_99_02', 'ERI_S_99_02', 'Was any other source [2] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 390 , 'ERI_S_99_03', 'ERI_S_99_03', 'Was any other source [3] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 391 , 'ERI_S_99_04', 'ERI_S_99_04', 'Was any other source [4] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 392 , 'ERI_S_99_05', 'ERI_S_99_05', 'Was any other source [5] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 393 , 'ERI_S_99_06', 'ERI_S_99_06', 'Was any other source [6] used for coding Economic Regulation?', '', '', ''
UNION ALL SELECT 394 , 'IEI_01', 'IEI_01', 'Does the legal system in any way disadvantage or discriminate against women?', '', '', ''
UNION ALL SELECT 395 , 'IEI_02', 'IEI_02', 'Were there any reports that any level of government action, policy or law disadvantaged individuals in the education system due to ethnicity, race, national or minority status, religion, belief, gender, etc.?', '', '', ''
UNION ALL SELECT 396 , 'IEI_A_01', 'IEI_A_01', 'Was information available for each question?', '', '', ''
UNION ALL SELECT 397 , 'IEI_S_01', 'IEI_S_01', 'Was the country Constitution used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 398 , 'IEI_S_02', 'IEI_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 399 , 'IEI_S_03', 'IEI_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 400 , 'IEI_S_04', 'IEI_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 401 , 'IEI_S_05', 'IEI_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 402 , 'IEI_S_06', 'IEI_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 403 , 'IEI_S_07', 'IEI_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 404 , 'IEI_S_08', 'IEI_S_08', 'Was the Freedom House report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 405 , 'IEI_S_09', 'IEI_S_09', 'Was the Human Rights Watch topical report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 406 , 'IEI_S_10', 'IEI_S_10', 'Was the International Crisis Group country report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 407 , 'IEI_S_11', 'IEI_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 408 , 'IEI_S_12', 'IEI_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 409 , 'IEI_S_13', 'IEI_S_13', 'Was the Council of the European Union annual report on human rights used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 410 , 'IEI_S_14', 'IEI_S_14', 'Was the Amnesty International report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 411 , 'IEI_S_15', 'IEI_S_15', 'Was the European Network Against Racism Shadow Report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 412 , 'IEI_S_16', 'IEI_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 413 , 'IEI_S_17', 'IEI_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 414 , 'IEI_S_18', 'IEI_S_18', 'Was the TBC source on terrorism used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 415 , 'IEI_S_19', 'IEI_S_19', 'Was the Anti-Defamation League report used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 416 , 'IEI_S_20', 'IEI_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 417 , 'IEI_S_21', 'IEI_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 418 , 'IEI_S_22', 'IEI_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 419 , 'IEI_S_23', 'IEI_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 420 , 'IEI_S_24', 'IEI_S_24', 'Was the U.S. Trade Representative Annual Special 301 Report on Intellectual Property Rights used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 421 , 'IEI_S_25', 'IEI_S_25', 'Was the U.S. Country Commercial Guide [current year] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 422 , 'IEI_S_99_01', 'IEI_S_99_01', 'Was any other source [1] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 423 , 'IEI_S_99_02', 'IEI_S_99_02', 'Was any other source [2] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 424 , 'IEI_S_99_03', 'IEI_S_99_03', 'Was any other source [3] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 425 , 'IEI_S_99_04', 'IEI_S_99_04', 'Was any other source [4] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 426 , 'IEI_S_99_05', 'IEI_S_99_05', 'Was any other source [5] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 427 , 'IEI_S_99_06', 'IEI_S_99_06', 'Was any other source [6] used for coding Individual Empowerment?', '', '', ''
UNION ALL SELECT 428 , 'PPR_01', 'PPR_01', 'What year was the most recent national legislative election?', '', '', ''
UNION ALL SELECT 429 , 'PPR_01_a', 'PPR_01_a', 'If the most recent national legislative election occurred since 2000, was that election generally free and fair?', '', '', ''
UNION ALL SELECT 430 , 'PPR_02', 'PPR_02', 'What year was the most recent national executive election?', '', '', ''
UNION ALL SELECT 431 , 'PPR_02_a', 'PPR_02_a', 'If the most recent national executive election occurred since 2000, was that election generally free and fair?', '', '', ''
UNION ALL SELECT 432 , 'PPR_03', 'PPR_03', 'Are there any legal limits on universal suffrage?', '', '', ''
UNION ALL SELECT 433 , 'PPR_04', 'PPR_04', 'Are there political prisoners or detainees?', '', '', ''
UNION ALL SELECT 434 , 'PPR_S_01', 'PPR_S_01', 'Was the country Constitution used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 435 , 'PPR_S_02', 'PPR_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 436 , 'PPR_S_03', 'PPR_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 437 , 'PPR_S_04', 'PPR_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 438 , 'PPR_S_05', 'PPR_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 439 , 'PPR_S_06', 'PPR_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 440 , 'PPR_S_07', 'PPR_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 441 , 'PPR_S_08', 'PPR_S_08', 'Was the Freedom House report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 442 , 'PPR_S_09', 'PPR_S_09', 'Was the Human Rights Watch topical report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 443 , 'PPR_S_10', 'PPR_S_10', 'Was the International Crisis Group country report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 444 , 'PPR_S_11', 'PPR_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 445 , 'PPR_S_12', 'PPR_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 446 , 'PPR_S_13', 'PPR_S_13', 'Was the Council of the European Union annual report on human rights used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 447 , 'PPR_S_14', 'PPR_S_14', 'Was the Amnesty International report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 448 , 'PPR_S_15', 'PPR_S_15', 'Was the European Network Against Racism Shadow Report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 449 , 'PPR_S_16', 'PPR_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 450 , 'PPR_S_17', 'PPR_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 451 , 'PPR_S_18', 'PPR_S_18', 'Was the TBC source on terrorism used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 452 , 'PPR_S_19', 'PPR_S_19', 'Was the Anti-Defamation League report used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 453 , 'PPR_S_20', 'PPR_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 454 , 'PPR_S_21', 'PPR_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 455 , 'PPR_S_22', 'PPR_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 456 , 'PPR_S_23', 'PPR_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 457 , 'PPR_S_24', 'PPR_S_24', 'Was the U.S. Trade Representative Annual Special 301 Report on Intellectual Property Rights used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 458 , 'PPR_S_25', 'PPR_S_25', 'Was the U.S. Country Commercial Guide [current year] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 459 , 'PPR_S_99_01', 'PPR_S_99_01', 'Was any other source [1] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 460 , 'PPR_S_99_02', 'PPR_S_99_02', 'Was any other source [2] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 461 , 'PPR_S_99_03', 'PPR_S_99_03', 'Was any other source [3] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 462 , 'PPR_S_99_04', 'PPR_S_99_04', 'Was any other source [4] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 463 , 'PPR_S_99_05', 'PPR_S_99_05', 'Was any other source [5] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 464 , 'PPR_S_99_06', 'PPR_S_99_06', 'Was any other source [6] used for coding Political Process Restrictions?', '', '', ''
UNION ALL SELECT 465 , 'RIR_01', 'RIR_01', 'Does the law prohibit torture or other cruel, inhumane, or degrading treatment or punishment?', '', '', ''
UNION ALL SELECT 466 , 'RIR_02', 'RIR_02', 'Were there instances during the year being coded when the government or government-related agents engaged in torture or other cruel, inhumane, or degrading treatment or punishment?', '', '', ''
UNION ALL SELECT 467 , 'RIR_03', 'RIR_03', 'Does the law provide for freedom of internal movement, foreign travel, emigration, and repatriation?', '', '', ''
UNION ALL SELECT 468 , 'RIR_03_a', 'RIR_03_a', 'If de jure or de facto restrictions were in place, are there restrictions on in-country movement?', '', '', ''
UNION ALL SELECT 469 , 'RIR_03_b', 'RIR_03_b', 'If de jure or de facto restrictions were in place, are there restrictions on foreign travel?', '', '', ''
UNION ALL SELECT 470 , 'RIR_03_c', 'RIR_03_c', 'If de jure or de facto restrictions were in place, was the freedom of movement restricted for women?', '', '', ''
UNION ALL SELECT 471 , 'RIR_04', 'RIR_04', 'Is human trafficking present within the country?', '', '', ''
UNION ALL SELECT 472 , 'RIR_04_a', 'RIR_04_a', 'Is the country a source, transit point or destination for human trafficking?', '', '', ''
UNION ALL SELECT 473 , 'RIR_04_a_01', 'RIR_04_a_01', 'Is the country a source for human trafficking?', '', '', ''
UNION ALL SELECT 474 , 'RIR_04_a_02', 'RIR_04_a_02', 'Is the country a transit point for human trafficking?', '', '', ''
UNION ALL SELECT 475 , 'RIR_04_a_03', 'RIR_04_a_03', 'Is the country a destination for human trafficking?', '', '', ''
UNION ALL SELECT 476 , 'RIR_04_a_04', 'RIR_04_a_04', 'Is there internal trafficking in the country?', '', '', ''
UNION ALL SELECT 477 , 'RIR_04_b', 'RIR_04_b', 'Who are the victims of human trafficking?', '', '', ''
UNION ALL SELECT 478 , 'RIR_04_b_01', 'RIR_04_b_01', 'Are women the victims of human trafficking?', '', '', ''
UNION ALL SELECT 479 , 'RIR_04_b_02', 'RIR_04_b_02', 'Are men the victims of human trafficking?', '', '', ''
UNION ALL SELECT 480 , 'RIR_04_b_03', 'RIR_04_b_03', 'Are boys the victims of human trafficking?', '', '', ''
UNION ALL SELECT 481 , 'RIR_04_b_04', 'RIR_04_b_04', 'Are girls the victims of human trafficking?', '', '', ''
UNION ALL SELECT 482 , 'RIR_S_01', 'RIR_S_01', 'Was the country Constitution used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 483 , 'RIR_S_02', 'RIR_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 484 , 'RIR_S_03', 'RIR_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 485 , 'RIR_S_04', 'RIR_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 486 , 'RIR_S_05', 'RIR_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 487 , 'RIR_S_06', 'RIR_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 488 , 'RIR_S_07', 'RIR_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 489 , 'RIR_S_08', 'RIR_S_08', 'Was the Freedom House report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 490 , 'RIR_S_09', 'RIR_S_09', 'Was the Human Rights Watch topical report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 491 , 'RIR_S_10', 'RIR_S_10', 'Was the International Crisis Group country report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 492 , 'RIR_S_11', 'RIR_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 493 , 'RIR_S_12', 'RIR_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 494 , 'RIR_S_13', 'RIR_S_13', 'Was the Council of the European Union annual report on human rights used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 495 , 'RIR_S_14', 'RIR_S_14', 'Was the Amnesty International report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 496 , 'RIR_S_15', 'RIR_S_15', 'Was the European Network Against Racism Shadow Report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 497 , 'RIR_S_16', 'RIR_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 498 , 'RIR_S_17', 'RIR_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 499 , 'RIR_S_18', 'RIR_S_18', 'Was the TBC source on terrorism used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 500 , 'RIR_S_19', 'RIR_S_19', 'Was the Anti-Defamation League report used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 501 , 'RIR_S_20', 'RIR_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 502 , 'RIR_S_21', 'RIR_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 503 , 'RIR_S_22', 'RIR_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 504 , 'RIR_S_23', 'RIR_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 505 , 'RIR_S_24', 'RIR_S_24', 'Was the U.S. Trade Representative Annual Special 301 Report on Intellectual Property Rights used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 506 , 'RIR_S_25', 'RIR_S_25', 'Was the U.S. Country Commercial Guide [current year] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 507 , 'RIR_S_99_01', 'RIR_S_99_01', 'Was any other source [1] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 508 , 'RIR_S_99_02', 'RIR_S_99_02', 'Was any other source [2] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 509 , 'RIR_S_99_03', 'RIR_S_99_03', 'Was any other source [3] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 510 , 'RIR_S_99_04', 'RIR_S_99_04', 'Was any other source [4] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 511 , 'RIR_S_99_05', 'RIR_S_99_05', 'Was any other source [5] used for coding Restrictions on Individual Rights?', '', '', ''
UNION ALL SELECT 512 , 'RIR_S_99_06', 'RIR_S_99_06', 'Was any other source [6] used for coding Restrictions on Individual Rights?', '', '', ''
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
GO
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S01_CrT_Q_XLSXupdatable______v05__RUN.sql                                                                                                                        
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                  ******************************************************************************************/
/***************************************************************************************************************************************************************/
-- this works as a STEP BY STEP procedure
-- in the future we should have this data as part of the std question table or as a view having some of the notes in other table
USE 
            [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID
         (N'[forum_ResAnal].[dbo].[AllQuestions]', N'U') IS NOT NULL
DROP TABLE
            [forum_ResAnal].[dbo].[AllQuestions]
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE
               [AllQuestions]
                                      (
                                       [Q_Number]        [bigint]          NULL
                                     , [Variable]        [nvarchar] (128)  NULL
                                     , [Label_minus4]    [nvarchar]  (50)  NULL
                                     , [Wording_minus3]  [nvarchar] (max)  NULL
                                     , [Notes1_plus201]  [nvarchar] (max)  NULL
                                     , [Notes2_plus202]  [nvarchar] (max)  NULL
                                     , [Notes3_plus203]  [nvarchar] (max)  NULL
                                      )
ON [PRIMARY]
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
/***************************************************************************************************************************************************************/
/****** Load values using code from Excel **********************************************************************************************************************/
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO
               [AllQuestions]
                                      (
                                       [Q_Number]
                                     , [Variable]
                                     , [Label_minus4]
                                     , [Wording_minus3]
                                     , [Notes1_plus201]
                                     , [Notes2_plus202]
                                     , [Notes3_plus203]
                                                       )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                 1 , 'GRI_scaled', 'GRI', 'Government Restrictions Index (GRI)', '', '', ''
UNION ALL SELECT 2 , 'SHI_scaled', 'SHI', 'Social Hostilities Index (SHI)', '', '', ''
UNION ALL SELECT 3 , 'GFI_scaled', 'GFI', 'Government Favoritism Index (GFI)', '', 'In this analysis, GRI.Q.20 is treated as a Government Favoritism Index. The Pew Forum categorizes the levels of government favoritism of religion by percentiles. Countries with scores in the top 5% on GRI.Q.20 were categorized as "very high." The next highest 15% of scores were categorized as "high," and the following 20% were categorized as "moderate." The bottom 60% of scores were categorized as "low."', 'In this analysis, GRI.Q.20 is treated as a Government Favoritism Index (see page TK). The Pew Forum categorizes the levels of government favoritism of religion by percentiles. Countries with scores in the top 5% on GRI.Q.20 were categorized as "very high." The next highest 15% of scores were categorized as "high," and the following 20% were categorized as "moderate." The bottom 60% of scores were categorized as "low."'
UNION ALL SELECT 4 , 'GRI_rd_1d', 'GRI', 'Calculated Year Value of the Government Restrictions Index (rounded to one decimal)', '', '', ''
UNION ALL SELECT 5 , 'SHI_rd_1d', 'SHI', 'Calculated Year Value of the Social Hostilities Index (rounded to one decimal)', '', '', ''
UNION ALL SELECT 6 , 'GFI_rd_1d', 'GFI', 'Calculated Year Value of the Government Favoritism Index (rounded to one decimal)', '', '', ''
UNION ALL SELECT 7 , 'GRI', 'GRI', 'Calculated Year Value of the Government Restrictions Index', '', '', ''
UNION ALL SELECT 8 , 'SHI', 'SHI', 'Calculated Year Value of the Social Hostilities Index', '', '', ''
UNION ALL SELECT 9 , 'GFI', 'GFI', 'Calculated Year Value of the Government Favoritism Index', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 10 , 'GRI_01_x', 'GRI_01_x', 'Is there any evidence that the constitution changed since the former coding period?', '', '', ''
UNION ALL SELECT 11 , 'GRI_01_x2', 'GRI_01_x2', 'Did the constitution change make a change in either GRI_01 and GRI_02?', '', '', ''
UNION ALL SELECT 12 , 'GRI_01_x2_a', 'GRI_01_x2_a', 'Did the constitution change make a change in GRI_01?', '', '', ''
UNION ALL SELECT 13 , 'GRI_01', 'GRI.Q.1', 'Does the constitution, or law that functions in the place of a constitution (basic law), specifically provide for "freedom of religion" or include language used in Article 18 of the United Nations Universal Declaration of Human Rights? *', '* Article 18 states: "Everyone has the right to freedom of thought, conscience and religion; this right includes freedom to change his religion or belief, and freedom, either alone or in community with others and in public or private, to manifest his religion or belief in teaching, practice, worship and observance."', '', ''
UNION ALL SELECT 14 , 'GRI_01_x2_b', 'GRI_01_x2_b', 'Did the constitution change make a change in GRI_02?', '', '', ''
UNION ALL SELECT 15 , 'GRI_02', 'GRI.Q.2', 'Does the constitution or basic law include stipulations that appear to qualify or substantially contradict the concept of "religious freedom"?', ' ', '', ''
UNION ALL SELECT 16 , 'GRI_03', 'GRI.Q.3', 'Taken together, how do the constitution/basic law and other national laws and policies affect religious freedom?', ' ', '', ''
UNION ALL SELECT 17 , 'GRI_04', 'GRI.Q.4', 'Does any level of government interfere with worship or other religious practices?', ' ', '', ''
UNION ALL SELECT 18 , 'GRI_05', 'GRI.Q.5', 'Is public preaching by religious groups limited by any level of government?', ' ', '', ''
UNION ALL SELECT 19 , 'GRI_06', 'GRI.Q.6', 'Is proselytizing limited by any level of government?', ' ', '', ''
UNION ALL SELECT 20 , 'GRI_07', 'GRI.Q.7', 'Is converting from one religion to another limited by any level of government?', ' ', '', ''
UNION ALL SELECT 21 , 'GRI_08_for_index', 'GRI.Q.8', 'Is religious literature or broadcasting limited by any level of government?', ' ', '', ''
UNION ALL SELECT 22 , 'GRI_08', 'GRI_08', 'Is religious literature or broadcasting limited by any level of government?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 23 , 'GRI_09', 'GRI.Q.9', 'Are foreign missionaries allowed to operate?', ' ', '', ''
UNION ALL SELECT 24 , 'GRI_10', 'GRI.Q.10', 'Is the wearing of religious symbols, such as head coverings for women and facial hair for men, regulated by law or by any level of government?', ' ', '', ''
UNION ALL SELECT 25 , 'GRI_10_01', 'GRI_10_01', 'Is the wearing of scarves or head coverings for women regulated by law or by any level of government?', '', '', ''
UNION ALL SELECT 26 , 'GRI_10_02', 'GRI_10_02', 'Is the wearing of beards or facial hair for men regulated by law or by any level of government?', '', '', ''
UNION ALL SELECT 27 , 'GRI_10_03', 'GRI_10_03', 'Is the wearing of other religious symbols, besides head coverings for women and facial hair for men, regulated by law or by any level of government?', '', '', ''
UNION ALL SELECT 28 , 'GRI_11', 'GRI.Q.11', 'Was there harassment or intimidation of religious groups by any level of government?', ' ', '', ''
UNION ALL SELECT 29 , 'GRI_11_01a', 'GRI_11_01a', 'Was there harassment or intimidation of Orthodox Christianity by any level of government?', '', '', ''
UNION ALL SELECT 30 , 'GRI_11_01b', 'GRI_11_01b', 'Was there harassment or intimidation of Catholic Christianity by any level of government?', '', '', ''
UNION ALL SELECT 31 , 'GRI_11_02', 'GRI_11_02', 'Was there harassment or intimidation of Protestant/Anglican Christianity by any level of government?', '', '', ''
UNION ALL SELECT 32 , 'GRI_11_03', 'GRI_11_03', 'Was there harassment or intimidation of Christianity (unspecified) by any level of government?', '', '', ''
UNION ALL SELECT 33 , 'GRI_11_04', 'GRI_11_04', 'Was there harassment or intimidation of Sunni Islam by any level of government?', '', '', ''
UNION ALL SELECT 34 , 'GRI_11_05', 'GRI_11_05', 'Was there harassment or intimidation of Shia Islam by any level of government?', '', '', ''
UNION ALL SELECT 35 , 'GRI_11_06', 'GRI_11_06', 'Was there harassment or intimidation of Islam (unspecified) by any level of government?', '', '', ''
UNION ALL SELECT 36 , 'GRI_11_07', 'GRI_11_07', 'Was there harassment or intimidation of Buddhism by any level of government?', '', '', ''
UNION ALL SELECT 37 , 'GRI_11_08', 'GRI_11_08', 'Was there harassment or intimidation of Hinduism by any level of government?', '', '', ''
UNION ALL SELECT 38 , 'GRI_11_09', 'GRI_11_09', 'Was there harassment or intimidation of Judaism by any level of government?', '', '', ''
UNION ALL SELECT 39 , 'GRI_11_10', 'GRI_11_10', 'Was there harassment or intimidation of other "new" religions (Scientology or Bahai) by any level of government?', '', '', ''
UNION ALL SELECT 40 , 'GRI_11_11', 'GRI_11_11', 'Was there harassment or intimidation of other schismatic Christian sects (Mormons or Jehovah Witnesses) by any level of government?', '', '', ''
UNION ALL SELECT 41 , 'GRI_11_12', 'GRI_11_12', 'Was there harassment or intimidation of other schismatic Muslim sects (Ahmadiyya or Druze) by any level of government?', '', '', ''
UNION ALL SELECT 42 , 'GRI_11_13', 'GRI_11_13', 'Was there harassment or intimidation of other ethnic or tribal religions (Voodoo or Witchcraft) by any level of government?', '', '', ''
UNION ALL SELECT 43 , 'GRI_11_14', 'GRI_11_14', 'Was there harassment or intimidation of other ancient religions (Zoroastrianism or Sikhs) by any level of government?', '', '', ''
UNION ALL SELECT 44 , 'GRI_11_15', 'GRI_11_15', 'Was there harassment or intimidation of Sikhs by any level of government?', '', '', ''
UNION ALL SELECT 45 , 'GRI_11_16', 'GRI_11_16', 'Was there harassment or intimidation of other ancient religions (Zoroastrianism) by any level of government?', '', '', ''
UNION ALL SELECT 46 , 'GRI_11_17', 'GRI_11_17', 'Was there harassment or intimidation of atheists by any level of government?', '', '', ''
UNION ALL SELECT 47 , 'GRI_11_xG1', 'GRI_11_xG1', 'Was there harassment or intimidation of Christianity by any level of government?', '', '', ''
UNION ALL SELECT 48 , 'GRI_11_xG2', 'GRI_11_xG2', 'Was there harassment or intimidation of Islam by any level of government?', '', '', ''
UNION ALL SELECT 49 , 'GRI_11_xG3', 'GRI_11_xG3', 'Was there harassment or intimidation of Buddhism by any level of government?', '', '', ''
UNION ALL SELECT 50 , 'GRI_11_xG4', 'GRI_11_xG4', 'Was there harassment or intimidation of Hinduism by any level of government?', '', '', ''
UNION ALL SELECT 51 , 'GRI_11_xG5', 'GRI_11_xG5', 'Was there harassment or intimidation of Judaism by any level of government?', '', '', ''
UNION ALL SELECT 52 , 'GRI_11_xG6', 'GRI_11_xG6', 'Was there harassment or intimidation of other religions by any level of government?', '', '', ''
UNION ALL SELECT 53 , 'GRI_11_xG7', 'GRI_11_xG7', 'Was there harassment or intimidation of ethnic or tribal religions by any level of government?', '', '', ''
UNION ALL SELECT 54 , 'GRI_12', 'GRI.Q.12', 'Did the national government display hostility involving physical violence toward minority or nonapproved religious groups?', ' ', '', ''
UNION ALL SELECT 55 , 'GRI_13', 'GRI.Q.13', 'Where there instances when the national government did not intervene in cases of discrimination or abuses against religious groups?', ' ', '', ''
UNION ALL SELECT 56 , 'GRI_14', 'GRI.Q.14', 'Does the national government have an established organization to regulate or manage religious affairs?', ' ', '', ''
UNION ALL SELECT 57 , 'GRI_15', 'GRI.Q.15', 'Did the national government denounce one or more religious groups by characterizing them as dangerous "cults" or "sects"?', ' ', '', ''
UNION ALL SELECT 58 , 'GRI_16', 'GRI_16', 'Does any level of government formally ban any religious group?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 59 , 'GRI_16_ny', 'GRI.Q.16', 'Does any level of government formally ban any religious group?', ' ', '', ''
UNION ALL SELECT 60 , 'GRI_16_01', 'GRI_16_01', 'List group(s) banned by  any level of government.', '', '', ''
UNION ALL SELECT 61 , 'GRI_17', 'GRI.Q.17', 'Were there instances when the national government attempted to eliminate an entire religious group's presence in the country?', ' ', '', ''
UNION ALL SELECT 62 , 'GRI_18', 'GRI.Q.18', 'Did any level of government ask religious groups to register for any reason, including to be eligible for benefits such as tax exemption?', ' ', '', ''
UNION ALL SELECT 63 , 'GRI_19', 'GRI_19', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 64 , 'GRI_19_filter', 'GRI_19_filter', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', '', '', ''
UNION ALL SELECT 65 , 'GRI_19_ny', 'GRI.Q.19', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', ' ', '', ''
UNION ALL SELECT 66 , 'GRI_19_summ_ny', 'GRI.Q.19b', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', 'Percentages add to more than 100 because countries can have multiple types of cases of government force.
^ This line represents the number or percentage of countries in which at least one of the following types of government force occurred.', '', ''
UNION ALL SELECT 67 , 'GRI_19_x', 'GRI_19_x', 'Did any level of government use force toward religious groups that resulted in individuals being killed, physically abused, imprisoned, detained or displaced from their homes, or having their personal or religious properties damaged or destroyed?', '', '', ''
UNION ALL SELECT 68 , 'GRI_19_b', 'GRI_19_b', 'Was property damaged, due to religion, as a result of any level of government action or policy?', '', '', ''
UNION ALL SELECT 69 , 'GRI_19_c', 'GRI_19_c', 'Were there detentions or abductions, due to religion, as a result of any level of government action or policy?', '', '', ''
UNION ALL SELECT 70 , 'GRI_19_d', 'GRI_19_d', 'Were individuals displaced from their homes, due to religion, by any level of government action or policy?', '', '', ''
UNION ALL SELECT 71 , 'GRI_19_e', 'GRI_19_e', 'Were there physical assaults, due to religion, motivated by any level of government action or policy in this country?', '', '', ''
UNION ALL SELECT 72 , 'GRI_19_f', 'GRI_19_f', 'Were there deaths, due to religion, motivated by any level of government action or policy in this country?', '', '', ''
UNION ALL SELECT 73 , 'GRI_19_da', 'GRI_19_da', 'Were individuals internally displaced, due to religion, by any level of government action or policy?', '', '', ''
UNION ALL SELECT 74 , 'GRI_19_db', 'GRI_19_db', 'Were individuals displaced to another country, due to religion, by any level of government action or policy?', '', '', ''
UNION ALL SELECT 75 , 'GRI_20', 'GRI_20', 'Do some religious groups receive government support or favors, such as funding, official recognition or special access?', '', '', ''
UNION ALL SELECT 76 , 'GRI_20_top', 'GRI.Q.20', 'Do some religious groups receive government support or favors, such as funding, official recognition or special access?', 'This is a summary table that puts the restrictions identified in Questions 20.1, 20.2, 20.3a-c, 20.4, and 20.5 into a single measure indicating the level to which a government supports religious groups in the country.
Government support of a religion or religions is considered restrictive only when preferential treatment of one or more religious groups puts other religious groups at a disadvantage. ', '', ''
UNION ALL SELECT 77 , 'GRI_20_01', 'GRI.Q.20.1', 'Does the country''s constitution or basic law recognize a favored religion or religions?', 'This question is a component of GRI.Q.20.
For GRI.Q.20.1, the differences between the coding periods may not be as significant as they appear due to minor changes in coding procedures.', '', ''
UNION ALL SELECT 78 , 'GRI_20_01x_01a', 'GRI_20_01x_01a', 'Is Orthodox Christianity recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 79 , 'GRI_20_01x_01b', 'GRI_20_01x_01b', 'Is Catholic Christianity recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 80 , 'GRI_20_01x_02', 'GRI_20_01x_02', 'Is Protestant/Anglican Christianity recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 81 , 'GRI_20_01x_03', 'GRI_20_01x_03', 'Is Christianity (unspecified) recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 82 , 'GRI_20_01x_04', 'GRI_20_01x_04', 'Is Sunni Islam recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 83 , 'GRI_20_01x_05', 'GRI_20_01x_05', 'Is Shia Islam recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 84 , 'GRI_20_01x_06', 'GRI_20_01x_06', 'Is Islam (unspecified) recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 85 , 'GRI_20_01x_07', 'GRI_20_01x_07', 'Is Buddhism recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 86 , 'GRI_20_01x_08', 'GRI_20_01x_08', 'Is Hinduism recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 87 , 'GRI_20_01x_09', 'GRI_20_01x_09', 'Is Judaism recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 88 , 'GRI_20_01x_10', 'GRI_20_01x_10', 'Are other religions recognized as a favored religion by the constitution or law that functions in the place of constitution?', '', '', ''
UNION ALL SELECT 89 , 'GRI_20_02', 'GRI.Q.20.2', 'Do all religious groups receive the same level of government access and privileges?', 'This question is a component of GRI.Q.20.', '', ''
UNION ALL SELECT 90 , 'GRI_20_03_top', 'GRI.Q.20.3', 'Does any level of government provide funds or other resources to religious groups?', 'This question is a component of GRI.Q.20.
This is a summary table that puts the restrictions identified in Questions 20.3a-c into a single measure indicating the level to which a government supports religious groups in the country.
Government support of a religion or religions is considered restrictive only when preferential treatment of one or more religious groups puts other religious groups at a disadvantage.', '', ''
UNION ALL SELECT 91 , 'GRI_20_03_a', 'GRI.Q.20.3.a', 'Does any level of government provide funds or other resources for religious education programs and/or religious schools?', 'This question is a component of GRI.Q.20.3.', '', ''
UNION ALL SELECT 92 , 'GRI_20_03_b', 'GRI.Q.20.3.b', 'Does any level of government provide funds or other resources for religious property (e.g., buildings, upkeep, repair or land)?', 'This question is a component of GRI.Q.20.3.', '', ''
UNION ALL SELECT 93 , 'GRI_20_03_c', 'GRI.Q.20.3.c', 'Does any level of government provide funds or other resources for religious activities other than education or property?', 'This question is a component of GRI.Q.20.3.', '', ''
UNION ALL SELECT 94 , 'GRI_20_04', 'GRI.Q.20.4', 'Is religious education required in public schools?', 'This question is a component of GRI.Q.20.', '', ''
UNION ALL SELECT 95 , 'GRI_20_04_x', 'GRI_20_04_x', 'Is religious education offered in public schools?', '', '', ''
UNION ALL SELECT 96 , 'GRI_20_05', 'GRI.Q.20.5', 'Does the national government defer in some way to religious authorities, texts or doctrines on legal issues?', 'This question is a component of GRI.Q.20.', '', ''
UNION ALL SELECT 97 , 'GRI_20_05_x', 'GRI_20_05_x', 'Have provisions of sharia law been adopted in the country?', '', '', ''
UNION ALL SELECT 98 , 'GRI_20_05_x1', 'GRI_20_05_x1', 'Have provisions of sharia law been adopted in the province?', '', '', ''
UNION ALL SELECT 99 , 'SHI_01', 'SHI.Q.1', 'Were there crimes, malicious acts or violence motivated by religious hatred or bias?', 'This is a summary table that captures the hostilities identified in questions 1.a-f into a single measure indicating the severity of religious hatred or bias in each country.
If one type of hostility occurred the country received 1/6 point for that year. Countries can have multiple types of hostilities. The scores on this question are cumulative; a country with three types of malicious acts would score 0.50 for that period and a country with all six types in any of both years would score 1.00.', '', ''
UNION ALL SELECT 100 , 'SHI_01_summary_a_ny', 'SHI.Q.1a', 'Were there crimes, malicious acts or violence motivated by religious hatred or bias?', 'This is a summary table that captures the hostilities identified in questions 1.a-f indicating the types of religious hatred or bias.
Percentages add to more than 100 because countries can have multiple types of hostilities.
^ This line represents the number or percentage of countries in which at least one of the following hostilities occurred.', '', ''
UNION ALL SELECT 101 , 'SHI_01_summary_a', 'SHI_01_summary_a', 'Were there crimes, malicious acts or violence motivated by religious hatred or bias?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 102 , 'SHI_01_summary_b', 'SHI.Q.1b', 'How many different types of crimes, malicious acts or violence motivated by religious hatred or bias occured? The six different types considered include: harassment/intimidation, property damage, detentions/abductions, displacement from homes, physcal assaults and killings.', 'This is a summary table that captures the different types of hostilities into a single measure indicating the severity of religious hatred or bias.', '', ''
UNION ALL SELECT 103 , 'SHI_01_x', 'SHI_01_x', 'Did individuals face harassment or intimidation motivated by religious hatred or bias?', '', '', ''
UNION ALL SELECT 104 , 'SHI_01_a_dummy', 'SHI.Q.1a', 'Did individuals face harassment or intimidation motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 105 , 'SHI_01_b_dummy', 'SHI.Q.1b', 'Was property damaged as a result of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 106 , 'SHI_01_c_dummy', 'SHI.Q.1c', 'Were there detentions or abductions motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 107 , 'SHI_01_d_dummy', 'SHI.Q.1d', 'Were individuals displaced from their homes because of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 108 , 'SHI_01_e_dummy', 'SHI.Q.1e', 'Were there physical assaults motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 109 , 'SHI_01_f_dummy', 'SHI.Q.1f', 'Were there deaths motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 110 , 'SHI_01_a', 'SHI.Q.1a', 'Did individuals face harassment or intimidation motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 111 , 'SHI_01_x_01a', 'SHI_01_x_01a', 'Has there been any alleged harassment of Orthodox Christianity by social groups?', '', '', ''
UNION ALL SELECT 112 , 'SHI_01_x_01b', 'SHI_01_x_01b', 'Has there been any alleged harassment of Catholic Christianity by social groups?', '', '', ''
UNION ALL SELECT 113 , 'SHI_01_x_02', 'SHI_01_x_02', 'Has there been any alleged harassment of Protestant/Anglican Christianity by social groups?', '', '', ''
UNION ALL SELECT 114 , 'SHI_01_x_03', 'SHI_01_x_03', 'Has there been any alleged harassment of Christianity (unspecified) by social groups?', '', '', ''
UNION ALL SELECT 115 , 'SHI_01_x_04', 'SHI_01_x_04', 'Has there been any alleged harassment of Sunni Islam by social groups?', '', '', ''
UNION ALL SELECT 116 , 'SHI_01_x_05', 'SHI_01_x_05', 'Has there been any alleged harassment of Shia Islam by social groups?', '', '', ''
UNION ALL SELECT 117 , 'SHI_01_x_06', 'SHI_01_x_06', 'Has there been any alleged harassment of Islam (unspecified) by social groups?', '', '', ''
UNION ALL SELECT 118 , 'SHI_01_x_07', 'SHI_01_x_07', 'Has there been any alleged harassment of Buddhism by social groups?', '', '', ''
UNION ALL SELECT 119 , 'SHI_01_x_08', 'SHI_01_x_08', 'Has there been any alleged harassment of Hinduism by social groups?', '', '', ''
UNION ALL SELECT 120 , 'SHI_01_x_09', 'SHI_01_x_09', 'Has there been any alleged harassment of Judaism by social groups?', '', '', ''
UNION ALL SELECT 121 , 'SHI_01_x_10', 'SHI_01_x_10', 'Has there been any alleged harassment of other "new" religions (Scientology or Bahai) by social groups?', '', '', ''
UNION ALL SELECT 122 , 'SHI_01_x_11', 'SHI_01_x_11', 'Has there been any alleged harassment of other schismatic Christian sects (Mormons or Jehovah Witnesses) by social groups?', '', '', ''
UNION ALL SELECT 123 , 'SHI_01_x_12', 'SHI_01_x_12', 'Has there been any alleged harassment of other schismatic Muslim sects (Ahmadiyya or Druze) by social groups?', '', '', ''
UNION ALL SELECT 124 , 'SHI_01_x_13', 'SHI_01_x_13', 'Has there been any alleged harassment of other ethnic or tribal religions (Voodoo or Witchcraft) by social groups?', '', '', ''
UNION ALL SELECT 125 , 'SHI_01_x_14', 'SHI_01_x_14', 'Has there been any alleged harassment of other ancient religions (Zoroastrianism or Sikhs) by social groups?', '', '', ''
UNION ALL SELECT 126 , 'SHI_01_x_15', 'SHI_01_x_15', 'Has there been any alleged harassment of Sikhs by social groups?', '', '', ''
UNION ALL SELECT 127 , 'SHI_01_x_16', 'SHI_01_x_16', 'Has there been any alleged harassment of other ancient religions (Zoroastrianism) by social groups?', '', '', ''
UNION ALL SELECT 128 , 'SHI_01_x_17', 'SHI_01_x_17', 'Has there been any alleged harassment of atheists by social groups?', '', '', ''
UNION ALL SELECT 129 , 'SHI_01_xG1', 'SHI_01_xG1', 'Has there been any alleged harassment of Christianity by social groups?', '', '', ''
UNION ALL SELECT 130 , 'SHI_01_xG2', 'SHI_01_xG2', 'Has there been any alleged harassment of Islam by social groups?', '', '', ''
UNION ALL SELECT 131 , 'SHI_01_xG3', 'SHI_01_xG3', 'Has there been any alleged harassment of Buddhism by social groups?', '', '', ''
UNION ALL SELECT 132 , 'SHI_01_xG4', 'SHI_01_xG4', 'Has there been any alleged harassment of Hinduism by social groups?', '', '', ''
UNION ALL SELECT 133 , 'SHI_01_xG5', 'SHI_01_xG5', 'Has there been any alleged harassment of Judaism by social groups?', '', '', ''
UNION ALL SELECT 134 , 'SHI_01_xG6', 'SHI_01_xG6', 'Has there been any alleged harassment of other religions by social groups?', '', '', ''
UNION ALL SELECT 135 , 'SHI_01_xG7', 'SHI_01_xG7', 'Has there been any alleged harassment of ethnic or tribal religions by social groups?', '', '', ''
UNION ALL SELECT 136 , 'SHI_01_b', 'SHI.Q.1b', 'Was property damaged as a result of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 137 , 'SHI_01_c', 'SHI.Q.1c', 'Were there detentions or abductions motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 138 , 'SHI_01_d', 'SHI.Q.1d', 'Were individuals displaced from their homes because of religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 139 , 'SHI_01_e', 'SHI.Q.1e', 'Were there physical assaults motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 140 , 'SHI_01_f', 'SHI.Q.1f', 'Were there deaths motivated by religious hatred or bias?', ' This question is a component of SHI.Q.1', '', ''
UNION ALL SELECT 141 , 'SHI_01_da', 'SHI_01_da', 'Were individuals internally displaced because of religious hatred or bias?', '', '', ''
UNION ALL SELECT 142 , 'SHI_01_db', 'SHI_01_db', 'Were individuals displaced to another country because of religious hatred or bias?', '', '', ''
UNION ALL SELECT 143 , 'SHI_02', 'SHI.Q.2', 'Was there mob violence related to religion?', ' ', '', ''
UNION ALL SELECT 144 , 'SHI_02_01', 'SHI_02_01', 'Was there "ethnic cleansing" or "genocide" related to religion?', '', '', ''
UNION ALL SELECT 145 , 'SHI_03', 'SHI.Q.3', 'Were there acts of sectarian or communal violence between religious groups?', ' Sectarian or communal violence involves two or more religious groups facing off in repeated clashes.', '', ''
UNION ALL SELECT 146 , 'SHI_04', 'SHI_04', 'Were religion-related terrorist groups active in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 147 , 'SHI_04_filter', 'SHI_04_filter', 'Were religion-related terrorist groups active in the country?', '', '', ''
UNION ALL SELECT 148 , 'SHI_04_ny', 'SHI.Q.4', 'Were religion-related terrorist groups active in the country?', 'Religion-related terrorism is defined as politically motivated violence agaisnt noncombatants by subnational groups or clandestine agents with a religious justification or intent. 
Some of the increase in religion-related terrorism between the year ending in mid-2007 and the year ending in mid-2009 could reflect the use of new source material providing greater detail on terrorist activities than was provided by sources used in the baseline report.', '', ''
UNION ALL SELECT 149 , 'SHI_04_x', 'SHI_04_x', 'How many religion-related terrorist crimes, malicious acts or events of violence were found in the country?', '', '', ''
UNION ALL SELECT 150 , 'SHI_04_b', 'SHI_04_b', 'Was property damaged due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 151 , 'SHI_04_c', 'SHI_04_c', 'Were there detentions or abductions due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 152 , 'SHI_04_d', 'SHI_04_d', 'Were individuals displaced from their homes due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 153 , 'SHI_04_e', 'SHI_04_e', 'Were there physical assaults due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 154 , 'SHI_04_f', 'SHI_04_f', 'Were there deaths due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 155 , 'SHI_04_da', 'SHI_04_da', 'Were individuals internally displaced due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 156 , 'SHI_04_db', 'SHI_04_db', 'Were individuals displaced to another country due to religion-related terrorism?', '', '', ''
UNION ALL SELECT 157 , 'SHI_04_x01', 'SHI_04_x01', 'List the religion-related terrorist groups active in the country.', '', '', ''
UNION ALL SELECT 158 , 'SHI_05', 'SHI_05', 'Was there a religion-related war or armed conflict in the country (including ongoing displacements from previous wars)?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 159 , 'SHI_05_filter', 'SHI_05_filter', 'Was there a religion-related war or armed conflict in the country (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 160 , 'SHI_05_ny', 'SHI.Q.5', 'Was there a religion-related war or armed conflict in the country?', 'Religion-related war is defined as armed conflict (involving sustained casualties over time or more than 1,000 battle deaths) in which religious rhetoric is commonly employed to justify the use of force, or in which one or more of the combatants primarily identifies itself or the opposings side by religion. 
Some of the increase shown above for 2011 reflects ongoing displacements that were not coded in previous years, including the religion-related conflicts in such places as Cyprus.', '', ''
UNION ALL SELECT 161 , 'SHI_05_x', 'SHI_05_x', 'How many religion-related war  crimes, malicious acts or events of violence were found in the country?', '', '', ''
UNION ALL SELECT 162 , 'SHI_05_b', 'SHI_05_b', 'By province, count the number of people who, due to religion, had property damaged/defaced or destroyed during a religiously-related war/revolution/armed conflict', '', '', ''
UNION ALL SELECT 163 , 'SHI_05_c', 'SHI_05_c', 'Were there detentions or abductions due to religion-related war or armed conflict?', '', '', ''
UNION ALL SELECT 164 , 'SHI_05_d', 'SHI_05_d', 'Were individuals displaced from their homes due to religion-related war or armed conflict (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 165 , 'SHI_05_e', 'SHI_05_e', 'Were there physical assaults due to religion-related war or armed conflict?', '', '', ''
UNION ALL SELECT 166 , 'SHI_05_f', 'SHI_05_f', 'Were there deaths due to religion-related war or armed conflict?', '', '', ''
UNION ALL SELECT 167 , 'SHI_05_da', 'SHI_05_da', 'Were individuals internally displaced due to religion-related war or armed conflict (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 168 , 'SHI_05_db', 'SHI_05_db', 'Were individuals displaced to another country due to religion-related war or armed conflict (including ongoing displacements from previous wars)?', '', '', ''
UNION ALL SELECT 169 , 'SHI_06', 'SHI.Q.6', 'Did violence result from tensions between religious groups?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 170 , 'SHI_07', 'SHI_07', 'Did organized groups use force or coercion in an attempt to dominate public life with their perspective on religion, including preventing some religious groups from operating in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 171 , 'SHI_07_ny', 'SHI.Q.7', 'Did organized groups use force or coercion in an attempt to dominate public life with their perspective on religion, including preventing some religious groups from operating in the country?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 172 , 'SHI_08', 'SHI.Q.8', 'Did religious groups themselves attempt to prevent other religious groups from being able to operate?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 173 , 'SHI_09', 'SHI.Q.9', 'Did individuals or groups use violence or the threat of violence, including so-called honor killings, to try to enforce religious norms?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 174 , 'SHI_10', 'SHI.Q.10', 'Were individuals assaulted or displaced from their homes in retaliation for religious activities, including preaching and other forms of religious expression, considered offensive or threatening to the majority faith?', 'The data for each year also takes into account information from the two previous years.', '', ''
UNION ALL SELECT 175 , 'SHI_11_for_index', 'SHI.Q.11', 'Were women harassed for violating religious dress codes?', 'The data for each year also takes into account information from the two previous years. ', '', ''
UNION ALL SELECT 176 , 'SHI_11', 'SHI_11', 'Were women harassed for violating religious dress codes?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 177 , 'SHI_11_x', 'SHI_11_x', 'Are women socially discriminated against or harassed due to violating religious norms or precepts, including being harassed for violating religious dress codes?', '', '', ''
UNION ALL SELECT 178 , 'SHI_12', 'SHI.Q.12', 'Were there incidents of hostility over proselytizing?', 'The data for each year also takes into account information from the two previous years. ', '', ''
UNION ALL SELECT 179 , 'SHI_13', 'SHI.Q.13', 'Were there incidents of hostility over conversions from one religion to another?', 'The data for each year also takes into account information from the two previous years. ', '', ''
UNION ALL SELECT 180 , 'GRX_21_01', 'GRX_21_01', 'Did religious issues trigger the use of force toward religious individuals or groups by government actors?', '', '', ''
UNION ALL SELECT 181 , 'GRX_21_02', 'GRX_21_02', 'Did political issues trigger the use of force toward religious individuals or groups by government actors?', '', '', ''
UNION ALL SELECT 182 , 'GRX_21_03', 'GRX_21_03', 'Did other socio-economic isues trigger the use of force toward religious individuals or groups by government actors?', '', '', ''
UNION ALL SELECT 183 , 'GRX_22_filter', 'GRX_22_filter', 'Does any level of government penalize the defamation of religion, including penalizing such things as blasphemy, apostasy, and criticism or critiques of a religion or religions?', '', '', ''
UNION ALL SELECT 184 , 'GRX_22_ny', 'Additional Question 1', 'Does any level of government penalize the defamation of religion, including penalizing such things as blasphemy, apostasy, and criticism or critiques of a religion or religions?', 'Additional Question 1 was only coded beginning with the year ending in mid-2009.', '', ''
UNION ALL SELECT 185 , 'GRX_22', 'GRX_22', 'Does any level of government penalize the defamation of religion, including penalizing such things as blasphemy, apostasy, and criticism or critiques of a religion or religions?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 186 , 'GRX_22_01', 'GRX_22_01', 'Does any level of government penalize blasphemy?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 187 , 'GRX_22_01_ny', 'Additional Question 1a', 'Does any level of government penalize blasphemy?', 'This question is a component of the Additional Question 1.
Additional Question 1a is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 188 , 'GRX_22_02', 'GRX_22_02', 'Does any level of government penalize apostasy?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 189 , 'GRX_22_02_ny', 'Additional Question 1b', 'Does any level of government penalize apostasy?', 'This question is a component of the Additional Question 1.
Additional Question 1b is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 190 , 'GRX_22_03', 'GRX_22_03', 'Does any level of government penalize hate speech about a religion or religions?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 191 , 'GRX_22_04_ny', 'Additional Question 1c', 'Does any level of government penalize criticism or critiques of a religion or religions?', 'This question is a component of the Additional Question 1.
Additional Question 1c is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 192 , 'GRX_22_03_ny', 'Additional Question 2', 'Does any level of government penalize hate speech about a religion or religions?', 'Additional Question 2 is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 193 , 'GRX_22_04', 'GRX_22_04', 'Does any level of government penalize criticism or critiques of a religion or religions?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 194 , 'XSG_25n27_ny', 'Additional Question 3', 'Did events, groups or individuals from outside the country contribute to government restrictions on religion or social hostilities involving religion in the country?', 'Additional Question 3 is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 195 , 'GRX_23', 'GRX_23', 'Are public expressions of faith or religiously based socio-political arguments restricted by any level of government?', '', '', ''
UNION ALL SELECT 196 , 'GRX_25_ny', 'Additional Question 3a', 'Did events, groups or individuals from outside the country contribute to government restrictions on religion in the country?', 'This question is a component of the Additional Question 3.
Additional Question 3a is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 197 , 'GRX_25_01', 'GRX_25_01', 'Did events, groups or individuals from outside the country contribute to government restrictions on religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 198 , 'GRX_25_02', 'GRX_25_02', 'Did events, groups or individuals from outside the country, which were entirely outside the country, contribute to government restrictions on religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 199 , 'GRX_25_03', 'GRX_25_03', 'Did events, groups or individuals from outside the country, which were in the country, contribute to government restrictions on religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 200 , 'SHX_27_ny', 'Additional Question 3b', 'Did events, groups or individuals from outside the country contribute to social hostilities involving religion in the country?', 'This question is a component of the Additional Question 3.
Additional Question 3b is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 201 , 'SHX_27_01', 'SHX_27_01', 'Did events, groups or individuals from outside the country contribute to social hostilities involving religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 202 , 'SHX_27_02', 'SHX_27_02', 'Did events, groups or individuals from outside the country, which were entirely outside the country, contribute to social hostilities involving religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 203 , 'SHX_27_03', 'SHX_27_03', 'Did events, groups or individuals from outside the country, which were in the country, contribute to social hostilities involving religion in the country?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 204 , 'XSG_242526_ny', 'Additional Question 4', 'Was there discrimination, harassment or violence in the country related to immigrants, in whole or part because of religion?', 'Additional Question 4 is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 205 , 'GRX_24_ny', 'Additional Question 4a', 'Did any level of government discriminate against, harass or use physical force toward immigrants or those seeking to immigrate in whole or part because of the immigrants'' religion?', 'This question is a component of the Additional Question 4.
Additional Question 4a is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 206 , 'GRX_24', 'GRX_24', 'Did any level of government discriminate against, harass or use physical force toward immigrants or those seeking to immigrate in whole or part because of the immigrants'' religion?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 207 , 'SHX_25_ny', 'Additional Question 4b', 'Did individuals or groups in society discriminate against, harass or commit acts of violence toward immigrants or those seeking to immigrate in whole or part because of the immigrants' religion?', 'This question is a component of the Additional Question 4.
Additional Question 4b is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 208 , 'SHX_25', 'SHX_25', 'Did individuals or groups in society discriminate against, harass or commit acts of violence toward immigrants or those seeking to immigrate in whole or part because of the immigrants' religion?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 209 , 'SHX_26_ny', 'Additional Question 4c', 'Did immigrants in the country engage in religion-related acts of violence?', 'This question is a component of the Additional Question 4.
Additional Question 4c is a new question, so data are only available for the year ending in mid-2010.', '', ''
UNION ALL SELECT 210 , 'SHX_26', 'SHX_26', 'Did immigrants in the country engage in religion-related acts of discrimination, harassment or violence?', '*** Included in other question: exact variable not currently used in toplines or results by country', '', ''
UNION ALL SELECT 211 , 'GRX_26_01', 'GRX_26_01', 'Did religion-related armed conflict that crosses a border contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 212 , 'GRX_26_02', 'GRX_26_02', 'Did religion-related terrorism with cross-border ties or acts contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 213 , 'GRX_26_03', 'GRX_26_03', 'Did the influence of foreign governments contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 214 , 'GRX_26_04', 'GRX_26_04', 'Did problems involving international immigrants contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 215 , 'GRX_26_05', 'GRX_26_05', 'Did extremist influences (alleged or real) contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 216 , 'GRX_26_06', 'GRX_26_06', 'Did hostile reactions to foreign (non-citizen) preachers contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 217 , 'GRX_26_07', 'GRX_26_07', 'Did hostile reactions to incidents that occurred in other countries contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 218 , 'GRX_26_08', 'GRX_26_08', 'Did other events, groups or individuals from outside the country contribute to government restrictions on religion in the country?', '', '', ''
UNION ALL SELECT 219 , 'GRX_27_01', 'GRX_27_01', 'There is no reported initiative that aimed to help improve respect for religious freedom in the country.', '', '', ''
UNION ALL SELECT 220 , 'GRX_27_02', 'GRX_27_02', 'Were initiatives reported at the local level that aimed to help improve respect for religious freedom in the country?', '', '', ''
UNION ALL SELECT 221 , 'GRX_27_03', 'GRX_27_03', 'Were initiatives reported at the national level that aimed to help improve respect for religious freedom in the country?', '', '', ''
UNION ALL SELECT 222 , 'GRX_28_01', 'GRX_28_01', 'There is no reported improvement in the respect for religious freedom by any level of the government.', '', '', ''
UNION ALL SELECT 223 , 'GRX_28_02', 'GRX_28_02', 'Was there an improvement reported at the local level in the respect for religious freedom by any level of the government?', '', '', ''
UNION ALL SELECT 224 , 'GRX_28_03', 'GRX_28_03', 'Was there an improvement reported at the national level in the respect for religious freedom by any level of the government?', '', '', ''
UNION ALL SELECT 225 , 'GRX_29_01', 'GRX_29_01', 'Were initiatives or actions reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 226 , 'GRX_29_02', 'GRX_29_02', 'Were interfaith dialogues reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 227 , 'GRX_29_03', 'GRX_29_03', 'Were antidiscrimination policies of actions reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 228 , 'GRX_29_04', 'GRX_29_04', 'Were educational and training initiatives reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 229 , 'GRX_29_05', 'GRX_29_05', 'Were land and property initiatives reported that aimed to reduce religious restrictions or hostilities in the country?', '', '', ''
UNION ALL SELECT 230 , 'SHX_14_01', 'SHX_14_01', 'Did a reaction to religious issues trigger the nongovernmental violence related to religion?', '', '', ''
UNION ALL SELECT 231 , 'SHX_14_02', 'SHX_14_02', 'Did a reaction to political issues trigger the nongovernmental violence related to religion?', '', '', ''
UNION ALL SELECT 232 , 'SHX_14_03', 'SHX_14_03', 'Did a reaction to other socio-economic issues trigger the nongovernmental violence related to religion?', '', '', ''
UNION ALL SELECT 233 , 'SHX_14_04', 'SHX_14_04', 'Sources do not specify the immediate triggering situation that led to the nongovernmental violence related to religion.', '', '', ''
UNION ALL SELECT 234 , 'SHX_15_01', 'SHX_15_01', 'Did Christians harass Christians?', '', '', ''
UNION ALL SELECT 235 , 'SHX_15_02', 'SHX_15_02', 'Did Christians harass Muslims?', '', '', ''
UNION ALL SELECT 236 , 'SHX_15_03', 'SHX_15_03', 'Did Christians harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 237 , 'SHX_15_04', 'SHX_15_04', 'Did Muslims harass Muslims?', '', '', ''
UNION ALL SELECT 238 , 'SHX_15_05', 'SHX_15_05', 'Did Muslims harass Christians?', '', '', ''
UNION ALL SELECT 239 , 'SHX_15_06', 'SHX_15_06', 'Did Muslims harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 240 , 'SHX_15_07', 'SHX_15_07', 'Did non-specifically identified group(s) harass Christians?', '', '', ''
UNION ALL SELECT 241 , 'SHX_15_08', 'SHX_15_08', 'Did non-specifically identified group(s) harass Muslims?', '', '', ''
UNION ALL SELECT 242 , 'SHX_15_09', 'SHX_15_09', 'Did non-specifically identified group(s) harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 243 , 'SHX_15_10', 'SHX_15_10', 'Did followers of religion(s) other than Christianity or Islam harass followers of religion(s) other than Christianity or Islam?', '', '', ''
UNION ALL SELECT 244 , 'SHX_28_01', 'SHX_28_01', 'Did religion-related armed conflict that crosses a border contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 245 , 'SHX_28_02', 'SHX_28_02', 'Did religion-related terrorism with cross-border ties or acts contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 246 , 'SHX_28_03', 'SHX_28_03', 'Did the influence of foreign governments contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 247 , 'SHX_28_04', 'SHX_28_04', 'Did problems involving international immigrants contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 248 , 'SHX_28_05', 'SHX_28_05', 'Did extremist influences (alleged or real) contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 249 , 'SHX_28_06', 'SHX_28_06', 'Did hostile reactions to foreign (non-citizen) preachers contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 250 , 'SHX_28_07', 'SHX_28_07', 'Did hostile reactions to incidents that occurred in other countries contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 251 , 'SHX_28_08', 'SHX_28_08', 'Did other events, groups or individuals from outside the country contribute to social hostilities involving religion in the country?', '', '', ''
UNION ALL SELECT 252 , 'XSG_01_xG1', 'XSG_01_xG1', 'Has there been any alleged harassment of Christianity by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 253 , 'XSG_01_xG2', 'XSG_01_xG2', 'Has there been any alleged harassment of Islam by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 254 , 'XSG_01_xG3', 'XSG_01_xG3', 'Has there been any alleged harassment of Buddhism by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 255 , 'XSG_01_xG4', 'XSG_01_xG4', 'Has there been any alleged harassment of Hinduism by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 256 , 'XSG_01_xG5', 'XSG_01_xG5', 'Has there been any alleged harassment of Judaism by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 257 , 'XSG_01_xG6', 'XSG_01_xG6', 'Has there been any alleged harassment of other religions by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 258 , 'XSG_01_xG7', 'XSG_01_xG7', 'Has there been any alleged harassment of ethnic or tribal religions by any level of government or by social groups?', '', '', ''
UNION ALL SELECT 259 , 'XSG_24', 'XSG_24', 'Is there a police force that enforces religious norms?', '', '', ''
UNION ALL SELECT 260 , 'XSG_S_01', 'XSG_S_01', 'Was the country Constitution used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 261 , 'XSG_S_02', 'XSG_S_02', 'Was the  U.S. State Department annual report on International Religious Freedom [current version] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 262 , 'XSG_S_03', 'XSG_S_03', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 1] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 263 , 'XSG_S_04', 'XSG_S_04', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 2] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 264 , 'XSG_S_05', 'XSG_S_05', 'Was the  U.S. State Department annual report on International Religious Freedom [current version minus 3] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 265 , 'XSG_S_06', 'XSG_S_06', 'Was the U.S. Commission on International Religious Freedom annual report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 266 , 'XSG_S_07', 'XSG_S_07', 'Was the U.N. Special Rapporteur on Freedom of Religion or Belief report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 267 , 'XSG_S_08', 'XSG_S_08', 'Was the Freedom House report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 268 , 'XSG_S_09', 'XSG_S_09', 'Was the Human Rights Watch topical report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 269 , 'XSG_S_10', 'XSG_S_10', 'Was the International Crisis Group country report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 270 , 'XSG_S_11', 'XSG_S_11', 'Was the International Crisis Group CrisisWatch bulletin used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 271 , 'XSG_S_12', 'XSG_S_12', 'Was the United Kingdom Foreign & Commonwealth Office annual report on human rights used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 272 , 'XSG_S_13', 'XSG_S_13', 'Was the Council of the European Union annual report on human rights used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 273 , 'XSG_S_14', 'XSG_S_14', 'Was the Amnesty International report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 274 , 'XSG_S_15', 'XSG_S_15', 'Was the European Network Against Racism Shadow Report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 275 , 'XSG_S_16', 'XSG_S_16', 'Was the United Nations High Commissioner for Refugees report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 276 , 'XSG_S_17', 'XSG_S_17', 'Was the U.S. State Department annual Country Report on Terrorism used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 277 , 'XSG_S_18', 'XSG_S_18', 'Was the TBC source on terrorism used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 278 , 'XSG_S_19', 'XSG_S_19', 'Was the Anti-Defamation League report used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 279 , 'XSG_S_20', 'XSG_S_20', 'Was the U.S. State Department Country Reports on Human Rights Practices used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 280 , 'XSG_S_21', 'XSG_S_21', 'Was the Uppsala University's Uppsala Conflict Data Program, Armed Conflict Database used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 281 , 'XSG_S_22', 'XSG_S_22', 'Was the Human Rights Without Frontiers "Freedom of Religion or Belief" newsletters used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 282 , 'XSG_S_23', 'XSG_S_23', 'Was the Hudson Institute publication: "Religious Freedom in the World" (Paul Marshall) used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 283 , 'XSG_S_99_filter', 'XSG_S_99_filter', 'How many other sources were used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 284 , 'XSG_S_99_01', 'XSG_S_99_01', 'Was any other source [1] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 285 , 'XSG_S_99_02', 'XSG_S_99_02', 'Was any other source [2] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 286 , 'XSG_S_99_03', 'XSG_S_99_03', 'Was any other source [3] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 287 , 'XSG_S_99_04', 'XSG_S_99_04', 'Was any other source [4] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 288 , 'XSG_S_99_05', 'XSG_S_99_05', 'Was any other source [5] used for coding government restrictions and social hostilities on religion?', '', '', ''
UNION ALL SELECT 289 , 'XSG_S_99_06', 'XSG_S_99_06', 'Was any other source [6] used for coding government restrictions and social hostilities on religion?', '', '', ''
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
GO
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S02_CrT_QnA_XLSXupd_________v03__RUN.sql                                                                                                                         
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                  ******************************************************************************************/
/***************************************************************************************************************************************************************/
-- this should be a view later
-- all answers should be parto of answers table
USE 
            [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
IF OBJECT_ID
         (N'[forum_ResAnal].[dbo].[AllAnswers]', N'U') IS NOT NULL
DROP TABLE
            [forum_ResAnal].[dbo].[AllAnswers]
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE
               [AllAnswers]
                                      (
                                       [QA_Number]       [bigint]         NULL
                                     , [Variable]        [nvarchar](128)  NULL
                                     , [Value]           [decimal](38,2)  NULL
                                     , [Answer_wording]  [nvarchar](max)  NULL
                                      )
ON [PRIMARY]
GO
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SET ANSI_PADDING OFF
GO
/***************************************************************************************************************************************************************/
/****** Load values using code from Excel **********************************************************************************************************************/
/***************************************************************************************************************************************************************/
INSERT INTO
               [AllAnswers]
                                      (
                                       [Variable]
                                     , [Value]
                                     , [Answer_wording]
                                      )
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
                 'GRI_scaled'          , 1.00 , 'Low'
UNION ALL SELECT 'GRI_scaled'          , 2.00 , 'Moderate'
UNION ALL SELECT 'GRI_scaled'          , 3.00 , 'High'
UNION ALL SELECT 'GRI_scaled'          , 4.00 , 'Very High'
UNION ALL SELECT 'SHI_scaled'          , 1.00 , 'Low'
UNION ALL SELECT 'SHI_scaled'          , 2.00 , 'Moderate'
UNION ALL SELECT 'SHI_scaled'          , 3.00 , 'High'
UNION ALL SELECT 'SHI_scaled'          , 4.00 , 'Very High'
UNION ALL SELECT 'GFI_scaled'          , 1.00 , 'Low'
UNION ALL SELECT 'GFI_scaled'          , 2.00 , 'Moderate'
UNION ALL SELECT 'GFI_scaled'          , 3.00 , 'High'
UNION ALL SELECT 'GFI_scaled'          , 4.00 , 'Very High'
UNION ALL SELECT 'GRI_rd_1d'           , 0.00 , 'scale 0 - [+.1] - 10'
UNION ALL SELECT 'SHI_rd_1d'           , 0.00 , 'scale 0 - [+.1] - 10'
UNION ALL SELECT 'GFI_rd_1d'           , 0.00 , 'scale 0 - [+.1] - 10'
UNION ALL SELECT 'GRI'                 , 0.00 , 'scale 0 - [+.] - 10'
UNION ALL SELECT 'SHI'                 , 0.00 , 'scale 0 - [+.] - 10'
UNION ALL SELECT 'GFI'                 , 0.00 , 'scale 0 - [+.] - 10'
UNION ALL SELECT 'GRI_01_x'            , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_01_x2'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x2'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_01_x2_a'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x2_a'         , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_01'              , 0.00 , 'Yes'
UNION ALL SELECT 'GRI_01'              , 0.50 , 'The constitution or basic law does not specifically provide for freedom of religion but does protect some religious practices'
UNION ALL SELECT 'GRI_01'              , 1.00 , 'No'
UNION ALL SELECT 'GRI_01_x2_b'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_01_x2_b'         , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_02'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_02'              , 0.33 , 'Yes, there is a qualification'
UNION ALL SELECT 'GRI_02'              , 0.67 , 'Yes, there is a substantial contradiction and only some religious practices are protected'
UNION ALL SELECT 'GRI_02'              , 1.00 , 'Religious freedom is not provided in the first place'
UNION ALL SELECT 'GRI_03'              , 0.00 , 'National laws and policies provide for religious freedom, and the national government respects religious freedom in practice'
UNION ALL SELECT 'GRI_03'              , 0.33 , 'National laws and policies provide for religious freedom, and the national government generally respects religious freedom in practice; but there are some instances (e.g., in certain localities) where religious freedom is not respected in practice'
UNION ALL SELECT 'GRI_03'              , 0.67 , 'There are limited national legal protections for religious freedom, but the national government does not generally respect religious freedom in practice'
UNION ALL SELECT 'GRI_03'              , 1.00 , 'National laws and policies do not provide for religious freedom and the national government does not respect religious freedom in practice'
UNION ALL SELECT 'GRI_04'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_04'              , 0.33 , 'Yes, in a few cases'
UNION ALL SELECT 'GRI_04'              , 0.67 , 'Yes, in many cases'
UNION ALL SELECT 'GRI_04'              , 1.00 , 'Government prohibits worship or religious practices of one or more religious groups as a general policy'
UNION ALL SELECT 'GRI_05'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_05'              , 0.50 , 'Yes, for some religious groups'
UNION ALL SELECT 'GRI_05'              , 1.00 , 'Yes, for all religious groups'
UNION ALL SELECT 'GRI_06'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_06'              , 0.50 , 'Yes, for some religious groups'
UNION ALL SELECT 'GRI_06'              , 1.00 , 'Yes, for all religious groups'
UNION ALL SELECT 'GRI_07'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_07'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_08_for_index'    , 0.00 , 'No'
UNION ALL SELECT 'GRI_08_for_index'    , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_08'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_08'              , 0.50 , 'Yes'
UNION ALL SELECT 'GRI_08'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_09'              , 0.00 , 'Yes'
UNION ALL SELECT 'GRI_09'              , 0.50 , 'Yes, but with restrictions'
UNION ALL SELECT 'GRI_09'              , 1.00 , 'No'
UNION ALL SELECT 'GRI_10'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_10'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_10_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_10_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_10_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_10_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_10_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_10_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_11'              , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11'              , 1.00 , 'Yes, there was widespread intimidation'
UNION ALL SELECT 'GRI_11_01a'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_01a'          , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_01a'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_01b'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_01b'          , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_01b'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_02'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_03'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_04'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_05'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_06'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_06'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_07'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_07'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_08'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_08'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_09'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_09'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_09'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_10'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_10'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_10'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_11'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_11'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_11'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_12'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_12'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_12'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_13'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_13'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_13'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_14'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_14'           , 0.50 , 'Yes, there was limited intimidation'
UNION ALL SELECT 'GRI_11_14'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_15'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_15'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_16'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_16'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_17'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_17'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG1'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG1'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG2'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG2'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG3'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG3'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG4'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG4'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG5'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG5'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG6'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG6'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_11_xG7'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_11_xG7'          , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_12'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_12'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_13'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_13'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_14'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_14'              , 0.33 , 'No, but the government consults a nongovernmental religious advisory board'
UNION ALL SELECT 'GRI_14'              , 0.67 , 'Yes, but the organization is noncoercive toward religious groups'
UNION ALL SELECT 'GRI_14'              , 1.00 , 'Yes, and the organization is coercive toward religious groups'
UNION ALL SELECT 'GRI_15'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_15'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_16_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_16_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRI_16_ny'           , 0.33 , 'Security reasons stated as rationale'
UNION ALL SELECT 'GRI_16_ny'           , 0.67 , 'Nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16_ny'           , 1.00 , 'Both security and nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_16'              , 0.33 , 'Yes, security reasons stated as rationale'
UNION ALL SELECT 'GRI_16'              , 0.67 , 'Yes, nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16'              , 1.00 , 'Yes, both security and nonsecurity reasons stated as rationale'
UNION ALL SELECT 'GRI_16_01'           , 0.00 , 'No groups'
UNION ALL SELECT 'GRI_16_01'           , 1.00 , 'One or more groups'
UNION ALL SELECT 'GRI_17'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_17'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_18'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_18'              , 0.33 , 'Yes, but in a nondiscriminatory way'
UNION ALL SELECT 'GRI_18'              , 0.67 , 'Yes, the process adversely affects the ability of some religious groups to operate'
UNION ALL SELECT 'GRI_18'              , 1.00 , 'Yes, and the process clearly discriminates against some religious groups'
UNION ALL SELECT 'GRI_19_filter'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_19_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_19_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_19_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRI_19_ny'           , 0.20 , '1-9 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 0.40 , '10-200 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 0.60 , '201-1,000 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 0.80 , '1,001-9,999 cases of government force'
UNION ALL SELECT 'GRI_19_ny'           , 1.00 , '10,000+ cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.00 , 'No'
UNION ALL SELECT 'GRI_19'              , 0.20 , 'Yes, 1-9 cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.40 , 'Yes, 10-200 cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.60 , 'Yes, 201-1,000 cases of government force'
UNION ALL SELECT 'GRI_19'              , 0.80 , 'Yes, 1,001-9,999 cases of government force'
UNION ALL SELECT 'GRI_19'              , 1.00 , 'Yes, 10,000+ cases of government force'
UNION ALL SELECT 'GRI_19_summ_ny'      , 0.00 , 'No'
UNION ALL SELECT 'GRI_19_summ_ny'      , 0.01 , 'Yes ^'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.02 , 'Property damage'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.03 , 'Detentions / abductions'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.04 , 'Displacement from homes'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.05 , 'Physical assaults'
UNION ALL SELECT 'GRI_19_summ_ny'      , 1.06 , 'Deaths'
UNION ALL SELECT 'GRI_19_x'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'GRI_19_b'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_c'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_d'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_da'           , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_db'           , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_e'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_19_f'            , 0.00 , ' cases found'
UNION ALL SELECT 'GRI_20'              , 0.00 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.02 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.03 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.05 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.07 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.08 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.10 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.12 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.13 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.15 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.17 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.18 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.20 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.22 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.23 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.25 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.27 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.28 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.30 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.32 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.33 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.35 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.37 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.38 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.40 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.42 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.43 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.45 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.47 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.48 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.50 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.52 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.53 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.55 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.57 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.58 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.60 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.62 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.63 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.65 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.67 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.68 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.70 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.72 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.73 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.75 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.77 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.78 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.80 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.82 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.83 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.85 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.87 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.88 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.90 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.92 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.93 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.95 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.97 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 0.98 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20'              , 1.00 , 'scale 0 - [+.01667] - 1'
UNION ALL SELECT 'GRI_20_top'          , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_top'          , 0.50 , 'Yes, the government provides support  to religious groups, but it does so on a more-or-less fair and equal basis'
UNION ALL SELECT 'GRI_20_top'          , 1.00 , 'Yes, the government gives preferential support or favors to some religious group(s) and clearly discriminates against others'
UNION ALL SELECT 'GRI_20_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_01a'      , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_01a'      , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_01b'      , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_01b'      , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_02'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_02'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_03'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_03'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_04'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_04'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_05'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_05'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_06'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_06'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_07'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_07'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_08'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_08'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_09'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_09'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_01x_10'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_01x_10'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_02'           , 0.00 , 'All religious groups are generally treated the same'
UNION ALL SELECT 'GRI_20_02'           , 0.25 , 'Some religious groups have minimal privileges unavailable to other religious groups, limited to things such as inheriting buildings or properties'
UNION ALL SELECT 'GRI_20_02'           , 0.50 , 'Some religious groups have general privileges or government access unavailable to other religious groups'
UNION ALL SELECT 'GRI_20_02'           , 0.75 , 'One religious group has privileges or government access unavailable to other religious groups, but it is not recognized as the country''s official religion'
UNION ALL SELECT 'GRI_20_02'           , 1.00 , 'One religious group has privileges or government access unavailable to other religious groups, and it is recognized by the national government as the official religion'
UNION ALL SELECT 'GRI_20_03_top'       , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_top'       , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_top'       , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_a'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_a'         , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_a'         , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_b'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_b'         , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_b'         , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_c'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_03_c'         , 0.50 , 'Yes, but with no obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_03_c'         , 1.00 , 'Yes, and with obvious favoritism to a particular group or groups'
UNION ALL SELECT 'GRI_20_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_04'           , 0.50 , 'Yes, by at least some local governments'
UNION ALL SELECT 'GRI_20_04'           , 1.00 , 'Yes, by the national government'
UNION ALL SELECT 'GRI_20_04_x'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_04_x'         , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRI_20_05_x'         , 0.00 , 'No'
UNION ALL SELECT 'GRI_20_05_x'         , 0.50 , 'Yes, in some Provinces'
UNION ALL SELECT 'GRI_20_05_x'         , 1.00 , 'Yes, in the whole country'
UNION ALL SELECT 'SHI_01'              , 0.00 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.17 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.33 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.50 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.67 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 0.83 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01'              , 1.00 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 0.01 , 'Yes ^'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.01 , 'Harassment/Intimidation'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.02 , 'Property damage'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.03 , 'Detentions/abductions'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.04 , 'Displacement from homes'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.05 , 'Physical assaults'
UNION ALL SELECT 'SHI_01_summary_a_ny' , 1.06 , 'Deaths'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.00 , 'scale 0 - [+.1667] - 0'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.17 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.33 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.50 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.67 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 0.83 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_a'    , 1.00 , 'scale 0 - [+.1667] - 1'
UNION ALL SELECT 'SHI_01_summary_b'    , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_summary_b'    , 1.00 , 'Yes: 1 type of '
UNION ALL SELECT 'SHI_01_summary_b'    , 2.00 , 'Yes: 2 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 3.00 , 'Yes: 3 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 4.00 , 'Yes: 4 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 5.00 , 'Yes: 5 types of '
UNION ALL SELECT 'SHI_01_summary_b'    , 6.00 , 'Yes: 6 types of '
UNION ALL SELECT 'SHI_01_x'            , 0.00 , ' cases found (in total, except harassment)'
UNION ALL SELECT 'SHI_01_a_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_a_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_b_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_b_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_c_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_c_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_d_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_d_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_e_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_e_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_f_dummy'      , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_f_dummy'      , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_a'            , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_a'            , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_a'            , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_01a'        , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_01a'        , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_01a'        , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_01b'        , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_01b'        , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_01b'        , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_02'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_02'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_02'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_03'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_03'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_03'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_04'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_04'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_04'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_05'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_05'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_05'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_06'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_06'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_06'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_07'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_07'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_07'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_08'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_08'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_08'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_09'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_09'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_09'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_10'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_10'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_10'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_11'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_11'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_11'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_12'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_12'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_12'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_13'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_13'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_13'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_14'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_14'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_14'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_15'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_15'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_15'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_17'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_17'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_17'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_x_16'         , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_x_16'         , 0.50 , 'Yes, in limited ways'
UNION ALL SELECT 'SHI_01_x_16'         , 1.00 , 'Yes, widespread social harassment'
UNION ALL SELECT 'SHI_01_xG1'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG1'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG2'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG2'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG3'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG3'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG4'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG4'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG5'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG5'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG6'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG6'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_xG7'          , 0.00 , 'No'
UNION ALL SELECT 'SHI_01_xG7'          , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_01_b'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_c'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_d'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_da'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_db'           , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_e'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_01_f'            , 0.00 , ' cases found'
UNION ALL SELECT 'SHI_02'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_02'              , 0.50 , 'Yes, but there were no deaths reported'
UNION ALL SELECT 'SHI_02'              , 1.00 , 'Yes, and there were deaths reported'
UNION ALL SELECT 'SHI_02_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_02_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_03'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_03'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_04_filter'       , 0.00 , 'No'
UNION ALL SELECT 'SHI_04_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_04_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_04_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHI_04_ny'           , 0.25 , 'Yes, but their activity was limited to recruitment or fundraising'
UNION ALL SELECT 'SHI_04_ny'           , 0.50 , 'Yes, with violence that resulted in some casualties (1-9 injuries or deaths)'
UNION ALL SELECT 'SHI_04_ny'           , 0.75 , 'Yes, with violence that resulted in multiple casualties (10-50 injuries or deaths)'
UNION ALL SELECT 'SHI_04_ny'           , 1.00 , 'Yes, with violence that resulted in many casualties (more than 50 injuries or deaths)'
UNION ALL SELECT 'SHI_04'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_04'              , 0.25 , 'Yes, but their activity was limited to recruitment and fundraising'
UNION ALL SELECT 'SHI_04'              , 0.50 , 'Yes, with violence that resulted in some casualties (1-9 injuries or deaths)'
UNION ALL SELECT 'SHI_04'              , 0.75 , 'Yes, with violence that resulted in multiple casualties (10-50 injuries or deaths)'
UNION ALL SELECT 'SHI_04'              , 1.00 , 'Yes, with violence that resulted in many casualties (more than 50 injuries or deaths)'
UNION ALL SELECT 'SHI_04_x'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_b'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_c'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_d'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_da'           , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_db'           , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_e'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_f'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_04_x01'          , 0.00 , 'No groups'
UNION ALL SELECT 'SHI_04_x01'          , 1.00 , 'One or more groups'
UNION ALL SELECT 'SHI_05_filter'       , 0.00 , 'No'
UNION ALL SELECT 'SHI_05_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_05_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_05_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHI_05_ny'           , 0.25 , 'Yes, with fewer than 10,000 casualties or people displaced'
UNION ALL SELECT 'SHI_05_ny'           , 0.50 , 'Yes, with tens of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05_ny'           , 0.75 , 'Yes, with hundreds of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05_ny'           , 1.00 , 'Yes, with millions of casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_05'              , 0.25 , 'Yes, with fewer than 10,000 casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 0.50 , 'Yes, with tens of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 0.75 , 'Yes, with hundreds of thousands of casualties or people displaced'
UNION ALL SELECT 'SHI_05'              , 1.00 , 'Yes, with millions of casualties or people displaced'
UNION ALL SELECT 'SHI_05_x'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_b'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_c'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_d'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_da'           , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_db'           , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_e'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_05_f'            , 0.00 , ' cases found (in total)'
UNION ALL SELECT 'SHI_06'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_06'              , 0.33 , 'There were public tensions between religious groups, but they fell short of hostilities involving physical violence'
UNION ALL SELECT 'SHI_06'              , 0.67 , 'Yes, with physical violence in a few cases'
UNION ALL SELECT 'SHI_06'              , 1.00 , 'Yes, with physical violence in numerous cases'
UNION ALL SELECT 'SHI_07_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHI_07_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHI_07_ny'           , 0.33 , 'At the local level'
UNION ALL SELECT 'SHI_07_ny'           , 0.67 , 'At the regional level'
UNION ALL SELECT 'SHI_07_ny'           , 1.00 , 'At the national level'
UNION ALL SELECT 'SHI_07'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_07'              , 0.33 , 'Yes, at the local level'
UNION ALL SELECT 'SHI_07'              , 0.67 , 'Yes, at the regional level'
UNION ALL SELECT 'SHI_07'              , 1.00 , 'Yes, at the national level'
UNION ALL SELECT 'SHI_08'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_08'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_09'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_09'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_10'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_10'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_11_for_index'    , 0.00 , 'No'
UNION ALL SELECT 'SHI_11_for_index'    , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_11'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_11'              , 0.50 , 'Yes'
UNION ALL SELECT 'SHI_11'              , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_11_x'            , 0.00 , 'No'
UNION ALL SELECT 'SHI_11_x'            , 0.50 , 'No, but religious women were harassed for violating secular norms'
UNION ALL SELECT 'SHI_11_x'            , 1.00 , 'Yes'
UNION ALL SELECT 'SHI_12'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_12'              , 0.50 , 'Yes, but they fell short of physical violence'
UNION ALL SELECT 'SHI_12'              , 1.00 , 'Yes, and they included physical violence'
UNION ALL SELECT 'SHI_13'              , 0.00 , 'No'
UNION ALL SELECT 'SHI_13'              , 0.50 , 'Yes, but they fell short of physical violence'
UNION ALL SELECT 'SHI_13'              , 1.00 , 'Yes, and they included physical violence'
UNION ALL SELECT 'GRI_20_05_x1'        , 1.00 , '(probably means no)'
UNION ALL SELECT 'GRI_20_05_x1'        , 2.00 , '(probably means yes)'
UNION ALL SELECT 'GRX_21_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_21_01'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'GRX_21_01'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'GRX_21_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_21_02'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'GRX_21_02'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'GRX_21_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_21_03'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'GRX_21_03'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'GRX_22_filter'       , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_filter'       , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_22_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_ny'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_ny'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22'              , 0.00 , 'No'
UNION ALL SELECT 'GRX_22'              , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22'              , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22'              , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_01'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_01'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_01'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_01_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_01_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_01_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_01_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_02'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_02'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_02'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_02_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_02_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_02_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_02_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_03'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_03'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_03'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_04_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_04_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_04_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_04_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_03_ny'        , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_03_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_22_03_ny'        , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_03_ny'        , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'GRX_22_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_22_04'           , 0.33 , 'No, but such a policy is being considered'
UNION ALL SELECT 'GRX_22_04'           , 0.67 , 'Yes, but penalties are not enforced'
UNION ALL SELECT 'GRX_22_04'           , 1.00 , 'Yes, and penalties are enforced'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.00 , 'No'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.01 , 'Yes'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.02 , 'Yes, but the implicated events, groups or individuals were entirely outside the country'
UNION ALL SELECT 'XSG_25n27_ny'        , 0.03 , 'Yes, and the implicated events, groups or individuals were in the country'
UNION ALL SELECT 'GRX_23'              , 0.00 , 'No'
UNION ALL SELECT 'GRX_23'              , 0.50 , 'No, but by social norms'
UNION ALL SELECT 'GRX_23'              , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_25_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_25_ny'           , 0.02 , 'Yes, but the implicated events, groups or individuals were entirely outside the country'
UNION ALL SELECT 'GRX_25_ny'           , 0.03 , 'Yes, and the implicated events, groups or individuals were in the country'
UNION ALL SELECT 'GRX_25_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_25_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_25_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_25_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_27_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHX_27_ny'           , 0.02 , 'Yes, but the implicated events, groups or individuals were entirely outside the country'
UNION ALL SELECT 'SHX_27_ny'           , 0.03 , 'Yes, and the implicated events, groups or individuals were in the country'
UNION ALL SELECT 'SHX_27_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_27_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_27_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_27_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_242526_ny'       , 0.00 , 'No'
UNION ALL SELECT 'XSG_242526_ny'       , 0.01 , 'Yes'
UNION ALL SELECT 'XSG_242526_ny'       , 0.33 , 'Yes, there was no physical violence'
UNION ALL SELECT 'XSG_242526_ny'       , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'XSG_242526_ny'       , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'GRX_24_ny'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_24_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'GRX_24_ny'           , 0.33 , 'Yes, there were cases of obvious government discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'GRX_24_ny'           , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'GRX_24_ny'           , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'GRX_24'              , 0.00 , 'No'
UNION ALL SELECT 'GRX_24'              , 0.33 , 'Yes, there were cases of obvious government discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'GRX_24'              , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'GRX_24'              , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_25_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_25_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHX_25_ny'           , 0.33 , 'Yes, there were cases of obvious social discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'SHX_25_ny'           , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_25_ny'           , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_25'              , 0.00 , 'No'
UNION ALL SELECT 'SHX_25'              , 0.33 , 'Yes, there were cases of obvious social discrimination or harassment that did not, however, involve physical violence'
UNION ALL SELECT 'SHX_25'              , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_25'              , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_26_ny'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_26_ny'           , 0.01 , 'Yes'
UNION ALL SELECT 'SHX_26_ny'           , 0.33 , 'Yes, but they engaged in crimes or malicious acts motivated by religious hatred or bias that fell short of violence'
UNION ALL SELECT 'SHX_26_ny'           , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_26_ny'           , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'SHX_26'              , 0.00 , 'No'
UNION ALL SELECT 'SHX_26'              , 0.33 , 'Yes, but they engaged in crimes or malicious acts motivated by religious hatred or bias that fell short of violence'
UNION ALL SELECT 'SHX_26'              , 0.67 , 'Yes, and it involved physical violence, but no-one was killed'
UNION ALL SELECT 'SHX_26'              , 1.00 , 'Yes, and it involved physical violence, and it resulted in deaths'
UNION ALL SELECT 'GRX_26_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_06'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_07'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_26_08'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_26_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_27_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_27_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_27_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_27_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_27_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_27_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_28_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_28_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_28_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_28_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_28_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_28_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_01'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_02'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_03'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_04'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'GRX_29_05'           , 0.00 , 'No'
UNION ALL SELECT 'GRX_29_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_14_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_01'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_01'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_14_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_02'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_02'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_14_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_03'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_03'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_14_04'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_14_04'           , 0.50 , 'Yes, in one case'
UNION ALL SELECT 'SHX_14_04'           , 1.00 , 'Yes, in more than one case'
UNION ALL SELECT 'SHX_15_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_04'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_05'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_06'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_07'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_08'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_09'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_09'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_15_10'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_15_10'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_01'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_01'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_02'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_02'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_03'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_03'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_04'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_04'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_05'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_05'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_06'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_06'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_07'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_07'           , 1.00 , 'Yes'
UNION ALL SELECT 'SHX_28_08'           , 0.00 , 'No'
UNION ALL SELECT 'SHX_28_08'           , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG1'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG1'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG2'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG2'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG3'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG3'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG4'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG4'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG5'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG5'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG6'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG6'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_01_xG7'          , 0.00 , 'No'
UNION ALL SELECT 'XSG_01_xG7'          , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_24'              , 0.00 , 'No'
UNION ALL SELECT 'XSG_24'              , 0.50 , 'Yes, but nongovernmental'
UNION ALL SELECT 'XSG_24'              , 1.00 , 'Yes, and governmental'
UNION ALL SELECT 'XSG_S_01'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_01'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_01'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_02'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_02'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_02'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_03'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_03'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_03'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_04'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_04'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_04'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_05'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_05'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_05'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_06'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_06'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_06'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_07'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_07'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_07'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_08'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_08'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_08'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_09'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_09'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_09'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_10'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_10'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_10'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_11'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_11'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_11'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_12'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_12'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_12'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_13'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_13'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_13'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_14'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_14'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_14'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_15'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_15'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_15'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_16'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_16'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_16'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_17'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_17'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_17'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_18'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_18'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_18'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_19'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_19'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_19'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_20'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_20'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_20'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_21'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_21'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_21'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_22'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_22'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_22'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_23'            , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_23'            , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_23'            , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_filter'     , 0.00 , 'No'
UNION ALL SELECT 'XSG_S_99_filter'     , 1.00 , 'Yes'
UNION ALL SELECT 'XSG_S_99_01'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_01'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_02'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_02'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_03'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_03'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_04'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_04'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_05'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_05'         , 1.00 , 'Country included in the source, with new information obtained'
UNION ALL SELECT 'XSG_S_99_06'         , 0.50 , 'Country included in the source, but no new information obtained'
UNION ALL SELECT 'XSG_S_99_06'         , 1.00 , 'Country included in the source, with new information obtained'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
GO
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S11_Cr_V1DBLong_extrX_fromFORUM_aut.sql                                                                                                                          
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***      The long set of data includes numeric values and descriptive wordings.                                                                             ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V1_DB_Long]
AS
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Basic Data: Long NPR ******************************************************************************************/
----------------------------------------------------------------------------------------------------------------------
/*** Set of data at country level ***********************************************************************************/
SELECT
           entity      = 'Ctry'
      ,    link_fk     = KN.[Nation_answer_pk]
      ,    Nation_fk   = N.[Nation_pk]
      ,    Locality_fk = NULL
      ,    Religion_fk = NULL
      ,    Region5     = N.[Region]
      ,    Region6     = N.[SubRegion6]
      , N.[Ctry_EditorialName]
      ,    Locality    = 'not detailed'
      ,    Religion    = ''
      , Q.[Question_Year]
      ,    QA_std      = Q.[Question_abbreviation_std]
      ,    QW_std      = Q.[Question_short_wording_std]
      , A.[Answer_value]
      , A.[answer_wording]
      , A.[answer_wording_std]
      ,    Question_fk = Q.[Question_pk]
      ,    Answer_fk   = A.[Answer_pk]
      , Q.[Notes]
  FROM [forum].[dbo].[Pew_Answer]            A
      ,[forum].[dbo].[Pew_Question]          Q
      ,[forum].[dbo].[Pew_Nation]            N
      ,[forum].[dbo].[Pew_Nation_Answer]     KN
WHERE Q.[Question_pk] =  A.[Question_fk]
  AND A.[Answer_pk]   = KN.[Answer_fk]
  AND N.[Nation_pk]   = KN.[Nation_fk]
/*********************************************************************************** Set of data at country level ***/
UNION
/*** Set of data at country/religious group level *******************************************************************/
SELECT
           entity      = 'RGrp'
      ,    link_fk     = KR.[Nation_religion_answer_pk]
      ,    Nation_fk   = N.[Nation_pk]
      ,    Locality_fk = NULL
      ,    Religion_fk = G.[Religion_group_pk]
      ,    Region5     = N.[Region]
      ,    Region6     = N.[SubRegion6]
      , N.[Ctry_EditorialName]
      ,    Locality    = 'not detailed'
      ,    Religion    = G.[Pew_religion]
      , Q.[Question_Year]
      , Q.[Question_abbreviation_std]  AS  QA_std
      , Q.[Question_short_wording_std] AS  QW_std
      , A.[Answer_value]
      , A.[answer_wording]
      , A.[answer_wording_std]
      ,    Question_fk = Q.[Question_pk]
      ,    Answer_fk   = A.[Answer_pk]
      , Q.[Notes]
  FROM [forum].[dbo].[Pew_Answer]                   A
      ,[forum].[dbo].[Pew_Question]                 Q
      ,[forum].[dbo].[Pew_Nation]                   N
      ,[forum].[dbo].[Pew_Religion_Group]           G
      ,[forum].[dbo].[Pew_Nation_Religion_Answer]   KR
WHERE  Q.[Question_pk]       =  A.[Question_fk]
  AND  A.[Answer_pk]         = KR.[Answer_fk]
  AND KR.[Religion_group_fk] =  G.[Religion_group_pk]
  AND  N.[Nation_pk]         = KR.[Nation_fk]
                           /* Pull only data on Restrictions */
  AND (   Q.[Question_abbreviation_std] like 'SHI_%'
       OR Q.[Question_abbreviation_std] like 'GRI_%'  )
/******************************************************************* Set of data at country/religious group level ***/
UNION
/*** Set of data at country/province level **************************************************************************/
SELECT
           entity             = 'Prov'
      ,    link_fk     = KL.[Locality_answer_pk]
      ,    Nation_fk   = N.[Nation_pk]
      ,    Locality_fk = L.[Locality_pk]
      ,    Religion_fk = NULL
      ,    Region5     = N.[Region]
      ,    Region6     = N.[SubRegion6]
      , N.[Ctry_EditorialName]
      ,    Locality    = L.Locality
      ,    Religion    = ''
      , Q.[Question_Year]
      ,    QA_std      = Q.[Question_abbreviation_std]
      ,    QW_std      = Q.[Question_short_wording_std]
      , A.[Answer_value]
      , A.[answer_wording]
      , A.[answer_wording_std]
      ,    Question_fk = Q.[Question_pk]
      ,    Answer_fk   = A.[Answer_pk]
      , Q.[Notes]
  FROM [forum].[dbo].[Pew_Answer]            A
      ,[forum].[dbo].[Pew_Question]          Q
      ,[forum].[dbo].[Pew_Locality]          L
      ,[forum].[dbo].[Pew_Nation]            N
      ,[forum].[dbo].[Pew_Locality_Answer]   KL
WHERE Q.[Question_pk] = A.[Question_fk]
  AND A.[Answer_pk]   = KL.[Answer_fk]
  AND L.[Locality_pk] = KL.[Locality_fk]
  AND N.[Nation_pk]   =
                           /* In order to keep consistent to previuos years 
                              Data by Province currently belonging to South Sudan
                              should considered data for Sudan before 2010: */
                     CASE 
                            WHEN L.[Nation_fk]     = 237 
                             AND Q.[Question_Year] < 2010 
                            THEN                           197
                            ELSE                           L.[Nation_fk]
                     END 
                           /* In order to avoid changing the final set,
                              Data previously used for Northern Cyprus
                              should be excluded: ????                                 */
                           /* Although we have REAL data by province for North Korea,
                              we will not use them in this analysis: ????              */
/************************************************************************** Set of data at country/province level ***/
----------------------------------------------------------------------------------------------------------------------
/******************************************************************************************  Basic Data: Long NPR ***/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S12_Cr_V2WbyCtryYear_________v02__RUN.sql                                                                                                                        
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V2_WRestr_by_Ctry&Year]                                                    <<<<<     ***/
/***             This view only includes numeric values aggregated by country/religion & year (does not include descriptive wordings).                       ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V2_W_by_Ctry&Year]
AS
/***************************************************************************************************************************************************************/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/***************************************************************************************************************************************************************/
SELECT
       *
FROM
/***************************************************************************************************************************************************************/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Long NPR aggregated by country (& religion due to variable names)  ***************************************************************************************/
N'
(
/***************************************************************************************************************************************************************/
SELECT 
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
      ,[Answer_value]      = SUM([Answer_value])
  FROM
/***  Basic Data: Long NPR *************************************************************************************************************************************/
            [V1_DB_Long]
/************************************************************************************************************************************  Basic Data: Long NPR  ***/
GROUP BY
       [Nation_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
/***************************************************************************************************************************************************************/
)                                                                                                                                                      AS   lnpr
'
/***************************************************************************************  Long NPR aggregated by country (& religion due to variable names)  ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/***************************************************************************************************************************************************************/
PIVOT
(
  MAX([Answer_value])
  FOR [QA_std]
                   in (
/***************************************************************************************************************************************************************/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement (notice THERE IS alias for the recoded field           ***/
          DISTINCT                                                              /*** should be distinct to include once each variable name                   ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [QA_std]                                                              /*** Fiels including all Q Abb Std (StdVarName)                              ***/
    FROM                                                                        /*** from...                                                                 ***/
          [V1_DB_Long]                                                          /*** name of the table which includes all field (var) names as rows          ***/
                                                                                /*** NO FILTERS needed                                                       ***/
         ORDER BY                                                               /*** sorting order using exact final field, including:                       ***/
          ', '                                                                  /*** comma delimiter                                  -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          [QA_std]                                                              /*** Fiels including all Q Abb Std (StdVarName)       -> as part of sorting  ***/
         for xml path('')                                                       /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/***************************************************************************************************************************************************************/
)                                                                               /*** end of listing of variables                                             ***/
 )                                                                                                                                                      AS   pivt
/***************************************************************************************************************************************************************/
'
/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--  SELECT @ALLCODE
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
/***************************************************************************************************************************************************************/
EXEC  (@ALLCODE)
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S13_Cr_V3WnRbyCtryYear_____v13__RUN.sql                                                                                                                          
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[V3_WRestr&Extras_by_Ctry&Year]                                  <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V3_W&Extras_by_Ctry&Year]
AS
/***************************************************************************************************************************************************************/
--*** May need to:
--    Clean XSG_25n27  as rowmax(GRX_25_01_2010 SHX_27_01_2010)
/*** main select statement *************************************************************************************************************************************/
/*** table including numeric values + Step-3 calculated variables **********************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI_scaled index */
         GRI_scaled 
         =        CAST ((
                  CASE
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'low'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 1.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'moderate'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 2.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 3.00
                  WHEN GRI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'very high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GRI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
/* SHI_scaled index */
      ,  SHI_scaled 
         =        CAST ((
                  CASE
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'low'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 1.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'moderate'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 2.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 3.00
                  WHEN SHI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'very high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'SHI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GFI_scaled index */
      ,  GFI_scaled 
         =        CAST ((
                  CASE
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'low'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 1.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'moderate'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 2.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 3.00
                  WHEN GFI <= ( SELECT [CutPoint] FROM [forum].[dbo].[Pew_Field]
                                                     , [forum].[dbo].[Pew_Index_Cut_Points]
                                WHERE  [Field_fk]   = [Field_pk]
                                  AND  [Level]      = 'very high'
                                  AND  [Point]      = 'highest'
                                  AND  [Field_type] = 'GFI'
                                  AND  [Field_year] = '2007'
                              )
                  THEN 4.00
                  END
                                                               ) AS DECIMAL (38,2))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI_rounded index */
      ,  GRI_rd_1d 
         =        CAST ((
                                  GRI 
                                                               ) AS DECIMAL (38,1))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
/* SHI_rounded index */
      ,  SHI_rd_1d 
         =        CAST ((
                                  SHI 
                                                               ) AS DECIMAL (38,1))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GFI_rounded index */
      ,  GFI_rd_1d 
         =        CAST ((
                                  GFI
                                                               ) AS DECIMAL (38,1))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------



-------------------------------------------------------------------------------------------------------------------------------------------------------------------
       ,
 *
FROM
/***************************************************************************************************************************************************************/
(
/*** table including numeric values + Step-2 calculated variables **********************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GRI index */
         GRI 
         =
--/*********************************************************************************************/    
--                  CASE
--/*  Fit previously published data  ----------------------------------------------------------*/    
--    ---------------------------------------------------------------------------------------
--	                                        WHEN Nation_fk	               = 69
--	                                         AND Question_Year             = 2011
--	                                        THEN 1.8
--    -----------------------------------------------------------------------------------------
--                                            WHEN Nation_fk	               = 146
--                                             AND Question_Year             = 2011
--                                            THEN 1.950
--    -----------------------------------------------------------------------------------------
--                                            WHEN Nation_fk	               = 131
--                                             AND Question_Year             = 2011
--                                            THEN 1.350
--    -----------------------------------------------------------------------------------------
--                                            WHEN Nation_fk	               = 186
--                                             AND Question_Year             = 2011
--                                            THEN 1.750
--    -----------------------------------------------------------------------------------------
--/*  Fit previously published median  --------------------------------------------------------*/    
--    ---------------------------------------------------------------------------------------
--                                            WHEN Nation_fk	               = 116
--                                             AND Question_Year             = 2010
--                                            THEN 5.844
--    ---------------------------------------------------------------------------------------
--                  ELSE
--/*********************************************************************************************/    
                  ROUND(
                  CAST ((((
                                [GRI_01]
                         +      [GRI_02]
                         +      [GRI_03]
                         +      [GRI_04]
                         +      [GRI_05]
                         +      [GRI_06]
                         +      [GRI_07]
                         +      [GRI_08_for_index]
                         +      [GRI_09]
                         +      [GRI_10]
                         +      [GRI_11]
                         +      [GRI_12]
                         +      [GRI_13]
                         +      [GRI_14]
                         +      [GRI_15]
                         +      [GRI_16]
                         +      [GRI_17]
                         +      [GRI_18]
                         +      [GRI_19]
                         +      [GRI_20]
                                                       ) / 2    )
                                                                  ) AS float) ,64)
--                                                                ) AS DECIMAL (38,4)) ,4)
--                  END
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* SHI index */
       , SHI 
         =        ROUND(
                  CAST ((((
                                [SHI_01]
                         +      [SHI_02]
                         +      [SHI_03]
                         +      [SHI_04]
                         +      [SHI_05]
                         +      [SHI_06]
                         +      [SHI_07]
                         +      [SHI_08]
                         +      [SHI_09]
                         +      [SHI_10]
                         +      [SHI_11_for_index]
                         +      [SHI_12]
                         +      [SHI_13]
                                                       ) / 1.3  )
                                                                  ) AS float) ,64)
--                                                                ) AS DECIMAL (38,4)) ,4)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* GFI index */
       , GFI 
         =        ROUND(
                  CAST ((((
                                [GRI_20_01]
                         +      [GRI_20_02]
                         + ( (  [GRI_20_03_a]
                              + [GRI_20_03_b]
                              + [GRI_20_03_c]
                                               ) / 3 )
                         +      [GRI_20_04]
                         +      [GRI_20_05]
                                                       ) / 5 ) 
                                                              * 10
                                                                  ) AS float) ,64)
--                                                                ) AS DECIMAL (38,4)) ,4)
--         =        GRI_20 * 10
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Christianity */
       , XSG_01_xG1 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG1 + SHI_01_xG1 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Islam */
       , XSG_01_xG2 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG2 + SHI_01_xG2 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Buddhism */
       , XSG_01_xG3 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG3 + SHI_01_xG3 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Hinduism */
       , XSG_01_xG4 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG4 + SHI_01_xG4 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Judaism */
       , XSG_01_xG5 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG5 + SHI_01_xG5 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
       , XSG_01_xG6 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG6 + SHI_01_xG6 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Government & Social harassment of Ethnic or Tribal Religions */
       , XSG_01_xG7 
         =        CAST ((
                  CASE
                  WHEN GRI_11_xG7 + SHI_01_xG7 > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_01_summary_a_ny           for toplines */
       ,           SHI_01_summary_a_ny0
       = CAST ((
         CASE 
              WHEN SHI_01     =  0.00
              THEN               0.00
              WHEN SHI_01     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_ny1
       = CAST ((
         CASE 
              WHEN SHI_01_a   >  0.00
              THEN               1.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_ny2
       = CAST ((
         CASE 
              WHEN SHI_01_b   >  0.00
              THEN               1.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_ny3
       = CAST ((
         CASE 
              WHEN SHI_01_c   >  0.00
              THEN               1.03
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_ny4
       = CAST ((
         CASE 
              WHEN SHI_01_d   >  0.00
              THEN               1.04
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_ny5
       = CAST ((
         CASE 
              WHEN SHI_01_e   >  0.00
              THEN               1.05
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_summary_a_ny6
       = CAST ((
         CASE 
              WHEN SHI_01_f   >  0.00
              THEN               1.06
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 XSG_242526_ny           for toplines */
       ,           XSG_242526_ny0
       = CAST ((
         CASE WHEN GRX_24     = 0.00
               AND SHX_25     = 0.00
               AND SHX_26     = 0.00
              THEN              0.00
              WHEN GRX_24     = 1.00
                OR SHX_25     = 1.00
                OR SHX_26     = 1.00
              THEN              1.00
              WHEN GRX_24     = 0.67
                OR SHX_25     = 0.67
                OR SHX_26     = 0.67
              THEN              0.67
              WHEN GRX_24     = 0.33
                OR SHX_25     = 0.33
                OR SHX_26     = 0.33
              THEN              0.33
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_242526_ny1
       = CAST ((
         CASE WHEN GRX_24     > 0.00
                OR SHX_25     > 0.00
                OR SHX_26     > 0.00
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 XSG_25n27_ny           for toplines */
       ,           XSG_25n27_ny1
       = CAST ((
         CASE WHEN GRX_25_ny1 = 0.00
               AND SHX_27_ny1 = 0.00
              THEN              0.00
              WHEN GRX_25_ny1 = 0.01
                OR SHX_27_ny1 = 0.01
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_25n27_ny2
       = CAST ((
         CASE WHEN GRX_25_ny2 = 0.02
                OR SHX_27_ny2 = 0.02
              THEN              0.02
              END
                                                               ) AS DECIMAL (38,2))
       ,           XSG_25n27_ny3
       = CAST ((
         CASE WHEN GRX_25_ny3 = 0.03
                OR SHX_27_ny3 = 0.03
              THEN              0.03
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------

       , *
FROM
/***************************************************************************************************************************************************************/
(
/*** table including numeric values + Step-1 calculated variables **********************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
         GRI_20
         =        ROUND(
                  CAST ((((
                                [GRI_20_01]
                         +      [GRI_20_02]
                         + ( (  [GRI_20_03_a]
                              + [GRI_20_03_b]
                              + [GRI_20_03_c]
                                               ) / 3 )
                         +      [GRI_20_04]
                         +      [GRI_20_05]
                                                       ) / 5  )
                                                               ) AS DECIMAL (38,2)) ,2)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , GRI_20_top
         =        CAST ((
                  CASE
                  WHEN GRI_20_03_a = 1
                    OR GRI_20_03_b = 1
                    OR GRI_20_03_c = 1
                    OR GRI_20_02   > 0.5
                  THEN               1.00
                  WHEN GRI_20_01   > 0
                    OR GRI_20_02   > 0
                    OR GRI_20_03_a > 0
                    OR GRI_20_03_b > 0
                    OR GRI_20_03_c > 0
                    OR GRI_20_04   > 0
                    OR GRI_20_05   > 0
                  THEN               0.50
                  ELSE               0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , GRI_20_03_top
         =        CAST ((
                  CASE
                  WHEN GRI_20_03_a >= GRI_20_03_b
                   AND GRI_20_03_a >= GRI_20_03_c
                  THEN GRI_20_03_a
                  WHEN GRI_20_03_b >= GRI_20_03_a
                   AND GRI_20_03_b >= GRI_20_03_c
                  THEN GRI_20_03_b
                  WHEN GRI_20_03_c >= GRI_20_03_b
                   AND GRI_20_03_c >= GRI_20_03_c
                  THEN GRI_20_03_c
                  ELSE NULL
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , 
--       select
       SHI_01
         =        CAST ((
                  (
                  CAST ((
                    ( CASE
                      WHEN SHI_01_a > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_b > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_c > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_d > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_e > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_f > 0 THEN 1
                      ELSE                   0
                       END                     )
                                                       
                                                               ) AS DECIMAL (38,2))
                                                                                    / 6 )
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , SHI_01_summary_b
         =        CAST ((
                    ( CASE
                      WHEN SHI_01_a > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_b > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_c > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_d > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_e > 0 THEN 1
                      ELSE                   0
                       END                     )
                  + ( CASE
                      WHEN SHI_01_f > 0 THEN 1
                      ELSE                   0
                       END                     )
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_01_[a,b,c,d,e,f]_dummy for tables of question answers by country */
       ,           SHI_01_a_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_a   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_b_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_b   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_c_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_c   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_d_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_d   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_e_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_e   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHI_01_f_dummy
       = CAST ((
         CASE 
              WHEN SHI_01_f   >  0.00
              THEN               1
              ELSE               0
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Christianity */
       , GRI_11_xG1
         =        CAST ((
                  CASE
                  WHEN   GRI_11_01a
                       + GRI_11_01b
                       + GRI_11_02
                       + GRI_11_03
                       + GRI_11_11
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Islam */
       , GRI_11_xG2 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_04
                       + GRI_11_05
                       + GRI_11_06
                       + GRI_11_12
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Buddhism */
       , GRI_11_xG3 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_07
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Hinduism */
       , GRI_11_xG4 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_08
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Judaism */
       , GRI_11_xG5 
         =        CAST ((
                  CASE
                  WHEN   GRI_11_09
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
       , GRI_11_xG6 
         =        CAST ((
                  CASE
                  WHEN   isnull(GRI_11_10, 0)
                       + isnull(GRI_11_14, 0)
                       + isnull(GRI_11_15, 0)
                       + isnull(GRI_11_16, 0)
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Gov harassment of Ethnic or Tribal Religions */
       , GRI_11_xG7
         =        CAST ((
                  CASE
                  WHEN   GRI_11_13
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Christianity */
       , SHI_01_xG1
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_01a
                       + SHI_01_x_01b
                       + SHI_01_x_02
                       + SHI_01_x_03
                       + SHI_01_x_11
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Islam */
       , SHI_01_xG2 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_04
                       + SHI_01_x_05
                       + SHI_01_x_06
                       + SHI_01_x_12
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Buddhism */
       , SHI_01_xG3 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_07
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Hinduism */
       , SHI_01_xG4 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_08
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Judaism */
       , SHI_01_xG5 
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_09
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Other ('New' Religions, Ancient Religions, Sikhs, Zoroastrianism) */
       , SHI_01_xG6 
         =        CAST ((
                  CASE
                  WHEN   isnull(SHI_01_x_10, 0)
                       + isnull(SHI_01_x_14, 0)
                       + isnull(SHI_01_x_15, 0)
                       + isnull(SHI_01_x_16, 0)
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* Social harassment of Ethnic or Tribal Religions */
       , SHI_01_xG7
         =        CAST ((
                  CASE
                  WHEN   SHI_01_x_13
                  > 0
                  THEN 1.00
                  ELSE 0.00
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* recode GRI_08 to be used as index-factor */
       , GRI_08_for_index
         =        CAST ((
                  CASE
                  WHEN GRI_08  = 0.5
                  THEN           1
                  ELSE GRI_08
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/* recode SHI_Q_11 to be used as index-factor */
       , SHI_11_for_index
         =        CAST ((
                  CASE
                  WHEN SHI_11  = 0.5
                  THEN           1
                  ELSE SHI_11
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_16               for toplines */
       ,           GRI_16_ny1
       =           GRI_16
       ,           GRI_16_ny2
       = CAST ((
         CASE WHEN GRI_16  > 0
                  THEN           0.01
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_19               for toplines */
       ,           GRI_19_ny1
       =           GRI_19
       ,           GRI_19_ny2
       = CAST ((
         CASE WHEN GRI_19  > 0
              THEN           0.01
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_19_summ_ny          for toplines */
       ,           GRI_19_summ_ny1
       = CAST ((
         CASE 
              WHEN GRI_19     =  0.00
              THEN               0.00
              WHEN GRI_19     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_ny2
       = CAST ((
         CASE 
              WHEN GRI_19_b   >  0.00
              THEN               1.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_ny3
       = CAST ((
         CASE 
              WHEN GRI_19_c   >  0.00
              THEN               1.03
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_ny4
       = CAST ((
         CASE 
              WHEN GRI_19_d   >  0.00
              THEN               1.04
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_ny5
       = CAST ((
         CASE 
              WHEN GRI_19_e   >  0.00
              THEN               1.05
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRI_19_summ_ny6
       = CAST ((
         CASE 
              WHEN GRI_19_f   >  0.00
              THEN               1.06
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRI_19_x              for toplines */
       ,           GRI_19_x
       =           ISNULL(GRI_19_b, 0)
                 + ISNULL(GRI_19_c, 0)
                 + ISNULL(GRI_19_d, 0)
                 + ISNULL(GRI_19_e, 0)
                 + ISNULL(GRI_19_f, 0)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_04_ny          for toplines */
       ,           SHI_04_ny0
       =           SHI_04

       ,           SHI_04_ny1
       = CAST ((
         CASE 
              WHEN SHI_04     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_05_ny          for toplines */
       ,           SHI_05_ny0
       =           SHI_05
       ,           SHI_05_ny1
       = CAST ((
         CASE 
              WHEN SHI_05     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHI_07_ny          for toplines */
       ,           SHI_07_ny0
       =           SHI_07
       ,           SHI_07_ny1
       = CAST ((
         CASE 
              WHEN SHI_07     >  0.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
--/*                 SHI_01_x              for toplines shoul;d be added???*/
--       ,           SHI_01_x
--       =           ISNULL(SHI_01_b, 0)
--                 + ISNULL(SHI_01_c, 0)
--                 + ISNULL(SHI_01_d, 0)
--                 + ISNULL(SHI_01_e, 0)
--                 + ISNULL(SHI_01_f, 0)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22               for toplines */
       ,           GRX_22_ny1
       = CAST ((
         CASE WHEN ISNULL(GRX_22   , 0)  < 0.66
               AND ISNULL(GRX_22_01, 0)  < 0.66
               AND ISNULL(GRX_22_02, 0)  < 0.66
               AND ISNULL(GRX_22_04, 0)  < 0.66
              THEN                         0
              WHEN ISNULL(GRX_22   , 0)  < 1.00
               AND ISNULL(GRX_22_01, 0)  < 1.00
               AND ISNULL(GRX_22_02, 0)  < 1.00
               AND ISNULL(GRX_22_04, 0)  < 1.00
              THEN                         0.67
              WHEN ISNULL(GRX_22   , 0)  = 1.00
                OR ISNULL(GRX_22_01, 0)  = 1.00
                OR ISNULL(GRX_22_02, 0)  = 1.00
                OR ISNULL(GRX_22_04, 0)  = 1.00
              THEN                         1.00
--              ELSE GRX_22_01                 -- value does not fit logical distribution where 2 "no" cetegories are collapsed 
              END
                                                               ) AS DECIMAL (38,2))
--       ,           GRX_22_ny2
--       = CAST ((
--         CASE WHEN GRX_22    >= 0.66
--                OR GRX_22_01 >= 0.66
--                OR GRX_22_02 >= 0.66
--                OR GRX_22_04 >= 0.66
--              THEN              0.01
--              END
--                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_01               for toplines */
       ,           GRX_22_01_ny1
       = CAST ((
         CASE WHEN GRX_22_01  < 0.66
              THEN              0
              ELSE GRX_22_01
              END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_01_ny2
       = CAST ((
         CASE WHEN GRX_22_01 >= 0.66
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_02               for toplines */
       ,           GRX_22_02_ny1
       = CAST ((
         CASE WHEN GRX_22_02  < 0.66
              THEN              0
              ELSE GRX_22_02
              END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_02_ny2
       = CAST ((
         CASE WHEN GRX_22_02 >= 0.66
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_03               for toplines */
       ,           GRX_22_03_ny1
       = CAST ((
         CASE WHEN GRX_22_03  < 0.66
              THEN              0
              ELSE GRX_22_03
              END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_03_ny2
       = CAST ((
         CASE WHEN GRX_22_03 >= 0.66
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_22_04               for toplines */
       ,           GRX_22_04_ny1
       = CAST ((
         CASE WHEN GRX_22_04  < 0.66
              THEN              0
              ELSE GRX_22_04
              END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_22_04_ny2
       = CAST ((
         CASE WHEN GRX_22_04 >= 0.66
              THEN              0.01
              END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_24               for toplines */
       ,           GRX_24_ny1
       =           GRX_24
       ,           GRX_24_ny2
       = CAST ((
         CASE WHEN GRX_24  > 0
                  THEN           0.01
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 GRX_25               for toplines */
       ,           GRX_25_ny1
       = CAST ((
         CASE 
              WHEN GRX_25_01  =  0.00
              THEN               0.00
              WHEN GRX_25_01  =  1.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_25_ny2
       = CAST ((
         CASE 
              WHEN GRX_25_02  =  1.00
              THEN               0.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           GRX_25_ny3
       = CAST ((
         CASE 
              WHEN GRX_25_03  =  1.00
              THEN               0.03
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHX_25               for toplines */
       ,           SHX_25_ny1
       =           SHX_25
       ,           SHX_25_ny2
       = CAST ((
         CASE WHEN SHX_25  > 0
                  THEN           0.01
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHX_26               for toplines */
       ,           SHX_26_ny1
       =           SHX_26
       ,           SHX_26_ny2
       = CAST ((
         CASE WHEN SHX_26  > 0
                  THEN           0.01
                  END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*                 SHX_27               for toplines */
       ,           SHX_27_ny1
       = CAST ((
         CASE 
              WHEN SHX_27_01  =  0.00
              THEN               0.00
              WHEN SHX_27_01  =  1.00
              THEN               0.01
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHX_27_ny2
       = CAST ((
         CASE 
              WHEN SHX_27_02  =  1.00
              THEN               0.02
         END
                                                               ) AS DECIMAL (38,2))
       ,           SHX_27_ny3
       = CAST ((
         CASE 
              WHEN SHX_27_03  =  1.00
              THEN               0.03
         END
                                                               ) AS DECIMAL (38,2))
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       , *
FROM
/*** View including numeric values aggregated by country/religion & year ***************************************************************************************/
               [dbo].[V2_W_by_Ctry&Year]
/*************************************************************************************** View including numeric values aggregated by country/religion & year ***/
/********************************************************************************************** table including numeric values + Step-1 calculated variables ***/
)                                                                                                                                                       AS NV_S1
/***************************************************************************************************************************************************************/
)                                                                                                                                                       AS NV_S2
/********************************************************************************************** table including numeric values + Step-2 calculated variables ***/
/* filters */
WHERE
Ctry_EditorialName                                   != 'North Korea'
AND
Ctry_EditorialName + '_/_' + STR(Question_Year, 4,0) != 'South Sudan_/_2010'            /* although data are not aggregated for the other part of former Sudan */
/* filters */
/********************************************************************************************** table including numeric values + Step-3 calculated variables ***/
/************************************************************************************************************************************* main select statement ***/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S14_Cr_V4LbyCYV_extended______v01__aut.sql                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V4short_LRestr_by_CYV]                                                  <<<<<     ***/
/***             This view only includes numeric values aggregated by country/religion & year & variable (long format).                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V4_L_by_CYV_extended]
AS
/***************************************************************************************************************************************************************/
SELECT
       *
  FROM
/***************************************************************************************************************************************************************/
(  
/***************************************************************************************************************************************************************/
SELECT   
       [Basic_updatable_data_pk] = ROW_NUMBER()OVER(ORDER BY Nation_fk, Question_Year, QA_std)
--      ,[entity]
--      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[answer_wording_std]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]


/****** Script for SelectTopNRows command from SSMS  ******/
SELECT 
       distinct
       [entity]
      --,[link_fk]
      --,[Nation_fk]
      --,[Locality_fk]
      --,[Religion_fk]
      --,[Region5]
      --,[Region6]
      --,[Ctry_EditorialName]
      --,[Locality]
      --,[Religion]
      --,[Question_Year]
      --,[QA_std]
      --,[QW_std]
      --,[Answer_value]
      --,[answer_wording]
      --,[answer_wording_std]
      --,[Question_fk]
      --,[Answer_fk]
      --,[Notes]
  FROM [forum_ResAnal].[dbo].[V1_DB_Long]
  
  


        [row_key]            = ROW_NUMBER()
                               OVER(ORDER BY   
                                                  V.[Nation_fk]
                                                , Q.[Q_Number]
                                                , V.[Question_Year]
                                                , V.[Variable]
                                                , V.[Value]                      ) 
      ,  [Nation_fk]
      ,  [Ctry_EditorialName]
      ,  [YEAR]
      ,  [Question_Year]
      ,  [GRI]
      ,  [SHI]
      ,  [GFI]
      ,V.[Variable]
      ,  [Value]
      ,  [PctWg]
      ,  [PctWgR5]
      ,  [PctWgR6]
      ,  [CntWg]
      ,Q.[Q_Number]
  FROM [V4_L_by_CYV]       V
     , [AllQuestions]      Q
WHERE  
       V.[Variable]
     = Q.[Variable]
/***************************************************************************************************************************************************************/
)   AS  V4s
/***************************************************************************************************************************************************************/
    WHERE                                                                       /*** begining of filters to be applied...                                    ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'CSR%'                                           /*** filter to exclude CSR questions                                         ***/
    AND                                                                         /*** second filter to be applied...                                          ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'ERI%'                                           /*** filter to exclude ERI questions                                         ***/
    AND                                                                         /*** third filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'IEI%'                                           /*** filter to exclude IEI questions                                         ***/
    AND                                                                         /*** fourth filter to be applied...                                          ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'PPR%'                                           /*** filter to exclude PPR questions                                         ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'RIR%'                                           /*** filter to exclude RIR questions                                         ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE '%_ny'                                           /*** filter to exclude y/n (repeated) questions                              ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE '%_dummy'                                        /*** filter to exclude dummy questions                                       ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT IN (                                                  /*** filter to exclude unuseful Restrictions/Hostilities questions           ***/
                                  'GRI_01_x2'
                                , 'XSG_S_99_01'
                                , 'XSG_S_99_02'
                                , 'XSG_S_99_03'
                                , 'XSG_S_99_04'
                                , 'XSG_S_99_05'
                                , 'XSG_S_99_06'
                                , 'GRI_20_05_x1'
                                , 'GRX_21_01'
                                , 'GRX_21_02'
                                , 'GRX_21_03'
                                                            )


--      ,[entity]
--      ,[note]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording]
      ,[answer_wording_std]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]


SELECT [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Region5Yr]
      ,[Region6Yr]
      ,[Region5]
      ,[Region6]
      ,[YEAR]
      ,[Question_Year]
      ,[GRI]
      ,[SHI]
      ,[GFI]
      ,[Variable]
      ,[Value]
      ,[PctWg]
      ,[PctWgR5]
      ,[PctWgR6]
      ,[CntWg]
  FROM [forum_ResAnal].[dbo].[V4_L_by_CYV] 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S14_Cr_V4LbyCYVnR____________v04__RUN.sql                                                                                                                        
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V4_LRestr_by_CYV]                                                       <<<<<     ***/
/***             This view only includes numeric values aggregated by country/religion & year & variable (long format).                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V4_L_by_CYV]
AS
/***************************************************************************************************************************************************************/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Begining of select statement (values by country/year/question)  ******************************************************************************************/
N'
/***************************************************************************************************************************************************************/
SELECT
        [Nation_fk]
      , [Ctry_EditorialName]
      , [Region5Yr]
         =        [Region5] + ''_'' + STR([Question_Year], 4,0)
      , [Region6Yr]
         =        [Region6] + ''_'' + STR([Question_Year], 4,0)
      , [Region5]
      , [Region6]
      , [YEAR]
         =        CASE
                  WHEN [Question_Year] <  2011 THEN ''MID-'' + STR([Question_Year], 4,0)
                  ELSE                              ''END-'' + STR([Question_Year], 4,0)
                  END
      , [Question_Year]
      , [GRI]
      , [SHI]
      , [GFI]
      , [Variable]
         =        
                  CASE
                  WHEN                 [Variable] LIKE ''%_ny%'' 
                  THEN STUFF(          [Variable]      ,         
                  ((CHARINDEX(''_ny'', [Variable])) + 3) , 1, '''')
                  ELSE                 [Variable]
                  END
      , [Value]
      , [PctWg]
         =        
                  CAST ((
                            100.000000000000
                           /SUM([CntWg]) 
                            OVER(
                            PARTITION BY  [Question_Year]
                                        , [Variable]      )
                                                            ) AS DECIMAL (38,12))
      , [PctWgR5]
         =        
                  CAST ((
                            100.000000000000
                           /SUM([CntWg]) 
                            OVER(
                            PARTITION BY  [Region5]
                                        , [Question_Year]
                                        , [Variable]      )
                                                            ) AS DECIMAL (38,12))
      , [PctWgR6]
         =        
                  CAST ((
                            100.000000000000
                           /SUM([CntWg]) 
                            OVER(
                            PARTITION BY  [Region6]
                                        , [Question_Year]
                                        , [Variable]      )
                                                            ) AS DECIMAL (38,12))
      , [CntWg] 
FROM
(
SELECT  
        *
      , [CntWg] 
         =        1
  FROM [V3_W&Extras_by_Ctry&Year]
) NR
UNPIVOT
  (
     Value
FOR
     Variable
in (
/***************************************************************************************************************************************************************/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [COLUMN_NAME]                                                         /*** field in system view which includes all field names                     ***/
    FROM                                                                        /*** from...                                                                 ***/
          [INFORMATION_SCHEMA].[COLUMNS]                                        /*** name of the system view which includes all field names                  ***/
    WHERE                                                                       /*** begining of filters to be applied...                                    ***/
          [TABLE_NAME]                                                          /*** field in system view which includes all table names                     ***/
                        IN     (                                                /*** FITER TO INCLUDE ONLY:                                                  ***/
                                 'V3_W&Extras_by_Ctry&Year'                     /*** desired view (restrictions/indexes and extras by country and year)      ***/
                                                                         )      /*** end filter "in"                                                         ***/
    AND                                                                         /*** second filter to be applied...                                          ***/
          [COLUMN_NAME]                                                         /*** field in system view which includes all field names                     ***/
                        NOT IN (                                                /*** FITER TO EXCLUDE ALL variables not to be unpivoted:                     ***/
                                    'Nation_fk'                                 /*** Exclude field: PK of Pew_Nation (countries)                             ***/
                                  , 'Region5'                                   /*** Exclude field: 5-Regions categorization of countries                    ***/
                                  , 'Region6'                                   /*** Exclude field: 6-Regions categorization of countries                    ***/
                                  , 'Ctry_EditorialName'                        /*** Exclude field: Editorial Name of Country (in Pew_Nation)                ***/
                                  , 'Question_Year'                             /*** Exclude field: Year corresponding to the coded data                     ***/
                                  , 'GRI'                                       /*** Exclude field: GRI Year index (different number precision and scale)    ***/
                                  , 'SHI'                                       /*** Exclude field: SHI Year index (different number precision and scale)    ***/
                                  , 'GFI'                                       /*** Exclude field: GFI Year index (different number precision and scale)    ***/
                                  , 'GRI_rd_1d'                                 /*** Exclude field: GRI round index (different number precision and scale)   ***/
                                  , 'SHI_rd_1d'                                 /*** Exclude field: SHI round index (different number precision and scale)   ***/
                                  , 'GFI_rd_1d'                                 /*** Exclude field: GFI round index (different number precision and scale)   ***/
                                                                         )      /*** end filter "not in"                                                     ***/
    ORDER BY                                                                    /*** sorting order by variables names, including:                            ***/
          ', '                                                                  /*** comma delimiter                                  -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          [COLUMN_NAME]                                                         /*** field in system view which includes all field names                     ***/
    FOR XML PATH('')                                                            /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
N'
/***************************************************************************************************************************************************************/
)                                                                               /*** end of listing of variables                                             ***/
 )                                                                                                                                                      AS   pivt
/***************************************************************************************************************************************************************/
'
/*


Nation_fk	Ctry_EditorialName
154	North Korea

Nation_fk	Ctry_EditorialName
237	South Sudan
*/


/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--  SELECT @ALLCODE
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
/***************************************************************************************************************************************************************/
EXEC  (@ALLCODE)
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S15_Cr_V5LRestrbyCYV___________v03__aut.sql                                                                                                                      
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V4short_LRestr_by_CYV]                                                  <<<<<     ***/
/***             This view only includes numeric values aggregated by country/religion & year & variable (long format).                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V5_LRestr_by_CYV]
AS
/***************************************************************************************************************************************************************/
SELECT
       *
  FROM
/***************************************************************************************************************************************************************/
(  
/***************************************************************************************************************************************************************/
SELECT   
        [row_key]            = ROW_NUMBER()
                               OVER(ORDER BY   
                                                  V.[Nation_fk]
                                                , Q.[Q_Number]
                                                , V.[Question_Year]
                                                , V.[Variable]
                                                , V.[Value]                      ) 
      ,  [Nation_fk]
      ,  [Ctry_EditorialName]
      ,  [YEAR]
      ,  [Question_Year]
      ,  [GRI]
      ,  [SHI]
      ,  [GFI]
      ,V.[Variable]
      ,  [Value]
      ,  [PctWg]
      ,  [PctWgR5]
      ,  [PctWgR6]
      ,  [CntWg]
      ,Q.[Q_Number]
  FROM [V4_L_by_CYV]       V
     , [AllQuestions]      Q
WHERE  
       V.[Variable]
     = Q.[Variable]
/***************************************************************************************************************************************************************/
)   AS  V4s
/***************************************************************************************************************************************************************/
    WHERE                                                                       /*** begining of filters to be applied...                                    ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'CSR%'                                           /*** filter to exclude CSR questions                                         ***/
    AND                                                                         /*** second filter to be applied...                                          ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'ERI%'                                           /*** filter to exclude ERI questions                                         ***/
    AND                                                                         /*** third filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'IEI%'                                           /*** filter to exclude IEI questions                                         ***/
    AND                                                                         /*** fourth filter to be applied...                                          ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'PPR%'                                           /*** filter to exclude PPR questions                                         ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'RIR%'                                           /*** filter to exclude RIR questions                                         ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE '%_ny'                                           /*** filter to exclude y/n (repeated) questions                              ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE '%_dummy'                                        /*** filter to exclude dummy questions                                       ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT IN (                                                  /*** filter to exclude unuseful Restrictions/Hostilities questions           ***/
                                  'GRI_01_x2'
                                , 'XSG_S_99_01'
                                , 'XSG_S_99_02'
                                , 'XSG_S_99_03'
                                , 'XSG_S_99_04'
                                , 'XSG_S_99_05'
                                , 'XSG_S_99_06'
                                , 'GRI_20_05_x1'
                                , 'GRX_21_01'
                                , 'GRX_21_02'
                                , 'GRX_21_03'
                                                            )
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S16_Cr_V6Basic_n_Index__________v02__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V5_Basic&Index]                                                         <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V6_Basic&Index]
AS
/***************************************************************************************************************************************************************/
/***  Begining of select statement (values by country)  ********************************************************************************************************/
/***************************************************************************************************************************************************************/
SELECT 
/*** variables NOT changing though time ************************************************************************************************************************/
       [Nation_fk]
      ,[Country_fk]
      ,[Ctry_EditorialName]
      ,[GDP_per_capita]
      ,[Region5]
      ,[Region6]
      ,[SubRegion]
      ,[IMF_Advance]
      ,[Global_NS]
      ,[UN_Reg1]
      ,[UN_Reg2]
      ,[UN_Develop]
/*** population variables CAN CHANGE though time ***************************************************************************************************************/
      ,[Pop2000]
      ,[Pop2010]
      ,[Pop2012]
/*** index values SHOULD BE ADDED EACH YEAR ********************************************************************************************************************/
      ,[GRI_2007]
      ,[GRI_2008]
      ,[GRI_2009]
      ,[GRI_2010]
      ,[GRI_2011]
      ,[GRI_2012]
      ,[SHI_2007]
      ,[SHI_2008]
      ,[SHI_2009]
      ,[SHI_2010]
      ,[SHI_2011]
      ,[SHI_2012]
      ,[GFI_2007]
      ,[GFI_2008]
      ,[GFI_2009]
      ,[GFI_2010]
      ,[GFI_2011]
      ,[GFI_2012]
/***************************************************************************************************************************************************************/
FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
/*** variables NOT changibng though time ***********************************************************************************************************************/
       [Nation_pk]                 AS Nation_fk
      ,[Country_fk]
      ,N.[Ctry_EditorialName]
      ,[GDP_per_capita]
      ,[Region]                    AS Region5
      ,[SubRegion6]                AS Region6
      ,[SubRegion]
      ,[IMF_Advance]
      ,[Global_NS]
      ,[UN_Reg1]
      ,[UN_Reg2]
      ,[UN_Develop]
/*** population variables CAN CHANGE though time ***************************************************************************************************************/
      ,S1.[Cnt]                    AS Pop2000
      ,S2.[Cnt]                    AS Pop2010
      ,S3.[Cnt]                    AS Pop2012
/*** sources for the query (some repeated for different years) *************************************************************************************************/
  FROM 
       [forum].[dbo].[Pew_Nation]                N
     , [forum].[dbo].[Pew_Nation_Age_Sex_Value]  S1
     , [forum].[dbo].[Pew_Field]                 F1
     , [forum].[dbo].[Pew_Nation_Age_Sex_Value]  S2
     , [forum].[dbo].[Pew_Field]                 F2
     , [forum].[dbo].[Pew_Nation_Age_Sex_Value]  S3
     , [forum].[dbo].[Pew_Field]                 F3
/*** filters and matching conditions ***************************************************************************************************************************/
 WHERE 
       S1.[Nation_fk]   =     [Nation_pk]
   AND S2.[Nation_fk]   =     [Nation_pk]
   AND S3.[Nation_fk]   =     [Nation_pk]
   AND S1.[Field_fk]    =  F1.[Field_pk]
   AND S2.[Field_fk]    =  F2.[Field_pk]
   AND S3.[Field_fk]    =  F3.[Field_pk]
   AND S1.[Age_fk]      =  0
   AND S1.[Sex_fk]      =  0
   AND S2.[Age_fk]      =  0
   AND S2.[Sex_fk]      =  0
   AND S3.[Age_fk]      =  0
   AND S3.[Sex_fk]      =  0
   AND F1.[Field_year]  =  '2000'
   AND F2.[Field_year]  =  '2010'
   AND F3.[Field_year]  =  '2012'
/***************************************************************************************************************************************************************/
)                                                                                                                                           AS      M  /* MAIN */
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
/*** query with most current index values should be added here to be joined ************************************************************************************/
/***************************************************************************************************************************************************************/
(
/*** index values for 2012 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2012_pk
      ,[GRI]                    AS GRI_2012
      ,[SHI]                    AS SHI_2012
      ,[GFI]                    AS GFI_2012
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2012
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2012   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2012_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2011 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2011_pk
      ,[GRI]                    AS GRI_2011
      ,[SHI]                    AS SHI_2011
      ,[GFI]                    AS GFI_2011
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2011
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2011   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2011_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2010 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2010_pk
      ,[GRI]                    AS GRI_2010
      ,[SHI]                    AS SHI_2010
      ,[GFI]                    AS GFI_2010
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2010
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2010   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2010_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2009 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2009_pk
      ,[GRI]                    AS GRI_2009
      ,[SHI]                    AS SHI_2009
      ,[GFI]                    AS GFI_2009
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2009
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2009   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2009_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2008 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2008_pk
      ,[GRI]                    AS GRI_2008
      ,[SHI]                    AS SHI_2008
      ,[GFI]                    AS GFI_2008
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2008
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2008   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2008_pk
/***************************************************************************************************************************************************************/
LEFT JOIN
/***************************************************************************************************************************************************************/
(
/*** index values for 2007 *************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Nation_fk]              AS N2007_pk
      ,[GRI]                    AS GRI_2007
      ,[SHI]                    AS SHI_2007
      ,[GFI]                    AS GFI_2007
  FROM 
       [V3_W&Extras_by_Ctry&Year]
 WHERE 
       [Question_Year]  =  2007
/***************************************************************************************************************************************************************/
)                                                                                                                                         AS   I2007   /* MAIN */
/***************************************************************************************************************************************************************/
ON 
     Nation_fk = N2007_pk
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S17_Cr_V7LRestrbyCV_____________v02__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [V7_LRestr_by_VarVal]                                                                  <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V7_LRestr_by_VarVal]
AS
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Begining of select statement (values by country/year/question)  ******************************************************************************************/

/***************************************************************************************************************************************************************/
SELECT
          V5Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Variable]
                           , [Value]
                                          )
        , Variable
        , Value
        , [NC_MID-2007]   =  STR(MAX([NC_MID-2007]),12,0)
        , [PC_MID-2007]   =  STR(MAX([PC_MID-2007]),3,0)
        , [NC_MID-2008]   =  STR(MAX([NC_MID-2008]),12,0)
        , [PC_MID-2008]   =  STR(MAX([PC_MID-2008]),3,0)
        , [NC_MID-2009]   =  STR(MAX([NC_MID-2009]),12,0)
        , [PC_MID-2009]   =  STR(MAX([PC_MID-2009]),3,0)
        , [NC_MID-2010]   =  STR(MAX([NC_MID-2010]),12,0)
        , [PC_MID-2010]   =  STR(MAX([PC_MID-2010]),3,0)
        , [NC_END-2011]   =  STR(MAX([NC_END-2011]),12,0)
        , [PC_END-2011]   =  STR(MAX([PC_END-2011]),3,0)
        , [NC_END-2012]   =  STR(MAX([NC_END-2012]),12,0)
        , [PC_END-2012]   =  STR(MAX([PC_END-2012]),3,0)
FROM
(
/*** AggrEgate view by C/Y/Q/A *********************************************************************************************************************************/
SELECT
       [YCNT]     = 'NC_' + [YEAR]
      ,[YPCT]     = 'PC_' + [YEAR]
      ,[Variable]
      ,[Value]
      ,Number     = SUM([CntWg])
      ,Percentage = SUM([PctWg])
  FROM
/***************************************************************************************************************************************************************/
(
/*** >>> recode for total events (only GRI_19 is currently working) ********************************************************************************************/
/***************************************************************************************************************************************************************/
SELECT 
       [YEAR]
      ,[Variable]
      ,[Value]
               = CASE
                 WHEN [Variable] = 'GRI_19_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'GRI_19_x'
                  AND [Value]    = 0
                 THEN              NULL
                 WHEN [Variable] = 'SHI_01_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'SHI_01_x'
                  AND [Value]    = 0
                 THEN              NULL
                 WHEN [Variable] = 'SHI_04_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'SHI_04_x'
                  AND [Value]    = 0
                 THEN              NULL
                 WHEN [Variable] = 'SHI_05_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'SHI_05_x'
                  AND [Value]    = 0
                 THEN              NULL
                 ELSE [Value]
                 END
      ,[PctWg]
               = CASE
                 WHEN [Variable] = 'GRI_19_x'
                 THEN              NULL
                 WHEN [Variable] = 'SHI_01_x'
                 THEN              NULL
                 WHEN [Variable] = 'SHI_04_x'
                 THEN              NULL
                 WHEN [Variable] = 'SHI_05_x'
                 THEN              NULL
                 ELSE [PctWg]
                 END
      ,[CntWg]
               = CASE
                 WHEN [Variable] = 'GRI_19_x'
                 THEN [Value]
                 WHEN [Variable] = 'SHI_01_x'
                 THEN [Value]
                 WHEN [Variable] = 'SHI_04_x'
                 THEN [Value]
                 WHEN [Variable] = 'SHI_05_x'
                 THEN [Value]
                 ELSE [CntWg]
                 END
  FROM 
       [V4_L_by_CYV]
/*** <<< recode for total events *******************************************************************************************************************************/
)                                                                                                                                                      AS    RTE
/***************************************************************************************************************************************************************/
GROUP BY
       [YEAR]
      ,[Variable]
      ,[Value]
/********************************************************************************************************************************* Aggregate view by C/Y/Q/A ***/
)                                                                                                                                                      AS A_CYQA
/*** pivoting percentage ***************************************************************************************************************************************/
PIVOT
 (
     MAX(Percentage)
FOR
     YPCT
in (
        [PC_MID-2007]
      , [PC_MID-2008]
      , [PC_MID-2009]
      , [PC_MID-2010]
      , [PC_END-2011]
      , [PC_END-2012]
/***************************************************************************************************************************************************************/
                         )                                                      /*** end of listing of variables                                             ***/
 )                                                                                                                                                    AS   pivt1
/*************************************************************************************************************************************** pivoting percentage ***/
/*** pivoting counts *******************************************************************************************************************************************/
PIVOT
 (
     MAX(Number)
FOR
     YCNT
in (
        [NC_MID-2007]
      , [NC_MID-2008]
      , [NC_MID-2009]
      , [NC_MID-2010]
      , [NC_END-2011]
      , [NC_END-2012]
/***************************************************************************************************************************************************************/
                         )                                                      /*** end of listing of variables                                             ***/
 )                                                                                                                                                    AS   pivt2
/******************************************************************************************************************************************* pivoting counts ***/

GROUP BY
          Variable
        , Value
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S18_Cr_V8AggIdxbyVarVal________v09__aut.sql                                                                                                                      
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [V8_AggIdx_by_VarVal]                                                                  <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V8_AggIdx_by_VarVal]
AS
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Begining of select statement (values by country/year/question)  ******************************************************************************************/
/***************************************************************************************************************************************************************/
SELECT
          V7Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             Variable
                           , Value
                           , INDX
                                          )
        , Variable
        , Value
        , INDX
        , AVRG
        , NCtries = STR(NCtries)
FROM
/***************************************************************************************************************************************************************/
(
/*** union of both GRI & SHI aggregate views by C/Y/Q/A ********************************************************************************************************/
/***************************************************************************************************************************************************************/
/*** Aggregate view by C/Y/Q/A *********************************************************************************************************************************/
SELECT
       [Variable]
      ,[Value]
      ,INDX     =     'GRI'
      ,AVRG     = AVG([GRI])
      ,NCtries  = SUM([CntWg])
  FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       [GRI]
      ,[Question_Year]
      ,[Variable]
      ,[Value]
      ,[CntWg]
  FROM 
       [V4_L_by_CYV]
WHERE 
       [Question_Year] = 2012
  AND 
    (
       [Variable]      LIKE 'SH%'
   OR
       [Variable]      LIKE 'GR%'
   OR
       [Variable]      LIKE 'GF%'
   OR
       [Variable]      LIKE 'XS%'
    )
/*** <<< recode for total events *******************************************************************************************************************************/
)                                                                                                                                                      AS    RTE
/***************************************************************************************************************************************************************/
GROUP BY
       [Variable]
      ,[Value]
/********************************************************************************************************************************* Aggregate view by C/Y/Q/A ***/
UNION
/*** Aggregate view by C/Y/Q/A *********************************************************************************************************************************/
SELECT
       [Variable]
      ,[Value]
      ,INDX     =     'SHI'
      ,AVRG     = AVG([SHI])
      ,NCtries  = SUM([CntWg])
  FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       [SHI]
      ,[Question_Year]
      ,[Variable]
      ,[Value]
      ,[CntWg]

  FROM 
       [V4_L_by_CYV]
WHERE 
       [Question_Year] = 2012
  AND 
    (
       [Variable]      LIKE 'SH%'
   OR
       [Variable]      LIKE 'GR%'
   OR
       [Variable]      LIKE 'GF%'
   OR
       [Variable]      LIKE 'XS%'
    )
/*** <<< recode for total events *******************************************************************************************************************************/
)                                                                                                                                                      AS    RTE
/***************************************************************************************************************************************************************/
GROUP BY
       [Variable]
      ,[Value]
/********************************************************************************************************************************* Aggregate view by C/Y/Q/A ***/
)                                                                                                                                                      AS    UBA
/******************************************************************************************************** union of both GRI & SHI aggregate views by C/Y/Q/A ***/

/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S19_Cr_V9AggIdxYr_______________v01__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [V9AggIdx_by_Yr]                                                                       <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V9_AggIdx_by_Yr]
AS
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** Aggregate GRI view by Y ***********************************************************************************************************************************/
SELECT
       [Question_Year]
      ,INDX     =     'GRI'
      ,AVRG     = AVG([GRI])
      ,NCtries  = STR(SUM([CntWg]))
  FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       DISTINCT
       [Nation_fk]
      ,[GRI]
      ,[Question_Year]
      ,[CntWg]
  FROM 
       [V4_L_by_CYV]
WHERE 
       [Question_Year] = 2012
/*** <<< recode for total events *******************************************************************************************************************************/
)                                                                                                                                                      AS    RTE
/***************************************************************************************************************************************************************/
GROUP BY
       [Question_Year]
/*********************************************************************************************************************************** Aggregate GRI view by Y ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
UNION ALL
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** Aggregate SHI view by Y ***********************************************************************************************************************************/
SELECT
       [Question_Year]
      ,INDX     =     'SHI'
      ,AVRG     = AVG([SHI])
      ,NCtries  = STR(SUM([CntWg]))
  FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       DISTINCT
       [Nation_fk]
      ,[SHI]
      ,[Question_Year]
      ,[CntWg]
  FROM 
       [V4_L_by_CYV]
WHERE 
       [Question_Year] = 2012
/*** <<< recode for total events *******************************************************************************************************************************/
)                                                                                                                                                      AS    RTE
/***************************************************************************************************************************************************************/
GROUP BY
       [Question_Year]
/*********************************************************************************************************************************** Aggregate SHI view by Y ***/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S21_Cr_V5rLRestrbyCYV___________v00__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V7r_LRestr_by_RV]                                                       <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [for_x]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[V7r_LRestr_by_RV]
AS
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  Begining of select statement (values by country/year/question)  ******************************************************************************************/

/***************************************************************************************************************************************************************/
SELECT
          V5Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Variable]
                           , [Value]
                                          )
        , Variable
        , Value
        , [NC_Americas_2007]                   =  STR(ISNULL(MAX([NC_Americas_2007]),0),12,0)
        , [PC_Americas_2007]                   =  STR(ISNULL(MAX([PC_Americas_2007]),0),3,0)+' %'
        , [NC_Americas_2008]                   =  STR(ISNULL(MAX([NC_Americas_2008]),0),12,0)
        , [PC_Americas_2008]                   =  STR(ISNULL(MAX([PC_Americas_2008]),0),3,0)+' %'
        , [NC_Americas_2009]                   =  STR(ISNULL(MAX([NC_Americas_2009]),0),12,0)
        , [PC_Americas_2009]                   =  STR(ISNULL(MAX([PC_Americas_2009]),0),3,0)+' %'
        , [NC_Americas_2010]                   =  STR(ISNULL(MAX([NC_Americas_2010]),0),12,0)
        , [PC_Americas_2010]                   =  STR(ISNULL(MAX([PC_Americas_2010]),0),3,0)+' %'
        , [NC_Americas_2011]                   =  STR(ISNULL(MAX([NC_Americas_2011]),0),12,0)
        , [PC_Americas_2011]                   =  STR(ISNULL(MAX([PC_Americas_2011]),0),3,0)+' %'
        , [NC_Americas_2012]                   =  STR(ISNULL(MAX([NC_Americas_2012]),0),12,0)
        , [PC_Americas_2012]                   =  STR(ISNULL(MAX([PC_Americas_2012]),0),3,0)+' %'
        , [NC_Asia-Pacific_2007]               =  STR(ISNULL(MAX([NC_Asia-Pacific_2007]),0),12,0)
        , [PC_Asia-Pacific_2007]               =  STR(ISNULL(MAX([PC_Asia-Pacific_2007]),0),3,0)+' %'
        , [NC_Asia-Pacific_2008]               =  STR(ISNULL(MAX([NC_Asia-Pacific_2008]),0),12,0)
        , [PC_Asia-Pacific_2008]               =  STR(ISNULL(MAX([PC_Asia-Pacific_2008]),0),3,0)+' %'
        , [NC_Asia-Pacific_2009]               =  STR(ISNULL(MAX([NC_Asia-Pacific_2009]),0),12,0)
        , [PC_Asia-Pacific_2009]               =  STR(ISNULL(MAX([PC_Asia-Pacific_2009]),0),3,0)+' %'
        , [NC_Asia-Pacific_2010]               =  STR(ISNULL(MAX([NC_Asia-Pacific_2010]),0),12,0)
        , [PC_Asia-Pacific_2010]               =  STR(ISNULL(MAX([PC_Asia-Pacific_2010]),0),3,0)+' %'
        , [NC_Asia-Pacific_2011]               =  STR(ISNULL(MAX([NC_Asia-Pacific_2011]),0),12,0)
        , [PC_Asia-Pacific_2011]               =  STR(ISNULL(MAX([PC_Asia-Pacific_2011]),0),3,0)+' %'
        , [NC_Asia-Pacific_2012]               =  STR(ISNULL(MAX([NC_Asia-Pacific_2012]),0),12,0)
        , [PC_Asia-Pacific_2012]               =  STR(ISNULL(MAX([PC_Asia-Pacific_2012]),0),3,0)+' %'
        , [NC_Europe_2007]                     =  STR(ISNULL(MAX([NC_Europe_2007]),0),12,0)
        , [PC_Europe_2007]                     =  STR(ISNULL(MAX([PC_Europe_2007]),0),3,0)+' %'
        , [NC_Europe_2008]                     =  STR(ISNULL(MAX([NC_Europe_2008]),0),12,0)
        , [PC_Europe_2008]                     =  STR(ISNULL(MAX([PC_Europe_2008]),0),3,0)+' %'
        , [NC_Europe_2009]                     =  STR(ISNULL(MAX([NC_Europe_2009]),0),12,0)
        , [PC_Europe_2009]                     =  STR(ISNULL(MAX([PC_Europe_2009]),0),3,0)+' %'
        , [NC_Europe_2010]                     =  STR(ISNULL(MAX([NC_Europe_2010]),0),12,0)
        , [PC_Europe_2010]                     =  STR(ISNULL(MAX([PC_Europe_2010]),0),3,0)+' %'
        , [NC_Europe_2011]                     =  STR(ISNULL(MAX([NC_Europe_2011]),0),12,0)
        , [PC_Europe_2011]                     =  STR(ISNULL(MAX([PC_Europe_2011]),0),3,0)+' %'
        , [NC_Europe_2012]                     =  STR(ISNULL(MAX([NC_Europe_2012]),0),12,0)
        , [PC_Europe_2012]                     =  STR(ISNULL(MAX([PC_Europe_2012]),0),3,0)+' %'
        , [NC_Middle East-North Africa_2007]   =  STR(ISNULL(MAX([NC_Middle East-North Africa_2007]),0),12,0)
        , [PC_Middle East-North Africa_2007]   =  STR(ISNULL(MAX([PC_Middle East-North Africa_2007]),0),3,0)+' %'
        , [NC_Middle East-North Africa_2008]   =  STR(ISNULL(MAX([NC_Middle East-North Africa_2008]),0),12,0)
        , [PC_Middle East-North Africa_2008]   =  STR(ISNULL(MAX([PC_Middle East-North Africa_2008]),0),3,0)+' %'
        , [NC_Middle East-North Africa_2009]   =  STR(ISNULL(MAX([NC_Middle East-North Africa_2009]),0),12,0)
        , [PC_Middle East-North Africa_2009]   =  STR(ISNULL(MAX([PC_Middle East-North Africa_2009]),0),3,0)+' %'
        , [NC_Middle East-North Africa_2010]   =  STR(ISNULL(MAX([NC_Middle East-North Africa_2010]),0),12,0)
        , [PC_Middle East-North Africa_2010]   =  STR(ISNULL(MAX([PC_Middle East-North Africa_2010]),0),3,0)+' %'
        , [NC_Middle East-North Africa_2011]   =  STR(ISNULL(MAX([NC_Middle East-North Africa_2011]),0),12,0)
        , [PC_Middle East-North Africa_2011]   =  STR(ISNULL(MAX([PC_Middle East-North Africa_2011]),0),3,0)+' %'
        , [NC_Middle East-North Africa_2012]   =  STR(ISNULL(MAX([NC_Middle East-North Africa_2012]),0),12,0)
        , [PC_Middle East-North Africa_2012]   =  STR(ISNULL(MAX([PC_Middle East-North Africa_2012]),0),3,0)+' %'
        , [NC_Sub-Saharan Africa_2007]         =  STR(ISNULL(MAX([NC_Sub-Saharan Africa_2007]),0),12,0)
        , [PC_Sub-Saharan Africa_2007]         =  STR(ISNULL(MAX([PC_Sub-Saharan Africa_2007]),0),3,0)+' %'
        , [NC_Sub-Saharan Africa_2008]         =  STR(ISNULL(MAX([NC_Sub-Saharan Africa_2008]),0),12,0)
        , [PC_Sub-Saharan Africa_2008]         =  STR(ISNULL(MAX([PC_Sub-Saharan Africa_2008]),0),3,0)+' %'
        , [NC_Sub-Saharan Africa_2009]         =  STR(ISNULL(MAX([NC_Sub-Saharan Africa_2009]),0),12,0)
        , [PC_Sub-Saharan Africa_2009]         =  STR(ISNULL(MAX([PC_Sub-Saharan Africa_2009]),0),3,0)+' %'
        , [NC_Sub-Saharan Africa_2010]         =  STR(ISNULL(MAX([NC_Sub-Saharan Africa_2010]),0),12,0)
        , [PC_Sub-Saharan Africa_2010]         =  STR(ISNULL(MAX([PC_Sub-Saharan Africa_2010]),0),3,0)+' %'
        , [NC_Sub-Saharan Africa_2011]         =  STR(ISNULL(MAX([NC_Sub-Saharan Africa_2011]),0),12,0)
        , [PC_Sub-Saharan Africa_2011]         =  STR(ISNULL(MAX([PC_Sub-Saharan Africa_2011]),0),3,0)+' %'
        , [NC_Sub-Saharan Africa_2012]         =  STR(ISNULL(MAX([NC_Sub-Saharan Africa_2012]),0),12,0)
        , [PC_Sub-Saharan Africa_2012]         =  STR(ISNULL(MAX([PC_Sub-Saharan Africa_2012]),0),3,0)+' %'
FROM
(
/*** AggrEgate view by C/Y/Q/A *********************************************************************************************************************************/
SELECT
       [RYCNT]     = 'NC_' + [RegionYr]
      ,[RYPCT]     = 'PC_' + [RegionYr]
      ,[Variable]
      ,[Value]
      ,Number      = SUM([CntWg])
      ,Percentage  = SUM([PctWg])
  FROM
/***************************************************************************************************************************************************************/
(
/*** >>> recode for total events (only GRI_19 is currently working) ********************************************************************************************/
/***************************************************************************************************************************************************************/
SELECT 
       [RegionYr]
      ,[Variable]
      ,[Value]
               = CASE
                 WHEN [Variable] = 'GRI_19_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'GRI_19_x'
                  AND [Value]    = 0
                 THEN              NULL
                 WHEN [Variable] = 'SHI_01_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'SHI_01_x'
                  AND [Value]    = 0
                 THEN              NULL
                 WHEN [Variable] = 'SHI_04_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'SHI_04_x'
                  AND [Value]    = 0
                 THEN              NULL
                 WHEN [Variable] = 'SHI_05_x'
                  AND [Value]    > 0
                 THEN              0
                 WHEN [Variable] = 'SHI_05_x'
                  AND [Value]    = 0
                 THEN              NULL
                 ELSE [Value]
                 END
      ,[PctWg]
               = CASE
                 WHEN [Variable] = 'GRI_19_x'
                 THEN              NULL
                 WHEN [Variable] = 'SHI_01_x'
                 THEN              NULL
                 WHEN [Variable] = 'SHI_04_x'
                 THEN              NULL
                 WHEN [Variable] = 'SHI_05_x'
                 THEN              NULL
                 ELSE [PctWg]
                 END
      ,[CntWg]
               = CASE
                 WHEN [Variable] = 'GRI_19_x'
                 THEN [Value]
                 WHEN [Variable] = 'SHI_01_x'
                 THEN [Value]
                 WHEN [Variable] = 'SHI_04_x'
                 THEN [Value]
                 WHEN [Variable] = 'SHI_05_x'
                 THEN [Value]
                 ELSE [CntWg]
                 END
  FROM 
       [for_x].[dbo].[V4r_L_by_RYV]
    WHERE                                                                       /*** begining of filters to be applied...                                    ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'CSR%'                                           /*** filter to exclude CSR questions                                         ***/
    AND                                                                         /*** second filter to be applied...                                          ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'ERI%'                                           /*** filter to exclude ERI questions                                         ***/
    AND                                                                         /*** third filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'IEI%'                                           /*** filter to exclude IEI questions                                         ***/
    AND                                                                         /*** fourth filter to be applied...                                          ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'PPR%'                                           /*** filter to exclude PPR questions                                         ***/
    AND                                                                         /*** ficth filter to be applied...                                           ***/
          [Variable]                                                            /*** field in view including varnames (also those to be excluded)            ***/
                      NOT LIKE 'RIR%'                                           /*** filter to exclude RIR questions                                         ***/
/*** <<< recode for total events *******************************************************************************************************************************/
)                                                                                                                                                      AS    RTE
/***************************************************************************************************************************************************************/
GROUP BY
       [RegionYr]
      ,[Variable]
      ,[Value]
--ORDER BY
--       [YEAR]
--      ,[Variable]
--      ,[Value]
/********************************************************************************************************************************* Aggregate view by C/Y/Q/A ***/
)                                                                                                                                                      AS A_CYQA
/*** pivoting percentage ***************************************************************************************************************************************/
PIVOT
 (
     MAX(Percentage)
FOR
     RYPCT
in (
        [PC_Americas_2007]
      , [PC_Americas_2008]
      , [PC_Americas_2009]
      , [PC_Americas_2010]
      , [PC_Americas_2011]
      , [PC_Americas_2012]
      , [PC_Asia-Pacific_2007]
      , [PC_Asia-Pacific_2008]
      , [PC_Asia-Pacific_2009]
      , [PC_Asia-Pacific_2010]
      , [PC_Asia-Pacific_2011]
      , [PC_Asia-Pacific_2012]
      , [PC_Europe_2007]
      , [PC_Europe_2008]
      , [PC_Europe_2009]
      , [PC_Europe_2010]
      , [PC_Europe_2011]
      , [PC_Europe_2012]
      , [PC_Middle East-North Africa_2007]
      , [PC_Middle East-North Africa_2008]
      , [PC_Middle East-North Africa_2009]
      , [PC_Middle East-North Africa_2010]
      , [PC_Middle East-North Africa_2011]
      , [PC_Middle East-North Africa_2012]
      , [PC_Sub-Saharan Africa_2007]
      , [PC_Sub-Saharan Africa_2008]
      , [PC_Sub-Saharan Africa_2009]
      , [PC_Sub-Saharan Africa_2010]
      , [PC_Sub-Saharan Africa_2011]
      , [PC_Sub-Saharan Africa_2012]
/***************************************************************************************************************************************************************/
                         )                                                      /*** end of listing of variables                                             ***/
 )                                                                                                                                                    AS   pivt1
/*************************************************************************************************************************************** pivoting percentage ***/
/*** pivoting counts *******************************************************************************************************************************************/
PIVOT
 (
     MAX(Number)
FOR
     RYCNT
in (
        [NC_Americas_2007]
      , [NC_Americas_2008]
      , [NC_Americas_2009]
      , [NC_Americas_2010]
      , [NC_Americas_2011]
      , [NC_Americas_2012]
      , [NC_Asia-Pacific_2007]
      , [NC_Asia-Pacific_2008]
      , [NC_Asia-Pacific_2009]
      , [NC_Asia-Pacific_2010]
      , [NC_Asia-Pacific_2011]
      , [NC_Asia-Pacific_2012]
      , [NC_Europe_2007]
      , [NC_Europe_2008]
      , [NC_Europe_2009]
      , [NC_Europe_2010]
      , [NC_Europe_2011]
      , [NC_Europe_2012]
      , [NC_Middle East-North Africa_2007]
      , [NC_Middle East-North Africa_2008]
      , [NC_Middle East-North Africa_2009]
      , [NC_Middle East-North Africa_2010]
      , [NC_Middle East-North Africa_2011]
      , [NC_Middle East-North Africa_2012]
      , [NC_Sub-Saharan Africa_2007]
      , [NC_Sub-Saharan Africa_2008]
      , [NC_Sub-Saharan Africa_2009]
      , [NC_Sub-Saharan Africa_2010]
      , [NC_Sub-Saharan Africa_2011]
      , [NC_Sub-Saharan Africa_2012]
/***************************************************************************************************************************************************************/
                         )                                                      /*** end of listing of variables                                             ***/
 )                                                                                                                                                    AS   pivt2
/******************************************************************************************************************************************* pivoting counts ***/

GROUP BY
          Variable
        , Value


--ORDER BY
--       [Variable]
--      ,[Value]
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S31_Vx_a_LongData_______________v04__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [Vx_a_LongData]                                                                        <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_a_LongData]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Vx_a_Row]
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Nation_fk]
                            ,[Locality_fk]
                            ,[Q_Number]
                            ,[QA_std]
                            ,[Question_Year]
                            ,[Answer_value]
                            ,[AW_det]         )
      ,[entity]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[AW_std]
      ,[AW_det]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT 
       distinct
       [Q_Number]        =   CASE WHEN [Q_Number] IS NULL THEN 9999
                                  ELSE [Q_Number]
                                  END
      ,[entity]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[AW_std]
                              --= CASE
                              --       WHEN [AW_std] IS NULL THEN [answer_wording]
                              --       ELSE [AW_std]
                              --   END
      ,[AW_det]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
/***************************************************************************************************************************************************************/
FROM
/** >> ** sorting order of questions ***************************************************************************************************************************/
       [AllQuestions]
/** << ** sorting order of questions ***************************************************************************************************************************/
RIGHT OUTER JOIN
(
/** >> ** current rows of coded & calculated data **************************************************************************************************************/
SELECT 
       [entity]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording_std]        AS [AW_std]
      ,[answer_wording]            AS [AW_det]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
  FROM [V1_DB_Long]
/* filters */
WHERE
Ctry_EditorialName                                   != 'North Korea'
AND
Ctry_EditorialName + '_/_' + STR(Question_Year, 4,0) != 'South Sudan_/_2010'            /* although data are not aggregated for the other part of former Sudan */
/* filters */
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = V4.[Variable]
      ,[QW_std]                    = [Wording_minus3]
      ,[Answer_value]              = V4.[Value]
      ,[AW_std]                    = [Answer_wording]
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V4_L_by_CYV]   V4
LEFT OUTER JOIN
       [AllQuestions]  AQ
ON
       V4.[Variable]
    =  AQ.[Variable]
LEFT OUTER JOIN
       [AllAnswers]    AA
ON
       V4.[Variable]
    =  AA.[Variable]
AND
       V4.[Value]
    =  AA.[Value]
WHERE 
       V4.[Variable]
       NOT IN
              (
                SELECT  
                       DISTINCT
                       [QA_std]
                  FROM 
                       [V1_DB_Long]
                  WHERE 
                       [QA_std] NOT IN (
                                            'GRI_19_b'
                                          , 'GRI_19_c'
                                          , 'GRI_19_d'
                                          , 'GRI_19_da'
                                          , 'GRI_19_db'
                                          , 'GRI_19_e'
                                          , 'GRI_19_f'
                                          , 'GRI_20_05_x1'
                                          , 'SHI_01_b'
                                          , 'SHI_01_c'
                                          , 'SHI_01_d'
                                          , 'SHI_01_da'
                                          , 'SHI_01_db'
                                          , 'SHI_01_e'
                                          , 'SHI_01_f'
                                          , 'SHI_04_b'
                                          , 'SHI_04_c'
                                          , 'SHI_04_d'
                                          , 'SHI_04_da'
                                          , 'SHI_04_db'
                                          , 'SHI_04_e'
                                          , 'SHI_04_f'
                                          , 'SHI_05_b'
                                          , 'SHI_05_c'
                                          , 'SHI_05_d'
                                          , 'SHI_05_da'
                                          , 'SHI_05_db'
                                          , 'SHI_05_e'
                                          , 'SHI_05_f'

                                                                  ) 
                                                                    )
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GRI'
      ,[QW_std]                    = 'Government Restrictions Index (GRI)'
      ,[Answer_value]              = [GRI]
      ,[AW_std]                    = 'scale 0 - [+.] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'SHI'
      ,[QW_std]                    = 'Social Hostilities Index (SHI)'
      ,[Answer_value]              = [SHI]
      ,[AW_std]                    = 'scale 0 - [+.] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GFI'
      ,[QW_std]                    = 'Government Favoritism Index (GFI)'
      ,[Answer_value]              = [GFI]
      ,[AW_std]                    = 'scale 0 - [+.] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GRI_rd_1d'
      ,[QW_std]                    = 'Government Restrictions Index (GRI-rounded)'
      ,[Answer_value]              = [GRI_rd_1d]
      ,[AW_std]                    = 'scale 0 - [+.1] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'SHI_rd_1d'
      ,[QW_std]                    = 'Social Hostilities Index (SHI-rounded)'
      ,[Answer_value]              = [SHI_rd_1d]
      ,[AW_std]                    = 'scale 0 - [+.1] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Region5]
      ,[Region6]
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GFI_rd_1d'
      ,[QW_std]                    = 'Government Favoritism Index (GFI-rounded)'
      ,[Answer_value]              = [GFI_rd_1d]
      ,[AW_std]                    = 'scale 0 - [+.1] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [V3_W&Extras_by_Ctry&Year]
/** << ** current rows of coded & calculated data **************************************************************************************************************/
)                                                                                                                                                         AS CRC
/***************************************************************************************************************************************************************/
ON     
       [Variable]
     = [QA_std]
/***************************************************************************************************************************************************************/
)                                                                                                                                                         AS AbO
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S32_Vx_b_TopLines_______________v11__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [V9b_TopLines]                                                                         <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_b_TopLines]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT 
          V6Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Q_Number]
                           , [Variable]
                           , [Value]
                                          )
      ,  [Variable]
      ,  [Value]
      ,  [Answer_wording]
      ,  [NC_MID-2007]
      ,  [PC_MID-2007]
      ,  [NC_MID-2008]
      ,  [PC_MID-2008]
      ,  [NC_MID-2009]
      ,  [PC_MID-2009]
      ,  [NC_MID-2010]
      ,  [PC_MID-2010]
      ,  [NC_END-2011]
      ,  [PC_END-2011]
      ,  [NC_END-2012]
      ,  [PC_END-2012]
      ,  [V5Row]   
FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       Q.[Q_Number]
      ,V.[Variable]
      ,V.[Value]
      ,V.[Answer_wording]
      ,  [NC_MID-2007]
      ,  [PC_MID-2007]
      ,  [NC_MID-2008]
      ,  [PC_MID-2008]
      ,  [NC_MID-2009]
      ,  [PC_MID-2009]
      ,  [NC_MID-2010]
      ,  [PC_MID-2010]
      ,  [NC_END-2011]
      ,  [PC_END-2011]
      ,  [NC_END-2012]
      ,  [PC_END-2012]
      ,  [V5Row]   
  FROM
       [AllAnswers]            V
LEFT
OUTER
JOIN
       [V7_LRestr_by_CV]       D
ON
       V.[Variable]
     = D.[Variable]
AND
       V.[Value]
     = D.[Value]
JOIN
       [AllQuestions]          Q
ON
       V.[Variable]
     = Q.[Variable]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -6.00
      ,  [Answer_wording] = [Label_minus4]
      ,  [NC_MID-2007]    = ''
      ,  [PC_MID-2007]    = ''
      ,  [NC_MID-2008]    = ''
      ,  [PC_MID-2008]    = ''
      ,  [NC_MID-2009]    = ''
      ,  [PC_MID-2009]    = ''
      ,  [NC_MID-2010]    = ''
      ,  [PC_MID-2010]    = ''
      ,  [NC_END-2011]    = ''
      ,  [PC_END-2011]    = ''
      ,  [NC_END-2012]    = ''
      ,  [PC_END-2012]    = ''
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -5.00
      ,  [Answer_wording] = [Wording_minus3]
      ,  [NC_MID-2007]    = ''
      ,  [PC_MID-2007]    = ''
      ,  [NC_MID-2008]    = ''
      ,  [PC_MID-2008]    = ''
      ,  [NC_MID-2009]    = ''
      ,  [PC_MID-2009]    = ''
      ,  [NC_MID-2010]    = ''
      ,  [PC_MID-2010]    = ''
      ,  [NC_END-2011]    = ''
      ,  [PC_END-2011]    = ''
      ,  [NC_END-2012]    = ''
      ,  [PC_END-2012]    = ''
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -4.00
      ,  [Answer_wording] = ''
      ,  [NC_MID-2007]    = 'baseline year,'
      ,  [PC_MID-2007]    = 'ending'
      ,  [NC_MID-2008]    = 'year'
      ,  [PC_MID-2008]    = 'ending'
      ,  [NC_MID-2009]    = 'year'
      ,  [PC_MID-2009]    = 'ending'
      ,  [NC_MID-2010]    = 'year'
      ,  [PC_MID-2010]    = 'ending'
      ,  [NC_END-2011]    = 'previous year'
      ,  [PC_END-2011]    = 'ending'
      ,  [NC_END-2012]    = 'latest year,'
      ,  [PC_END-2012]    = 'ending'
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -3.00
      ,  [Answer_wording] = ''
      ,  [NC_MID-2007]    = 'JUN '
      ,  [PC_MID-2007]    = '2007'
      ,  [NC_MID-2008]    = 'JUN '
      ,  [PC_MID-2008]    = '2008'
      ,  [NC_MID-2009]    = 'JUN '
      ,  [PC_MID-2009]    = '2009'
      ,  [NC_MID-2010]    = 'JUN '
      ,  [PC_MID-2010]    = '2010'
      ,  [NC_END-2011]    = 'DEC '
      ,  [PC_END-2011]    = '2011'
      ,  [NC_END-2012]    = 'DEC '
      ,  [PC_END-2012]    = '2012'
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -2.00
      ,  [Answer_wording] = ''
      ,  [NC_MID-2007]    = 'NUMBER OF'
      ,  [PC_MID-2007]    = '  %  OF  '
      ,  [NC_MID-2008]    = 'NUMBER OF'
      ,  [PC_MID-2008]    = '  %  OF  '
      ,  [NC_MID-2009]    = 'NUMBER OF'
      ,  [PC_MID-2009]    = '  %  OF  '
      ,  [NC_MID-2010]    = 'NUMBER OF'
      ,  [PC_MID-2010]    = '  %  OF  '
      ,  [NC_MID-2011]    = 'NUMBER OF'
      ,  [PC_MID-2011]    = '  %  OF  '
      ,  [NC_MID-2012]    = 'NUMBER OF'
      ,  [PC_MID-2012]    = '  %  OF  '
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -1.00
      ,  [Answer_wording] = ''
      ,  [NC_MID-2007]    = 'COUNTRIES'
      ,  [PC_MID-2007]    = 'COUNTRIES'
      ,  [NC_MID-2008]    = 'COUNTRIES'
      ,  [PC_MID-2008]    = 'COUNTRIES'
      ,  [NC_MID-2009]    = 'COUNTRIES'
      ,  [PC_MID-2009]    = 'COUNTRIES'
      ,  [NC_MID-2010]    = 'COUNTRIES'
      ,  [PC_MID-2010]    = 'COUNTRIES'
      ,  [NC_MID-2011]    = 'COUNTRIES'
      ,  [PC_MID-2011]    = 'COUNTRIES'
      ,  [NC_MID-2012]    = 'COUNTRIES'
      ,  [PC_MID-2012]    = 'COUNTRIES'
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 200.00
      ,  [Answer_wording] = ''
      ,  [NC_MID-2007]    = '197'
      ,  [PC_MID-2007]    = '100%'
      ,  [NC_MID-2008]    = '197'
      ,  [PC_MID-2008]    = '100%'
      ,  [NC_MID-2009]    = '197'
      ,  [PC_MID-2009]    = '100%'
      ,  [NC_MID-2010]    = '197'
      ,  [PC_MID-2010]    = '100%'
      ,  [NC_END-2011]    = '198'
      ,  [PC_END-2011]    = '100%'
      ,  [NC_END-2012]    = '198'
      ,  [PC_END-2012]    = '100%'
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 201.00
      ,  [Answer_wording] = [Notes1_plus201]
      ,  [NC_MID-2007]    = ''
      ,  [PC_MID-2007]    = ''
      ,  [NC_MID-2008]    = ''
      ,  [PC_MID-2008]    = ''
      ,  [NC_MID-2009]    = ''
      ,  [PC_MID-2009]    = ''
      ,  [NC_MID-2010]    = ''
      ,  [PC_MID-2010]    = ''
      ,  [NC_END-2011]    = ''
      ,  [PC_END-2011]    = ''
      ,  [NC_END-2012]    = ''
      ,  [PC_END-2012]    = ''
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 500.00
      ,  [Answer_wording] = ''
      ,  [NC_MID-2007]    = ''
      ,  [PC_MID-2007]    = ''
      ,  [NC_MID-2008]    = ''
      ,  [PC_MID-2008]    = ''
      ,  [NC_MID-2009]    = ''
      ,  [PC_MID-2009]    = ''
      ,  [NC_MID-2010]    = ''
      ,  [PC_MID-2010]    = ''
      ,  [NC_END-2011]    = ''
      ,  [PC_END-2011]    = ''
      ,  [NC_END-2012]    = ''
      ,  [PC_END-2012]    = ''
      ,  V5Row            = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
)                                                                                                                                                      AS     TL
/***************************************************************************************************************************************************************/
      --,[Notes2_plus202]
      --,[Notes3_plus203]
      --,[CtryVals_p300]

WHERE
Variable
NOT IN
( 
  'GFI'
, 'GRI'
, 'SHI'
, 'GFI_rd_1d'
, 'GRI_rd_1d'
, 'SHI_rd_1d'
--
, 'GRI_01_x2'
, 'GRI_01_x2_a'
, 'GRI_01_x2_b'
--
, 'GRI_19_b'
, 'GRI_19_c'
, 'GRI_19_d'
, 'GRI_19_da'
, 'GRI_19_db'
, 'GRI_19_e'
, 'GRI_19_f'
, 'GRI_19_filter'
--
, 'GRI_20_05_x1'
--
, 'GRX_21_01'
, 'GRX_21_02'
, 'GRX_21_03'
--
, 'GRX_22'
, 'GRX_22_01'
, 'GRX_22_02'
, 'GRX_22_03'
, 'GRX_22_04'
, 'GRX_22_filter'
--
, 'GRX_23'
, 'GRX_24'
--
, 'GRX_27_01'
, 'GRX_27_02'
, 'GRX_27_03'
, 'GRX_28_01'
, 'GRX_28_02'
, 'GRX_28_03'
--
, 'SHI_01_a'
, 'SHI_01_b'
, 'SHI_01_c'
, 'SHI_01_d'
, 'SHI_01_da'
, 'SHI_01_db'
, 'SHI_01_e'
, 'SHI_01_f'
--
, 'SHI_04_b'
, 'SHI_04_c'
, 'SHI_04_d'
, 'SHI_04_da'
, 'SHI_04_db'
, 'SHI_04_e'
, 'SHI_04_f'
, 'SHI_04_filter'
, 'SHI_04_x'
--
, 'SHI_05_b'
, 'SHI_05_c'
, 'SHI_05_d'
, 'SHI_05_da'
, 'SHI_05_db'
, 'SHI_05_e'
, 'SHI_05_f'
, 'SHI_05_filter'
, 'SHI_05_x'
--
, 'SHX_14_01'
, 'SHX_14_02'
, 'SHX_14_03'
, 'SHX_14_04'
, 'SHX_15_01'
, 'SHX_15_02'
, 'SHX_15_03'
, 'SHX_15_04'
, 'SHX_15_05'
, 'SHX_15_06'
, 'SHX_15_07'
, 'SHX_15_08'
, 'SHX_15_09'
, 'SHX_15_10'
--
, 'XSG_S_99_01'
, 'XSG_S_99_02'
, 'XSG_S_99_03'
, 'XSG_S_99_04'
, 'XSG_S_99_05'
, 'XSG_S_99_06'
, 'XSG_S_99_filter'
 ) 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S33_Vx_c_GRSHWideData________v06__RUN.sql                                                                                                                        
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [Vx_c_GR&SH_WideData]                                                                  <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
declare @ALLCODE nvarchar(max)
/***************************************************************************************************************************************************************/
set     @ALLCODE = 
/***************************************************************************************************************************************************************/

/***************************************************************************************************************************************************************/
N'
ALTER  VIEW
               [dbo].[Vx_c_GR&SH_WideData]
AS
'
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/***  Begining of select statement (values by country)  ********************************************************************************************************/
/***************************************************************************************************************************************************************/
N'
SELECT 
/*** final list of variables > *********************************************************************************************************************************/
/*** variables NOT changing though time ************************************************************************************************************************/
       [Nation_fk]
      ,[Country_fk]
      ,[Ctry_EditorialName]
      ,[GDP_per_capita]
      ,[Region5]
      ,[Region6]
      ,[SubRegion]
      ,[IMF_Advance]
      ,[Global_NS]
      ,[UN_Reg1]
      ,[UN_Reg2]
      ,[UN_Develop]
/*** population variables CAN CHANGE though time ***************************************************************************************************************/
      ,[Pop2000]
      ,[Pop2010]
      ,[Pop2012]
/*** index values SHOULD BE ADDED EACH YEAR ********************************************************************************************************************/
      ,[GRI_2007]
      ,[GRI_2008]
      ,[GRI_2009]
      ,[GRI_2010]
      ,[GRI_2011]
      ,[GRI_2012]
      ,[SHI_2007]
      ,[SHI_2008]
      ,[SHI_2009]
      ,[SHI_2010]
      ,[SHI_2011]
      ,[SHI_2012]
      ,[GFI_2007]
      ,[GFI_2008]
      ,[GFI_2009]
      ,[GFI_2010]
      ,[GFI_2011]
      ,[GFI_2012]
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
/*** all other variable values which are automatically listed **************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** list of pivoted questions (variables, extracted from the former view) > ***********************************************************************************/
(                                                                                /*** parenthesis to include query for the cell including th string          ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          DISTINCT
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [Variable]                                                            /*** field in view including varnames to become part of new field names      ***/
        +                                                                       /*** concatenated to...                                                      ***/
          '_'                                                                   /*** underscore to concatenate varname & year                                ***/
        +                                                                       /*** concatenated to...                                                      ***/
          STR([Question_Year], 4,0)                                             /*** modif. field in view including years to become part of new field names  ***/
    FROM                                                                        /*** FROM (statement)...                                                     ***/
          [V5_LRestr_by_CYV]                                                    /*** name of the view which includes the data (values & new field names)     ***/
                                                                                /*** note: no need of filter(s)                                              ***/
    ORDER BY                                                                    /*** sorting order by variables names, including:                            ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [Variable]                                                            /*** field in view including varnames                 -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          '_'                                                                   /*** underscore to concatenate varname & year         -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          STR([Question_Year], 4,0)                                             /*** modif. field in view including years             -> as part of sorting  ***/
    FOR XML PATH('')                                                            /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell including the string         ***/
/*** < list of pivoted questions (variables) ends here *********************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** remaining code for the main query *************************************************************************************************************************/
N'
  FROM 
       [V6_Basic&Index]
                                                                                                                                            AS      M  /* MAIN */
'
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***  join data with variables pivoted at the country level > **************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
JOIN
/***************************************************************************************************************************************************************/
(
/*** variable data in wide format > ****************************************************************************************************************************/
SELECT
                 *
FROM
/***************************************************************************************************************************************************************/
(
/*** variable data in long format (concatenating varnames ans years) > *****************************************************************************************/
SELECT 
       NV           = [Nation_fk] 
      ,[MYVAR]      = [Variable] + ''_'' + STR([Question_Year], 4,0)
      ,[Value]
  FROM [V5_LRestr_by_CYV]
/*** < variable data in long format ****************************************************************************************************************************/
)                                                                                                                                                AS        NOIND
/*** pivoting begins > *****************************************************************************************************************************************/
pivot (max (Value) 
       for  MYVAR
           in (
/***************************************************************************************************************************************************************/
'
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** list of questions (variables) to be pivoted (extracted from the former view) > ****************************************************************************/
-- select                                                                       /*** SELECT statement to TEST stuffing procedure...                          ***/
/*** Begin stuffing function to remove the first comma in the list of fields to be retrieved (parenthesis not needed) ******************************************/
STUFF(                                                                          /*** begining of the "stuff: function                                        ***/
/***************************************************************************************************************************************************************/
(                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
/*** Begin selection (into text, in a cell) of a comma delimited list of fields from a system view *************************************************************/
/***************************************************************************************************************************************************************/
    SELECT                                                                      /*** SELECT statement                                                        ***/
          DISTINCT
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [Variable]                                                            /*** field in view including varnames to become part of new field names      ***/
        +                                                                       /*** concatenated to...                                                      ***/
          '_'                                                                   /*** underscore to concatenate varname & year                                ***/
        +                                                                       /*** concatenated to...                                                      ***/
          STR([Question_Year], 4,0)                                             /*** modif. field in view including years to become part of new field names  ***/
    FROM                                                                        /*** FROM (statement)...                                                     ***/
          [V5_LRestr_by_CYV]                                                    /*** name of the view which includes the data (values & new field names)     ***/
                                                                                /*** note: no need of filter(s)                                              ***/
    ORDER BY                                                                    /*** sorting order by variables names, including:                            ***/
          ', '                                                                  /*** comma delimiter                                                         ***/
        +                                                                       /*** concatenated to...                                                      ***/
          [Variable]                                                            /*** field in view including varnames                 -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          '_'                                                                   /*** underscore to concatenate varname & year         -> as part of sorting  ***/
        +                                                                       /*** concatenated to...                               -> as part of sorting  ***/
          STR([Question_Year], 4,0)                                             /*** modif. field in view including years             -> as part of sorting  ***/
    FOR XML PATH('')                                                            /*** Modifies the selected rowset nesting all cells into an XML string cell  ***/
/***************************************************************************************************************************************************************/
/*** End of the selection (into text, in a cell) of a comma delimited list of fields ***************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                /*** parenthesis to include query for the cell to be stuffed                ***/
/***************************************************************************************************************************************************************/
, 1, 1, '')                                                                     /*** from STUFF: from position 1, change 1 character into ''                 ***/
/****************************************************************************************************************************** stuffing function ends here! ***/
/*** < list of questions (variables) to be pivoted ends here ***************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
+
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/*** remaining code for pivoting and joining *******************************************************************************************************************/
N'
/***************************************************************************************************************************************************************/
)                                                                               /*** end of listing of variables                                             ***/
 )                                                                                                                                              AS   PivotedData
/*** < ends pivoting *******************************************************************************************************************************************/
/*** < variable data in wide format ****************************************************************************************************************************/
)                                                                                                                                           AS      V  /* VARS */
/*** matching criteria for joining *****************************************************************************************************************************/
ON 
     Nation_fk = NV
/***************************************************************************************************************************************************************/
                                                                                                                                                /* END OF CODE */
'
/***  < data joined with variables pivoted at the country level ************************************************************************************************/

/***************************************************************************************************************************************************************/
/*** This is a way for checking the SQL statement that has been stored as a string variable ********************************************************************/
--SELECT @ALLCODE
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
/*** The complete SQL statement stored as a string variable is executed as a character string ******************************************************************/
/***************************************************************************************************************************************************************/
EXEC  (@ALLCODE)
/***************************************************************************************************************************************************************/









 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S34_Vx_d_Vars_by_Ctry____________v06__aut.sql                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V9f_Vars_by_Ctry]                                                       <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [for_x]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_d_Vars_by_Ctry]
AS
/***************************************************************************************************************************************************************/
SELECT 
       [V9xRow]
                            =  ROW_NUMBER()
                               OVER(ORDER BY
                                             [Nation_KEY]
                                            ,[Q_Number]
                                                           )
      ,[Nation_fk]
                            =  CASE
                                   WHEN [Nation_fk] IS NULL
                                   THEN [Nation_KEY]
                                   ELSE [Nation_fk]
                                END
      ,[Ctry_EditorialName]
                            =  CASE
                                   WHEN [Nation_fk] IS NULL
                                   THEN [Nation_NN]
                                   ELSE [Ctry_EditorialName]
                                END
      ,[Variable]
                            =  CASE
                                   WHEN [Nation_fk] IS NULL
                                   THEN [Variable]
                                   ELSE [QA_std]
                                END
      ,[Y2007]
                            --=  CASE
                            --       WHEN [Nation_fk] = 237 -- South Sudan
                            --       THEN NULL
                            --       ELSE [Answer_value]
                            --    END
      ,[Y2008]
      ,[Y2009]
      ,[Y2010]
      ,[Y2011]
      ,[Y2012]
--                            =  CASE
--                                   WHEN [Nation_fk] IS NULL
--                                   THEN 0
--                                   ELSE [Answer_value]
--                                END

--      	Y2008	Y2009	Y2010	Y2011	Y2012
--1	Afghanistan	GRI_01	0.50	0.50	0.50	0.50	0.50	0.50


  FROM
/***************************************************************************************************************************************************************/
(
/*** ALL POSSIBLE VALUES TO BE STORED ->> **********************************************************************************************************************/
SELECT 
       DISTINCT
       [Nation_KEY]
     , [Nation_NN]
     , [Q_Number]
     , [Variable]
  FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       [Nation_KEY] = [Nation_pk]
     , [Nation_NN]  = [Ctry_EditorialName]
  FROM [forum].[dbo].[Pew_Nation]
WHERE
       [Nation_pk] NOT IN (
                               4   --   American Samoa
                          ,    7   --   Anguilla
                          ,   11   --   Aruba
                          ,   29   --   British Virgin Islands
                          ,   23   --   Bermuda
                          ,   41   --   Channel Islands
                          ,   48   --   Cook Islands
                          ,   66   --   Faeroe Islands
                          ,   67   --   Falkland Islands (Malvinas)
                          ,   71   --   French Guiana
                          ,   72   --   French Polynesia
                          ,   38   --   Cayman Islands
                          ,   78   --   Gibraltar
                          ,   82   --   Guadeloupe
                          ,   83   --   Guam
                          ,   99   --   Isle of Man
                          ,   89   --   Vatican City
                          ,   80   --   Greenland
                          ,  129   --   Martinique
                          ,  132   --   Mayotte
                          ,  139   --   Montserrat
                          ,  153   --   Niue
                          ,  154   --   North Korea                          (recently included)
                          ,  155   --   Northern Mariana Islands
                          ,  178   --   St. Pierre and Miquelon
                          ,  147   --   Netherlands Antilles
                          ,  148   --   New Caledonia
                          ,  171   --   Reunion
                          ,  169   --   Puerto Rico
                          ,  175   --   St. Helena
                          ,  209   --   Tokelau
                          ,  215   --   Turks and Caicos Islands
                          ,  222   --   U.S. Virgin Islands
                          ,  228   --   Wallis and Futuna
                                                                              )
/***************************************************************************************************************************************************************/
)                                                                                                                                                              C
/***************************************************************************************************************************************************************/
CROSS JOIN
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       [Q_Number]
     , [Variable] = CASE
                         WHEN [Variable] = 'GRI_20_03_top'
                         THEN              'GRI_20_03'
                         ELSE [Variable]
                     END
  FROM [for_x].[dbo].[AllQuestions]
WHERE
       [Variable]      IN (
                               'GRI_01'           ,
                               'GRI_02'           ,
                               'GRI_03'           ,
                               'GRI_04'           ,
                               'GRI_05'           ,
                               'GRI_06'           ,
                               'GRI_07'           ,
                               'GRI_08_for_index' ,
                               'GRI_09'           ,
                               'GRI_10'           ,
                               'GRI_11'           ,
                               'GRI_12'           ,
                               'GRI_13'           ,
                               'GRI_14'           ,
                               'GRI_15'           ,
                               'GRI_16'           ,
                               'GRI_17'           ,
                               'GRI_18'           ,
                               'GRI_19'           ,
                               'GRI_20'           ,
                               'GRI_20_01'        ,
                               'GRI_20_02'        ,
                               'GRI_20_03_top'    ,
                               'GRI_20_03_a'      ,
                               'GRI_20_03_b'      ,
                               'GRI_20_03_c'      ,
                               'GRI_20_04'        ,
                               'GRI_20_05'        ,
                               'SHI_01'           ,
                               'SHI_01_a'         ,
                               'SHI_01_b'         ,
                               'SHI_01_c'         ,
                               'SHI_01_d'         ,
                               'SHI_01_e'         ,
                               'SHI_01_f'         ,
                               'SHI_02'           ,
                               'SHI_03'           ,
                               'SHI_04'           ,
                               'SHI_05'           ,
                               'SHI_06'           ,
                               'SHI_07'           ,
                               'SHI_08'           ,
                               'SHI_09'           ,
                               'SHI_10'           ,
                               'SHI_11_for_index' ,
                               'SHI_12'           ,
                               'SHI_13'           
                                                         )
/***************************************************************************************************************************************************************/
)                                                                                                                                                              V
/*** <<- ALL POSSIBLE VALUES TO BE STORED **********************************************************************************************************************/
)                                                                                                                                                            PVS
/***************************************************************************************************************************************************************/
LEFT OUTER JOIN
/***************************************************************************************************************************************************************/
(
/*** CURRENTLY PIVOTED CODED VALUES DISPLAYED PER YEAR (SOME ZEROS AS MISSING) ->> *****************************************************************************/
SELECT
       *
FROM
/***************************************************************************************************************************************************************/
(
/*** CURRENTLY CODED VALUES (SOME ZEROS BECAME MISSING) ->> ****************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          distinct
       [Nation_fk]
      ,[Question_Year]       = 'Y'+ STR([Question_Year],4)
      ,[Ctry_EditorialName]
      ,[QA_std] = CASE
                       WHEN       [QA_std] =    'GRI_20_03_top'
                       THEN                     'GRI_20_03'
                       WHEN       [QA_std] LIKE '%_dummy'
                       THEN STUFF([QA_std], 9, 6, '')               /*** from position 9, change 6 ch into ''  ***/
                       ELSE       [QA_std]
                   END
      ,[Answer_value]
                             =  CASE
                                     WHEN [Nation_fk]      = 237 -- South Sudan
                                      AND [Question_Year]  < 2011
                                     THEN NULL
                                     ELSE [Answer_value]
                                 END

/***************************************************************************************************************************************************************/
FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]
      ,[Answer_value]
  FROM [for_x].[dbo].[V1_DB_Long]
/* filters */
WHERE
--       [Question_Year]  = 2012
--AND
       [QA_std]         IN (
                               'GRI_01'           ,
                               'GRI_02'           ,
                               'GRI_03'           ,
                               'GRI_04'           ,
                               'GRI_05'           ,
                               'GRI_06'           ,
                               'GRI_07'           ,
                               'GRI_09'           ,
                               'GRI_10'           ,
                               'GRI_11'           ,
                               'GRI_12'           ,
                               'GRI_13'           ,
                               'GRI_14'           ,
                               'GRI_15'           ,
                               'GRI_16'           ,
                               'GRI_17'           ,
                               'GRI_18'           ,
                               'GRI_19'           ,
                               'GRI_20'           ,
                               'GRI_20_01'        ,
                               'GRI_20_02'        ,
                               'GRI_20_03'        ,
                               'GRI_20_03_a'      ,
                               'GRI_20_03_b'      ,
                               'GRI_20_03_c'      ,
                               'GRI_20_04'        ,
                               'GRI_20_05'        ,
                               'SHI_01'           ,
                               'SHI_02'           ,
                               'SHI_03'           ,
                               'SHI_04'           ,
                               'SHI_05'           ,
                               'SHI_06'           ,
                               'SHI_07'           ,
                               'SHI_08'           ,
                               'SHI_09'           ,
                               'SHI_10'           ,
                               'SHI_12'           ,
                               'SHI_13'           
                                                         )
         
/* filters */
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [Nation_fk]
      ,[Ctry_EditorialName]
      ,[Question_Year]
      ,[QA_std]                    = [Variable]
      ,[Answer_value]              = [Value]
  FROM
       [for_x].[dbo].[V4_L_by_CYV]
WHERE
--       [Question_Year]  = 2012
--AND
       [Variable]       IN (
                               'GRI_08_for_index' ,
                               'GRI_20'           ,
                               'GRI_20_03_top'    ,
                               'SHI_01'           ,
                               'SHI_01_a_dummy'   ,
                               'SHI_01_b_dummy'   ,
                               'SHI_01_c_dummy'   ,
                               'SHI_01_d_dummy'   ,
                               'SHI_01_e_dummy'   ,
                               'SHI_01_f_dummy'   ,
                               'SHI_11_for_index' 
                                                         )
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
)                                                                                                                                                         AS CRC
/*** <<- CURRENTLY CODED VALUES (SOME ZEROS BECAME MISSING) ****************************************************************************************************/
)                                                                                                                                                            CCV
/***************************************************************************************************************************************************************/
PIVOT
      (MAX
           (Answer_value) 
       FOR
            Question_Year
                           in (
                                 [Y2007]
                               , [Y2008]
                               , [Y2009]
                               , [Y2010]
                               , [Y2011]
                               , [Y2012]
                                         )) 
                                            as ValuesPerYear
/*** <<- CURRENTLY PIVOTED CODED VALUES DISPLAYED PER YEAR (SOME ZEROS AS MISSING) *****************************************************************************/
)                                                                                                                                                           CCVP
/***************************************************************************************************************************************************************/
ON
       PVS.[Nation_KEY]  =  CCVP.[Nation_fk]
AND
       PVS.[Variable]    =  CCVP.[QA_std]
/***************************************************************************************************************************************************************/


/*** check point: **********************************************************************************************************************************************/
--where
--    Y2007 is NULL
--OR  Y2008 is NULL
--OR  Y2009 is NULL
--OR  Y2010 is NULL
--OR  Y2011 is NULL
--OR  Y2012 is NULL
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S35_Vx_e_LongIndex______________v05__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/******************************************************************************************************************************/
/***                                                                                                                        ***/
/***     >>>>>   This is the script used to create the view [forum_ResAnal].[dbo].[Vx_e_LongIndex]                <<<<<     ***/
/***             This view is hosted in the default place for auxiliary fixed tables & views: [forum_ResAnal]               ***/
/***                                                                                                                        ***/
/***          NOTICE that indexes and median indexes, for now, should be rounded and calculated in Stata                    ***/
/***                      (this is in order to get comparable numbers to previously published data)                         ***/
/***                                                                                                                        ***/
/******************************************************************************************************************************/
USE [forum_ResAnal]
GO
/******************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_e_LongIndex]
AS
/******************************************************************************************************************************/
SELECT
        [Nation_fk]
      , [Ctry_EditorialName]
      , [Region]
      , [SubRegion6]
      , [Index_Year]
         =        CASE
                  WHEN [Question_Year] <  2011 THEN 'MID-' + STR([Question_Year], 4,0)
                  ELSE                              'END-' + STR([Question_Year], 4,0)
                  END
      , [Index_Name]
         =        CASE
                  WHEN [Index_Abbreviation] = 'GRI' THEN 'Government Restrictions Index'
                  WHEN [Index_Abbreviation] = 'SHI' THEN 'Social Hostilities Index'
                  WHEN [Index_Abbreviation] = 'GFI' THEN 'Government Favoritism Index'
                  END
      , [Index_Abbreviation]
      , [Index_Value]
      , [I_Rounded_Value]
      , [I_Scaled_Value]
      , [Question_Year]
FROM
/******************************************************************************************************************************/
(
/******************************************************************************************************************************/
SELECT 
          [Nation_fk]
      , d.[Ctry_EditorialName]
      ,   [Region]
      ,   [SubRegion6]
      ,   [Question_Year]
      ,   [GRI] -- float works fro rounding: don't re-cast
      ,   [SHI] -- float works fro rounding: don't re-cast
      ,   [GFI] -- float works fro rounding: don't re-cast
  FROM         [dbo].[V3_W&Extras_by_Ctry&Year] d
      ,[forum].[dbo].[Pew_Nation]
WHERE
          [Nation_fk]
        = [Nation_pk]
/******************************************************************************************************************************/
)                                                         B
/******************************************************************************************************************************/
UNPIVOT
  (
     [Index_Value]
FOR
     [Index_Abbreviation]
in (
               [GRI]  /*** GRI Yindex (d prec/scale)    ***/
             , [SHI]  /*** SHI Yindex (d prec/scale)    ***/
             , [GFI]  /*** GFI Yindex (d prec/scale)    ***/
                                               ) ) as UNPIVTD1
/******************************************************************************************************************************/
JOIN
/******************************************************************************************************************************/
(
/******************************************************************************************************************************/
SELECT 
          [N2]        = [Nation_fk]
      ,   [Y2]        = [Question_Year]
      ,   [GRI]       = [GRI_rd_1d]    -- already rounded: don't re-cast
      ,   [SHI]       = [SHI_rd_1d]    -- already rounded: don't re-cast
      ,   [GFI]       = [GFI_rd_1d]    -- already rounded: don't re-cast
  FROM         [dbo].[V3_W&Extras_by_Ctry&Year] d
/******************************************************************************************************************************/
)                                                         B
/******************************************************************************************************************************/
UNPIVOT
  (
     [I_Rounded_Value]
FOR
     [I2]
in (
               [GRI]  /*** GRI Yindex rounded ***/
             , [SHI]  /*** SHI Yindex rounded ***/
             , [GFI]  /*** GFI Yindex rounded ***/
                                               ) ) as UNPIVTD2
/******************************************************************************************************************************/
ON        [N2]        = [Nation_fk]
AND       [Y2]        = [Question_Year]
AND       [I2]        = [Index_Abbreviation]
/******************************************************************************************************************************/
JOIN
/******************************************************************************************************************************/
(
/******************************************************************************************************************************/
SELECT 
          [N3]        = [Nation_fk]
      ,   [Y3]        = [Question_Year]
      ,   [GRI]       = [GRI_scaled]    -- already scaled: don't re-cast
      ,   [SHI]       = [SHI_scaled]    -- already scaled: don't re-cast
      ,   [GFI]       = [GFI_scaled]    -- already scaled: don't re-cast
  FROM         [dbo].[V3_W&Extras_by_Ctry&Year] d
/******************************************************************************************************************************/
)                                                         B
/******************************************************************************************************************************/
UNPIVOT
  (
     [I_Scaled_Value]
FOR
     [I3]
in (
               [GRI]  /*** GRI Yindex scaled ***/
             , [SHI]  /*** SHI Yindex scaled ***/
             , [GFI]  /*** GFI Yindex scaled ***/
                                               ) ) as UNPIVTD3
/******************************************************************************************************************************/
ON        [N3]        = [Nation_fk]
AND       [Y3]        = [Question_Year]
AND       [I3]        = [Index_Abbreviation]
/******************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S36_Vx_f_Index_by_Var____________v04__aut.sql                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [Vx_f_Index_by_Var]                                                                    <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_f_Index_by_Var]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT 
          V6Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Q_Number]
                           , [Variable]
                           , [Value]
                           ,  [INDX]    DESC
                                             )
      ,  [Q_Number]
      ,  [Variable]
      ,  [Value]
      ,  [Answer_wording]
      ,  [INDX]
      ,  [AVRG]
      ,  [NCtries]
      ,  [V7Row]
FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       Q.[Q_Number]
      ,V.[Variable]
      ,V.[Value]
      ,V.[Answer_wording]
      ,I.[INDX]
      ,  [AVRG]
      ,  [NCtries]
      ,  [V7Row]
  FROM
       [AllAnswers]            V
CROSS JOIN
(
             SELECT [INDX] = 'GRI'
       UNION SELECT [INDX] = 'SHI'
                                    )        I
LEFT
OUTER
JOIN
       [V8_AggIdx_by_VarVal]   D
ON
       V.[Variable]
     = D.[Variable]
AND
       V.[Value]
     = D.[Value]
AND
       I.[INDX]
     = D.[INDX]
JOIN
       [AllQuestions]          Q
ON
       V.[Variable]
     = Q.[Variable]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 200.00
      ,  [Answer_wording] = 'Total'
      ,  [INDX]
      ,  [AVRG]
      ,  [NCtries]
      ,  [V7Row]          = 0
  FROM
       [AllQuestions]          Q
CROSS JOIN
       [V9_AggIdx_by_Yr]          I
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -6.00
      ,  [Answer_wording] = [Label_minus4]
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = NULL
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -5.00
      ,  [Answer_wording] = [Wording_minus3]
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = NULL
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -4.00
      ,  [Answer_wording] = 'Average Social Hostilities Index (SHI) and Government Restrictions Index (GRI)'
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = 'Number of countries'
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -3.00
      ,  [Answer_wording] = 'scores, (Jan - Dec 2012)'
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = 'by answer'
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -2.00
      ,  [Answer_wording] = 'Answers'
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = 'YEAR 2012'
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 202.00
      ,  [Answer_wording] = [Notes1_plus201]
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = NULL
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 500.00
      ,  [Answer_wording] = ''
      ,  [INDX]           = NULL
      ,  [AVRG]           = NULL
      ,  [NCtries]        = NULL
      ,  [V7Row]          = 0
  FROM 
       [AllQuestions]
/***************************************************************************************************************************************************************/
)                                                                                                                                                      AS     TL
/***************************************************************************************************************************************************************/
      --,[Notes2_plus202]
      --,[Notes3_plus203]
      --,[CtryVals_p300]

WHERE
Variable
IN
( 
  'GFI_scaled'
, 'GRI_scaled'
, 'SHI_scaled'
, 'GRI_01'
, 'GRI_02'
, 'GRI_03'
, 'GRI_04'
, 'GRI_05'
, 'GRI_06'
, 'GRI_07'
, 'GRI_08'
, 'GRI_09'
, 'GRI_10'
, 'GRI_11'
, 'GRI_12'
, 'GRI_13'
, 'GRI_14'
, 'GRI_15'
, 'GRI_16_ny'
, 'GRI_17'
, 'GRI_18'
, 'GRI_19_ny'
, 'GRI_19_summ_ny'
, 'GRI_20_top'
, 'GRI_20_01'
, 'GRI_20_02'
, 'GRI_20_03_top'
, 'GRI_20_03_a'
, 'GRI_20_03_b'
, 'GRI_20_03_c'
, 'GRI_20_04'
, 'GRI_20_05'
, 'SHI_01_summary_a_ny'
, 'SHI_01_summary_b'
, 'SHI_01_a_dummy'
, 'SHI_01_b_dummy'
, 'SHI_01_c_dummy'
, 'SHI_01_d_dummy'
, 'SHI_01_e_dummy'
, 'SHI_01_f_dummy'
, 'SHI_02'
, 'SHI_03'
, 'SHI_04_ny'
, 'SHI_05_ny'
, 'SHI_06'
, 'SHI_07_ny'
, 'SHI_08'
, 'SHI_09'
, 'SHI_10'
, 'SHI_11'
, 'SHI_12'
, 'SHI_13'
, 'GRX_22_ny'
, 'GRX_22_01_ny'
, 'GRX_22_02_ny'
, 'GRX_22_04_ny'
, 'GRX_22_03_ny'
, 'XSG_25n27_ny'
, 'GRX_25_ny'
, 'SHX_27_ny'
, 'XSG_242526_ny'
, 'GRX_24_ny'
, 'SHX_25_ny'
, 'SHX_26_ny'
 )
 /***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S37_Vx_g_EndTopLines___________v02__aut.sql                                                                                                                      
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [Vx_f_End_TopLines]                                                                    <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_g_End_TopLines]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [V6Row]  =  ROW_NUMBER()
                   OVER(ORDER BY [V6Row] )
      ,[Variable]
      ,[Value]
      ,[Answer_wording]
      ,[NC_MID-2007]
      ,[PC_MID-2007]
      ,[NC_END-2011]
      ,[PC_END-2011]
      ,[NC_END-2012]
      ,[PC_END-2012]
      ,[V5Row]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM 
       [Vx_b_TopLines]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
WHERE
Variable
IN
( 
  'GRI_01'
, 'GRI_02'
, 'GRI_03'
, 'GRI_04'
, 'GRI_05'
, 'GRI_06'
, 'GRI_07'
, 'GRI_08_for_index'
, 'GRI_09'
, 'GRI_10'
, 'GRI_11'
, 'GRI_12'
, 'GRI_13'
, 'GRI_14'
, 'GRI_15'
, 'GRI_16_ny'
, 'GRI_17'
, 'GRI_18'
, 'GRI_19_ny'
, 'GRI_19_summ_ny'
, 'GRI_20_top'
, 'GRI_20_01'
, 'GRI_20_02'
, 'GRI_20_03_top'
, 'GRI_20_03_a'
, 'GRI_20_03_b'
, 'GRI_20_03_c'
, 'GRI_20_04'
, 'GRI_20_05'
, 'SHI_01_summary_a_ny'
, 'SHI_01_summary_b'
, 'SHI_02'
, 'SHI_03'
, 'SHI_04_ny'
, 'SHI_05_ny'
, 'SHI_06'
, 'SHI_07_ny'
, 'SHI_08'
, 'SHI_09'
, 'SHI_10'
, 'SHI_11_for_index'
, 'SHI_12'
, 'SHI_13'
, 'GRX_22_ny'
, 'GRX_22_01_ny'
, 'GRX_22_02_ny'
, 'GRX_22_04_ny'
, 'GRX_22_03_ny'
, 'XSG_25n27_ny'
, 'GRX_25_ny'
, 'SHX_27_ny'
, 'XSG_242526_ny'
, 'GRX_24_ny'
, 'SHX_25_ny'
, 'SHX_26_ny'
                                      )
/***************************************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S38_Vx_h_RRIdxScores____________v01__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[Vx_h_RRIndexScores]                                                            <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [for_x]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_h_RRIndexScores]
AS
/***************************************************************************************************************************************************************/
/*** > pivoted data ********************************************************************************************************************************************/
SELECT 
       [VxhRow]
                   =  ROW_NUMBER()
                      OVER(ORDER BY
                                     [Region]
                                    ,[CEN]
                                              )
      ,[Nation_fk]
      ,[Ctry_EditorialName]
      ,[GRI - MID-2007]
      ,[SHI - MID-2007]
      ,[GRI - END-2011]
      ,[SHI - END-2011]
      ,[GRI - END-2012]
      ,[SHI - END-2012]
      ,[Region]
      ,[GRI - MID-2008]
      ,[SHI - MID-2008]
      ,[GRI - MID-2009]
      ,[SHI - MID-2009]
      ,[GRI - MID-2010]
      ,[SHI - MID-2010]
      ,[GFI - MID-2007]
      ,[GFI - MID-2008]
      ,[GFI - MID-2009]
      ,[GFI - MID-2010]
      ,[GFI - END-2011]
      ,[GFI - END-2012]
      ,[CEN]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
  FROM
/***************************************************************************************************************************************************************/
/*** > pivotable data ******************************************************************************************************************************************/
(
SELECT 
       [Nation_fk]
      ,[Ctry_EditorialName]    =  LTRIM(RTRIM([Ctry_EditorialName]))
      ,[Region]
      ,[CEN]                   =  [Ctry_EditorialName]
      ,[HEAD]                  =  [Index_abbreviation] + ' - ' + [Index_Year]
      ,[I_Rounded_value]
  FROM
       [forum].[dbo].[Pew_Indexes]
UNION All
SELECT 
       [Nation_fk]             = NULL
      ,[Ctry_EditorialName]    = 'Americas     35 countries'
      ,[Region]                = 'Americas'
      ,[CEN]                   = ' '
      ,[HEAD]                  = 'GFI - MID-2007'
      ,[I_Rounded_value]       = NULL
UNION All
SELECT 
       [Nation_fk]             = NULL
      ,[Ctry_EditorialName]    = 'Asia-Pacific     50 countries'
      ,[Region]                = 'Asia-Pacific'
      ,[CEN]                   = ' '
      ,[HEAD]                  = 'GFI - MID-2007'
      ,[I_Rounded_value]       = NULL
UNION All
SELECT 
       [Nation_fk]             = NULL
      ,[Ctry_EditorialName]    = 'Europe     45 countries'
      ,[Region]                = 'Europe'
      ,[CEN]                   = ' '
      ,[HEAD]                  = 'GFI - MID-2007'
      ,[I_Rounded_value]       = NULL
UNION All
SELECT 
       [Nation_fk]             = NULL
      ,[Ctry_EditorialName]    = 'Middle East-North Africa     20 countries'
      ,[Region]                = 'Middle East-North Africa'
      ,[CEN]                   = ' '
      ,[HEAD]                  = 'GFI - MID-2007'
      ,[I_Rounded_value]       = NULL
UNION All
SELECT 
       [Nation_fk]             = NULL
      ,[Ctry_EditorialName]    = 'Sub-Saharan Africa     48 countries'
      ,[Region]                = 'Sub-Saharan Africa'
      ,[CEN]                   = ' '
      ,[HEAD]                  = 'GFI - MID-2007'
      ,[I_Rounded_value]       = NULL
)                                                                                   AS this
/*** < pivotable data ******************************************************************************************************************************************/
PIVOT  ( MAX([I_Rounded_value])    
         FOR [HEAD]
IN ( 
       [GRI - MID-2007]
     , [GRI - MID-2008]
     , [GRI - MID-2009]
     , [GRI - MID-2010]
     , [GRI - END-2011]
     , [GRI - END-2012]
     , [SHI - MID-2007]
     , [SHI - MID-2008]
     , [SHI - MID-2009]
     , [SHI - MID-2010]
     , [SHI - END-2011]
     , [SHI - END-2012]
     , [GFI - MID-2007]
     , [GFI - MID-2008]
     , [GFI - MID-2009]
     , [GFI - MID-2010]
     , [GFI - END-2011]
     , [GFI - END-2012]
                        )
                           ) AS pivt
/*** < pivoted data ********************************************************************************************************************************************/

/***************************************************************************************************************************************************************/

/*** > pivoted data ********************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S39_Vx_i_RRIdxMedians___________v01__aut.sql                                                                                                                     
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[Vx_i_RRIndexMedians]                                                            <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [for_x]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_i_RRIndexMedians]
AS
/***************************************************************************************************************************************************************/

/****************************************************************************/
/***  Query for calculating the median value:                             ***/
/****************************************************************************/
/***  The median is the numerical value separating the higher half from   ***/
/***  the lower half of the data (it can differ from the mean).           ***/
/***  We find it by arranging all the observations from lowest value to   ***/
/***  highest value and picking the middle one. If there is an even       ***/
/***  number of observations, median is defined to be the mean of the two ***/
/***  middle values.                                                      ***/
/****************************************************************************/

/*** >> query to select the median index by year and region: ***************************************************************************************************/
SELECT
        RowN                 = ROW_NUMBER() 
                               OVER 
                               (ORDER BY   
                                           [Question_Year]
                                         , [Index_abbreviation]
                                         , [Region]
                                                                 )
      , [Question_Year]
      , [Index_Year]
      , [Region]
      , [Index_abbreviation]
      , [Median]    = round((AVG([Index_value])),1) /* avg 2 middle values if needed */
FROM
/****************************************************************************/
(
/*** > include StOrd & MedPos ***********************************************/
/*     Notice that:                                                         */
/*      [StOrd]  will have the numeric sorting order of rows by values      */
/*      [MedPos] will have the position in the sorted list:                 */
/*               in three cases:  | 1  |  2  | 3 |                          */
/*               the median is the secong value:  (3+1)/2 = 2               */
/****************************************************************************/
SELECT 
       [StOrd]                = ROW_NUMBER()
                                OVER 
                                (PARTITION BY  
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region]
                                 ORDER BY
                                               [Index_abbreviation]
                                              ,[Index_Year]
                                              ,[Region]
                                              ,[Index_value]
                                                                                )                     /**/
      ,[MedPos]               = (((CAST
                                 ((COUNT(*)
                                   OVER 
                                   (PARTITION BY  [Index_abbreviation]
                                                 ,[Index_Year]
                                                 ,[Region]
                                                                       )) AS DECIMAL (6,2)))+1) / 2)  /**/
      ,[Nation_fk]
      ,[Ctry_EditorialName]
      ,[Region]
      ,[Question_Year]
      ,[Index_Year]
      ,[Index_name]
      ,[Index_abbreviation]
      ,[Index_value]
--      ,[I_Rounded_value]
  FROM
       [forum].[dbo].[Pew_Indexes]
WHERE  
       [Index_abbreviation] IN ('GRI' , 'SHI')
/*** < include StOrd & MedPos ***********************************************/
)                                                                 B
/****************************************************************************/
/*  Notice that:                                                            */
/*  In an odd number of observations, the position is an integer,           */
/*  then we can say: [StOrd] = [MedPos]                                     */
/*  In an even number of observations, the position is between the two      */
/*  middle values, then we need: [StOrd] = ([MedPos] +/- 0.5)               */
/****************************************************************************/
WHERE
      StOrd >= (MedPos - 0.5)
  AND
      StOrd <= (MedPos + 0.5)
/****************************************************************************/
/*  We can have one or two middle values, we group by the other variables   */
/****************************************************************************/
GROUP BY
         [Region]
        ,[Question_Year]
        ,[Index_Year]
        ,[Index_abbreviation]
/*** << query to select the median index by year and region: ***************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S40_Vx_a_LongData_n_Region____v04__aut.sql                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[V9x_LongData]                                                           <<<<<     ***/
/***             NOTE: query does CURRENTLY pull data corresponding to other indexes than GRI & SHI                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [for_x]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_a_LongData&Region]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT 
          distinct
          V9xRow
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Nation_fk]
                            ,CASE WHEN [Q_Number] IS NULL THEN 9999
                                  ELSE [Q_Number]
                                  END
                            ,[QA_std]
                            ,[Question_Year]
                            ,[Answer_value]
                                          )
      ,[entity]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Region]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[AW_std]
                              --= CASE
                              --       WHEN [AW_std] IS NULL THEN [answer_wording]
                              --       ELSE [AW_std]
                              --   END
      ,[AW_det]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
/***************************************************************************************************************************************************************/
FROM
/** >> ** sorting order of questions ***************************************************************************************************************************/
       [for_x].[dbo].[AllQuestions]
/** << ** sorting order of questions ***************************************************************************************************************************/
RIGHT OUTER JOIN
(
/** >> ** current rows of coded & calculated data **************************************************************************************************************/
SELECT 
       [entity]
      ,[link_fk]
      ,[Nation_fk]
      ,[Locality_fk]
      ,[Religion_fk]
      ,[Ctry_EditorialName]
      ,[Locality]
      ,[Religion]
      ,[Question_Year]
      ,[QA_std]
      ,[QW_std]
      ,[Answer_value]
      ,[answer_wording_std]        AS [AW_std]
      ,[answer_wording]            AS [AW_det]
      ,[Question_fk]
      ,[Answer_fk]
      ,[Notes]
  FROM [for_x].[dbo].[V1_DB_Long]
/* filters */
WHERE
Ctry_EditorialName                                   != 'North Korea'
AND
Ctry_EditorialName + '_/_' + STR(Question_Year, 4,0) != 'South Sudan_/_2010'            /* although data are not aggregated for the other part of former Sudan */
/* filters */
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = V4.[Variable]
      ,[QW_std]                    = [Wording_minus3]
      ,[Answer_value]              = V4.[Value]
      ,[AW_std]                    = [Answer_wording]
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V4_L_by_CYV]   V4
LEFT OUTER JOIN
       [for_x].[dbo].[AllQuestions]  AQ
ON
       V4.[Variable]
    =  AQ.[Variable]
LEFT OUTER JOIN
       [for_x].[dbo].[AllAnswers]    AA
ON
       V4.[Variable]
    =  AA.[Variable]
AND
       V4.[Value]
    =  AA.[Value]
WHERE 
       V4.[Variable]
       NOT IN
              (
                SELECT  
                       DISTINCT
                       [QA_std]
                  FROM 
                       [for_x].[dbo].[V1_DB_Long]
                  WHERE 
                       [QA_std] NOT IN (
                                            'GRI_19_b'
                                          , 'GRI_19_c'
                                          , 'GRI_19_d'
                                          , 'GRI_19_da'
                                          , 'GRI_19_db'
                                          , 'GRI_19_e'
                                          , 'GRI_19_f'
                                          , 'GRI_20_05_x1'
                                          , 'SHI_01_b'
                                          , 'SHI_01_c'
                                          , 'SHI_01_d'
                                          , 'SHI_01_da'
                                          , 'SHI_01_db'
                                          , 'SHI_01_e'
                                          , 'SHI_01_f'
                                          , 'SHI_04_b'
                                          , 'SHI_04_c'
                                          , 'SHI_04_d'
                                          , 'SHI_04_da'
                                          , 'SHI_04_db'
                                          , 'SHI_04_e'
                                          , 'SHI_04_f'
                                          , 'SHI_05_b'
                                          , 'SHI_05_c'
                                          , 'SHI_05_d'
                                          , 'SHI_05_da'
                                          , 'SHI_05_db'
                                          , 'SHI_05_e'
                                          , 'SHI_05_f'

                                                                  ) 
                                                                    )
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GRI'
      ,[QW_std]                    = 'Government Restrictions Index (GRI)'
      ,[Answer_value]              = [GRI]
      ,[AW_std]                    = 'scale 0 - [+.] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'SHI'
      ,[QW_std]                    = 'Social Hostilities Index (SHI)'
      ,[Answer_value]              = [SHI]
      ,[AW_std]                    = 'scale 0 - [+.] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GFI'
      ,[QW_std]                    = 'Government Favoritism Index (GFI)'
      ,[Answer_value]              = [GFI]
      ,[AW_std]                    = 'scale 0 - [+.] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GRI_rd_1d'
      ,[QW_std]                    = 'Government Restrictions Index (GRI-rounded)'
      ,[Answer_value]              = [GRI_rd_1d]
      ,[AW_std]                    = 'scale 0 - [+.1] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'SHI_rd_1d'
      ,[QW_std]                    = 'Social Hostilities Index (SHI-rounded)'
      ,[Answer_value]              = [SHI_rd_1d]
      ,[AW_std]                    = 'scale 0 - [+.1] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V3_W&Extras_by_Ctry&Year]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
       [entity]                    = 'Ctry'
      ,[link_fk]                   = 0
      ,[Nation_fk]
      ,[Locality_fk]               = NULL
      ,[Religion_fk]               = NULL
      ,[Ctry_EditorialName]
      ,[Locality]                  = 'not detailed'
      ,[Religion]                  = ''
      ,[Question_Year]
      ,[QA_std]                    = 'GFI_rd_1d'
      ,[QW_std]                    = 'Government Favoritism Index (GFI-rounded)'
      ,[Answer_value]              = [GFI_rd_1d]
      ,[AW_std]                    = 'scale 0 - [+.1] - 10'
      ,[AW_det]                    = NULL
      ,[Question_fk]               = NULL
      ,[Answer_fk]                 = NULL
      ,[Notes]                     = NULL
  FROM
       [for_x].[dbo].[V3_W&Extras_by_Ctry&Year]
/** << ** current rows of coded & calculated data **************************************************************************************************************/
)                                                                                                                                                         AS CRC
/***************************************************************************************************************************************************************/
ON     
       [Variable]
     = [QA_std]
/***************************************************************************************************************************************************************/
/** >> ** add region *******************************************************************************************************************************************/
JOIN
(
SELECT
       [Nation_pk]
      ,[Region]
FROM
       [forum].[dbo].[Pew_Nation]
)                                                                                                                                                         AS RDI
ON     
       [Nation_fk]
     = [Nation_pk]
/** << ** add region *******************************************************************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S41_pend_Vx_j_TopLinesRegion__v10__aut.sql                                                                                                                       
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [for_x].[dbo].[Vx_j_TopLines_by_Region]                                                <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [for_x]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[Vx_j_TopLines_by_Region]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT 
          V6Row
          =  ROW_NUMBER()
             OVER(ORDER BY
                             [Q_Number]
                           , [Variable]
                           , [Value]
                                          )
      ,  [Variable]
      ,  [Value]
      ,  [Answer_wording]
      ,  [NC_Americas_2007]
      ,  [PC_Americas_2007]
      ,  [NC_Americas_2008]
      ,  [PC_Americas_2008]
      ,  [NC_Americas_2009]
      ,  [PC_Americas_2009]
      ,  [NC_Americas_2010]
      ,  [PC_Americas_2010]
      ,  [NC_Americas_2011]
      ,  [PC_Americas_2011]
      ,  [NC_Americas_2012]
      ,  [PC_Americas_2012]
      ,  [NC_Asia-Pacific_2007]
      ,  [PC_Asia-Pacific_2007]
      ,  [NC_Asia-Pacific_2008]
      ,  [PC_Asia-Pacific_2008]
      ,  [NC_Asia-Pacific_2009]
      ,  [PC_Asia-Pacific_2009]
      ,  [NC_Asia-Pacific_2010]
      ,  [PC_Asia-Pacific_2010]
      ,  [NC_Asia-Pacific_2011]
      ,  [PC_Asia-Pacific_2011]
      ,  [NC_Asia-Pacific_2012]
      ,  [PC_Asia-Pacific_2012]
      ,  [NC_Europe_2007]
      ,  [PC_Europe_2007]
      ,  [NC_Europe_2008]
      ,  [PC_Europe_2008]
      ,  [NC_Europe_2009]
      ,  [PC_Europe_2009]
      ,  [NC_Europe_2010]
      ,  [PC_Europe_2010]
      ,  [NC_Europe_2011]
      ,  [PC_Europe_2011]
      ,  [NC_Europe_2012]
      ,  [PC_Europe_2012]
      ,  [NC_Middle East-North Africa_2007]
      ,  [PC_Middle East-North Africa_2007]
      ,  [NC_Middle East-North Africa_2008]
      ,  [PC_Middle East-North Africa_2008]
      ,  [NC_Middle East-North Africa_2009]
      ,  [PC_Middle East-North Africa_2009]
      ,  [NC_Middle East-North Africa_2010]
      ,  [PC_Middle East-North Africa_2010]
      ,  [NC_Middle East-North Africa_2011]
      ,  [PC_Middle East-North Africa_2011]
      ,  [NC_Middle East-North Africa_2012]
      ,  [PC_Middle East-North Africa_2012]
      ,  [NC_Sub-Saharan Africa_2007]
      ,  [PC_Sub-Saharan Africa_2007]
      ,  [NC_Sub-Saharan Africa_2008]
      ,  [PC_Sub-Saharan Africa_2008]
      ,  [NC_Sub-Saharan Africa_2009]
      ,  [PC_Sub-Saharan Africa_2009]
      ,  [NC_Sub-Saharan Africa_2010]
      ,  [PC_Sub-Saharan Africa_2010]
      ,  [NC_Sub-Saharan Africa_2011]
      ,  [PC_Sub-Saharan Africa_2011]
      ,  [NC_Sub-Saharan Africa_2012]
      ,  [PC_Sub-Saharan Africa_2012]
      ,  [V5Row]  FROM
/***************************************************************************************************************************************************************/
(
/***************************************************************************************************************************************************************/
SELECT 
       Q.[Q_Number]
      ,V.[Variable]
      ,V.[Value]
      ,V.[Answer_wording]
      ,  [NC_Americas_2007]
      ,  [PC_Americas_2007]
      ,  [NC_Americas_2008]
      ,  [PC_Americas_2008]
      ,  [NC_Americas_2009]
      ,  [PC_Americas_2009]
      ,  [NC_Americas_2010]
      ,  [PC_Americas_2010]
      ,  [NC_Americas_2011]
      ,  [PC_Americas_2011]
      ,  [NC_Americas_2012]
      ,  [PC_Americas_2012]
      ,  [NC_Asia-Pacific_2007]
      ,  [PC_Asia-Pacific_2007]
      ,  [NC_Asia-Pacific_2008]
      ,  [PC_Asia-Pacific_2008]
      ,  [NC_Asia-Pacific_2009]
      ,  [PC_Asia-Pacific_2009]
      ,  [NC_Asia-Pacific_2010]
      ,  [PC_Asia-Pacific_2010]
      ,  [NC_Asia-Pacific_2011]
      ,  [PC_Asia-Pacific_2011]
      ,  [NC_Asia-Pacific_2012]
      ,  [PC_Asia-Pacific_2012]
      ,  [NC_Europe_2007]
      ,  [PC_Europe_2007]
      ,  [NC_Europe_2008]
      ,  [PC_Europe_2008]
      ,  [NC_Europe_2009]
      ,  [PC_Europe_2009]
      ,  [NC_Europe_2010]
      ,  [PC_Europe_2010]
      ,  [NC_Europe_2011]
      ,  [PC_Europe_2011]
      ,  [NC_Europe_2012]
      ,  [PC_Europe_2012]
      ,  [NC_Middle East-North Africa_2007]
      ,  [PC_Middle East-North Africa_2007]
      ,  [NC_Middle East-North Africa_2008]
      ,  [PC_Middle East-North Africa_2008]
      ,  [NC_Middle East-North Africa_2009]
      ,  [PC_Middle East-North Africa_2009]
      ,  [NC_Middle East-North Africa_2010]
      ,  [PC_Middle East-North Africa_2010]
      ,  [NC_Middle East-North Africa_2011]
      ,  [PC_Middle East-North Africa_2011]
      ,  [NC_Middle East-North Africa_2012]
      ,  [PC_Middle East-North Africa_2012]
      ,  [NC_Sub-Saharan Africa_2007]
      ,  [PC_Sub-Saharan Africa_2007]
      ,  [NC_Sub-Saharan Africa_2008]
      ,  [PC_Sub-Saharan Africa_2008]
      ,  [NC_Sub-Saharan Africa_2009]
      ,  [PC_Sub-Saharan Africa_2009]
      ,  [NC_Sub-Saharan Africa_2010]
      ,  [PC_Sub-Saharan Africa_2010]
      ,  [NC_Sub-Saharan Africa_2011]
      ,  [PC_Sub-Saharan Africa_2011]
      ,  [NC_Sub-Saharan Africa_2012]
      ,  [PC_Sub-Saharan Africa_2012]
      ,  [V5Row]
  FROM [for_x].[dbo].[AllAnswers]            V
LEFT
OUTER
JOIN
       [for_x].[dbo].[V7r_LRestr_by_RV]      D
ON
       V.[Variable]
     = D.[Variable]
AND
       V.[Value]
     = D.[Value]
JOIN
       [for_x].[dbo].[AllQuestions]          Q
ON
       V.[Variable]
     = Q.[Variable]
/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = -6.00
--      ,  [Answer_wording] = [Label_minus4]
--      ,  [NC_Americas_2007]                  = '' 
--      ,  [PC_Americas_2007]                  = '' 
--      ,  [NC_Americas_2008]                  = '' 
--      ,  [PC_Americas_2008]                  = '' 
--      ,  [NC_Americas_2009]                  = '' 
--      ,  [PC_Americas_2009]                  = '' 
--      ,  [NC_Americas_2010]                  = '' 
--      ,  [PC_Americas_2010]                  = '' 
--      ,  [NC_Americas_2011]                  = '' 
--      ,  [PC_Americas_2011]                  = '' 
--      ,  [NC_Americas_2012]                  = '' 
--      ,  [PC_Americas_2012]                  = '' 
--      ,  [NC_Asia-Pacific_2007]              = '' 
--      ,  [PC_Asia-Pacific_2007]              = '' 
--      ,  [NC_Asia-Pacific_2008]              = '' 
--      ,  [PC_Asia-Pacific_2008]              = '' 
--      ,  [NC_Asia-Pacific_2009]              = '' 
--      ,  [PC_Asia-Pacific_2009]              = '' 
--      ,  [NC_Asia-Pacific_2010]              = '' 
--      ,  [PC_Asia-Pacific_2010]              = '' 
--      ,  [NC_Asia-Pacific_2011]              = '' 
--      ,  [PC_Asia-Pacific_2011]              = '' 
--      ,  [NC_Asia-Pacific_2012]              = '' 
--      ,  [PC_Asia-Pacific_2012]              = '' 
--      ,  [NC_Europe_2007]                    = '' 
--      ,  [PC_Europe_2007]                    = '' 
--      ,  [NC_Europe_2008]                    = '' 
--      ,  [PC_Europe_2008]                    = '' 
--      ,  [NC_Europe_2009]                    = '' 
--      ,  [PC_Europe_2009]                    = '' 
--      ,  [NC_Europe_2010]                    = '' 
--      ,  [PC_Europe_2010]                    = '' 
--      ,  [NC_Europe_2011]                    = '' 
--      ,  [PC_Europe_2011]                    = '' 
--      ,  [NC_Europe_2012]                    = '' 
--      ,  [PC_Europe_2012]                    = '' 
--      ,  [NC_Middle East-North Africa_2007]  = '' 
--      ,  [PC_Middle East-North Africa_2007]  = '' 
--      ,  [NC_Middle East-North Africa_2008]  = '' 
--      ,  [PC_Middle East-North Africa_2008]  = '' 
--      ,  [NC_Middle East-North Africa_2009]  = '' 
--      ,  [PC_Middle East-North Africa_2009]  = '' 
--      ,  [NC_Middle East-North Africa_2010]  = '' 
--      ,  [PC_Middle East-North Africa_2010]  = '' 
--      ,  [NC_Middle East-North Africa_2011]  = '' 
--      ,  [PC_Middle East-North Africa_2011]  = '' 
--      ,  [NC_Middle East-North Africa_2012]  = '' 
--      ,  [PC_Middle East-North Africa_2012]  = '' 
--      ,  [NC_Sub-Saharan Africa_2007]        = '' 
--      ,  [PC_Sub-Saharan Africa_2007]        = '' 
--      ,  [NC_Sub-Saharan Africa_2008]        = '' 
--      ,  [PC_Sub-Saharan Africa_2008]        = '' 
--      ,  [NC_Sub-Saharan Africa_2009]        = '' 
--      ,  [PC_Sub-Saharan Africa_2009]        = '' 
--      ,  [NC_Sub-Saharan Africa_2010]        = '' 
--      ,  [PC_Sub-Saharan Africa_2010]        = '' 
--      ,  [NC_Sub-Saharan Africa_2011]        = '' 
--      ,  [PC_Sub-Saharan Africa_2011]        = '' 
--      ,  [NC_Sub-Saharan Africa_2012]        = '' 
--      ,  [PC_Sub-Saharan Africa_2012]        = '' 
--      ,  [V5Row]                             = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = -5.00
      ,  [Answer_wording] = [Wording_minus3]
      ,  [NC_Americas_2007]                  = '' 
      ,  [PC_Americas_2007]                  = '' 
      ,  [NC_Americas_2008]                  = '' 
      ,  [PC_Americas_2008]                  = '' 
      ,  [NC_Americas_2009]                  = '' 
      ,  [PC_Americas_2009]                  = '' 
      ,  [NC_Americas_2010]                  = '' 
      ,  [PC_Americas_2010]                  = '' 
      ,  [NC_Americas_2011]                  = '' 
      ,  [PC_Americas_2011]                  = '' 
      ,  [NC_Americas_2012]                  = '' 
      ,  [PC_Americas_2012]                  = '' 
      ,  [NC_Asia-Pacific_2007]              = '' 
      ,  [PC_Asia-Pacific_2007]              = '' 
      ,  [NC_Asia-Pacific_2008]              = '' 
      ,  [PC_Asia-Pacific_2008]              = '' 
      ,  [NC_Asia-Pacific_2009]              = '' 
      ,  [PC_Asia-Pacific_2009]              = '' 
      ,  [NC_Asia-Pacific_2010]              = '' 
      ,  [PC_Asia-Pacific_2010]              = '' 
      ,  [NC_Asia-Pacific_2011]              = '' 
      ,  [PC_Asia-Pacific_2011]              = '' 
      ,  [NC_Asia-Pacific_2012]              = '' 
      ,  [PC_Asia-Pacific_2012]              = '' 
      ,  [NC_Europe_2007]                    = '' 
      ,  [PC_Europe_2007]                    = '' 
      ,  [NC_Europe_2008]                    = '' 
      ,  [PC_Europe_2008]                    = '' 
      ,  [NC_Europe_2009]                    = '' 
      ,  [PC_Europe_2009]                    = '' 
      ,  [NC_Europe_2010]                    = '' 
      ,  [PC_Europe_2010]                    = '' 
      ,  [NC_Europe_2011]                    = '' 
      ,  [PC_Europe_2011]                    = '' 
      ,  [NC_Europe_2012]                    = '' 
      ,  [PC_Europe_2012]                    = '' 
      ,  [NC_Middle East-North Africa_2007]  = '' 
      ,  [PC_Middle East-North Africa_2007]  = '' 
      ,  [NC_Middle East-North Africa_2008]  = '' 
      ,  [PC_Middle East-North Africa_2008]  = '' 
      ,  [NC_Middle East-North Africa_2009]  = '' 
      ,  [PC_Middle East-North Africa_2009]  = '' 
      ,  [NC_Middle East-North Africa_2010]  = '' 
      ,  [PC_Middle East-North Africa_2010]  = '' 
      ,  [NC_Middle East-North Africa_2011]  = '' 
      ,  [PC_Middle East-North Africa_2011]  = '' 
      ,  [NC_Middle East-North Africa_2012]  = '' 
      ,  [PC_Middle East-North Africa_2012]  = '' 
      ,  [NC_Sub-Saharan Africa_2007]        = '' 
      ,  [PC_Sub-Saharan Africa_2007]        = '' 
      ,  [NC_Sub-Saharan Africa_2008]        = '' 
      ,  [PC_Sub-Saharan Africa_2008]        = '' 
      ,  [NC_Sub-Saharan Africa_2009]        = '' 
      ,  [PC_Sub-Saharan Africa_2009]        = '' 
      ,  [NC_Sub-Saharan Africa_2010]        = '' 
      ,  [PC_Sub-Saharan Africa_2010]        = '' 
      ,  [NC_Sub-Saharan Africa_2011]        = '' 
      ,  [PC_Sub-Saharan Africa_2011]        = '' 
      ,  [NC_Sub-Saharan Africa_2012]        = '' 
      ,  [PC_Sub-Saharan Africa_2012]        = '' 
      ,  [V5Row]                             = 0
  FROM 
       [for_x].[dbo].[AllQuestions]
/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = -4.00
--      ,  [Answer_wording] = ''
--      ,  [NC_MID-2007]    = 'baseline year,'
--      ,  [PC_MID-2007]    = 'ending'
--      ,  [NC_MID-2008]    = 'year'
--      ,  [PC_MID-2008]    = 'ending'
--      ,  [NC_MID-2009]    = 'year'
--      ,  [PC_MID-2009]    = 'ending'
--      ,  [NC_MID-2010]    = 'year'
--      ,  [PC_MID-2010]    = 'ending'
--      ,  [NC_END-2011]    = 'previous year'
--      ,  [PC_END-2011]    = 'ending'
--      ,  [NC_END-2012]    = 'latest year,'
--      ,  [PC_END-2012]    = 'ending'
--      ,  V5Row            = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
--/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = -3.00
--      ,  [Answer_wording] = ''
--      ,  [NC_MID-2007]    = 'MID-'
--      ,  [PC_MID-2007]    = '2007'
--      ,  [NC_MID-2008]    = 'MID-'
--      ,  [PC_MID-2008]    = '2008'
--      ,  [NC_MID-2009]    = 'MID-'
--      ,  [PC_MID-2009]    = '2009'
--      ,  [NC_MID-2010]    = 'MID-'
--      ,  [PC_MID-2010]    = '2010'
--      ,  [NC_END-2011]    = 'Dec. 31,'
--      ,  [PC_END-2011]    = '2011'
--      ,  [NC_END-2012]    = 'Dec. 31,'
--      ,  [PC_END-2012]    = '2012'
--      ,  V5Row            = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
--/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = -2.00
--      ,  [Answer_wording] = ''
--      ,  [NC_MID-2007]    = 'NUMBER OF'
--      ,  [PC_MID-2007]    = '  %  OF  '
--      ,  [NC_MID-2008]    = 'NUMBER OF'
--      ,  [PC_MID-2008]    = '  %  OF  '
--      ,  [NC_MID-2009]    = 'NUMBER OF'
--      ,  [PC_MID-2009]    = '  %  OF  '
--      ,  [NC_MID-2010]    = 'NUMBER OF'
--      ,  [PC_MID-2010]    = '  %  OF  '
--      ,  [NC_MID-2011]    = 'NUMBER OF'
--      ,  [PC_MID-2011]    = '  %  OF  '
--      ,  [NC_MID-2012]    = 'NUMBER OF'
--      ,  [PC_MID-2012]    = '  %  OF  '
--      ,  V5Row            = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
--/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = -1.00
--      ,  [Answer_wording] = ''
--      ,  [NC_MID-2007]    = 'COUNTRIES'
--      ,  [PC_MID-2007]    = 'COUNTRIES'
--      ,  [NC_MID-2008]    = 'COUNTRIES'
--      ,  [PC_MID-2008]    = 'COUNTRIES'
--      ,  [NC_MID-2009]    = 'COUNTRIES'
--      ,  [PC_MID-2009]    = 'COUNTRIES'
--      ,  [NC_MID-2010]    = 'COUNTRIES'
--      ,  [PC_MID-2010]    = 'COUNTRIES'
--      ,  [NC_MID-2011]    = 'COUNTRIES'
--      ,  [PC_MID-2011]    = 'COUNTRIES'
--      ,  [NC_MID-2012]    = 'COUNTRIES'
--      ,  [PC_MID-2012]    = 'COUNTRIES'
--      ,  V5Row            = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
/***************************************************************************************************************************************************************/
UNION ALL
/***************************************************************************************************************************************************************/
SELECT 
         [Q_Number]
      ,  [Variable]
      ,  [Value]          = 200.00
      ,  [Answer_wording]                    = 'TOTAL'
      ,  [NC_Americas_2007]                  = '35' 
      ,  [PC_Americas_2007]                  = '100 %' 
      ,  [NC_Americas_2008]                  = '35' 
      ,  [PC_Americas_2008]                  = '100 %' 
      ,  [NC_Americas_2009]                  = '35' 
      ,  [PC_Americas_2009]                  = '100 %' 
      ,  [NC_Americas_2010]                  = '35' 
      ,  [PC_Americas_2010]                  = '100 %' 
      ,  [NC_Americas_2011]                  = '35' 
      ,  [PC_Americas_2011]                  = '100 %' 
      ,  [NC_Americas_2012]                  = '35' 
      ,  [PC_Americas_2012]                  = '100 %' 
      ,  [NC_Asia-Pacific_2007]              = '50' 
      ,  [PC_Asia-Pacific_2007]              = '100 %' 
      ,  [NC_Asia-Pacific_2008]              = '50' 
      ,  [PC_Asia-Pacific_2008]              = '100 %' 
      ,  [NC_Asia-Pacific_2009]              = '50' 
      ,  [PC_Asia-Pacific_2009]              = '100 %' 
      ,  [NC_Asia-Pacific_2010]              = '50' 
      ,  [PC_Asia-Pacific_2010]              = '100 %' 
      ,  [NC_Asia-Pacific_2011]              = '50' 
      ,  [PC_Asia-Pacific_2011]              = '100 %' 
      ,  [NC_Asia-Pacific_2012]              = '50' 
      ,  [PC_Asia-Pacific_2012]              = '100 %' 
      ,  [NC_Europe_2007]                    = '45' 
      ,  [PC_Europe_2007]                    = '100 %' 
      ,  [NC_Europe_2008]                    = '45' 
      ,  [PC_Europe_2008]                    = '100 %' 
      ,  [NC_Europe_2009]                    = '45' 
      ,  [PC_Europe_2009]                    = '100 %' 
      ,  [NC_Europe_2010]                    = '45' 
      ,  [PC_Europe_2010]                    = '100 %' 
      ,  [NC_Europe_2011]                    = '45' 
      ,  [PC_Europe_2011]                    = '100 %' 
      ,  [NC_Europe_2012]                    = '45' 
      ,  [PC_Europe_2012]                    = '100 %' 
      ,  [NC_Middle East-North Africa_2007]  = '20' 
      ,  [PC_Middle East-North Africa_2007]  = '100 %' 
      ,  [NC_Middle East-North Africa_2008]  = '20' 
      ,  [PC_Middle East-North Africa_2008]  = '100 %' 
      ,  [NC_Middle East-North Africa_2009]  = '20' 
      ,  [PC_Middle East-North Africa_2009]  = '100 %' 
      ,  [NC_Middle East-North Africa_2010]  = '20' 
      ,  [PC_Middle East-North Africa_2010]  = '100 %' 
      ,  [NC_Middle East-North Africa_2011]  = '20' 
      ,  [PC_Middle East-North Africa_2011]  = '100 %' 
      ,  [NC_Middle East-North Africa_2012]  = '20' 
      ,  [PC_Middle East-North Africa_2012]  = '100 %' 
      ,  [NC_Sub-Saharan Africa_2007]        = '47' 
      ,  [PC_Sub-Saharan Africa_2007]        = '100 %' 
      ,  [NC_Sub-Saharan Africa_2008]        = '47' 
      ,  [PC_Sub-Saharan Africa_2008]        = '100 %' 
      ,  [NC_Sub-Saharan Africa_2009]        = '47' 
      ,  [PC_Sub-Saharan Africa_2009]        = '100 %' 
      ,  [NC_Sub-Saharan Africa_2010]        = '47' 
      ,  [PC_Sub-Saharan Africa_2010]        = '100 %' 
      ,  [NC_Sub-Saharan Africa_2011]        = '48' 
      ,  [PC_Sub-Saharan Africa_2011]        = '100 %' 
      ,  [NC_Sub-Saharan Africa_2012]        = '48' 
      ,  [PC_Sub-Saharan Africa_2012]        = '100 %' 
      ,  [V5Row]                             = 0
  FROM 
       [for_x].[dbo].[AllQuestions]
/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = 201.00
--      ,  [Answer_wording] = [Notes1_plus201]
--      ,  [NC_Americas_2007]                  = '' 
--      ,  [PC_Americas_2007]                  = '' 
--      ,  [NC_Americas_2008]                  = '' 
--      ,  [PC_Americas_2008]                  = '' 
--      ,  [NC_Americas_2009]                  = '' 
--      ,  [PC_Americas_2009]                  = '' 
--      ,  [NC_Americas_2010]                  = '' 
--      ,  [PC_Americas_2010]                  = '' 
--      ,  [NC_Americas_2011]                  = '' 
--      ,  [PC_Americas_2011]                  = '' 
--      ,  [NC_Americas_2012]                  = '' 
--      ,  [PC_Americas_2012]                  = '' 
--      ,  [NC_Asia-Pacific_2007]              = '' 
--      ,  [PC_Asia-Pacific_2007]              = '' 
--      ,  [NC_Asia-Pacific_2008]              = '' 
--      ,  [PC_Asia-Pacific_2008]              = '' 
--      ,  [NC_Asia-Pacific_2009]              = '' 
--      ,  [PC_Asia-Pacific_2009]              = '' 
--      ,  [NC_Asia-Pacific_2010]              = '' 
--      ,  [PC_Asia-Pacific_2010]              = '' 
--      ,  [NC_Asia-Pacific_2011]              = '' 
--      ,  [PC_Asia-Pacific_2011]              = '' 
--      ,  [NC_Asia-Pacific_2012]              = '' 
--      ,  [PC_Asia-Pacific_2012]              = '' 
--      ,  [NC_Europe_2007]                    = '' 
--      ,  [PC_Europe_2007]                    = '' 
--      ,  [NC_Europe_2008]                    = '' 
--      ,  [PC_Europe_2008]                    = '' 
--      ,  [NC_Europe_2009]                    = '' 
--      ,  [PC_Europe_2009]                    = '' 
--      ,  [NC_Europe_2010]                    = '' 
--      ,  [PC_Europe_2010]                    = '' 
--      ,  [NC_Europe_2011]                    = '' 
--      ,  [PC_Europe_2011]                    = '' 
--      ,  [NC_Europe_2012]                    = '' 
--      ,  [PC_Europe_2012]                    = '' 
--      ,  [NC_Middle East-North Africa_2007]  = '' 
--      ,  [PC_Middle East-North Africa_2007]  = '' 
--      ,  [NC_Middle East-North Africa_2008]  = '' 
--      ,  [PC_Middle East-North Africa_2008]  = '' 
--      ,  [NC_Middle East-North Africa_2009]  = '' 
--      ,  [PC_Middle East-North Africa_2009]  = '' 
--      ,  [NC_Middle East-North Africa_2010]  = '' 
--      ,  [PC_Middle East-North Africa_2010]  = '' 
--      ,  [NC_Middle East-North Africa_2011]  = '' 
--      ,  [PC_Middle East-North Africa_2011]  = '' 
--      ,  [NC_Middle East-North Africa_2012]  = '' 
--      ,  [PC_Middle East-North Africa_2012]  = '' 
--      ,  [NC_Sub-Saharan Africa_2007]        = '' 
--      ,  [PC_Sub-Saharan Africa_2007]        = '' 
--      ,  [NC_Sub-Saharan Africa_2008]        = '' 
--      ,  [PC_Sub-Saharan Africa_2008]        = '' 
--      ,  [NC_Sub-Saharan Africa_2009]        = '' 
--      ,  [PC_Sub-Saharan Africa_2009]        = '' 
--      ,  [NC_Sub-Saharan Africa_2010]        = '' 
--      ,  [PC_Sub-Saharan Africa_2010]        = '' 
--      ,  [NC_Sub-Saharan Africa_2011]        = '' 
--      ,  [PC_Sub-Saharan Africa_2011]        = '' 
--      ,  [NC_Sub-Saharan Africa_2012]        = '' 
--      ,  [PC_Sub-Saharan Africa_2012]        = '' 
--      ,  [V5Row]                             = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
--/***************************************************************************************************************************************************************/
--UNION ALL
--/***************************************************************************************************************************************************************/
--SELECT 
--         [Q_Number]
--      ,  [Variable]
--      ,  [Value]          = 500.00
--      ,  [Answer_wording]                    = ''
--      ,  [NC_Americas_2007]                  = '' 
--      ,  [PC_Americas_2007]                  = '' 
--      ,  [NC_Americas_2008]                  = '' 
--      ,  [PC_Americas_2008]                  = '' 
--      ,  [NC_Americas_2009]                  = '' 
--      ,  [PC_Americas_2009]                  = '' 
--      ,  [NC_Americas_2010]                  = '' 
--      ,  [PC_Americas_2010]                  = '' 
--      ,  [NC_Americas_2011]                  = '' 
--      ,  [PC_Americas_2011]                  = '' 
--      ,  [NC_Americas_2012]                  = '' 
--      ,  [PC_Americas_2012]                  = '' 
--      ,  [NC_Asia-Pacific_2007]              = '' 
--      ,  [PC_Asia-Pacific_2007]              = '' 
--      ,  [NC_Asia-Pacific_2008]              = '' 
--      ,  [PC_Asia-Pacific_2008]              = '' 
--      ,  [NC_Asia-Pacific_2009]              = '' 
--      ,  [PC_Asia-Pacific_2009]              = '' 
--      ,  [NC_Asia-Pacific_2010]              = '' 
--      ,  [PC_Asia-Pacific_2010]              = '' 
--      ,  [NC_Asia-Pacific_2011]              = '' 
--      ,  [PC_Asia-Pacific_2011]              = '' 
--      ,  [NC_Asia-Pacific_2012]              = '' 
--      ,  [PC_Asia-Pacific_2012]              = '' 
--      ,  [NC_Europe_2007]                    = '' 
--      ,  [PC_Europe_2007]                    = '' 
--      ,  [NC_Europe_2008]                    = '' 
--      ,  [PC_Europe_2008]                    = '' 
--      ,  [NC_Europe_2009]                    = '' 
--      ,  [PC_Europe_2009]                    = '' 
--      ,  [NC_Europe_2010]                    = '' 
--      ,  [PC_Europe_2010]                    = '' 
--      ,  [NC_Europe_2011]                    = '' 
--      ,  [PC_Europe_2011]                    = '' 
--      ,  [NC_Europe_2012]                    = '' 
--      ,  [PC_Europe_2012]                    = '' 
--      ,  [NC_Middle East-North Africa_2007]  = '' 
--      ,  [PC_Middle East-North Africa_2007]  = '' 
--      ,  [NC_Middle East-North Africa_2008]  = '' 
--      ,  [PC_Middle East-North Africa_2008]  = '' 
--      ,  [NC_Middle East-North Africa_2009]  = '' 
--      ,  [PC_Middle East-North Africa_2009]  = '' 
--      ,  [NC_Middle East-North Africa_2010]  = '' 
--      ,  [PC_Middle East-North Africa_2010]  = '' 
--      ,  [NC_Middle East-North Africa_2011]  = '' 
--      ,  [PC_Middle East-North Africa_2011]  = '' 
--      ,  [NC_Middle East-North Africa_2012]  = '' 
--      ,  [PC_Middle East-North Africa_2012]  = '' 
--      ,  [NC_Sub-Saharan Africa_2007]        = '' 
--      ,  [PC_Sub-Saharan Africa_2007]        = '' 
--      ,  [NC_Sub-Saharan Africa_2008]        = '' 
--      ,  [PC_Sub-Saharan Africa_2008]        = '' 
--      ,  [NC_Sub-Saharan Africa_2009]        = '' 
--      ,  [PC_Sub-Saharan Africa_2009]        = '' 
--      ,  [NC_Sub-Saharan Africa_2010]        = '' 
--      ,  [PC_Sub-Saharan Africa_2010]        = '' 
--      ,  [NC_Sub-Saharan Africa_2011]        = '' 
--      ,  [PC_Sub-Saharan Africa_2011]        = '' 
--      ,  [NC_Sub-Saharan Africa_2012]        = '' 
--      ,  [PC_Sub-Saharan Africa_2012]        = '' 
--      ,  [V5Row]                             = 0
--  FROM 
--       [for_x].[dbo].[AllQuestions]
/***************************************************************************************************************************************************************/
)                                                                                                                                                      AS     TL
/***************************************************************************************************************************************************************/
      --,[Notes2_plus202]
      --,[Notes3_plus203]
      --,[CtryVals_p300]

WHERE
Variable
NOT IN
( 
  'GFI'
, 'GRI'
, 'SHI'
, 'GFI_rd_1d'
, 'GRI_rd_1d'
, 'SHI_rd_1d'
--
, 'GRI_01_x2'
, 'GRI_01_x2_a'
, 'GRI_01_x2_b'
--
, 'GRI_19_b'
, 'GRI_19_c'
, 'GRI_19_d'
, 'GRI_19_da'
, 'GRI_19_db'
, 'GRI_19_e'
, 'GRI_19_f'
, 'GRI_19_filter'
--
, 'GRI_20_05_x1'
--
, 'GRX_21_01'
, 'GRX_21_02'
, 'GRX_21_03'
--
, 'GRX_22'
, 'GRX_22_01'
, 'GRX_22_02'
, 'GRX_22_03'
, 'GRX_22_04'
, 'GRX_22_filter'
--
, 'GRX_23'
, 'GRX_24'
--
, 'GRX_27_01'
, 'GRX_27_02'
, 'GRX_27_03'
, 'GRX_28_01'
, 'GRX_28_02'
, 'GRX_28_03'
--
, 'SHI_01_a'
, 'SHI_01_b'
, 'SHI_01_c'
, 'SHI_01_d'
, 'SHI_01_da'
, 'SHI_01_db'
, 'SHI_01_e'
, 'SHI_01_f'
--
, 'SHI_04_b'
, 'SHI_04_c'
, 'SHI_04_d'
, 'SHI_04_da'
, 'SHI_04_db'
, 'SHI_04_e'
, 'SHI_04_f'
, 'SHI_04_filter'
, 'SHI_04_x'
--
, 'SHI_05_b'
, 'SHI_05_c'
, 'SHI_05_d'
, 'SHI_05_da'
, 'SHI_05_db'
, 'SHI_05_e'
, 'SHI_05_f'
, 'SHI_05_filter'
, 'SHI_05_x'
--
, 'SHX_14_01'
, 'SHX_14_02'
, 'SHX_14_03'
, 'SHX_14_04'
, 'SHX_15_01'
, 'SHX_15_02'
, 'SHX_15_03'
, 'SHX_15_04'
, 'SHX_15_05'
, 'SHX_15_06'
, 'SHX_15_07'
, 'SHX_15_08'
, 'SHX_15_09'
, 'SHX_15_10'
--
, 'XSG_S_99_01'
, 'XSG_S_99_02'
, 'XSG_S_99_03'
, 'XSG_S_99_04'
, 'XSG_S_99_05'
, 'XSG_S_99_06'
, 'XSG_S_99_filter'
 ) 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  S50_Cr_Ts_from_Vs______________v04__RUN.sql                                                                                                                      
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
/***********************************************************************************************/
/*** NOTE: [Vx_c_GR&SH_WideData] CANNOT BE A TABLE: minimum row size would be > 8 KB         ***/
/***********************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_a_LongData]
INSERT
INTO 
       [for_x].[dbo].[Tx_a_LongData]
SELECT *
  FROM
       [for_x].[dbo].[Vx_a_LongData]
GO
/***********************************************************************************************/
/***********************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_b_TopLines]
INSERT
INTO 
       [for_x].[dbo].[Tx_b_TopLines]
SELECT *
  FROM
       [for_x].[dbo].[Vx_b_TopLines]
GO
/******************************************************************************************/
/******************************************************************************************/
/*********** VIEW  [for_x].[dbo].[Vx_c_GR&SH_WideData]  IS TOO WIDE TO BECOME TABLE *******/
/******************************************************************************************/
/******************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_d_Vars_by_Ctry]
INSERT
INTO 
       [for_x].[dbo].[Tx_d_Vars_by_Ctry]
SELECT *
  FROM
       [for_x].[dbo].[Vx_d_Vars_by_Ctry]
GO
/******************************************************************************************/
/******************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_e_LongIndex]
INSERT
INTO 
       [for_x].[dbo].[Tx_e_LongIndex]
SELECT *
  FROM
       [for_x].[dbo].[Vx_e_LongIndex]
GO
/******************************************************************************************/
/******************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_f_Index_by_Var]
INSERT
INTO 
       [for_x].[dbo].[Tx_f_Index_by_Var]
SELECT *
  FROM
       [for_x].[dbo].[Vx_f_Index_by_Var]
GO
/******************************************************************************************/
/******************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_g_End_TopLines]
INSERT
INTO 
       [for_x].[dbo].[Tx_g_End_TopLines]
SELECT *
  FROM
       [for_x].[dbo].[Vx_g_End_TopLines]
GO
/******************************************************************************************/
/******************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_h_RRIndexScores]
INSERT
INTO 
       [for_x].[dbo].[Tx_h_RRIndexScores]
SELECT *
  FROM
       [for_x].[dbo].[Vx_h_RRIndexScores]
GO
/******************************************************************************************/
/******************************************************************************************/
TRUNCATE 
TABLE
       [for_x].[dbo].[Tx_i_RRIndexMedians]
INSERT
INTO 
       [for_x].[dbo].[Tx_i_RRIndexMedians]
SELECT *
  FROM
       [for_x].[dbo].[Vx_i_RRIndexMedians]
GO
/******************************************************************************************/
 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  SQLQuery7.sql                                                                                                                                                    
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
--USE [forum]
--GO
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***      The long set of data includes numeric values and descriptive wordings for GR&SH R                                                                  ***/
/***                                                                                                                                                         ***/
/***                                                      > > >     lookup tables work faster     < < <                                                      ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
--SELECT *
--FROM             [forum_ResAnal].[dbo].[vr_01w_DB_Long_NoAggregated]  --  170,623

SELECT     *
  FROM [GRSHR2014].[dbo].[s13_AllLongVals&Desc]
WHERE     [Question_Year] =     'Year_2012'


----/********************************************************************************************************************/
----IF OBJECT_ID('tempdb..#DR2013')         IS NOT NULL
----DROP TABLE           [#DR2013]
----GO
----/********************************************************************************************************************/
----/*** Set of data coded in the working summer-period *****************************************************************/
----SELECT
----           entity              = 'CR&P'
----      ,    link_fk             = 0
----      ,   [Nation_fk]
----      ,    Locality_fk         = NULL
----      ,    Religion_fk         = NULL
----      ,   [Region5]
----      ,   [Region6]
----      ,   [Ctry_EditorialName]
----      ,    Locality            = ''
----      ,    Religion            = ''
----      ,   [Question_Year]      = SUBSTRING([Question_Year], 6, 4)
----      ,   [QA_std]
----      ,   [QW_std]
----      ,   [Answer_value]       =      CAST([Answer_value]   AS DECIMAL(38,2))
----      ,   [answer_wdg_NoStd]   =           [answer_wording]
----      ,   [answer_wording_std]
----      ,    Question_fk         = 0
----      ,    Answer_fk           = 0
----      ,   [Notes]              = 'January - December 2013' 
----      ,   [QS_fk]
----  INTO [#DR2013]
------select *
----  FROM [GRSHR2014].[dbo].[s13_AllLongVals&Desc]
----WHERE
----          [Question_Year] =     'Year_2013'                       ---- only 2013, other data added to include variables not used in 2013
----  AND
----          [QA_std]  NOT IN (  
----                                'SHI_01_summary_b'                ---- 32,076
----                              , 'GRI_19_x'                        ---- 31,878
----                              , 'SHI_01_x'                        ---- 31,680
----                              , 'SHI_04_x'                        ---- 31,482
----                              , 'SHI_05_x'                        ---- 31,284
------                              --, 'SHI_05_filter'
------                              --, 'GRI_02_filter'
------                              --, 'XSG_S_99_filter'
------                              --, 'SHI_04_filter'
------                              --, 'GRI_01_filter'
------                              --, 'GRI_19_filter'
------                              --, 'GRI_02_yBe'
------                              --, 'GRI_01_yBe'  
----                                      )                           ---- 31,086 
----                                                                  ---- 29 927 
----                                                                  ----  1 159 
----  AND NOT
----          (
----                QA_std LIKE 'XSG_S_99_0%'
----           AND  QW_std LIKE '%] used for coding government restrictions and social hostilities on religion?'
----           AND  Answer_value        IS NULL
----           AND  answer_wording      IS NULL
----           AND  answer_wording_std  IS NULL    )                  ----1,158
----/***************************************************************  Set of data coded in the working summer-period  ***/




--/****** Script for SelectTopNRows command from SSMS  ******/
--SELECT [Answer_pk]
--      ,[Answer_value_NoStd]              =   [Answer_value]
--      ,[Answer_Wording]                  =   [answer_wording]
--      ,[Answer_Std_fk]                   =   [Answer_Std_pk]
--      ,[Question_fk]                     =   [Question_pk]
--  FROM [forum].[dbo].[Pew_Answer_NoStd]





/********************************************************************************************************************/
/********************************************************************************************************************/
IF OBJECT_ID('tempdb..#codedDR')         IS NOT NULL
DROP TABLE           [#codedDR]
GO
/********************************************************************************************************************/
SELECT *
INTO   [#codedDR]
FROM
(
/********************************************************************************************************************/
SELECT
          D13.[entity]
      ,   D13.[link_fk]
      ,   D13.[Nation_fk]
/*==================================================================================================================*/
      ,       [Locality_fk]         =  case when D13.[QA_std]        LIKE 'GRI_19_[b-f]'
                                              OR D13.[QA_std]        LIKE 'SHI_0[1, 4, 5]_[b-f]'
                                            then NLT.[Locality_fk]
                                        end
/*==================================================================================================================*/
      ,   QRT.[Religion_fk]
      ,   D13.[Region5]
      ,   D13.[Region6]
      ,   D13.[Ctry_EditorialName]
/*==================================================================================================================*/
      ,       [Locality]            =  case when D13.[QA_std]        LIKE 'GRI_19_[b-f]'
                                              OR D13.[QA_std]        LIKE 'SHI_0[1, 4, 5]_[b-f]'
                                            then NLT.[Locality]
                                            else ''
                                        end
/*==================================================================================================================*/
      ,   QRT.[Religion]
      ,   D13.[Question_Year]
      ,   D13.[QA_std]
      ,   D13.[QW_std]
      ,   AST.[Answer_value_std]
      ,   D13.[Answer_value]
/*==================================================================================================================*/
      ,       [answer_wdg_NoStd]    =  case
                                            when
/*----------------------------------------- nmeric variables -------------------------------------------------------*/
                                                 (    QST.[AnswerSet_num]      = 999999
                                                  and D13.[answer_wdg_NoStd]    IS NULL
                                                  and D13.[Answer_value]       =      0  )
/*----------------------------------------- variables with no descriptions coded -----------------------------------*/
                                              or (    D13.[QA_std]            in (  'GRI_08_a'
                                                                                  , 'GRI_19'
                                                                                  , 'GRI_20_05_x'
                                                                                  , 'GRX_29_01'
                                                                                  , 'SHI_05'
                                                                                  , 'SHI_11_a'   )  )   -- vars
/*----------------------------------------- sets of variables with no descriptions coded ---------------------------*/
                                              or (    D13.[QA_std]             like 'GRI_10_0%'     )   -- 1 to 3
                                              or (    D13.[QA_std]             like 'GRI_11_%'      )   -- 01a to 17
                                              or (    D13.[QA_std]             like 'GRI_20_01x_%'  )   -- 01a to 10
                                              or (    D13.[QA_std]             like 'SHI_01_x_%'    )   -- 01a to 17
                                              or (    D13.[QA_std]             like 'XSG_S_%'           -- 01 to 23
                                                  and D13.[QA_std]         not like 'XSG_S_99_0%'   )   -- ~ not 01-6
/*----------------------------------------- variables with value cero ----------------------------------------------*/
                                              or (    D13.[answer_wdg_NoStd]    IS NULL
                                                  and D13.[Answer_value]       =   0.00             )   -- ...
                                              -- GRI_03, GRI_04, GRI_05, GRI_06, GRI_07, GRI_08, GRI_09, GRI_10,
                                              -- GRI_11, GRI_12, GRI_13, GRI_14, GRI_15, GRI_16, GRI_17, GRI_18,
                                              -- GRX_30, GRX_31, GRX_32, GRX_33, SHI_02, SHI_03, SHI_04, SHI_06,
                                              -- SHI_07, SHI_08, SHI_09, SHI_10, SHI_11, SHI_12, SHI_13,
                                              -- GRI_01_x, GRI_16_01,
                                              -- GRI_20_01, GRI_20_02, GRI_20_03_a, GRI_20_03_b, GRI_20_03_c,
                                              -- GRI_20_04, GRI_20_04_x, GRI_20_05,
                                              -- GRX_22_01, GRX_22_02, GRX_22_03, GRX_22_04,
                                              -- GRX_29_02, GRX_29_03, GRX_29_04, GRX_29_05,
                                              -- SHI_01_a, SHI_02_01, SHI_04_x01, SHI_11_x, 
/*------------------------------------------------------------------------------------------------------------------*/
                                            then 'No description coded'
/*----------------------------------------- errors -----------------------------------------------------------------*/
                                            when
                                                 (    D13.[QA_std]              LIKE   'SHI_04_x01'
                                                  and D13.[answer_wdg_NoStd]    IS NULL
                                                  and D13.[Answer_Wording_Std]  LIKE   'One or more groups'   )
                                            then 'missing description: it should have been coded'
/*------------------------------------------------------------------------------------------------------------------*/
                                            else D13.[answer_wdg_NoStd]
/*------------------------------------------------------------------------------------------------------------------*/
                                        end
/*==================================================================================================================*/
      ,       [Answer_Wording_Std]  =  case when QST.[AnswerSet_num]      = 999999
                                            then AST.[Answer_Wording_Std]
                                            else D13.[answer_wording_std]
                                        end
/*==================================================================================================================*/
      ,   D13.[Question_fk]
      ,   D13.[Answer_fk]
      ,   D13.[Notes]
      ,   D13.[QS_fk]
      ,   QNS.[Question_Std_fk]
      ,   [Answer_Std_pk]
      ,   [Question_pk]
/*==================================================================================================================*/
  FROM [#DR2013]                                              D13
/*==================================================================================================================*/
 left
 join 
       [forum_ResAnal]..[vr_0______QuestionReligionTOOL]     QRT
on 
      D13.[QA_std]
    = QRT.[QA_std]
/*==================================================================================================================*/
 left
 join 
       [forum_ResAnal]..[vr_0______NationLocalityTOOL]       NLT
on 
      D13.[Nation_fk]
    = NLT.[Nation_fk]
/*==================================================================================================================*/
 inner
  join 
       [forum].[dbo].[Pew_Question_NoStd]  QNS
on 
      D13.[Question_Year]
    = QNS.[Question_Year]
and
      D13.[QA_std]
    = QNS.[Question_abbreviation]
/*==================================================================================================================*/
inner join 
       [forum].[dbo].[Pew_Question_Std]    QST
on 
      D13.[QA_std]
    = QST.[Question_abbreviation_std]
/*==================================================================================================================*/
inner join 
       [forum].[dbo].[Pew_Answer_Std]      AST
on 
      QST.[AnswerSet_num]
    = AST.[AnswerSet_number]
and
      case when QST.[AnswerSet_num] = 999999
            and D13.[Answer_value]  > 1      then 1     
           else D13.[Answer_value]
           end
    = AST.[Answer_value_std]
/*==================================================================================================================*/
/********************************************************************************************************************/
)   codedDR
/********************************************************************************************************************/
/********************************************************************************************************************/



  WHERE      NQ.Question_Year                    = 2012
         AND NV.Question_abbreviation_std NOT LIKE 'GRI_11_0%'
         AND NV.Question_abbreviation_std NOT LIKE 'GRI_19_%'
         AND NV.Question_abbreviation_std NOT LIKE 'GRI_20_01x%'
         AND NV.Question_abbreviation_std NOT LIKE 'SHI_01_x%'
         AND NV.Question_abbreviation_std NOT LIKE 'SHI_0[1, 4, 5]_[b-f]' 


         JOIN [forum_d].[dbo].[Pew_Nation_Locality]    NL
              ON NL.Nation_pk
               = NV.Nation_fk
  WHERE         NQ.Question_Year                    = 2012
         AND
           (    NV.Question_abbreviation_std     LIKE 'GRI_19_[b-f]'
             OR NV.Question_abbreviation_std     LIKE 'SHI_0[1, 4, 5]_[b-f]'  ) 


SELECT *
  FROM [#codedDR]
 WHERE
       [answer_wording_std]  is NULL
       or
       [answer_wdg_NoStd]    is NULL




[answer_wdg_NoStd]    =   'selectyprueba'


[QA_std] = 'SHI_05'
and
[answer_wdg_NoStd] is NULL





 -- [Answer_value]   = 0.00
   --and
[answer_wdg_NoStd] is NULL
and
[answer_wording_std] = 'No'





NULL

0.00	No description coded	No
'No description coded'

'No cases or events were found'
'1+ cases or events were found'






SELECT
       --distinct [QA_std], QW_std, [Answer_value_std], [answer_wording_std]
       *
  FROM [#codedDR]                                      ---- 155

where 
QA_std like 'GRI_04'

       --[answer_wording_std]  is NULL
       --or
       [answer_wdg_NoStd]    is NULL

order by  [QA_std], [Answer_value_std]



and QA_std like 'GRI_0[1-2]'



0.00	No description coded	No
'No description coded'

'No cases or events were found'
'1+ cases or events were found'




SELECT [Answer_pk]
SELECT
       distinct
       [QA_std]
      ,[QW_std]
      ,[Answer_value_NoStd]              =   [Answer_value]
      ,[Answer_Wording]                  =   [answer_wdg_NoStd]
      ,[Answer_Std_fk]                   =   [Answer_Std_pk]
      ,[Question_fk]                     =   [Question_pk]
  FROM [#codedDR]

where 
[answer_wdg_NoStd] is NULL



SELECT * from [forum_ResAnal].[dbo].[vrc_01_DB_Long_NoAggregated]
where [QA_std]  like  'SHI_05'
and
[Question_Year]  =  2012
order by
 [QA_std]
 
 

--where

--AST.[AnswerSet_number]  is  null

  

--/****** Script for SelectTopNRows command from SSMS  ******/
--SELECT [Answer_Std_pk]
--      ,[AnswerSet_number]
--      ,[Answer_value_std]
--      ,[Answer_Wording_std]
--      ,[Full_set_of_Answers]
--      ,[NA_by_set_of_Answers]
--  FROM [forum].[dbo].[Pew_Answer_Std]
























--/****** Script for SelectTopNRows command from SSMS  ******/
--SELECT [Question_Std_pk]
--      ,[Question_abbreviation_std]
--      ,[Question_wording_std]
--      ,[Question_short_wording_std]
--      ,[Display]
--      ,[AnswerSet_num]
--      ,[Editorially_Checked]

--      ,[Question_Label_80Chars]
--  FROM [forum].[dbo].[Pew_Question_Std]




--where 



--QNS.[Question_abbreviation] is null

--/****** Script for SelectTopNRows command from SSMS  ******/
--SELECT [Question_pk]
--      ,[Question_abbreviation]
--      ,[Question_wording]
--      ,[Question_Year]
--      ,[Notes]
--      ,[Data_source_fk]
--      ,[Question_Std_fk]
--  FROM [forum].[dbo].[Pew_Question_NoStd]
  
--  where Question_Year
--= 2013 
 
 
 
/***                                                                           -o-                                                                           ***/   
 
 
 
 
/***=========================================================================================================================================================***/   
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
 
 
 
  SQLQuery777.sql                                                                                                                                                  
 
 
 
/*** ------------------------------------------------------------------------------------------------------------------------------------------------------- ***/   
/***=========================================================================================================================================================***/   
 
 
--USE [forum]
--GO
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***      Long set of entered data should include numeric values, standard answers, and descriptive wordings for GR&SH R                                     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***         A. All Std Q&A and all NoStd Qs should have been entered before                                                                                 ***/
/***         B. This script updates the database in terms of:                                                                                                ***/
/***            - loading NoStd Answers to [Pew_Answer_NoStd]                                                                                                ***/
/***            - loading detailed answers (to be appended to [Pew_Nation_Answer], [Pew_Nation_Religion_Answer] & [Pew_Locality_Answer])                     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/


--/***************************************************************************************************************************************************************/
--/***                                                                                                                                                         ***/
--/***         1. Code to extract coded data coreewspondint to last year                                                                                       ***/
--/***                                                                                                                                                         ***/
--/***************************************************************************************************************************************************************/

--/***         currently using [GRSHR2014].[dbo].[s13_AllLongVals&Desc]                                                                                        ***/
--/***         should be revised for using [GRSHR2015].[dbo].[v06_NDLongNoAggreg]                                                                              ***/


--/***************************************************************************************************************************************************************/
--/********************************************************************************************************************/
--IF OBJECT_ID('tempdb..#DR2013')         IS NOT NULL
--DROP TABLE           [#DR2013]
--GO
--/********************************************************************************************************************/
--/*** Set of data coded in the working summer-period *****************************************************************/
--SELECT
--           entity              = 'CR&P'
--      ,    link_fk             = 0
--      ,   [Nation_fk]
--      ,    Locality_fk         = NULL
--      ,    Religion_fk         = NULL
--      ,   [Region5]
--      ,   [Region6]
--      ,   [Ctry_EditorialName]
--      ,    Locality            = ''
--      ,    Religion            = ''
--      ,   [Question_Year]      = SUBSTRING([Question_Year], 6, 4)
--      ,   [QA_std]
--      ,   [QW_std]
--      ,   [Answer_value]       =      CAST([Answer_value]   AS DECIMAL(38,2))
--      ,   [answer_wdg_NoStd]   =           [answer_wording]
--      ,   [answer_wording_std]
--      ,    Question_fk         = 0
--      ,    Answer_fk           = 0
--      ,   [Notes]              = 'January - December 2013' 
--      ,   [QS_fk]
--  INTO [#DR2013]
--select *
  FROM [GRSHR2014].[dbo].[s13_AllLongVals&Desc]     -------[GRSHR2015].[dbo].[v06_NDLongNoAggreg]
 
WHERE
          [Question_Year] =     'Year_2012'                       ---- only 2013, other data added to include variables not used in 2013
--  AND
--          [QA_std]  NOT IN (  
--                                'SHI_01_summary_b'                ---- 32,076
--                              , 'GRI_19_x'                        ---- 31,878
--                              , 'SHI_01_x'                        ---- 31,680
--                              , 'SHI_04_x'                        ---- 31,482
--                              , 'SHI_05_x'                        ---- 31,284
----                              --, 'SHI_05_filter'
----                              --, 'GRI_02_filter'
----                              --, 'XSG_S_99_filter'
----                              --, 'SHI_04_filter'
----                              --, 'GRI_01_filter'
----                              --, 'GRI_19_filter'
----                              --, 'GRI_02_yBe'
----                              --, 'GRI_01_yBe'  
--                                      )                           ---- 31,086 
--                                                                  ---- 29 927 
--                                                                  ----  1 159 
--  AND NOT
--          (
--                QA_std LIKE 'XSG_S_99_0%'
--           AND  QW_std LIKE '%] used for coding government restrictions and social hostilities on religion?'
--           AND  Answer_value        IS NULL
--           AND  answer_wording      IS NULL
--           AND  answer_wording_std  IS NULL    )                  ----1,158
--/***************************************************************  Set of data coded in the working summer-period  ***/
--/***************************************************************************************************************************************************************/
--/***************************************************************************************************************************************************************/



/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***         2. Code to prepare fields to be loaded                                                                                                          ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
IF OBJECT_ID('tempdb..#codedDR')         IS NOT NULL
DROP TABLE           [#codedDR]
GO
/********************************************************************************************************************/
SELECT 
        *
      , [Answer_pk]           =  (DENSE_RANK()
                                        OVER
                                   (ORDER BY     [QA_std]
                                            ,    [Answer_Value_NoStd]
                                            ,    [Answer_Wording_NoStd]    ) )
                               + (SELECT MAX([Answer_pk])
                                   FROM [forum].[dbo].[Pew_Answer_NoStd]     )
/*------------------------------------------------------------------------------------------------------------------*/
      , [Nation_answer_pk]          = CASE WHEN                 [Locality_fk] IS     NULL
                                                            AND [Religion_fk] IS     NULL
                                           THEN   (ROW_NUMBER()
                                                         OVER
                                                    (ORDER BY   [Nation_fk]
                                                              , [QA_Std]                            )  )
                                                 +  (SELECT MAX([Nation_answer_pk])
                                                           FROM [forum]..[Pew_Nation_Answer]           )
                                      END
/*------------------------------------------------------------------------------------------------------------------*/
      , [Locality_answer_pk]        = CASE WHEN                 [Locality_fk] IS NOT NULL
                                           THEN   (ROW_NUMBER()
                                                         OVER
                                                    (ORDER BY   [Nation_fk]
                                                              , [QA_Std]                            )  )
                                                 +  (SELECT MAX([Locality_answer_pk])
                                                           FROM [forum]..[Pew_Locality_Answer]         )
                                      END
/*------------------------------------------------------------------------------------------------------------------*/
      , [Nation_religion_answer_pk] = CASE WHEN                 [Religion_fk] IS NOT NULL
                                           THEN   (ROW_NUMBER()
                                                         OVER
                                                    (ORDER BY   [Nation_fk]
                                                              , [QA_Std]                            )  )
                                                  + (SELECT MAX([Nation_religion_answer_pk])
                                                           FROM [forum]..[Pew_Nation_Religion_Answer]  )  
                                      END
/*------------------------------------------------------------------------------------------------------------------*/
INTO   [#codedDR]
/*------------------------------------------------------------------------------------------------------------------*/
FROM
(
/********************************************************************************************************************/
SELECT
          D13.[entity]
      ,   D13.[link_fk]
      ,   D13.[Nation_fk]
/*==================================================================================================================*/
      ,       [Locality_fk]         =  case when D13.[QA_std]        LIKE 'GRI_19_[b-f]'
                                              OR D13.[QA_std]        LIKE 'SHI_0[1, 4, 5]_[b-f]'
                                            then NLT.[Locality_fk]
                                        end
/*==================================================================================================================*/
      ,   QRT.[Religion_fk]
      ,   D13.[Region5]
      ,   D13.[Region6]
      ,   D13.[Ctry_EditorialName]
/*==================================================================================================================*/
      ,       [Locality]            =  case when D13.[QA_std]        LIKE 'GRI_19_[b-f]'
                                              OR D13.[QA_std]        LIKE 'SHI_0[1, 4, 5]_[b-f]'
                                            then NLT.[Locality]
                                            else ''
                                        end
/*==================================================================================================================*/
      ,   QRT.[Religion]
      ,   D13.[Question_Year]
      ,   D13.[QA_std]
      ,   D13.[QW_std]
      ,   AST.[Answer_Value_Std]
/*------------------------------------------------------------------------------------------------------------------*/
      ,       [Answer_value_NoStd]  =                 D13.[Answer_value]
/*==================================================================================================================*/
      ,       [Answer_Wording_NoStd]=  case
                                            when
/*----------------------------------------- nmeric variables -------------------------------------------------------*/
                                                 (    QST.[AnswerSet_num]      = 999999
                                                  and D13.[Answer_value]       =      0
                                                  and D13.[answer_wdg_NoStd]    IS NULL  )
/*----------------------------------------- variables with no descriptions coded -----------------------------------*/
                                              or (    D13.[QA_std]            in (  'GRI_08_a'
                                                                                  , 'GRI_19'
                                                                                  , 'GRI_20_05_x'
                                                                                  , 'GRX_29_01'
                                                                                  , 'SHI_05'
                                                                                  , 'SHI_11_a'   )  )   -- vars
/*----------------------------------------- sets of variables with no descriptions coded ---------------------------*/
                                              or (    D13.[QA_std]             like 'GRI_10_0%'     )   -- 1 to 3
                                              or (    D13.[QA_std]             like 'GRI_11_%'      )   -- 01a to 17
                                              or (    D13.[QA_std]             like 'GRI_20_01x_%'  )   -- 01a to 10
                                              or (    D13.[QA_std]             like 'SHI_01_x_%'    )   -- 01a to 17
                                              or (    D13.[QA_std]             like 'XSG_S_%'           -- 01 to 23
                                                  and D13.[QA_std]         not like 'XSG_S_99_0%'   )   -- ~ not 01-6
/*----------------------------------------- variables with value cero ----------------------------------------------*/
                                              or (    D13.[answer_wdg_NoStd]    IS NULL
                                                  and D13.[Answer_value]       =   0.00             )   -- ...
                                              -- GRI_03, GRI_04, GRI_05, GRI_06, GRI_07, GRI_08, GRI_09, GRI_10,
                                              -- GRI_11, GRI_12, GRI_13, GRI_14, GRI_15, GRI_16, GRI_17, GRI_18,
                                              -- GRX_30, GRX_31, GRX_32, GRX_33, SHI_02, SHI_03, SHI_04, SHI_06,
                                              -- SHI_07, SHI_08, SHI_09, SHI_10, SHI_11, SHI_12, SHI_13,
                                              -- GRI_01_x, GRI_16_01,
                                              -- GRI_20_01, GRI_20_02, GRI_20_03_a, GRI_20_03_b, GRI_20_03_c,
                                              -- GRI_20_04, GRI_20_04_x, GRI_20_05,
                                              -- GRX_22_01, GRX_22_02, GRX_22_03, GRX_22_04,
                                              -- GRX_29_02, GRX_29_03, GRX_29_04, GRX_29_05,
                                              -- SHI_01_a, SHI_02_01, SHI_04_x01, SHI_11_x, 
/*------------------------------------------------------------------------------------------------------------------*/
                                            then 'No description coded'
/*----------------------------------------- errors -----------------------------------------------------------------*/
                                            when
                                                 (    D13.[QA_std]              LIKE   'SHI_04_x01'
                                                  and D13.[answer_wdg_NoStd]    IS NULL
                                                  and D13.[Answer_Wording_Std]  LIKE   'One or more groups'   )
                                            then 'missing description: it should have been coded'
/*------------------------------------------------------------------------------------------------------------------*/
                                            else D13.[answer_wdg_NoStd]
/*------------------------------------------------------------------------------------------------------------------*/
                                        end
/*==================================================================================================================*/
      ,       [Answer_Wording_Std]  =  case when QST.[AnswerSet_num]      = 999999
                                            then AST.[Answer_Wording_Std]
                                            else D13.[answer_wording_std]
                                        end
/*==================================================================================================================*/
      ,       [Display]             =  case when D13.[QA_std]
                                              In (   'GRI_01', 'GRI_02', 'GRI_03', 'GRI_04', 'GRI_05'
                                                   , 'GRI_06', 'GRI_07', 'GRI_08', 'GRI_09', 'GRI_10'
                                                   , 'GRI_11', 'GRI_12', 'GRI_13', 'GRI_14', 'GRI_15'
                                                   , 'GRI_16', 'GRI_17', 'GRI_18', 'GRI_19'
                                                   , 'GRI_20_01'  , 'GRI_20_02'
                                                   , 'GRI_20_03_a', 'GRI_20_03_b', 'GRI_20_03_c'
                                                   , 'GRI_20_04', 'GRI_20_05'
                                                   ,           'SHI_02', 'SHI_03', 'SHI_04', 'SHI_05'
                                                   , 'SHI_06', 'SHI_07', 'SHI_08', 'SHI_09', 'SHI_10'
                                                   , 'SHI_11', 'SHI_12', 'SHI_13'                     )
                                            then 1
                                            else 0
                                        end
/*==================================================================================================================*/


      ,   D13.[Notes]
      ,   D13.[QS_fk]
      ,   QNS.[Question_Std_fk]
/*------------------------------------------------------------------------------------------------------------------*/
      ,       [Answer_Std_fk]       =            AST.[Answer_Std_pk]
/*------------------------------------------------------------------------------------------------------------------*/
--    ,   D13.[Question_fk]
      ,       [Question_fk]         =            QNS.[Question_pk]
/*------------------------------------------------------------------------------------------------------------------*/
--    ,   D13.[Answer_fk]
/*==================================================================================================================*/
  FROM [#DR2013]                                              D13
/*==================================================================================================================*/
 left
 join 
       [forum_ResAnal]..[vr_0______QuestionReligionTOOL]     QRT
on 
      D13.[QA_std]
    = QRT.[QA_std]
/*==================================================================================================================*/
 left
 join 
       [forum_ResAnal]..[vr_0______NationLocalityTOOL]       NLT
on 
      D13.[Nation_fk]
    = NLT.[Nation_fk]
/*==================================================================================================================*/
 inner
  join 
       [forum].[dbo].[Pew_Question_NoStd]  QNS
on 
      D13.[Question_Year]
    = QNS.[Question_Year]
and
      D13.[QA_std]
    = QNS.[Question_abbreviation]
/*==================================================================================================================*/
inner join 
       [forum].[dbo].[Pew_Question_Std]    QST
on 
      D13.[QA_std]
    = QST.[Question_abbreviation_std]
/*==================================================================================================================*/
inner join 
       [forum].[dbo].[Pew_Answer_Std]      AST
on 
      QST.[AnswerSet_num]
    = AST.[AnswerSet_number]
and
      case when QST.[AnswerSet_num] = 999999
            and D13.[Answer_value]  > 1      then 1     
           else D13.[Answer_value]
           end
    = AST.[Answer_value_std]
/*==================================================================================================================*/
/********************************************************************************************************************/
)   codedDR
/********************************************************************************************************************/
/********************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/


select * from [#DR2013]
select * ,  ansk = DENSE_RANK() OVER (ORDER BY QA_std, Answer_value_NOSTD, answer_wording_NoStd)
from [#codedDR]

select distinct [QA_std]
from [#codedDR]
order by        [QA_std]


where 
--Nation_fk   is not NULL
    Locality_fk is     NULL
AND Religion_fk is     NULL
--Locality_fk is not NULL
--Religion_fk is not NULL


is NULL

is NULL
	NULL
/*=============================================================================================================================================================*/
INSERT                                                            ---- 17,255
INSERT                                                            ----  3,762
INSERT                                                            ----  8,910
                                                                       29,927


--USE [juancarlos]
--GO
--/***************************************************************************************************************************************************************/
--  DECLARE  @CrDt    varchar( 8)
--  DECLARE  @TofI    varchar(50)
--  SET      @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))
--  DECLARE  MyCursor
--  CURSOR FOR      SELECT 'Pew_Answer_NoStd'
--            UNION SELECT 'Pew_Locality_Answer'
--            UNION SELECT 'Pew_Nation_Answer'
--            UNION SELECT 'Pew_Nation_Religion_Answer'
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--   OPEN    MyCursor
--	FETCH  NEXT
--	FROM   MyCursor
--	INTO   @TofI
--	WHILE  @@FETCH_STATUS = 0
--	BEGIN
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--           EXEC ( ' SELECT *
--                    INTO  [juancarlos].[dbo].[' + @TofI + ']
--                    FROM       [forum].[dbo].[' + @TofI + ']' )
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	FETCH  NEXT
--	FROM   MyCursor
--	INTO   @TofI
--    END
--    CLOSE  MyCursor
--DEALLOCATE MyCursor
--/***************************************************************************************************************************************************************/
--ALTER TABLE [Pew_Answer_NoStd]
--ADD   CONSTRAINT PANS_pk PRIMARY KEY([Answer_pk])
--GO
--ALTER TABLE [Pew_Nation_Answer]
--ADD   CONSTRAINT PNAn_pk PRIMARY KEY([Nation_Answer_pk])
--GO
--ALTER TABLE [Pew_Locality_Answer]
--ADD   CONSTRAINT PLAn_pk PRIMARY KEY([Locality_Answer_pk])
--GO
--ALTER TABLE [Pew_Nation_Religion_Answer]
--ADD   CONSTRAINT PNRA_pk PRIMARY KEY([Nation_Religion_Answer_pk])
--GO

--TRUNCATE TABLE [juancarlos]..[Pew_Answer_NoStd]
--TRUNCATE TABLE [juancarlos]..[Pew_Nation_Answer]
--TRUNCATE TABLE [juancarlos]..[Pew_Locality_Answer]
--TRUNCATE TABLE [juancarlos]..[Pew_Nation_Religion_Answer]

--DROP TABLE [juancarlos]..[Pew_Answer_NoStd]
--DROP TABLE [juancarlos]..[Pew_Nation_Answer]
--DROP TABLE [juancarlos]..[Pew_Locality_Answer]
--DROP TABLE [juancarlos]..[Pew_Nation_Religion_Answer]
--/***************************************************************************************************************************************************************/




/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***         3. Load new data into tables                                                                                                                    ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
--USE [forum]
--GO
/***************************************************************************************************************************************************************/
/*****                                           BackUp  current Table(s)                                                                                  *****/
/***************************************************************************************************************************************************************/
  DECLARE  @CrDt    varchar( 8)
  DECLARE  @TofI    varchar(50)
  SET      @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))
  DECLARE  MyCursor
  CURSOR 
        FOR      SELECT 'Pew_Answer_NoStd'
           UNION SELECT 'Pew_Locality_Answer'
           UNION SELECT 'Pew_Nation_Answer'
           UNION SELECT 'Pew_Nation_Religion_Answer'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
   OPEN    MyCursor
	FETCH  NEXT
	FROM   MyCursor
	INTO   @TofI
	WHILE  @@FETCH_STATUS = 0
	BEGIN
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
EXEC ( ' SELECT *
                INTO  [_bk_forum].[dbo].[' + @TofI + '_' + @CrDt + ']
                FROM      [forum].[dbo].[' + @TofI               + ']' )
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
	FETCH  NEXT
	FROM   MyCursor
	INTO   @TofI
    END
    CLOSE  MyCursor
DEALLOCATE MyCursor
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
INSERT                                                            ----  5,097
  INTO
       [Pew_Answer_NoStd]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
       DISTINCT
       [Answer_pk]
      ,[Answer_value_NoStd]
      ,[Answer_Wording]       = [Answer_Wording_NoStd]
      ,[Answer_Std_fk]
      ,[Question_fk]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM   [#codedDR]
/*=============================================================================================================================================================*/
INSERT                                                            ---- 17,255
  INTO
       [Pew_Nation_Answer]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
       DISTINCT
       [Nation_answer_pk]
      ,[Nation_fk]
      ,[Answer_fk]            = [Answer_Pk]
      ,[display]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM   [#codedDR]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
WHERE  [Locality_fk] IS     NULL
  AND  [Religion_fk] IS     NULL
/*=============================================================================================================================================================*/
INSERT                                                            ----  3,762
  INTO
       [Pew_Locality_Answer]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
       DISTINCT
       [Locality_answer_pk]
      ,[Locality_fk]
      ,[Answer_fk]            = [Answer_pk]
      ,[display]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM   [#codedDR]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
WHERE  [Locality_fk] IS NOT NULL
/*=============================================================================================================================================================*/
INSERT                                                            ----  8,910
  INTO
       [Pew_Nation_Religion_Answer]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
       DISTINCT
       [Nation_religion_answer_pk]
      ,[Nation_fk]
      ,[Religion_group_fk]    = [Religion_fk]
      ,[Answer_fk]            = [Answer_Pk]
      ,[display]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM   [#codedDR]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
WHERE  [Religion_fk] IS NOT NULL
/*=============================================================================================================================================================*/







--SELECT 
--      distinct [Answer_Pk]
----     *
--FROM
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
--(
--/*** Set of data at country level ***********************************************************************************/
--SELECT     entity      = 'Ctry'
--      ,    link_fk     = KN.[Nation_answer_pk]
--      , Q.[Answer_Pk]
--      , Q.[Answer_value_NoStd]
--      , Q.[answer_wording]
--      , Q.[Question_fk]
--      , Q.[Answer_Std_fk]
--      ,    Nation_fk   = KN.[Nation_fk]
--      ,    Locality_fk = NULL
--      ,    Religion_fk = NULL
--      ,   [display]
--  FROM [Pew_Answer_NoStd]       Q
--      ,[Pew_Nation_Answer]      KN
--WHERE Q.[Answer_Pk]           = KN.[Answer_fk]
--/*********************************************************************************** Set of data at country level ***/
--UNION ALL
--/*** Set of data at country/religious group level *******************************************************************/
--SELECT     entity      = 'RGrp'
--      ,    link_fk     = KR.[Nation_religion_answer_pk]
--      , Q.[Answer_Pk]
--      , Q.[Answer_value_NoStd]
--      , Q.[answer_wording]
--      , Q.[Question_fk]
--      , Q.[Answer_Std_fk]
--      ,    Nation_fk   = NULL
--      ,    Locality_fk = NULL
--      ,    Religion_fk = KR.[Religion_group_fk]
--      ,   [display]
--  FROM [Pew_Answer_NoStd]             Q
--      ,[Pew_Nation_Religion_Answer]   KR
--WHERE Q.[Answer_pk]           = KR.[Answer_fk]
--/******************************************************************* Set of data at country/religious group level ***/
--UNION ALL
--/*** Set of data at country/province level **************************************************************************/
--SELECT
--           entity             = 'Prov'
--      ,    link_fk     = KL.[Locality_answer_pk]
--      , Q.[Answer_Pk]
--      , Q.[Answer_value_NoStd]
--      , Q.[answer_wording]
--      , Q.[Question_fk]
--      , Q.[Answer_Std_fk]
--      ,    Nation_fk   = NULL
--      ,    Locality_fk = KL.[Locality_fk]
--      ,    Religion_fk = NULL
--      ,   [display]
--  FROM [Pew_Answer_NoStd]      Q
--      ,[Pew_Locality_Answer]   KL
--WHERE Q.[Answer_pk]   = KL.[Answer_fk]
--/************************************************************************** Set of data at country/province level ***/
--) AS NPR


 
 
 
 
/***                                                                           -o-                                                                           ***/   
