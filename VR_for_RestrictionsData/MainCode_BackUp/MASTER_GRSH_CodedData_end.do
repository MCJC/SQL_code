*******************************************************************************************************************
** Master Program for SQL & Stata scripts                                                                        **
** for procesing data on Government Restrictions and Social Hostilities involving Religion                       **
*******************************************************************************************************************
{
*******************************************************************************************************************
*******************************************************************************************************************
**                                                                                                               **
**  NOTE:                                                                                                        **
**        This script and all those referred here are stored in the working directory                            **
**                                                                                                               **
*******************************************************************************************************************
*******************************************************************************************************************
*
* Select work directory:
cd "S:\Forum\Database\MANAGEMENT\Y2013\Load_using__for_x"
local dir = "S:\Forum\Database\MANAGEMENT\Y2013\Load_using__for_x"
* save date & time:
local d = subinstr( (c(current_date)) ," ","",.)
local t = subinstr( (c(current_time)) ,":","",.)
* Create log of the session:
capture log close
log using "C:\data\Restrictions_ver2013\For_x_procedure_`d'_`t'.log", replace
* context:
clear all
version 12
set more off
  pause off
* pause on
  set trace off
* set trace on
* Save & Display date & time to check how long the program takes to run:
scalar cxdM=(c(current_date))
scalar cxtM=(c(current_time))
di cxdM "   " cxtM
*******************************************************************************************************************
}
*******************************************************************************************************************
***                                                                                                             ***
***  SQL   scripts include versioning in their name: tailored command facilitates update                        ***
***  Stata scripts do not include versioning in their name                                                      ***
***                                                                                                             ***
*******************************************************************************************************************
{
*******************************************************************************************************************
***  Basic Tables *************************************************************************************************
*-----------------------------------------------------------------------------------------------------------------*
* the following extracts and merges together data from the basic tables (in SQL Server [forum] database)
* - code from here SHOULD BE UPDATED to work from [forum] to keep views once database is updated
runsql s11_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following changes data into a wide format and collapses by country & year (in SQL Server [for_x] database)
* - no need to update when working from [forum]
runsql s12_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following adds rescaled and aggregated variables into the wide format by country & year (in [for_x] database)
* - no need to update when working from [forum]
runsql s13_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following changes data into a long format (in [for_x] database)
* - currently excluding rounded indexes
* - currently not including regions, could be changed for S20
* - should it include basic variables?
* - no need to update when working from [forum]
runsql s14_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following filters only variables to be included in the wide Stata dataset (in [for_x] database)
* - no need to update when working from [forum]
runsql s15_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following extracts indexes & "basic" variables to be included in the wide Stata dataset (in [for_x] database)
* - no need to update when working from [forum]
runsql s16_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s17_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s18_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s19_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s20_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s21_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s31_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s32_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s33_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
qui: do postS33_ExportWideData.do
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s34_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
qui: do postS34_Tables_by_Coutry.do
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s35_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
qui: do postS35_ExportRoundableIndexes.do
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s36_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s37_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s38_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s39_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s40_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s50_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
* the following
* - 
runsql s99_  forumdb for_x
*-----------------------------------------------------------------------------------------------------------------*
*******************************************************************************************************************
}
*******************************************************************************************************************
***                                                                                                             ***
***  Stata notes to remind process of updating XLSX documents                                                   ***
***                                                                                                             ***
*******************************************************************************************************************
{
*******************************************************************************************************************
pause on
pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that file   ForAnalysis_6Yrs.xlsx   has been updated        **" _newline    ///
"**                                                                               **" _newline    ///
"**           (filter to display 1/2 country(ies) and check changes)              **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that file   TopLines_ALL_Draft.xlsx   1s updated      **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**                        (filter column C for value -6 )                        **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that file   AllData_long(+Region).xlsx   is updated         **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**                     (filter to check changes in 2/3 rows)                     **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that file   T6_TopLines_by_Ctry.xlsx   has been updated     **" _newline    ///
"**                       (in case table structure changed)                       **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that   T5_RRIdx_Medians_by_Region.xlsx   is updated         **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**               (filter to check changes if index values changed)               **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that   T4_TopLines_by_Region.xlsx   is updated              **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**                        (filter column C for value -5 )                        **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Check that   T3_Crosstabs_AvgGRI&SHI_by_Answs.xlsx   is updated          **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**                           (visually check column N)                           **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that   T2_RRIdx_Scores_by_Region.xlsx   is updated          **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**               (filter to check changes if index values changed)               **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
di as error                                                                           _newline(2) ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///
"**                                                                               **" _newline    ///
"**   -  Please check that   T1_TopLines.xlsx   is updated                        **" _newline    ///
"**                                                                               **" _newline    ///
"**                         (refresh ALL data & save !!!)                         **" _newline    ///
"**                        (filter column C for value -6 )                        **" _newline    ///
"**                                                                               **" _newline    ///
"**                                                                               **" _newline    ///
"***********************************************************************************" _newline    ///
"***********************************************************************************" _newline    ///

pause
*-----------------------------------------------------------------------------------------------------------------*
*******************************************************************************************************************
}
*******************************************************************************************************************
***                                                                                                             ***
***  Display overall final message:                                                                             ***
***                                                                                                             ***
*******************************************************************************************************************
{
di as error                                                                                                                 _newline(8) ///
"*************************************************************************************************************************" _newline    ///
"*************************************************************************************************************************" _newline    ///
"*************************************************************************************************************************" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                Stata script (do file)                                               **" _newline    ///
"**                                               MASTER_GRSH_CodedData.do                                              **" _newline    ///
"**                                                     ends  HERE!!!                                                   **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                        CHECK LOG FILE FOR ANY EVENTUAL ERROR                                        **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                       EXCEL FILES SHOULD BE MANUALLY UPDATED                                        **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                               VER: 2013.10          **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**                                                                                                                     **" _newline    ///
"**   Started: " _column(23)    cxdM           _column(35) "at" _column(39)    cxtM                       _column(120) "**" _newline    ///
"**   Ended:   " _column(23) (c(current_date)) _column(35) "at" _column(39) (c(current_time))             _column(120) "**" _newline    ///
"**"                                                                                                      _column(120) "**" _newline    ///
"*************************************************************************************************************************" _newline    ///
"*************************************************************************************************************************" _newline    ///
"*************************************************************************************************************************" _newline(2)  //
qui: log close
********************************************************************************************************************* .
}
