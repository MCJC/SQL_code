/***************************************************************************************************************************************************************/
Print '--- '+CONVERT(VARCHAR(19),SYSDATETIME())+' ==>  script 2.002    ---------------------------------------------------------------------------------------- '
/***************************************************************************************************************************************************************/
/***                                                                                                                                            ***/
/***     >>>>>   This is the script used to create the view [GRSHRYYYY].[dbo].[v02_AllCodedValues]                                    <<<<<     ***/
/***             (all new & formerly enetered values in wide format by country/year)                                                            ***/
/***                                                                                                                                            ***/
/**************************************************************************************************************************************************/
USE              [GRSHRcode]
GO
/**************************************************************************************************************************************************/
/*********************************************************     >>>>>  this is the first part of the code                                        ***/

/***  view [EnteredValues] ************************************************************************************************************************/
/**************************************************************************************************************************************************/
declare @CODEnew nvarchar(max)                            /***        declare variable for storing the main code to be executed                 ***/
set     @CODEnew =                                        /***        start storing text as part of the main code to be executed                ***/
/*********************************************************     >>>>>> this is the main code to be executed                                      ***/
/**************************************************************************************************************************************************/
                                                       /*** >>>    ...                                                                          ***/
 N'
ALTER VIEW     [v02_AllCodedValues]
AS
      SELECT
               EV.[Question_Year]
             , EV.[Nation_fk]
             , EV.[Ctry_EditorialName]
             ' +
/**************************************************************************************************************************************************/
(           SELECT ', ' + [QAS] FROM [AT_Qs]           /*** >      Begin selection (into text, in a cell, comma delimited list of varnames)     ***/
                             FOR XML PATH('')    )     /*** <      End of the selection, nesting all cells into an XML string cell              ***/
/**************************************************************************************************************************************************/
+N'                FROM [v01_EnteredValues]            EV


UNION ALL


      SELECT
               PV.[Question_Year]
             , PV.[Nation_fk]
             , PV.[Ctry_EditorialName]
             ' +
/**************************************************************************************************************************************************/
(           SELECT ', ' + [QAS] FROM [AT_Qs]           /*** >      Begin selection (into text, in a cell, comma delimited list of varnames)     ***/
                             FOR XML PATH('')    )     /*** <      End of the selection, nesting all cells into an XML string cell              ***/
/**************************************************************************************************************************************************/
+N'                FROM [GRSH_C]                       PV
                  WHERE [Question_Year] = (SELECT MIN([Question_Year]) FROM [GRSH_C])     '
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
--	EXEC dbo.LongPrint @CODEnew                        /***        display the currently stored code (to be executed)                           ***/
	EXEC              (@CODEnew)                       /***        execute the code that has been stored as text                                ***/
/**************************************************************************************************************************************************/
/**************************************************************************************************************************************************/
GO
/***************************************************************************************************************************************************************/
Print                    '------------------------------------------------------------------------------------------------------------------------------------- '
/***************************************************************************************************************************************************************/
GO