/***************************************************************************************************************************************************************/
--------Print 
--------'--- ' + CONVERT (VARCHAR(19), SYSDATETIME()) + ' ==>  script 000    ------------------------------------------------------------------------------------------ '
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>         This script loads  - STEP BY STEP -  new coded data for GR & SH on R                                                        <<<<<     ***/
/***                                                                                                                                                         ***/
/***                                                                                                                                                         ***/
/***      Long set of entered data should include numeric values, standard answers, and descriptive wordings for GR&SH R                                     ***/
/***                                                                                                                                                         ***/
/***         A. All Std Q&A and all NoStd Qs should have been entered before                                                                                 ***/
/***                                                                                                                                                         ***/
/***         B. This script updates the database in terms of:                                                                                                ***/
/***                                                                                                                                                         ***/
/***            - loading NoStd Answers to be added to:                                                                                                      ***/
/***                      [Pew_Answer_NoStd]                                                                                                                 ***/
/***                                                                                                                                                         ***/
/***            - loading 'çountry-level' answers to be added to:                                                                                            ***/
/***                      [Pew_Nation_Answer]                                                                                                                ***/
/***                      [Pew_Nation_Religion_Answer]                                                                                                       ***/
/***                      [Pew_Locality_Answer])                                                                                                             ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum_ResAnal]
GO
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***         1. Code to extract coded data corresponding to last coding period                                                                               ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
/***         1.1     CORRECTIONS                                                                                                                             ***/
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IF           OBJECT_ID('tempdb..#NDLongNoAggreg')  IS NOT NULL
DROP TABLE                     [#NDLongNoAggreg]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT * INTO                  [#NDLongNoAggreg]
  FROM        (
/*|->  CORRECTED set of coded data ===========================================================================================================================*/
/*    >  ADD SHI_11 - to be calculated from Access Tool next year ============================================================================================*/
		 SELECT
				 [entity]               = 'CR&P'
				,[link_fk]              = 0
				,[Nation_fk]
				,[Locality_fk]          = NULL
				,[Religion_fk]          = NULL
				,[Region5]
				,[Region6]
				,[Ctry_EditorialName]
				,[Locality]             = ''
				,[Religion]             = ''
				,[Question_Year]        = 2014
				,[QA_std]               = 'SHI_11'
				,[QW_std]               = 'Were women harassed for violating religious dress codes?'
                ,[Answer_value]         = CAST(
                                                CASE WHEN SUM([AV]) > 1 THEN 1
                                                     ELSE SUM([AV])                END   AS DECIMAL(38,2))
				,[answer_wording]       = ''
				,[answer_wording_std]   =       CASE WHEN SUM([AV]) = 0 THEN 'No'
                                                                        ELSE 'Yes' END
				,[Question_fk]          = 0
				,[Answer_fk]            = 0
				,[Notes]                = 'January - December 2014'
           FROM
			(	SELECT [AV]  = CASE
								   WHEN [QA_std] = 'SHI_11_a' AND [Answer_value] = 1 THEN 0.5 
                                   ELSE                           [Answer_value]
							   END
					  ,*
                  FROM [GRSHRResults].[dbo].[NDLongNoAggreg]
                 WHERE [QA_std] IN ( 'SHI_11_a', 'SHI_11_b' )                                   ) SHI11
       GROUP BY  [Nation_fk]
				,[Region5]
				,[Region6]
				,[Ctry_EditorialName]
/*    <  ADD SHI_11 - to be calculated from Access Tool next year ============================================================================================*/
		UNION
		  ALL
				SELECT
						 [entity]
						,[link_fk]
						,[Nation_fk]
						,[Locality_fk]
						,[Religion_fk]
						,[Region5]
						,[Region6]
						,[Ctry_EditorialName]
						,[Locality]
						,[Religion]
						,[Question_Year]
						,[QA_std]
						,[QW_std]
						,[Answer_value] = CASE
												WHEN [Nation_fk]				=        206
												 AND [Ctry_EditorialName]		=  'Thailand'
												 AND [Question_Year]			=       2014
												 AND [QA_std]					=  'SHI_05_c'
												 AND [QW_std]				 LIKE  '%detentions or abduction%war or armed conflict?'
												 AND [Answer_value]			   IS NULL
												 AND [answer_wording]		   IS NULL
												THEN 0
												ELSE CAST([Answer_value]   AS DECIMAL(38,2))
										  END
						,[answer_wording]
						,[answer_wording_std]
						,[Question_fk]
						,[Answer_fk]
						,[Notes]
             FROM        [GRSHRResults].[dbo].[NDLongNoAggreg]
/*|<-  CORRECTED set of coded data ===========================================================================================================================*/
              )  CSCD
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/***         1.2     Coded Long set of entered data (including fields ready to be loaded)                                                                    ***/
/***************************************************************************************************************************************************************/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IF                    OBJECT_ID('tempdb..#NLongCodedData')  IS NOT NULL
DROP TABLE                              [#NLongCodedData]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT * INTO                           [#NLongCodedData]
  FROM
/*=============================================================================================================================================================*/
(
/*=============================================================================================================================================================*/
SELECT 
/*|->  Final main CODED fields =====================================================================================================================================*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
           [entity]                         =  CASE
                                               WHEN    CD.[QA_std] LIKE 'GRI_11_%'      -- 01a to 17
                                                    OR CD.[QA_std] LIKE 'GRI_20_01x_%'  -- 01a to 10
                                                    OR CD.[QA_std] LIKE 'SHI_01_x_%'    -- 01a to 17
                                                                                                THEN  'R'
                                               WHEN    CD.[QA_std] LIKE 'GRI_19_[b-f]'
                                                    OR CD.[QA_std] LIKE 'SHI_0[1, 4, 5]_[b-f]'
                                                                                                THEN  'L'
                                                                                                ELSE  'C'
                                               END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--  >  Fields for PANS from the former coding-period --------------------------------------------------------------------------------------------------------*/
         , [Answer_pk]                      =  (DENSE_RANK()
                                                       OVER
                                                  (ORDER BY     CD.[QA_std]
                                                           ,    CD.[Answer_Value]
                                                           ,    CD.[Answer_Wording]    ) )
                                              + (SELECT MAX([Answer_pk])
                                                   FROM [forum].[dbo].[Pew_Answer_NoStd] )
         , [Answer_value_NoStd]             =  CD.[Answer_value]
         , [Answer_Wording]                 =  CASE
                                               WHEN
                                               /*  numeric variables including descriptions for non-zero values------------------------------------------------------------------------------------------*/
                                                   (    QT.[AnswerSet_num]      = 999999
                                                    AND CD.[Answer_value]       =      0
                                                    AND CD.[answer_wording]    IS NULL
                                                    AND CD.[QA_std]
                                                    IN  ( 'GRI_19_b','GRI_19_c','GRI_19_d','GRI_19_e','GRI_19_f'
                                                         ,'SHI_01_b','SHI_01_c','SHI_01_d','SHI_01_e','SHI_01_f'
                                                         ,'SHI_04_b','SHI_04_c','SHI_04_d','SHI_04_e','SHI_04_f'
                                                                    ,'SHI_05_c','SHI_05_d','SHI_05_e','SHI_05_f')  ) -- vars
                                               /*  numeric variables without any description ------------------------------------------------------------------*/
                                                OR (    QT.[AnswerSet_num]      = 999999
                                                    AND CD.[answer_wording]    IS NULL
                                                    AND CD.[QA_std]
                                                    IN  ( 'SHI_09_n','SHI_10_n','SHI_11_a_n','SHI_11_b_n'       )  ) -- vars
                                               /*   variables with no descriptions coded -----------------------------------*/
                                                OR (    CD.[QA_std]          IN (   'GRI_08_a'
                                                                                  , 'GRI_19'
                                                                                  , 'GRI_20_05_x'
                                                                                  , 'GRX_29_01'
                                                                                  , 'GRX_34_01'
                                                                                  , 'GRX_34_03'
                                                                                  , 'SHI_02_01'
                                                                                  , 'SHI_04'
                                                                                  , 'SHI_05'
                                                                                  , 'SHI_11'      )  )   -- vars
                                               /*   sets of variables with no descriptions coded ---------------------------*/
                                                OR (    CD.[QA_std]             like 'GRI_10_0%'     )   -- 1 to 3
                                                OR (    CD.[QA_std]             like 'GRI_11_%'      )   -- 01a to 17
                                                OR (    CD.[QA_std]             like 'GRI_20_01x_%'  )   -- 01a to 10
                                                OR (    CD.[QA_std]             like 'GRX_34_02_%'   )   -- a to g
                                                OR (    CD.[QA_std]             like 'GRX_35_0%'     )   -- 1 to 2
                                                OR (    CD.[QA_std]             like 'SHI_01_x_%'    )   -- 01a to 17
                                                OR (    CD.[QA_std]             like 'XSG_S_%'           -- 01 to 23
                                                    AND CD.[QA_std]         not like 'XSG_S_99_0%'   )   -- ~ not 01-6
                                               /*   variables with value cero ----------------------------------------------*/
                                                OR (    CD.[Answer_value]       =   0.00
                                                    AND CD.[answer_wording]    IS NULL
                                                    AND CD.[QA_std]
                                                    IN  (   'GRI_03','GRI_04','GRI_05','GRI_06','GRI_07','GRI_08'
                                                           ,'GRI_09','GRI_10','GRI_11','GRI_12','GRI_13','GRI_14'
                                                           ,'GRI_15','GRI_16','GRI_17','GRI_18'
                                                           ,'SHI_02','SHI_03','SHI_06','SHI_07','SHI_08','SHI_09'
                                                           ,'SHI_10','SHI_12','SHI_13'
                                                           ,'GRI_01_x','GRI_16_01'
                                                           ,'GRI_20_01','GRI_20_02','GRI_20_03_a','GRI_20_03_b'
                                                           ,'GRI_20_03_c','GRI_20_04','GRI_20_04_x','GRI_20_05'
                                                           ,'GRX_22_01','GRX_22_02','GRX_22_03','GRX_22_04'
                                                           ,'GRX_29_02','GRX_29_03','GRX_29_04','GRX_29_05'
                                                           ,'GRX_30','GRX_31','GRX_32','GRX_34_01'
                                                           ,'SHI_01_a','SHI_04_x01','SHI_11_a','SHI_11_b'       )  ) -- vars
                                               /*------------------------------------------------------------------------------------------------------------------*/
                                               THEN     'No description coded'
                                               ELSE     CD.[answer_wording]
                                               END
         , [Answer_Std_fk]                  =  AT.[Answer_Std_pk]
         , [Question_fk]                    =  QN.[Question_pk]
/*--  <  Fields for PANS from the former coding-period --------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
         , [Display]                        =  CASE
                                               WHEN    LEN(CD.[QA_std]) = 8
                                                    OR     CD.[QA_std]
                                                    IN  (   'GRI_20_01'  , 'GRI_20_02'
                                                          , 'GRI_20_03_a', 'GRI_20_03_b', 'GRI_20_03_c'
                                                          , 'GRI_20_04'  , 'GRI_20_05'                   )
                                                                                                          THEN  1
                                                                                                          ELSE  0
                                               END
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--  >  other fields -----------------------------------------------------------------------------------------------------------------------------------------*/
      , CD.[Nation_fk]
      , NL.[Locality_fk]
      , QR.[Religion_fk]
      , CD.[Region5]
      , CD.[Region6]
      , CD.[Ctry_EditorialName]
      , NL.[Locality]
      , QR.[Religion]
      , CD.[Question_Year]
      , CD.[QA_std]
      , CD.[QW_std]
      ,    [Answer_value]      =  CAST(CD.[Answer_value]   AS DECIMAL(38,2))
      , CD.[answer_wording_std]
      , CD.[Notes]
      , QT.[Question_Std_pk]
      , QT.[AnswerSet_num]
/*--  <  other fields -----------------------------------------------------------------------------------------------------------------------------------------*/
  FROM
/* TABLES section begins ======================================================================================================================================*/
/*|->  Clean set of coded data ================================================================================================================================*/
(
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 SELECT *
   FROM
/*--  >  Set of data from the former coding-period ------------------------------------------------------------------------------------------------------------*/
--      [GRSHRResults].[dbo].[NDLongNoAggreg]
                             [#NDLongNoAggreg]   -----  when data has been corrected
/*--  <  Set of data from the former coding-period ------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--  >  Filters ----------------------------------------------------------------------------------------------------------------------------------------------*/
WHERE
/*--  >>    aggregated Q/A ------------------------------------------------------------------------------------------------------------------------------------*/
            [QA_std]  NOT IN (  
                                 'SHI_01_summary_b'                ---- 
                               , 'GRI_19_x'                        ---- 
                               , 'SHI_01_x'                        ---- 
                               , 'SHI_04_x'                        ---- 
                               , 'SHI_05_x'                        ---- 
                               , 'GRX_34_02'                       ---- SHOULD BE DROPPED FROM DATABASE IN ACCES-NOT LINKED & added as StdQ
                               , 'GRX_35'                          ---- SHOULD BE DROPPED FROM DATABASE IN ACCES-NOT LINKED
                             )
/*--  <<    aggregated Q/A ------------------------------------------------------------------------------------------------------------------------------------*/
/*--  >>    null/empty extra sources --------------------------------------------------------------------------------------------------------------------------*/
      AND   NOT (
                       QA_std LIKE 'XSG_S_99_0%'
                  AND  QW_std LIKE '%] used for coding government restrictions and social hostilities on religion?'
                  AND  Answer_value        IS NULL
                  AND  answer_wording      IS NULL
                  AND  answer_wording_std  IS NULL
                )
/*--  <<    null/empty extra sources --------------------------------------------------------------------------------------------------------------------------*/
/*--  >>    filters and former-year-references have been already excluded -------------------------------------------------------------------------------------*/
--	 AND    [QA_std]  NOT IN (  
--	                             'SHI_05_filter'
--	                           , 'GRI_02_filter'
--	                           , 'XSG_S_99_filter'
--	                           , 'SHI_04_filter'
--	                           , 'GRI_01_filter'
--	                           , 'GRI_19_filter'
--	                           , 'GRI_02_yBe'
--	                           , 'GRI_01_yBe'  
--	                         )
/*--  <<    filters and former-year-references have been already excluded -------------------------------------------------------------------------------------*/
/*--  <  Filters ----------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
)                                                  CD
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*|<-  Clean set of coded data ================================================================================================================================*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 LEFT
 JOIN 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*|->  Set of =================================================================================================================================================*/
       [vr___0______QuestnReligionTOOL]            QR
   ON 
      CD.[QA_std]
    = QR.[QA_std]
/*|<-  Set of =================================================================================================================================================*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 INNER
 JOIN 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*|->  Set of =================================================================================================================================================*/
       [vr___0______NationLocalityTOOL]            NL
   ON 
      CD.[Nation_fk]
    = NL.[Nation_fk]
/*|<-  Set of =================================================================================================================================================*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 INNER
 JOIN 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*|->  Set of =================================================================================================================================================*/
       [forum].[dbo].[Pew_Question_Std]            QT
   ON 
      CD.[QA_std]
    = QT.[Question_abbreviation_std]
/*|<-  Set of =================================================================================================================================================*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 INNER
 JOIN 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*|->  Set of =================================================================================================================================================*/
       [forum].[dbo].[Pew_Answer_Std]              AT
   ON 
      QT.[AnswerSet_num]
    = AT.[AnswerSet_number]
  AND
      CASE WHEN QT.[AnswerSet_num] = 999999
            AND CD.[Answer_value]  > 1      THEN 1     
           ELSE CD.[Answer_value]
      END
    = AT.[Answer_value_std]
/*|<-  Set of =================================================================================================================================================*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
 INNER
 JOIN 
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*|->  Set of =================================================================================================================================================*/
       [forum].[dbo].[Pew_Question_NoStd]            QN
   ON 
      CD.[QA_std]
    = QN.[Question_abbreviation]
  AND
      CD.[Question_Year]
    = QN.[Question_Year]
/*|<-  Set of NoStd Questions =================================================================================================================================*/
/* TABLES section ends ========================================================================================================================================*/
/*|<-  Final main CODED fields =====================================================================================================================================*/
/*=============================================================================================================================================================*/
) source_for_loading_data
/*=============================================================================================================================================================*/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>         When NoStd Q's were not loaded before....                                                                                   <<<<<     ***/
/***                   This procedure works BEFORE matcing NosStd Q's by year                                                                                ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
--	/***********************************************************************************************************************************************************/
--	/*****     BackUp  current Table                                                                                                                       *****/
--	/***********************************************************************************************************************************************************/
--	  DECLARE @CrDt    varchar( 8)
--	  SET     @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))
--	/*---------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	EXEC ( ' SELECT *
--					INTO  [_bk_forum].[dbo].[Pew_Question_NoStd_' + @CrDt + ']
--					FROM      [forum].[dbo].[Pew_Question_NoStd]'               )
--	/***********************************************************************************************************************************************************/
--	INSERT INTO               [forum].[dbo].[Pew_Question_NoStd]                                                    /* insert statement into target in main DB */
--	/*---------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	SELECT                                                                                                          /* select statement...                     */
--	/*---------------------------------------------------------------------------------------------------------------------------------------------------------*/
--		   [Question_pk]           =   ROW_NUMBER()                                                                 /* number all rows                         */
--									   OVER( ORDER BY [Question_abbreviation])                                      /* sorted by NoStd Question Abbreviaton    */
--									+ (SELECT     MAX([Question_pk])                                                /* add currently max pk                    */
--										FROM [forum]..[Pew_Question_NoStd])                                         /* from NoStdQuestions                     */
--	/*---------------------------------------------------------------------------------------------------------------------------------------------------------*/
--		  ,[Question_abbreviation]
--		  ,[Question_wording]
--		  ,[Question_Year]
--		  ,[Notes]
--		  ,[Display]
--		  ,[Data_source_fk]
--		  ,[Question_Std_fk]
--	FROM
--	(
--	 SELECT
--		   DISTINCT
--		   [Question_abbreviation]      = [QA_std]
--		  ,[Question_wording]           = [QW_std]
--		  ,[Question_Year]
--		  ,[Notes]
--		  ,[Display]                    = 0
--		  ,[Data_source_fk]             = CASE WHEN [QA_std] like 'GRX_34_%' THEN 25
--											   WHEN [QA_std] like 'GRX_35_%' THEN 26
--											   WHEN [QA_std] like 'SHI_09_%' THEN 30
--											   WHEN [QA_std] like 'SHI_10_%' THEN 30
--											   WHEN [QA_std] like 'SHI_11_%' THEN 30
--																			 ELSE [Data_source_fk] END
--		  ,[Question_Std_fk]            = [Question_Std_pk]
--	 FROM  [#NLongCodedData]
--	) distinctquestions
--	/*---------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	/***********************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/










/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***         2. Code to load coded data into the database                                                                               ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
/***         2.1     BACKUP                                                                                                                             ***/
/***************************************************************************************************************************************************************/
  DECLARE  @CrDt    varchar( 8)
  DECLARE  @TofI    varchar(50)
  SET      @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))
  DECLARE  MyCursor
  CURSOR FOR      SELECT 'Pew_Answer_NoStd'
            UNION SELECT 'Pew_Locality_Answer'
            UNION SELECT 'Pew_Nation_Answer'
            UNION SELECT 'Pew_Nation_Religion_Answer'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
   OPEN    MyCursor
	FETCH  NEXT
	FROM   MyCursor
	INTO   @TofI
	WHILE  @@FETCH_STATUS = 0
	BEGIN
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--           EXEC ( ' SELECT *
--                    INTO   [_bk_forum].[dbo].[' + @TofI + ']
--                    FROM       [forum].[dbo].[' + @TofI + ']' )
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
	FETCH  NEXT
	FROM   MyCursor
	INTO   @TofI
    END
    CLOSE  MyCursor
DEALLOCATE MyCursor
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***         2.2         [Pew_Answer_NoStd]                                                                                                                      ***/
/***************************************************************************************************************************************************************/
--	INSERT INTO [forum]..[Pew_Answer_NoStd]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
           DISTINCT
           [Answer_pk]
         , [Answer_value_NoStd]
         , [Answer_Wording]
         , [Answer_Std_fk]
         , [Question_fk]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FROM   [#NLongCodedData]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/***         2.3         [Pew_Nation_Answer]                                                                                                                   ***/
/***************************************************************************************************************************************************************/
--	INSERT INTO [forum]..[Pew_Nation_Answer]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
/*--  >  Fields for PNA from the former coding-period ---------------------------------------------------------------------------------------------------------*/
       [Nation_answer_pk]    = ROW_NUMBER()
                                       OVER
                                  (ORDER BY   [Nation_fk]
                                            , [QA_Std]              )
                              +   (SELECT MAX([Nation_answer_pk]    )
                                FROM [forum]..[Pew_Nation_Answer]   )
      ,[Nation_fk]
      ,[Answer_fk]           = [Answer_pk]
      ,[display]
/*--  <  Fields for PNA from the former coding-period ---------------------------------------------------------------------------------------------------------*/
FROM   [#NLongCodedData]
WHERE  [entity]              = 'C'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/***         2.4         [Pew_Locality_Answer]                                                                                                                   ***/
/***************************************************************************************************************************************************************/
--	INSERT INTO [forum]..[Pew_Locality_Answer]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
/*--  >  Fields for PLA from the former coding-period ---------------------------------------------------------------------------------------------------------*/
       [Locality_answer_pk]  = ROW_NUMBER()
                                       OVER
                                  (ORDER BY   [Nation_fk]
                                            , [QA_Std]              )
                              +   (SELECT MAX([Locality_answer_pk])
                                FROM [forum]..[Pew_Locality_Answer] )
      ,[Locality_fk]
      ,[Answer_fk]           = [Answer_pk]
      ,[display]
/*--  <  Fields for PLA from the former coding-period ---------------------------------------------------------------------------------------------------------*/
FROM   [#NLongCodedData]
WHERE  [entity]              = 'L'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
/***         2.5         [Pew_Nation_Religion_Answer]                                                                                                            ***/
/***************************************************************************************************************************************************************/
--	INSERT INTO [forum]..[Pew_Nation_Religion_Answer]
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
SELECT
/*--  >  Fields for PNRA from the former coding-period --------------------------------------------------------------------------------------------------------*/
       [Nation_religion_answer_pk] = ROW_NUMBER()
                                             OVER
                                        (ORDER BY   [Nation_fk]
                                                  , [QA_Std]                      )
                                    +   (SELECT MAX([Nation_religion_answer_pk])
                                      FROM [forum]..[Pew_Nation_Religion_Answer]  )  

      ,[Nation_fk]
      ,[Religion_group_fk]   = [Religion_fk]
      ,[Answer_fk]           = [Answer_pk]
      ,[display]
/*--  <  Fields for PLA from the former coding-period ---------------------------------------------------------------------------------------------------------*/
FROM   [#NLongCodedData]
WHERE  [entity]              = 'R'
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/***************************************************************************************************************************************************************/
--		C   21,369
--		L    3,762
--		R    8,910
--          34,041
/***************************************************************************************************************************************************************/
