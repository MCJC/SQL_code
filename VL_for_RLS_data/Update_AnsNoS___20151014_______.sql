USE [RLS]
GO
/****************************************************************************************************************************************/
/*****                                                     BackUp current Table                                                     *****/
/****************************************************************************************************************************************/
/****************************************************************************************************************************************/
  DECLARE @CrDt    varchar( 8)                                                 /* declare variable to store current date                */
  SET     @CrDt = (CONVERT(VARCHAR(8),GETDATE(),112))                          /* store date in format YYYYMMDD                         */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
EXEC                                                                           /* exec statement to run string s script                 */
     ( ' SELECT * INTO [_bk_forum].[dbo].[Pew_Answer_NoStd_' + @CrDt + 'RLS]'  /* select into backup                                    */
         + '      FROM                   [Pew_Answer_NoStd]'               )   /* select into backup from current table                 */
/****************************************************************************************************************************************/



/****************************************************************************************************************************************/
/*****                                                          +    A D D                                                          *****/
/*****                                     notice:  this adds answers to a set previously added                                     *****/
/****************************************************************************************************************************************/
WITH NSV AS                                                                                  /* New Vals -common table expression       */
(                                                                                            /* > Sub-Set of Values begins...           */
        SELECT V = 18 , W = 'Baltimore'  , k = 10554                                         /* - answer value & wording...             */
  UNION SELECT V = 19 , W = 'Pittsburgh' , k = 10555
  UNION SELECT V = 20 , W = 'Providence' , k = 10556
  UNION SELECT V = 21 , W = 'St. Louis'  , k = 10557
  UNION SELECT V = 22 , W = 'Tampa'      , k = 10558              )                          /* <   Set of Values ends!                 */
/****************************************************************************************************************************************/
/*--------------------------------------------------------------------------------------------------------------------------------------*/
INSERT INTO                                                                                  /* insert statement                        */
               [Pew_Answer_NoStd]                                                            /* table in working database               */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
SELECT                                                                                       /* select statement...                     */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
       [Answer_pk]              =    ROW_NUMBER ()                                           /* number all rows                         */
                                           OVER (ORDER BY [V] )                              /* sorted by answer value                  */
                                  + (SELECT MAX([Answer_pk])                                 /* add currently max pk                    */
                                       FROM     [Pew_Answer_NoStd])                          /* from No-Std Answers                     */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
      ,[Answer_value_NoStd]     =   [V]                                                      /* conventional answer no-standard value   */
      ,[Answer_Wording]         =   [W]                                                      /* conventional answer no-standard wording */
      ,[Answer_Std_fk]          =   [k]                                                      /* conventional & known PK for std answer  */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
      ,[Question_fk]            =   1                                                        /* conventional & known PK for no-std Q's  */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
FROM    [NSV]                                                     AS SetVs                   /* main reference to CTE (New Set of Vals) */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
/****************************************************************************************************************************************/



/****************************************************************************************************************************************/
SELECT * FROM [Pew_Answer_NoStd] WHERE [Question_fk]      =  1                               /* check results in modified table         */
/*--------------------------------------------------------------------------------------------------------------------------------------*/
SELECT * FROM [Pew_Answer]       WHERE [AnswerSet_num]    = 51                               /* check results in updated view           */
/****************************************************************************************************************************************/
