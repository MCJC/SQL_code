/* ++> create_vi22_vi_QuestionMetadata_Svy&Restr.sql <++ */
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [forum]..[vi_QuestionMetadata_Svy&Restr]                                               <<<<<     ***/
/***             NOTE:  This is based on two auxiliary fixed tables hosted at the default place: [forum_ResAnal]                                             ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
USE [forum]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
              [dbo].[vi_QuestionMetadata_Svy&Restr]
AS
/***************************************************************************************************************************************************************/
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        DISTINCT
        [QMv_row] = ROW_NUMBER()OVER(ORDER BY
                                                [Topic_fk]
                                               ,[Question_abbreviation_std]
                                                                            )
      , *
FROM
/***************************************************************************************************************************************************************/
(
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
        DISTINCT
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
       [Topic_fk]
      ,[Topic]
      ,[SubTopic]
      ,[Question_Std_fk]              = [Question_Std_fk]
      ,[Question_abbreviation_std]
      ,[FootNote_by_Topic&Question]   = [Footnote]
      ,[About_the_Data_link]          = [About_the_Data_link]
      ,[RelatedPewResearchReports]    = [Reports]
      ,[Sources_by_Question]          = REPLACE([Q_Sources],': Global Restrictions on Religion studies)  (',', ')
      ,[Question_short_wording_std]
      ,[DetailedWording_by_Question]  = CASE
                                             WHEN [Question_abbreviation_std] LIKE 'SVY%'
                                               --OR [Q_Years]                   IS NULL
                                             THEN [Q_Wording]
                                             ELSE   '('
                                                  + [Q_Years]
                                                  + ': '
                                                  + [Question_short_wording_std]
                                                  + ')'
                                        END
      ,[Notes_by_Question]            = [Q_Notes]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
FROM
       [forum_ResAnal].[dbo].[vi_Topic&Question&Related_Displayable]    TL
      ,[forum_ResAnal].[dbo].[vi_QMetadata_Wording&Note&Source]         QL
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 WHERE
           [Question_Std_fk]
         = [Q_Std_fk]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
)  mytable
/***************************************************************************************************************************************************************/
go
