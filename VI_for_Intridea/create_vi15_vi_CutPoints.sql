/* ++> create_vi15_vi_CutPoints.sql <++ */
/***************************************************************************************************************************************************************/
/***                                                                                                                                                         ***/
/***     >>>>>   This is the script used to create the view [forum]..[vi_CutPoints]                                                                <<<<<     ***/
/***                                                                                                                                                         ***/
/***************************************************************************************************************************************************************/
USE [forum]
GO
/***************************************************************************************************************************************************************/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/***************************************************************************************************************************************************************/
ALTER  VIEW
               [dbo].[vi_CutPoints]
AS
/***************************************************************************************************************************************************************/
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
          [CPv_row]
          =  ROW_NUMBER()
             OVER(ORDER BY
                            Field_name
                          , Field_year      )
       , Field_fk      =    Field_pk
       , Index_Name    =    Field_Name
       , Index_Year    =    Field_year
       , Index_Type
       , Index_Level
       , Index_Level_Point
       , CutPoint
       , Data_source_fk
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
--select *
FROM     [Pew_Field] AS PF
--where
--[Field_type] IN ( 'GRI', 'SHI', 'GFI')

-----------------------------------------------------------------------------------------------------------------------------------------------------------------
JOIN 
		(
		SELECT
			   Index_Type         = [Field_type]
			  ,Index_Level        = [Level] 
			  ,Index_Level_Point  = [Point]
			  ,CutPoint           = [CutPoint]
		  FROM [Pew_Index_Cut_Points]
			 , [Pew_Field]
		WHERE
			   [Field_pk]
			  =[Field_fk]
		  AND
---------------Notice that table [Pew_Index_Cut_Points] only has 4 years: wshould it be redesigned?
			   [Field_fk] IN (15, 16, 48)    -- limiting to these fields makes possible apply same assumption to all years
		) AS Pew_Fixed_Index_Cut_Points
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
   ON   [Index_Type]
      = [Field_type]
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
/***************************************************************************************************************************************************************/
GO